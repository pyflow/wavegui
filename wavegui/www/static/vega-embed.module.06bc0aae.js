import{h as Si,i as ae,a as P,w as nd,s as Gi,$ as B,t as ci,b as ue,c as Hi,l as Fh,W as _h,d as j,e as $h,f as re,m as qs,g as qi,j as jh,v as Dh}from"./vega.module.7cb1a248.js";import"./vendor.2f0b4f78.js";/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var Nh=globalThis&&globalThis.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var s in r)r.hasOwnProperty(s)&&(i[s]=r[s])},e(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}}(),Th=Object.prototype.hasOwnProperty;function wa(e,t){return Th.call(e,t)}function Sa(e){if(Array.isArray(e)){for(var n=new Array(e.length),t=0;t<n.length;t++)n[t]=""+t;return n}if(Object.keys)return Object.keys(e);var n=[];for(var i in e)wa(e,i)&&n.push(i);return n}function Ue(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Ca(e){for(var t=0,n=e.length,i;t<n;){if(i=e.charCodeAt(t),i>=48&&i<=57){t++;continue}return!1}return!0}function Hn(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function id(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Fa(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Fa(e[t]))return!0}else if(typeof e=="object"){for(var i=Sa(e),r=i.length,t=0;t<r;t++)if(Fa(e[i[t]]))return!0}}return!1}function Kl(e,t){var n=[e];for(var i in t){var r=typeof t[i]=="object"?JSON.stringify(t[i],null,2):t[i];typeof r!="undefined"&&n.push(i+": "+r)}return n.join(`
`)}var rd=function(e){Nh(t,e);function t(n,i,r,s,o){var a=this.constructor,u=e.call(this,Kl(n,{name:i,index:r,operation:s,tree:o}))||this;return u.name=i,u.index=r,u.operation=s,u.tree=o,Object.setPrototypeOf(u,a.prototype),u.message=Kl(n,{name:i,index:r,operation:s,tree:o}),u}return t}(Error),ne=rd,kh=Ue,Ci={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var i=e[t];return delete e[t],{newDocument:n,removed:i}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:function(e,t,n){var i=As(n,this.path);i&&(i=Ue(i));var r=Yn(n,{op:"remove",path:this.from}).removed;return Yn(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(e,t,n){var i=As(n,this.from);return Yn(n,{op:"add",path:this.path,value:Ue(i)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Ar(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},Ph={add:function(e,t,n){return Ca(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var i=e.splice(t,1);return{newDocument:n,removed:i[0]}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:Ci.move,copy:Ci.copy,test:Ci.test,_get:Ci._get};function As(e,t){if(t=="")return e;var n={op:"_get",path:t};return Yn(e,n),n.value}function Yn(e,t,n,i,r,s){if(n===void 0&&(n=!1),i===void 0&&(i=!0),r===void 0&&(r=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):ws(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=As(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Ar(e,t.value),o.test===!1)throw new ne("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new ne("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{i||(e=Ue(e));var a=t.path||"",u=a.split("/"),l=e,c=1,f=u.length,d=void 0,p=void 0,g=void 0;for(typeof n=="function"?g=n:g=ws;;){if(p=u[c],r&&p=="__proto__")throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[p]===void 0?d=u.slice(0,c).join("/"):c==f-1&&(d=t.path),d!==void 0&&g(t,0,e,d)),c++,Array.isArray(l)){if(p==="-")p=l.length;else{if(n&&!Ca(p))throw new ne("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);Ca(p)&&(p=~~p)}if(c>=f){if(n&&t.op==="add"&&p>l.length)throw new ne("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=Ph[t.op].call(t,l,p,e);if(o.test===!1)throw new ne("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(p&&p.indexOf("~")!=-1&&(p=id(p)),c>=f){var o=Ci[t.op].call(t,l,p,e);if(o.test===!1)throw new ne("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}l=l[p]}}}function Vs(e,t,n,i,r){if(i===void 0&&(i=!0),r===void 0&&(r=!0),n&&!Array.isArray(t))throw new ne("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=Ue(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=Yn(e,t[o],n,!0,r,o),e=s[o].newDocument;return s.newDocument=e,s}function Ih(e,t,n){var i=Yn(e,t);if(i.test===!1)throw new ne("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument}function ws(e,t,n,i){if(typeof e!="object"||e===null||Array.isArray(e))throw new ne("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Ci[e.op]){if(typeof e.path!="string")throw new ne("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new ne('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new ne("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new ne("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Fa(e.value))throw new ne("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var r=e.path.split("/").length,s=i.split("/").length;if(r!==s+1&&r!==s)throw new ne("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==i)throw new ne("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=sd([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new ne("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new ne("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function sd(e,t,n){try{if(!Array.isArray(e))throw new ne("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Vs(Ue(t),Ue(e),n||!0);else{n=n||ws;for(var i=0;i<e.length;i++)n(e[i],i,t,void 0)}}catch(r){if(r instanceof ne)return r;throw r}}function Ar(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),i=Array.isArray(t),r,s,o;if(n&&i){if(s=e.length,s!=t.length)return!1;for(r=s;r--!==0;)if(!Ar(e[r],t[r]))return!1;return!0}if(n!=i)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(r=s;r--!==0;)if(!t.hasOwnProperty(a[r]))return!1;for(r=s;r--!==0;)if(o=a[r],!Ar(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var Rh=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",JsonPatchError:ne,deepClone:kh,getValueByPointer:As,applyOperation:Yn,applyPatch:Vs,applyReducer:Ih,validator:ws,validate:sd,_areEquals:Ar});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var uu=new WeakMap,Lh=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),Bh=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function zh(e){return uu.get(e)}function Mh(e,t){return e.observers.get(t)}function Uh(e,t){e.observers.delete(t.callback)}function Wh(e,t){t.unobserve()}function Gh(e,t){var n=[],i,r=zh(e);if(!r)r=new Lh(e),uu.set(e,r);else{var s=Mh(r,t);i=s&&s.observer}if(i)return i;if(i={},r.value=Ue(e),t){i.callback=t,i.next=null;var o=function(){_a(i)},a=function(){clearTimeout(i.next),i.next=setTimeout(o)};typeof window!="undefined"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return i.patches=n,i.object=e,i.unobserve=function(){_a(i),clearTimeout(i.next),Uh(r,i),typeof window!="undefined"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},r.observers.set(t,new Bh(t,i)),i}function _a(e,t){t===void 0&&(t=!1);var n=uu.get(e.object);lu(n.value,e.object,e.patches,"",t),e.patches.length&&Vs(n.value,e.patches);var i=e.patches;return i.length>0&&(e.patches=[],e.callback&&e.callback(i)),i}function lu(e,t,n,i,r){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=Sa(t),o=Sa(e),a=!1,u=o.length-1;u>=0;u--){var l=o[u],c=e[l];if(wa(t,l)&&!(t[l]===void 0&&c!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof c=="object"&&c!=null&&typeof f=="object"&&f!=null?lu(c,f,n,i+"/"+Hn(l),r):c!==f&&(r&&n.push({op:"test",path:i+"/"+Hn(l),value:Ue(c)}),n.push({op:"replace",path:i+"/"+Hn(l),value:Ue(f)}))}else Array.isArray(e)===Array.isArray(t)?(r&&n.push({op:"test",path:i+"/"+Hn(l),value:Ue(c)}),n.push({op:"remove",path:i+"/"+Hn(l)}),a=!0):(r&&n.push({op:"test",path:i,value:e}),n.push({op:"replace",path:i,value:t}))}if(!(!a&&s.length==o.length))for(var u=0;u<s.length;u++){var l=s[u];!wa(e,l)&&t[l]!==void 0&&n.push({op:"add",path:i+"/"+Hn(l),value:Ue(t[l])})}}}function Hh(e,t,n){n===void 0&&(n=!1);var i=[];return lu(e,t,i,"",n),i}var qh=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",unobserve:Wh,observe:Gh,generate:_a,compare:Hh});Object.assign({},Rh,qh,{JsonPatchError:rd,deepClone:Ue,escapePathComponent:Hn,unescapePathComponent:id});var Vh=/("(?:[^\\"]|\\.)*")|[:,]/g,Jo=function(t,n){var i,r,s;return n=n||{},i=JSON.stringify([1],void 0,n.indent===void 0?2:n.indent).slice(2,-3),r=i===""?1/0:n.maxLength===void 0?80:n.maxLength,s=n.replacer,function o(a,u,l){var c,f,d,p,g,m,h,x,v,S,F,E;if(a&&typeof a.toJSON=="function"&&(a=a.toJSON()),F=JSON.stringify(a,s),F===void 0)return F;if(h=r-u.length-l,F.length<=h&&(v=F.replace(Vh,function($,A){return A||$+" "}),v.length<=h))return v;if(s!=null&&(a=JSON.parse(F),s=void 0),typeof a=="object"&&a!==null){if(x=u+i,d=[],f=0,Array.isArray(a))for(S="[",c="]",h=a.length;f<h;f++)d.push(o(a[f],x,f===h-1?0:1)||"null");else for(S="{",c="}",m=Object.keys(a),h=m.length;f<h;f++)p=m[f],g=JSON.stringify(p)+": ",E=o(a[p],x,g.length+(f===h-1?0:1)),E!==void 0&&d.push(g+E);if(d.length>0)return[S,i+d.join(`,
`+x),c].join(`
`+u)}return F}(t,"",0)},yn={exports:{}};const Xh="2.0.0",Yh=256,Jh=Number.MAX_SAFE_INTEGER||9007199254740991,Kh=16;var Xs={SEMVER_SPEC_VERSION:Xh,MAX_LENGTH:Yh,MAX_SAFE_INTEGER:Jh,MAX_SAFE_COMPONENT_LENGTH:Kh};const Qh=typeof process=="object"&&process.env&&{}.NODE_DEBUG&&/\bsemver\b/i.test({}.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};var Ys=Qh;(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n}=Xs,i=Ys;t=e.exports={};const r=t.re=[],s=t.src=[],o=t.t={};let a=0;const u=(l,c,f)=>{const d=a++;i(d,c),o[l]=d,s[d]=c,r[d]=new RegExp(c,f?"g":void 0)};u("NUMERICIDENTIFIER","0|[1-9]\\d*"),u("NUMERICIDENTIFIERLOOSE","[0-9]+"),u("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),u("MAINVERSION",`(${s[o.NUMERICIDENTIFIER]})\\.(${s[o.NUMERICIDENTIFIER]})\\.(${s[o.NUMERICIDENTIFIER]})`),u("MAINVERSIONLOOSE",`(${s[o.NUMERICIDENTIFIERLOOSE]})\\.(${s[o.NUMERICIDENTIFIERLOOSE]})\\.(${s[o.NUMERICIDENTIFIERLOOSE]})`),u("PRERELEASEIDENTIFIER",`(?:${s[o.NUMERICIDENTIFIER]}|${s[o.NONNUMERICIDENTIFIER]})`),u("PRERELEASEIDENTIFIERLOOSE",`(?:${s[o.NUMERICIDENTIFIERLOOSE]}|${s[o.NONNUMERICIDENTIFIER]})`),u("PRERELEASE",`(?:-(${s[o.PRERELEASEIDENTIFIER]}(?:\\.${s[o.PRERELEASEIDENTIFIER]})*))`),u("PRERELEASELOOSE",`(?:-?(${s[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${s[o.PRERELEASEIDENTIFIERLOOSE]})*))`),u("BUILDIDENTIFIER","[0-9A-Za-z-]+"),u("BUILD",`(?:\\+(${s[o.BUILDIDENTIFIER]}(?:\\.${s[o.BUILDIDENTIFIER]})*))`),u("FULLPLAIN",`v?${s[o.MAINVERSION]}${s[o.PRERELEASE]}?${s[o.BUILD]}?`),u("FULL",`^${s[o.FULLPLAIN]}$`),u("LOOSEPLAIN",`[v=\\s]*${s[o.MAINVERSIONLOOSE]}${s[o.PRERELEASELOOSE]}?${s[o.BUILD]}?`),u("LOOSE",`^${s[o.LOOSEPLAIN]}$`),u("GTLT","((?:<|>)?=?)"),u("XRANGEIDENTIFIERLOOSE",`${s[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),u("XRANGEIDENTIFIER",`${s[o.NUMERICIDENTIFIER]}|x|X|\\*`),u("XRANGEPLAIN",`[v=\\s]*(${s[o.XRANGEIDENTIFIER]})(?:\\.(${s[o.XRANGEIDENTIFIER]})(?:\\.(${s[o.XRANGEIDENTIFIER]})(?:${s[o.PRERELEASE]})?${s[o.BUILD]}?)?)?`),u("XRANGEPLAINLOOSE",`[v=\\s]*(${s[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${s[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${s[o.XRANGEIDENTIFIERLOOSE]})(?:${s[o.PRERELEASELOOSE]})?${s[o.BUILD]}?)?)?`),u("XRANGE",`^${s[o.GTLT]}\\s*${s[o.XRANGEPLAIN]}$`),u("XRANGELOOSE",`^${s[o.GTLT]}\\s*${s[o.XRANGEPLAINLOOSE]}$`),u("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),u("COERCERTL",s[o.COERCE],!0),u("LONETILDE","(?:~>?)"),u("TILDETRIM",`(\\s*)${s[o.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",u("TILDE",`^${s[o.LONETILDE]}${s[o.XRANGEPLAIN]}$`),u("TILDELOOSE",`^${s[o.LONETILDE]}${s[o.XRANGEPLAINLOOSE]}$`),u("LONECARET","(?:\\^)"),u("CARETTRIM",`(\\s*)${s[o.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",u("CARET",`^${s[o.LONECARET]}${s[o.XRANGEPLAIN]}$`),u("CARETLOOSE",`^${s[o.LONECARET]}${s[o.XRANGEPLAINLOOSE]}$`),u("COMPARATORLOOSE",`^${s[o.GTLT]}\\s*(${s[o.LOOSEPLAIN]})$|^$`),u("COMPARATOR",`^${s[o.GTLT]}\\s*(${s[o.FULLPLAIN]})$|^$`),u("COMPARATORTRIM",`(\\s*)${s[o.GTLT]}\\s*(${s[o.LOOSEPLAIN]}|${s[o.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",u("HYPHENRANGE",`^\\s*(${s[o.XRANGEPLAIN]})\\s+-\\s+(${s[o.XRANGEPLAIN]})\\s*$`),u("HYPHENRANGELOOSE",`^\\s*(${s[o.XRANGEPLAINLOOSE]})\\s+-\\s+(${s[o.XRANGEPLAINLOOSE]})\\s*$`),u("STAR","(<|>)?=?\\s*\\*"),u("GTE0","^\\s*>=\\s*0.0.0\\s*$"),u("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")})(yn,yn.exports);const Zh=["includePrerelease","loose","rtl"],em=e=>e?typeof e!="object"?{loose:!0}:Zh.filter(t=>e[t]).reduce((t,n)=>(t[n]=!0,t),{}):{};var Js=em;const Ql=/^[0-9]+$/,od=(e,t)=>{const n=Ql.test(e),i=Ql.test(t);return n&&i&&(e=+e,t=+t),e===t?0:n&&!i?-1:i&&!n?1:e<t?-1:1},tm=(e,t)=>od(t,e);var $a={compareIdentifiers:od,rcompareIdentifiers:tm};const ns=Ys,{MAX_LENGTH:Zl,MAX_SAFE_INTEGER:is}=Xs,{re:ec,t:tc}=yn.exports,nm=Js,{compareIdentifiers:or}=$a;class tt{constructor(t,n){if(n=nm(n),t instanceof tt){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid Version: ${t}`);if(t.length>Zl)throw new TypeError(`version is longer than ${Zl} characters`);ns("SemVer",t,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;const i=t.trim().match(n.loose?ec[tc.LOOSE]:ec[tc.FULL]);if(!i)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>is||this.major<0)throw new TypeError("Invalid major version");if(this.minor>is||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>is||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(r=>{if(/^[0-9]+$/.test(r)){const s=+r;if(s>=0&&s<is)return s}return r}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(ns("SemVer.compare",this.version,this.options,t),!(t instanceof tt)){if(typeof t=="string"&&t===this.version)return 0;t=new tt(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof tt||(t=new tt(t,this.options)),or(this.major,t.major)||or(this.minor,t.minor)||or(this.patch,t.patch)}comparePre(t){if(t instanceof tt||(t=new tt(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let n=0;do{const i=this.prerelease[n],r=t.prerelease[n];if(ns("prerelease compare",n,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return or(i,r)}while(++n)}compareBuild(t){t instanceof tt||(t=new tt(t,this.options));let n=0;do{const i=this.build[n],r=t.build[n];if(ns("prerelease compare",n,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return or(i,r)}while(++n)}inc(t,n){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n),this.inc("pre",n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n),this.inc("pre",n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);i===-1&&this.prerelease.push(0)}n&&(this.prerelease[0]===n?isNaN(this.prerelease[1])&&(this.prerelease=[n,0]):this.prerelease=[n,0]);break;default:throw new Error(`invalid increment argument: ${t}`)}return this.format(),this.raw=this.version,this}}var $e=tt;const{MAX_LENGTH:im}=Xs,{re:nc,t:ic}=yn.exports,rc=$e,rm=Js,sm=(e,t)=>{if(t=rm(t),e instanceof rc)return e;if(typeof e!="string"||e.length>im||!(t.loose?nc[ic.LOOSE]:nc[ic.FULL]).test(e))return null;try{return new rc(e,t)}catch{return null}};var Vi=sm;const om=Vi,am=(e,t)=>{const n=om(e,t);return n?n.version:null};var um=am;const lm=Vi,cm=(e,t)=>{const n=lm(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};var fm=cm;const dm=$e,pm=(e,t,n,i)=>{typeof n=="string"&&(i=n,n=void 0);try{return new dm(e,n).inc(t,i).version}catch{return null}};var gm=pm;const sc=$e,hm=(e,t,n)=>new sc(e,n).compare(new sc(t,n));var lt=hm;const mm=lt,bm=(e,t,n)=>mm(e,t,n)===0;var cu=bm;const oc=Vi,ym=cu,vm=(e,t)=>{if(ym(e,t))return null;{const n=oc(e),i=oc(t),r=n.prerelease.length||i.prerelease.length,s=r?"pre":"",o=r?"prerelease":"";for(const a in n)if((a==="major"||a==="minor"||a==="patch")&&n[a]!==i[a])return s+a;return o}};var Om=vm;const Em=$e,xm=(e,t)=>new Em(e,t).major;var Am=xm;const wm=$e,Sm=(e,t)=>new wm(e,t).minor;var Cm=Sm;const Fm=$e,_m=(e,t)=>new Fm(e,t).patch;var $m=_m;const jm=Vi,Dm=(e,t)=>{const n=jm(e,t);return n&&n.prerelease.length?n.prerelease:null};var Nm=Dm;const Tm=lt,km=(e,t,n)=>Tm(t,e,n);var Pm=km;const Im=lt,Rm=(e,t)=>Im(e,t,!0);var Lm=Rm;const ac=$e,Bm=(e,t,n)=>{const i=new ac(e,n),r=new ac(t,n);return i.compare(r)||i.compareBuild(r)};var fu=Bm;const zm=fu,Mm=(e,t)=>e.sort((n,i)=>zm(n,i,t));var Um=Mm;const Wm=fu,Gm=(e,t)=>e.sort((n,i)=>Wm(i,n,t));var Hm=Gm;const qm=lt,Vm=(e,t,n)=>qm(e,t,n)>0;var Ks=Vm;const Xm=lt,Ym=(e,t,n)=>Xm(e,t,n)<0;var du=Ym;const Jm=lt,Km=(e,t,n)=>Jm(e,t,n)!==0;var ad=Km;const Qm=lt,Zm=(e,t,n)=>Qm(e,t,n)>=0;var pu=Zm;const e0=lt,t0=(e,t,n)=>e0(e,t,n)<=0;var gu=t0;const n0=cu,i0=ad,r0=Ks,s0=pu,o0=du,a0=gu,u0=(e,t,n,i)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e===n;case"!==":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e!==n;case"":case"=":case"==":return n0(e,n,i);case"!=":return i0(e,n,i);case">":return r0(e,n,i);case">=":return s0(e,n,i);case"<":return o0(e,n,i);case"<=":return a0(e,n,i);default:throw new TypeError(`Invalid operator: ${t}`)}};var ud=u0;const l0=$e,c0=Vi,{re:rs,t:ss}=yn.exports,f0=(e,t)=>{if(e instanceof l0)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;t=t||{};let n=null;if(!t.rtl)n=e.match(rs[ss.COERCE]);else{let i;for(;(i=rs[ss.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)(!n||i.index+i[0].length!==n.index+n[0].length)&&(n=i),rs[ss.COERCERTL].lastIndex=i.index+i[1].length+i[2].length;rs[ss.COERCERTL].lastIndex=-1}return n===null?null:c0(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)};var d0=f0,p0=z;z.Node=ei;z.create=z;function z(e){var t=this;if(t instanceof z||(t=new z),t.tail=null,t.head=null,t.length=0,e&&typeof e.forEach=="function")e.forEach(function(r){t.push(r)});else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)t.push(arguments[n]);return t}z.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t};z.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}};z.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}};z.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)h0(this,arguments[e]);return this.length};z.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)m0(this,arguments[e]);return this.length};z.prototype.pop=function(){if(!!this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}};z.prototype.shift=function(){if(!!this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}};z.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,i=0;n!==null;i++)e.call(t,n.value,i,this),n=n.next};z.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,i=this.length-1;n!==null;i--)e.call(t,n.value,i,this),n=n.prev};z.prototype.get=function(e){for(var t=0,n=this.head;n!==null&&t<e;t++)n=n.next;if(t===e&&n!==null)return n.value};z.prototype.getReverse=function(e){for(var t=0,n=this.tail;n!==null&&t<e;t++)n=n.prev;if(t===e&&n!==null)return n.value};z.prototype.map=function(e,t){t=t||this;for(var n=new z,i=this.head;i!==null;)n.push(e.call(t,i.value,this)),i=i.next;return n};z.prototype.mapReverse=function(e,t){t=t||this;for(var n=new z,i=this.tail;i!==null;)n.push(e.call(t,i.value,this)),i=i.prev;return n};z.prototype.reduce=function(e,t){var n,i=this.head;if(arguments.length>1)n=t;else if(this.head)i=this.head.next,n=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=0;i!==null;r++)n=e(n,i.value,r),i=i.next;return n};z.prototype.reduceReverse=function(e,t){var n,i=this.tail;if(arguments.length>1)n=t;else if(this.tail)i=this.tail.prev,n=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=this.length-1;i!==null;r--)n=e(n,i.value,r),i=i.prev;return n};z.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;n!==null;t++)e[t]=n.value,n=n.next;return e};z.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;n!==null;t++)e[t]=n.value,n=n.prev;return e};z.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new z;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,r=this.head;r!==null&&i<e;i++)r=r.next;for(;r!==null&&i<t;i++,r=r.next)n.push(r.value);return n};z.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new z;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,r=this.tail;r!==null&&i>t;i--)r=r.prev;for(;r!==null&&i>e;i--,r=r.prev)n.push(r.value);return n};z.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var i=0,r=this.head;r!==null&&i<e;i++)r=r.next;for(var s=[],i=0;r&&i<t;i++)s.push(r.value),r=this.removeNode(r);r===null&&(r=this.tail),r!==this.head&&r!==this.tail&&(r=r.prev);for(var i=0;i<n.length;i++)r=g0(this,r,n[i]);return s};z.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;n!==null;n=n.prev){var i=n.prev;n.prev=n.next,n.next=i}return this.head=t,this.tail=e,this};function g0(e,t,n){var i=t===e.head?new ei(n,null,t,e):new ei(n,t,t.next,e);return i.next===null&&(e.tail=i),i.prev===null&&(e.head=i),e.length++,i}function h0(e,t){e.tail=new ei(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function m0(e,t){e.head=new ei(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function ei(e,t,n,i){if(!(this instanceof ei))return new ei(e,t,n,i);this.list=i,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}try{require("./iterator.js")(z)}catch{}const b0=p0,qn=Symbol("max"),Ut=Symbol("length"),Ai=Symbol("lengthCalculator"),br=Symbol("allowStale"),Vn=Symbol("maxAge"),Mt=Symbol("dispose"),uc=Symbol("noDisposeOnSet"),fe=Symbol("lruList"),nt=Symbol("cache"),ld=Symbol("updateAgeOnGet"),Ko=()=>1;class y0{constructor(t){if(typeof t=="number"&&(t={max:t}),t||(t={}),t.max&&(typeof t.max!="number"||t.max<0))throw new TypeError("max must be a non-negative number");this[qn]=t.max||1/0;const n=t.length||Ko;if(this[Ai]=typeof n!="function"?Ko:n,this[br]=t.stale||!1,t.maxAge&&typeof t.maxAge!="number")throw new TypeError("maxAge must be a number");this[Vn]=t.maxAge||0,this[Mt]=t.dispose,this[uc]=t.noDisposeOnSet||!1,this[ld]=t.updateAgeOnGet||!1,this.reset()}set max(t){if(typeof t!="number"||t<0)throw new TypeError("max must be a non-negative number");this[qn]=t||1/0,ar(this)}get max(){return this[qn]}set allowStale(t){this[br]=!!t}get allowStale(){return this[br]}set maxAge(t){if(typeof t!="number")throw new TypeError("maxAge must be a non-negative number");this[Vn]=t,ar(this)}get maxAge(){return this[Vn]}set lengthCalculator(t){typeof t!="function"&&(t=Ko),t!==this[Ai]&&(this[Ai]=t,this[Ut]=0,this[fe].forEach(n=>{n.length=this[Ai](n.value,n.key),this[Ut]+=n.length})),ar(this)}get lengthCalculator(){return this[Ai]}get length(){return this[Ut]}get itemCount(){return this[fe].length}rforEach(t,n){n=n||this;for(let i=this[fe].tail;i!==null;){const r=i.prev;lc(this,t,i,n),i=r}}forEach(t,n){n=n||this;for(let i=this[fe].head;i!==null;){const r=i.next;lc(this,t,i,n),i=r}}keys(){return this[fe].toArray().map(t=>t.key)}values(){return this[fe].toArray().map(t=>t.value)}reset(){this[Mt]&&this[fe]&&this[fe].length&&this[fe].forEach(t=>this[Mt](t.key,t.value)),this[nt]=new Map,this[fe]=new b0,this[Ut]=0}dump(){return this[fe].map(t=>Ss(this,t)?!1:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[fe]}set(t,n,i){if(i=i||this[Vn],i&&typeof i!="number")throw new TypeError("maxAge must be a number");const r=i?Date.now():0,s=this[Ai](n,t);if(this[nt].has(t)){if(s>this[qn])return Fi(this,this[nt].get(t)),!1;const u=this[nt].get(t).value;return this[Mt]&&(this[uc]||this[Mt](t,u.value)),u.now=r,u.maxAge=i,u.value=n,this[Ut]+=s-u.length,u.length=s,this.get(t),ar(this),!0}const o=new v0(t,n,s,r,i);return o.length>this[qn]?(this[Mt]&&this[Mt](t,n),!1):(this[Ut]+=o.length,this[fe].unshift(o),this[nt].set(t,this[fe].head),ar(this),!0)}has(t){if(!this[nt].has(t))return!1;const n=this[nt].get(t).value;return!Ss(this,n)}get(t){return Qo(this,t,!0)}peek(t){return Qo(this,t,!1)}pop(){const t=this[fe].tail;return t?(Fi(this,t),t.value):null}del(t){Fi(this,this[nt].get(t))}load(t){this.reset();const n=Date.now();for(let i=t.length-1;i>=0;i--){const r=t[i],s=r.e||0;if(s===0)this.set(r.k,r.v);else{const o=s-n;o>0&&this.set(r.k,r.v,o)}}}prune(){this[nt].forEach((t,n)=>Qo(this,n,!1))}}const Qo=(e,t,n)=>{const i=e[nt].get(t);if(i){const r=i.value;if(Ss(e,r)){if(Fi(e,i),!e[br])return}else n&&(e[ld]&&(i.value.now=Date.now()),e[fe].unshiftNode(i));return r.value}},Ss=(e,t)=>{if(!t||!t.maxAge&&!e[Vn])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[Vn]&&n>e[Vn]},ar=e=>{if(e[Ut]>e[qn])for(let t=e[fe].tail;e[Ut]>e[qn]&&t!==null;){const n=t.prev;Fi(e,t),t=n}},Fi=(e,t)=>{if(t){const n=t.value;e[Mt]&&e[Mt](n.key,n.value),e[Ut]-=n.length,e[nt].delete(n.key),e[fe].removeNode(t)}};class v0{constructor(t,n,i,r,s){this.key=t,this.value=n,this.length=i,this.now=r,this.maxAge=s||0}}const lc=(e,t,n,i)=>{let r=n.value;Ss(e,r)&&(Fi(e,n),e[br]||(r=void 0)),r&&t.call(i,r.value,r.key,e)};var O0=y0;class yr{constructor(t,n){if(n=x0(n),t instanceof yr)return t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease?t:new yr(t.raw,n);if(t instanceof ja)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease,this.raw=t,this.set=t.split(/\s*\|\|\s*/).map(i=>this.parseRange(i.trim())).filter(i=>i.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${t}`);if(this.set.length>1){const i=this.set[0];if(this.set=this.set.filter(r=>!fc(r[0])),this.set.length===0)this.set=[i];else if(this.set.length>1){for(const r of this.set)if(r.length===1&&F0(r[0])){this.set=[r];break}}}this.format()}format(){return this.range=this.set.map(t=>t.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(t){t=t.trim();const i=`parseRange:${Object.keys(this.options).join(",")}:${t}`,r=cc.get(i);if(r)return r;const s=this.options.loose,o=s?ye[me.HYPHENRANGELOOSE]:ye[me.HYPHENRANGE];t=t.replace(o,R0(this.options.includePrerelease)),ie("hyphen replace",t),t=t.replace(ye[me.COMPARATORTRIM],w0),ie("comparator trim",t,ye[me.COMPARATORTRIM]),t=t.replace(ye[me.TILDETRIM],S0),t=t.replace(ye[me.CARETTRIM],C0),t=t.split(/\s+/).join(" ");const a=s?ye[me.COMPARATORLOOSE]:ye[me.COMPARATOR],u=t.split(" ").map(f=>_0(f,this.options)).join(" ").split(/\s+/).map(f=>I0(f,this.options)).filter(this.options.loose?f=>!!f.match(a):()=>!0).map(f=>new ja(f,this.options));u.length;const l=new Map;for(const f of u){if(fc(f))return[f];l.set(f.value,f)}l.size>1&&l.has("")&&l.delete("");const c=[...l.values()];return cc.set(i,c),c}intersects(t,n){if(!(t instanceof yr))throw new TypeError("a Range is required");return this.set.some(i=>dc(i,n)&&t.set.some(r=>dc(r,n)&&i.every(s=>r.every(o=>s.intersects(o,n)))))}test(t){if(!t)return!1;if(typeof t=="string")try{t=new A0(t,this.options)}catch{return!1}for(let n=0;n<this.set.length;n++)if(L0(this.set[n],t,this.options))return!0;return!1}}var ct=yr;const E0=O0,cc=new E0({max:1e3}),x0=Js,ja=Qs,ie=Ys,A0=$e,{re:ye,t:me,comparatorTrimReplace:w0,tildeTrimReplace:S0,caretTrimReplace:C0}=yn.exports,fc=e=>e.value==="<0.0.0-0",F0=e=>e.value==="",dc=(e,t)=>{let n=!0;const i=e.slice();let r=i.pop();for(;n&&i.length;)n=i.every(s=>r.intersects(s,t)),r=i.pop();return n},_0=(e,t)=>(ie("comp",e,t),e=D0(e,t),ie("caret",e),e=$0(e,t),ie("tildes",e),e=T0(e,t),ie("xrange",e),e=P0(e,t),ie("stars",e),e),we=e=>!e||e.toLowerCase()==="x"||e==="*",$0=(e,t)=>e.trim().split(/\s+/).map(n=>j0(n,t)).join(" "),j0=(e,t)=>{const n=t.loose?ye[me.TILDELOOSE]:ye[me.TILDE];return e.replace(n,(i,r,s,o,a)=>{ie("tilde",e,i,r,s,o,a);let u;return we(r)?u="":we(s)?u=`>=${r}.0.0 <${+r+1}.0.0-0`:we(o)?u=`>=${r}.${s}.0 <${r}.${+s+1}.0-0`:a?(ie("replaceTilde pr",a),u=`>=${r}.${s}.${o}-${a} <${r}.${+s+1}.0-0`):u=`>=${r}.${s}.${o} <${r}.${+s+1}.0-0`,ie("tilde return",u),u})},D0=(e,t)=>e.trim().split(/\s+/).map(n=>N0(n,t)).join(" "),N0=(e,t)=>{ie("caret",e,t);const n=t.loose?ye[me.CARETLOOSE]:ye[me.CARET],i=t.includePrerelease?"-0":"";return e.replace(n,(r,s,o,a,u)=>{ie("caret",e,r,s,o,a,u);let l;return we(s)?l="":we(o)?l=`>=${s}.0.0${i} <${+s+1}.0.0-0`:we(a)?s==="0"?l=`>=${s}.${o}.0${i} <${s}.${+o+1}.0-0`:l=`>=${s}.${o}.0${i} <${+s+1}.0.0-0`:u?(ie("replaceCaret pr",u),s==="0"?o==="0"?l=`>=${s}.${o}.${a}-${u} <${s}.${o}.${+a+1}-0`:l=`>=${s}.${o}.${a}-${u} <${s}.${+o+1}.0-0`:l=`>=${s}.${o}.${a}-${u} <${+s+1}.0.0-0`):(ie("no pr"),s==="0"?o==="0"?l=`>=${s}.${o}.${a}${i} <${s}.${o}.${+a+1}-0`:l=`>=${s}.${o}.${a}${i} <${s}.${+o+1}.0-0`:l=`>=${s}.${o}.${a} <${+s+1}.0.0-0`),ie("caret return",l),l})},T0=(e,t)=>(ie("replaceXRanges",e,t),e.split(/\s+/).map(n=>k0(n,t)).join(" ")),k0=(e,t)=>{e=e.trim();const n=t.loose?ye[me.XRANGELOOSE]:ye[me.XRANGE];return e.replace(n,(i,r,s,o,a,u)=>{ie("xRange",e,i,r,s,o,a,u);const l=we(s),c=l||we(o),f=c||we(a),d=f;return r==="="&&d&&(r=""),u=t.includePrerelease?"-0":"",l?r===">"||r==="<"?i="<0.0.0-0":i="*":r&&d?(c&&(o=0),a=0,r===">"?(r=">=",c?(s=+s+1,o=0,a=0):(o=+o+1,a=0)):r==="<="&&(r="<",c?s=+s+1:o=+o+1),r==="<"&&(u="-0"),i=`${r+s}.${o}.${a}${u}`):c?i=`>=${s}.0.0${u} <${+s+1}.0.0-0`:f&&(i=`>=${s}.${o}.0${u} <${s}.${+o+1}.0-0`),ie("xRange return",i),i})},P0=(e,t)=>(ie("replaceStars",e,t),e.trim().replace(ye[me.STAR],"")),I0=(e,t)=>(ie("replaceGTE0",e,t),e.trim().replace(ye[t.includePrerelease?me.GTE0PRE:me.GTE0],"")),R0=e=>(t,n,i,r,s,o,a,u,l,c,f,d,p)=>(we(i)?n="":we(r)?n=`>=${i}.0.0${e?"-0":""}`:we(s)?n=`>=${i}.${r}.0${e?"-0":""}`:o?n=`>=${n}`:n=`>=${n}${e?"-0":""}`,we(l)?u="":we(c)?u=`<${+l+1}.0.0-0`:we(f)?u=`<${l}.${+c+1}.0-0`:d?u=`<=${l}.${c}.${f}-${d}`:e?u=`<${l}.${c}.${+f+1}-0`:u=`<=${u}`,`${n} ${u}`.trim()),L0=(e,t,n)=>{for(let i=0;i<e.length;i++)if(!e[i].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let i=0;i<e.length;i++)if(ie(e[i].semver),e[i].semver!==ja.ANY&&e[i].semver.prerelease.length>0){const r=e[i].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0},ur=Symbol("SemVer ANY");class Cs{static get ANY(){return ur}constructor(t,n){if(n=B0(n),t instanceof Cs){if(t.loose===!!n.loose)return t;t=t.value}ea("comparator",t,n),this.options=n,this.loose=!!n.loose,this.parse(t),this.semver===ur?this.value="":this.value=this.operator+this.semver.version,ea("comp",this)}parse(t){const n=this.options.loose?pc[gc.COMPARATORLOOSE]:pc[gc.COMPARATOR],i=t.match(n);if(!i)throw new TypeError(`Invalid comparator: ${t}`);this.operator=i[1]!==void 0?i[1]:"",this.operator==="="&&(this.operator=""),i[2]?this.semver=new hc(i[2],this.options.loose):this.semver=ur}toString(){return this.value}test(t){if(ea("Comparator.test",t,this.options.loose),this.semver===ur||t===ur)return!0;if(typeof t=="string")try{t=new hc(t,this.options)}catch{return!1}return Zo(t,this.operator,this.semver,this.options)}intersects(t,n){if(!(t instanceof Cs))throw new TypeError("a Comparator is required");if((!n||typeof n!="object")&&(n={loose:!!n,includePrerelease:!1}),this.operator==="")return this.value===""?!0:new mc(t.value,n).test(this.value);if(t.operator==="")return t.value===""?!0:new mc(this.value,n).test(t.semver);const i=(this.operator===">="||this.operator===">")&&(t.operator===">="||t.operator===">"),r=(this.operator==="<="||this.operator==="<")&&(t.operator==="<="||t.operator==="<"),s=this.semver.version===t.semver.version,o=(this.operator===">="||this.operator==="<=")&&(t.operator===">="||t.operator==="<="),a=Zo(this.semver,"<",t.semver,n)&&(this.operator===">="||this.operator===">")&&(t.operator==="<="||t.operator==="<"),u=Zo(this.semver,">",t.semver,n)&&(this.operator==="<="||this.operator==="<")&&(t.operator===">="||t.operator===">");return i||r||s&&o||a||u}}var Qs=Cs;const B0=Js,{re:pc,t:gc}=yn.exports,Zo=ud,ea=Ys,hc=$e,mc=ct,z0=ct,M0=(e,t,n)=>{try{t=new z0(t,n)}catch{return!1}return t.test(e)};var Zs=M0;const U0=ct,W0=(e,t)=>new U0(e,t).set.map(n=>n.map(i=>i.value).join(" ").trim().split(" "));var G0=W0;const H0=$e,q0=ct,V0=(e,t,n)=>{let i=null,r=null,s=null;try{s=new q0(t,n)}catch{return null}return e.forEach(o=>{s.test(o)&&(!i||r.compare(o)===-1)&&(i=o,r=new H0(i,n))}),i};var X0=V0;const Y0=$e,J0=ct,K0=(e,t,n)=>{let i=null,r=null,s=null;try{s=new J0(t,n)}catch{return null}return e.forEach(o=>{s.test(o)&&(!i||r.compare(o)===1)&&(i=o,r=new Y0(i,n))}),i};var Q0=K0;const ta=$e,Z0=ct,bc=Ks,eb=(e,t)=>{e=new Z0(e,t);let n=new ta("0.0.0");if(e.test(n)||(n=new ta("0.0.0-0"),e.test(n)))return n;n=null;for(let i=0;i<e.set.length;++i){const r=e.set[i];let s=null;r.forEach(o=>{const a=new ta(o.semver.version);switch(o.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!s||bc(a,s))&&(s=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),s&&(!n||bc(n,s))&&(n=s)}return n&&e.test(n)?n:null};var tb=eb;const nb=ct,ib=(e,t)=>{try{return new nb(e,t).range||"*"}catch{return null}};var rb=ib;const sb=$e,cd=Qs,{ANY:ob}=cd,ab=ct,ub=Zs,yc=Ks,vc=du,lb=gu,cb=pu,fb=(e,t,n,i)=>{e=new sb(e,i),t=new ab(t,i);let r,s,o,a,u;switch(n){case">":r=yc,s=lb,o=vc,a=">",u=">=";break;case"<":r=vc,s=cb,o=yc,a="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(ub(e,t,i))return!1;for(let l=0;l<t.set.length;++l){const c=t.set[l];let f=null,d=null;if(c.forEach(p=>{p.semver===ob&&(p=new cd(">=0.0.0")),f=f||p,d=d||p,r(p.semver,f.semver,i)?f=p:o(p.semver,d.semver,i)&&(d=p)}),f.operator===a||f.operator===u||(!d.operator||d.operator===a)&&s(e,d.semver))return!1;if(d.operator===u&&o(e,d.semver))return!1}return!0};var hu=fb;const db=hu,pb=(e,t,n)=>db(e,t,">",n);var gb=pb;const hb=hu,mb=(e,t,n)=>hb(e,t,"<",n);var bb=mb;const Oc=ct,yb=(e,t,n)=>(e=new Oc(e,n),t=new Oc(t,n),e.intersects(t));var vb=yb;const Ob=Zs,Eb=lt;var xb=(e,t,n)=>{const i=[];let r=null,s=null;const o=e.sort((c,f)=>Eb(c,f,n));for(const c of o)Ob(c,t,n)?(s=c,r||(r=c)):(s&&i.push([r,s]),s=null,r=null);r&&i.push([r,null]);const a=[];for(const[c,f]of i)c===f?a.push(c):!f&&c===o[0]?a.push("*"):f?c===o[0]?a.push(`<=${f}`):a.push(`${c} - ${f}`):a.push(`>=${c}`);const u=a.join(" || "),l=typeof t.raw=="string"?t.raw:String(t);return u.length<l.length?u:t};const Ec=ct,ys=Qs,{ANY:na}=ys,lr=Zs,mu=lt,Ab=(e,t,n={})=>{if(e===t)return!0;e=new Ec(e,n),t=new Ec(t,n);let i=!1;e:for(const r of e.set){for(const s of t.set){const o=wb(r,s,n);if(i=i||o!==null,o)continue e}if(i)return!1}return!0},wb=(e,t,n)=>{if(e===t)return!0;if(e.length===1&&e[0].semver===na){if(t.length===1&&t[0].semver===na)return!0;n.includePrerelease?e=[new ys(">=0.0.0-0")]:e=[new ys(">=0.0.0")]}if(t.length===1&&t[0].semver===na){if(n.includePrerelease)return!0;t=[new ys(">=0.0.0")]}const i=new Set;let r,s;for(const p of e)p.operator===">"||p.operator===">="?r=xc(r,p,n):p.operator==="<"||p.operator==="<="?s=Ac(s,p,n):i.add(p.semver);if(i.size>1)return null;let o;if(r&&s){if(o=mu(r.semver,s.semver,n),o>0)return null;if(o===0&&(r.operator!==">="||s.operator!=="<="))return null}for(const p of i){if(r&&!lr(p,String(r),n)||s&&!lr(p,String(s),n))return null;for(const g of t)if(!lr(p,String(g),n))return!1;return!0}let a,u,l,c,f=s&&!n.includePrerelease&&s.semver.prerelease.length?s.semver:!1,d=r&&!n.includePrerelease&&r.semver.prerelease.length?r.semver:!1;f&&f.prerelease.length===1&&s.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(const p of t){if(c=c||p.operator===">"||p.operator===">=",l=l||p.operator==="<"||p.operator==="<=",r){if(d&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===d.major&&p.semver.minor===d.minor&&p.semver.patch===d.patch&&(d=!1),p.operator===">"||p.operator===">="){if(a=xc(r,p,n),a===p&&a!==r)return!1}else if(r.operator===">="&&!lr(r.semver,String(p),n))return!1}if(s){if(f&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===f.major&&p.semver.minor===f.minor&&p.semver.patch===f.patch&&(f=!1),p.operator==="<"||p.operator==="<="){if(u=Ac(s,p,n),u===p&&u!==s)return!1}else if(s.operator==="<="&&!lr(s.semver,String(p),n))return!1}if(!p.operator&&(s||r)&&o!==0)return!1}return!(r&&l&&!s&&o!==0||s&&c&&!r&&o!==0||d||f)},xc=(e,t,n)=>{if(!e)return t;const i=mu(e.semver,t.semver,n);return i>0?e:i<0||t.operator===">"&&e.operator===">="?t:e},Ac=(e,t,n)=>{if(!e)return t;const i=mu(e.semver,t.semver,n);return i<0?e:i>0||t.operator==="<"&&e.operator==="<="?t:e};var Sb=Ab;const ia=yn.exports;var fd={re:ia.re,src:ia.src,tokens:ia.t,SEMVER_SPEC_VERSION:Xs.SEMVER_SPEC_VERSION,SemVer:$e,compareIdentifiers:$a.compareIdentifiers,rcompareIdentifiers:$a.rcompareIdentifiers,parse:Vi,valid:um,clean:fm,inc:gm,diff:Om,major:Am,minor:Cm,patch:$m,prerelease:Nm,compare:lt,rcompare:Pm,compareLoose:Lm,compareBuild:fu,sort:Um,rsort:Hm,gt:Ks,lt:du,eq:cu,neq:ad,gte:pu,lte:gu,cmp:ud,coerce:d0,Comparator:Qs,Range:ct,satisfies:Zs,toComparators:G0,maxSatisfying:X0,minSatisfying:Q0,minVersion:tb,validRange:rb,outside:hu,gtr:gb,ltr:bb,intersects:vb,simplifyRange:xb,subset:Sb};const Cb="4.17.0";Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,i){return Array.isArray(i)?n.push.apply(n,e.call(i,t-1)):n.push(i),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var dd={exports:{}};(function(e){var t=function(){function n(d,p){return p!=null&&d instanceof p}var i;try{i=Map}catch{i=function(){}}var r;try{r=Set}catch{r=function(){}}var s;try{s=Promise}catch{s=function(){}}function o(d,p,g,m,h){typeof p=="object"&&(g=p.depth,m=p.prototype,h=p.includeNonEnumerable,p=p.circular);var x=[],v=[],S=typeof Buffer!="undefined";typeof p=="undefined"&&(p=!0),typeof g=="undefined"&&(g=1/0);function F(E,$){if(E===null)return null;if($===0)return E;var A,N;if(typeof E!="object")return E;if(n(E,i))A=new i;else if(n(E,r))A=new r;else if(n(E,s))A=new s(function(he,Be){E.then(function(Ze){he(F(Ze,$-1))},function(Ze){Be(F(Ze,$-1))})});else if(o.__isArray(E))A=[];else if(o.__isRegExp(E))A=new RegExp(E.source,f(E)),E.lastIndex&&(A.lastIndex=E.lastIndex);else if(o.__isDate(E))A=new Date(E.getTime());else{if(S&&Buffer.isBuffer(E))return Buffer.allocUnsafe?A=Buffer.allocUnsafe(E.length):A=new Buffer(E.length),E.copy(A),A;n(E,Error)?A=Object.create(E):typeof m=="undefined"?(N=Object.getPrototypeOf(E),A=Object.create(N)):(A=Object.create(m),N=m)}if(p){var U=x.indexOf(E);if(U!=-1)return v[U];x.push(E),v.push(A)}n(E,i)&&E.forEach(function(he,Be){var Ze=F(Be,$-1),Bt=F(he,$-1);A.set(Ze,Bt)}),n(E,r)&&E.forEach(function(he){var Be=F(he,$-1);A.add(Be)});for(var K in E){var Ae;N&&(Ae=Object.getOwnPropertyDescriptor(N,K)),!(Ae&&Ae.set==null)&&(A[K]=F(E[K],$-1))}if(Object.getOwnPropertySymbols)for(var Re=Object.getOwnPropertySymbols(E),K=0;K<Re.length;K++){var Qe=Re[K],ee=Object.getOwnPropertyDescriptor(E,Qe);ee&&!ee.enumerable&&!h||(A[Qe]=F(E[Qe],$-1),ee.enumerable||Object.defineProperty(A,Qe,{enumerable:!1}))}if(h)for(var Le=Object.getOwnPropertyNames(E),K=0;K<Le.length;K++){var ge=Le[K],ee=Object.getOwnPropertyDescriptor(E,ge);ee&&ee.enumerable||(A[ge]=F(E[ge],$-1),Object.defineProperty(A,ge,{enumerable:!1}))}return A}return F(d,g)}o.clonePrototype=function(p){if(p===null)return null;var g=function(){};return g.prototype=p,new g};function a(d){return Object.prototype.toString.call(d)}o.__objToStr=a;function u(d){return typeof d=="object"&&a(d)==="[object Date]"}o.__isDate=u;function l(d){return typeof d=="object"&&a(d)==="[object Array]"}o.__isArray=l;function c(d){return typeof d=="object"&&a(d)==="[object RegExp]"}o.__isRegExp=c;function f(d){var p="";return d.global&&(p+="g"),d.ignoreCase&&(p+="i"),d.multiline&&(p+="m"),p}return o.__getRegExpFlags=f,o}();e.exports&&(e.exports=t)})(dd);var Fb=dd.exports,_b=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var i,r,s;if(Array.isArray(t)){if(i=t.length,i!=n.length)return!1;for(r=i;r--!==0;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(s=Object.keys(t),i=s.length,i!==Object.keys(n).length)return!1;for(r=i;r--!==0;)if(!Object.prototype.hasOwnProperty.call(n,s[r]))return!1;for(r=i;r--!==0;){var o=s[r];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n},wr=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var n=typeof t.cycles=="boolean"?t.cycles:!1,i=t.cmp&&function(s){return function(o){return function(a,u){var l={key:a,value:o[a]},c={key:u,value:o[u]};return s(l,c)}}}(t.cmp),r=[];return function s(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,u;if(Array.isArray(o)){for(u="[",a=0;a<o.length;a++)a&&(u+=","),u+=s(o[a])||"null";return u+"]"}if(o===null)return"null";if(r.indexOf(o)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=r.push(o)-1,c=Object.keys(o).sort(i&&i(o));for(u="",a=0;a<c.length;a++){var f=c[a],d=s(o[f]);!d||(u&&(u+=","),u+=JSON.stringify(f)+":"+d)}return r.splice(l,1),"{"+u+"}"}}(e)};function bu(e){return!!e.or}function yu(e){return!!e.and}function vu(e){return!!e.not}function vs(e,t){if(vu(e))vs(e.not,t);else if(yu(e))for(const n of e.and)vs(n,t);else if(bu(e))for(const n of e.or)vs(n,t);else t(e)}function Os(e,t){return vu(e)?{not:Os(e.not,t)}:yu(e)?{and:e.and.map(n=>Os(n,t))}:bu(e)?{or:e.or.map(n=>Os(n,t))}:t(e)}const Xi=_b,I=Fb;function Ni(e,t){const n={};for(const i of t)Si(e,i)&&(n[i]=e[i]);return n}function We(e,t){const n=Object.assign({},e);for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>wr(e)).join(",")})`};const V=wr;function R(e){if(ae(e))return e;const t=P(e)?e:wr(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function Da(e){return e===!1||e===null}function D(e,t){return e.indexOf(t)>-1}function Ti(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function Ou(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function pd(e,...t){for(const n of t)$b(e,n!=null?n:{});return e}function $b(e,t){for(const n of y(t))nd(e,n,t[n],!0)}function Et(e,t){const n=[],i={};let r;for(const s of e)r=t(s),!(r in i)&&(i[r]=1,n.push(s));return n}function jb(e,t){const n=y(e),i=y(t);if(n.length!==i.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0}function gd(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Eu(e,t){for(const n of e)if(t.has(n))return!0;return!1}function Na(e){const t=new Set;for(const n of e){const r=Gi(n).map((o,a)=>a===0?o:`[${o}]`),s=r.map((o,a)=>r.slice(0,a+1).join(""));for(const o of s)t.add(o)}return t}function xu(e,t){return e===void 0||t===void 0?!0:Eu(Na(e),Na(t))}function G(e){return y(e).length===0}const y=Object.keys,qt=Object.values,Rr=Object.entries;function Sr(e){return e===!0||e===!1}function Y(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function _i(e,t){return vu(e)?"!("+_i(e.not,t)+")":yu(e)?"("+e.and.map(n=>_i(n,t)).join(") && (")+")":bu(e)?"("+e.or.map(n=>_i(n,t)).join(") || (")+")":t(e)}function Fs(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&Fs(e[n],t)&&delete e[n],G(e)}function Lr(e){return e.charAt(0).toUpperCase()+e.substr(1)}function Au(e,t="datum"){const n=Gi(e),i=[];for(let r=1;r<=n.length;r++){const s=`[${n.slice(0,r).map(B).join("][")}]`;i.push(`${t}${s}`)}return i.join(" && ")}function hd(e,t="datum"){return`${t}[${B(Gi(e).join("."))}]`}function Db(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function Qt(e){return`${Gi(e).map(Db).join("\\.")}`}function ti(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function wu(e){return`${Gi(e).join(".")}`}function ki(e){return e?Gi(e).length:0}function se(...e){for(const t of e)if(t!==void 0)return t}let md=42;function bd(e){const t=++md;return e?String(e)+t:t}function Nb(){md=42}function yd(e){return vd(e)?e:`__${e}`}function vd(e){return e.indexOf("__")===0}function Cr(e){if(e!==void 0)return(e%360+360)%360}function eo(e){return ae(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}const wc={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function Br(e){return e&&e.condition}const Od=["domain","grid","labels","ticks","title"],Tb={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},Ed={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},kb=Object.assign(Object.assign({},Ed),{style:1,labelExpr:1,encoding:1});function Sc(e){return!!kb[e]}const Pb={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},xd=y(Pb),Ib={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},Rb={count:1,min:1,max:1};function Zt(e){return!!e&&!!e.argmin}function wn(e){return!!e&&!!e.argmax}function Su(e){return P(e)&&!!Ib[e]}const Lb=["count","valid","missing","distinct"];function Ad(e){return P(e)&&D(Lb,e)}function Bb(e){return P(e)&&D(["min","max"],e)}const zb=["count","sum","distinct","valid","missing"],Mb=["mean","average","median","q1","q3","min","max"],Ub=ci(Mb);var zr=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Vt="row",Xt="column",to="facet",Z="x",ce="y",ft="x2",jt="y2",Dt="radius",tn="radius2",dt="theta",nn="theta2",Nt="latitude",Tt="longitude",pt="latitude2",Ve="longitude2",ke="color",kt="fill",Pt="stroke",Pe="shape",rn="size",fi="angle",sn="opacity",Sn="fillOpacity",Cn="strokeOpacity",Fn="strokeWidth",_n="strokeDash",Mr="text",Ur="order",Wr="detail",no="key",ni="tooltip",io="href",ro="url",so="description",Wb={x:1,y:1,x2:1,y2:1},wd={theta:1,theta2:1,radius:1,radius2:1};function Sd(e){return e in wd}const Cu={longitude:1,longitude2:1,latitude:1,latitude2:1};function Gb(e){switch(e){case Nt:return"y";case pt:return"y2";case Tt:return"x";case Ve:return"x2"}}function Hb(e){return e in Cu}const qb=y(Cu),Cd=Object.assign(Object.assign(Object.assign(Object.assign({},Wb),wd),Cu),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function $i(e){return e===ke||e===kt||e===Pt}const Fd={row:1,column:1,facet:1},qe=y(Fd),Fu=Object.assign(Object.assign({},Cd),Fd),Vb=y(Fu),Xb=zr(Fu,["order","detail","tooltip"]),Yb=zr(Xb,["row","column","facet"]);function Jb(e){return!!Yb[e]}function _d(e){return!!Fu[e]}const Kb=[ft,jt,pt,Ve,nn,tn];function $d(e){return di(e)!==e}function di(e){switch(e){case ft:return Z;case jt:return ce;case pt:return Nt;case Ve:return Tt;case nn:return dt;case tn:return Dt}return e}function vn(e){if(Sd(e))switch(e){case dt:return"startAngle";case nn:return"endAngle";case Dt:return"outerRadius";case tn:return"innerRadius"}return e}function It(e){switch(e){case Z:return ft;case ce:return jt;case Nt:return pt;case Tt:return Ve;case dt:return nn;case Dt:return tn}}function Rt(e){switch(e){case Z:case ft:return"width";case ce:case jt:return"height"}}function Qb(e){switch(e){case Z:return"xOffset";case ce:return"yOffset";case ft:return"x2Offset";case jt:return"y2Offset";case dt:return"thetaOffset";case Dt:return"radiusOffset";case nn:return"theta2Offset";case tn:return"radius2Offset"}}const _u=zr(Cd,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),Zb=y(_u),$n={x:1,y:1},Xe=y($n);function Ct(e){return e in $n}const $u={theta:1,radius:1},ey=y($u);function oo(e){return e==="width"?Z:ce}const jd=zr(_u,["text","tooltip","href","url","description","detail","key","order"]),ty=y(jd);function ny(e){return!!_u[e]}function iy(e){switch(e){case ke:case kt:case Pt:case rn:case Pe:case sn:case Fn:case _n:return!0;case Sn:case Cn:case fi:return!1}}const Dd=Object.assign(Object.assign(Object.assign({},$n),$u),jd),ao=y(Dd);function jn(e){return!!Dd[e]}function ry(e,t){return oy(e)[t]}const Nd={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},sy=zr(Nd,["geoshape"]);function oy(e){switch(e){case ke:case kt:case Pt:case so:case Wr:case no:case ni:case io:case Ur:case sn:case Sn:case Cn:case Fn:case to:case Vt:case Xt:return Nd;case Z:case ce:case Nt:case Tt:return sy;case ft:case jt:case pt:case Ve:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case rn:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case _n:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Pe:return{point:"always",geoshape:"always"};case Mr:return{text:"always"};case fi:return{point:"always",square:"always",text:"always"};case ro:return{image:"always"};case dt:return{text:"always",arc:"always"};case Dt:return{text:"always",arc:"always"};case nn:case tn:return{arc:"always"}}}function ra(e){switch(e){case Z:case ce:case dt:case Dt:case rn:case fi:case Fn:case sn:case Sn:case Cn:case ft:case jt:case nn:case tn:return;case to:case Vt:case Xt:case Pe:case _n:case Mr:case ni:case io:case ro:case so:return"discrete";case ke:case kt:case Pt:return"flexible";case Nt:case Tt:case pt:case Ve:case Wr:case no:case Ur:return}}function Td(e){return Hi(e)&&(e=Eo(e,void 0)),"bin"+y(e).map(t=>uo(e[t])?Y(`_${t}_${Rr(e[t])}`):Y(`_${t}_${e[t]}`)).join("")}function J(e){return e===!0||Gr(e)&&!e.binned}function Se(e){return e==="binned"||Gr(e)&&e.binned===!0}function Gr(e){return ue(e)}function uo(e){return e==null?void 0:e.selection}function Cc(e){switch(e){case Vt:case Xt:case rn:case ke:case kt:case Pt:case Fn:case sn:case Sn:case Cn:case Pe:return 6;case _n:return 4;default:return 10}}function ju(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const ay='Autosize "fit" only works for single views and layered views.';function Fc(e){return`${e=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function _c(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function $c(e){return e?`Dropping "fit-${e}" because spec has discrete ${Rt(e)}.`:'Dropping "fit" because spec has discrete size.'}function Du(e){return`Unknown field for ${e}. Cannot calculate view size.`}function jc(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function uy(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function ly(e){return`The "nearest" transform is not supported for ${e} marks.`}function kd(e){return`Selection not supported for ${e} yet.`}function cy(e){return`Cannot find a selection named "${e}".`}const fy="Scale bindings are currently only supported for scales with unbinned, continuous domains.",dy="Legend bindings are only supported for selections over an individual field or encoding channel.";function py(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}const gy="The same selection must be used to override scale domains in a layered view.",hy='Interval selections should be initialized using "x" and/or "y" keys.';function my(e){return`Unknown repeated value "${e}".`}function Dc(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const by="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function yy(e){return`Unrecognized parse "${e}".`}function Nc(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}const vy="Attempt to add the same child twice.";function Oy(e){return`Ignoring an invalid transform: ${V(e)}.`}const Ey='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function Tc(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function xy(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${V(t)} is overridden by a child projection ${V(n)}.`}const Ay="Arc marks uses theta channel rather than angle, replacing angle with theta.";function wy(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${V(n)}}.`}function Pd(e){return`Invalid field type "${e}".`}function Sy(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function Cy(e){return`Invalid aggregation operator "${e}".`}function Id(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function Ta(e,t){return`Dropping ${V(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const Fy="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function lo(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function _y(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function $y(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function jy(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function sa(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function Dy(e){return`The ${e} for range marks cannot be an expression`}function Ny(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function Ty(e,t){return`Specified orient "${e}" overridden with "${t}".`}const ky=`Scale's "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.`;function Py(e){return`Cannot use the scale property "${e}" with non-color channel.`}function Iy(e){return`Using unaggregated domain with raw field has no effect (${V(e)}).`}function Ry(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function Ly(e){return`Unaggregated domain is currently unsupported for log scale (${V(e)}).`}function By(e){return`Cannot apply size to non-oriented mark "${e}".`}function zy(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function My(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function Rd(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function Ld(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function Uy(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${V(n)} and ${V(i)}). Using ${V(n)}.`}function Wy(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${V(n)} and ${V(i)}). Using the union of the two domains.`}function Gy(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function Hy(e){return`Dropping sort property ${V(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const kc="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",qy="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",Vy="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",Xy="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function Yy(e){return`Cannot stack "${e}" if there is already "${e}2".`}function Jy(e){return`Cannot stack non-linear scale (${e}).`}function Ky(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function _s(e,t){return`Invalid ${e}: ${V(t)}.`}function Qy(e){return`Dropping day from datetime ${V(e)} as day cannot be combined with other units.`}function Zy(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function ev(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function tv(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function Pc(e){return`1D error band does not support ${e}.`}function Bd(e){return`Channel ${e} is required for "binned" bin.`}function nv(e){return`Channel ${e} should not be used with "binned" bin.`}function iv(e){return`Domain for ${e} is required for threshold scale.`}globalThis&&globalThis.__classPrivateFieldSet;globalThis&&globalThis.__classPrivateFieldGet;const zd=Fh(_h);let Pi=zd;function rv(e){return Pi=e,Pi}function sv(){return Pi=zd,Pi}function O(...e){Pi.warn(...e)}function ov(...e){Pi.debug(...e)}function pi(e){if(e&&ue(e)){for(const t of Tu)if(t in e)return!0}return!1}const Md=["january","february","march","april","may","june","july","august","september","october","november","december"],av=Md.map(e=>e.substr(0,3)),Ud=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],uv=Ud.map(e=>e.substr(0,3));function lv(e){if(eo(e)&&(e=+e),ae(e))return e>4&&O(_s("quarter",e)),e-1;throw new Error(_s("quarter",e))}function cv(e){if(eo(e)&&(e=+e),ae(e))return e-1;{const t=e.toLowerCase(),n=Md.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=av.indexOf(i);if(r!==-1)return r;throw new Error(_s("month",e))}}function fv(e){if(eo(e)&&(e=+e),ae(e))return e%7;{const t=e.toLowerCase(),n=Ud.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=uv.indexOf(i);if(r!==-1)return r;throw new Error(_s("day",e))}}function Nu(e,t){const n=[];if(t&&e.day!==void 0&&y(e).length>1&&(O(Qy(e)),e=I(e),delete e.day),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?cv(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?lv(e.quarter):e.quarter;n.push(ae(i)?i*3:i+"*3")}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?fv(e.day):e.day;n.push(ae(i)?i+1:i+"+1")}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r=="undefined"?0:r)}return n}function Fr(e){const n=Nu(e,!0).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function dv(e){const n=Nu(e,!1).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function pv(e){const t=Nu(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}var gv=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Wd={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Tu=y(Wd);function hv(e){return!!Wd[e]}function ku(e){return e.startsWith("utc")}function mv(e){return e.substr(3)}const bv={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function Pu(e){const t=[];for(const n of Tu)Gd(e,n)&&t.push(n);return t}function Gd(e,t){const n=e.indexOf(t);return!(n<0||n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o"||n>0&&t==="year"&&e.charAt(n-1)==="f")}function yv(e,t,{end:n}={end:!1}){const i=Au(t),r=ku(e)?"utc":"";function s(u){return u==="quarter"?`(${r}quarter(${i})-1)`:`${r}${u}(${i})`}let o;const a={};for(const u of Tu)Gd(e,u)&&(a[u]=s(u),o=u);return n&&(a[o]+="+1"),dv(a)}function Hd(e){if(!e)return;const t=Pu(e);return`timeUnitSpecifier(${wr(t)}, ${wr(bv)})`}function vv(e,t,n){if(!e)return;const i=Hd(e);return`${n||ku(e)?"utc":"time"}Format(${t}, ${i})`}function _e(e){if(!e)return;let t;return P(e)?t={unit:e}:ue(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),ku(t.unit)&&(t.utc=!0,t.unit=mv(t.unit)),t}function Ov(e){const t=_e(e),{utc:n}=t,i=gv(t,["utc"]);return i.unit?(n?"utc":"")+y(i).map(r=>Y(`${r==="unit"?"":`_${r}_`}${i[r]}`)).join(""):(n?"utc":"")+"timeunit"+y(i).map(r=>Y(`_${r}_${i[r]}`)).join("")}function T(e){return e&&!!e.signal}function Dn(e){return!!e.step}function Ev(e){return j(e)?!1:"fields"in e&&!("data"in e)}function xv(e){return j(e)?!1:"fields"in e&&"data"in e}function Ht(e){return j(e)?!1:"field"in e&&"data"in e}const Av={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},wv=y(Av),Sv={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},ka=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function Cv(e){return e==null?void 0:e.selection}function Iu(e){return e&&!!e.field&&e.equal!==void 0}function Ru(e){return e&&!!e.field&&e.lt!==void 0}function Lu(e){return e&&!!e.field&&e.lte!==void 0}function Bu(e){return e&&!!e.field&&e.gt!==void 0}function zu(e){return e&&!!e.field&&e.gte!==void 0}function Mu(e){if(e&&e.field){if(j(e.range)&&e.range.length===2)return!0;if(T(e.range))return!0}return!1}function Uu(e){return e&&!!e.field&&(j(e.oneOf)||j(e.in))}function Fv(e){return e&&!!e.field&&e.valid!==void 0}function qd(e){return Uu(e)||Iu(e)||Mu(e)||Ru(e)||Bu(e)||Lu(e)||zu(e)}function vt(e,t){return xo(e,{timeUnit:t,wrapTime:!0})}function _v(e,t){return e.map(n=>vt(n,t))}function Vd(e,t=!0){var n;const{field:i}=e,r=(n=_e(e.timeUnit))===null||n===void 0?void 0:n.unit,s=r?"time("+yv(r,i)+")":w(e,{expr:"datum"});if(Iu(e))return s+"==="+vt(e.equal,r);if(Ru(e)){const o=e.lt;return`${s}<${vt(o,r)}`}else if(Bu(e)){const o=e.gt;return`${s}>${vt(o,r)}`}else if(Lu(e)){const o=e.lte;return`${s}<=${vt(o,r)}`}else if(zu(e)){const o=e.gte;return`${s}>=${vt(o,r)}`}else{if(Uu(e))return`indexof([${_v(e.oneOf,r).join(",")}], ${s}) !== -1`;if(Fv(e))return Wu(s,e.valid);if(Mu(e)){const{range:o}=e,a=T(o)?{signal:`${o.signal}[0]`}:o[0],u=T(o)?{signal:`${o.signal}[1]`}:o[1];if(a!==null&&u!==null&&t)return"inrange("+s+", ["+vt(a,r)+", "+vt(u,r)+"])";const l=[];return a!==null&&l.push(`${s} >= ${vt(a,r)}`),u!==null&&l.push(`${s} <= ${vt(u,r)}`),l.length>0?l.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function Wu(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function $v(e){var t;return qd(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=_e(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const Hr={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},ii=Hr.quantitative,Gu=Hr.ordinal,Ii=Hr.temporal,Hu=Hr.nominal,Yi=Hr.geojson;function jv(e){if(e)switch(e=e.toLowerCase(),e){case"q":case ii:return"quantitative";case"t":case Ii:return"temporal";case"o":case Gu:return"ordinal";case"n":case Hu:return"nominal";case Yi:return"geojson"}}var Dv=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const oe={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},Pa={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function Nv(e,t){const n=Pa[e],i=Pa[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const Tv={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function Ic(e){return Tv[e]}const Xd=["linear","log","pow","sqrt","symlog","time","utc"],kv=ci(Xd),Pv=["linear","log","pow","sqrt","symlog"],Iv=ci(Pv);function Rv(e){return e in Iv}const Lv=["quantile","quantize","threshold"],Bv=ci(Lv),zv=Xd.concat(["quantile","quantize","threshold","sequential","identity"]),Mv=ci(zv),Uv=["ordinal","bin-ordinal","point","band"],Wv=ci(Uv);function Ie(e){return e in Wv}function Ye(e){return e in Mv}function st(e){return e in kv}function $s(e){return e in Bv}const Gv={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function Hv(e){return!P(e)&&!!e.name}function Yd(e){return e==null?void 0:e.selection}function qv(e){return e&&e.unionWith}const Vv={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},Xv=Dv(Vv,["type","domain","range","rangeMax","rangeMin","scheme"]),Yv=y(Xv);function Ia(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!D(["point","band","identity"],e);case"bins":return!D(["point","band","identity","ordinal"],e);case"round":return st(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return st(e)||D(["point","band"],e);case"paddingOuter":case"align":return D(["point","band"],e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"clamp":return st(e);case"nice":return st(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return Ye(e)&&!D(["log","time","utc","threshold","quantile"],e)}}function Jd(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return $i(e)?void 0:Py(e);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function Jv(e,t){return D([Gu,Hu],t)?e===void 0||Ie(e):t===Ii?D([oe.TIME,oe.UTC,void 0],e):t===ii?D([oe.LOG,oe.POW,oe.SQRT,oe.SYMLOG,oe.QUANTILE,oe.QUANTIZE,oe.THRESHOLD,oe.LINEAR,void 0],e):!0}function Kv(e,t){if(!jn(e))return!1;switch(e){case Z:case ce:case dt:case Dt:return st(t)||D(["band","point"],t);case rn:case Fn:case sn:case Sn:case Cn:case fi:return st(t)||$s(t)||D(["band","point","ordinal"],t);case ke:case kt:case Pt:return t!=="band";case _n:return t==="ordinal"||$s(t);case Pe:return t==="ordinal"}}function qr(e){return e&&!!e.expr}function it(e){const t=y(e||{}),n={};for(const i of t)n[i]=Ce(e[i]);return n}const je={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},Kd=je.arc,co=je.area,fo=je.bar,Qv=je.image,po=je.line,go=je.point,Zv=je.rect,js=je.rule,Qd=je.text,qu=je.tick,eO=je.trail,Vu=je.circle,Xu=je.square,Zd=je.geoshape;function Nn(e){return D(["line","area","trail"],e)}function Rc(e){return D(["rect","bar","image","arc"],e)}const ep=y(je);function en(e){return e.type}ci(ep);const tO=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],nO=["fill","fillOpacity"],iO=[...tO,...nO],rO={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1},Lc=y(rO),sO={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},oO={color:"#4c78a8",invalid:"filter",timeUnitBand:1},aO={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},tp=y(aO),uO={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},np=5,lO={binSpacing:1,continuousBandSize:np,timeUnitBandPosition:.5},cO={binSpacing:0,continuousBandSize:np,timeUnitBandPosition:.5},fO={thickness:1};function dO(e){return en(e)?e.type:e}function Yu(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:s}=e,o=rp(e);return C(n)&&!Ad(n.aggregate)&&r&&st(r.get("type"))&&r.get("zero")===!1?ip({fieldDef:n,channel:t,markDef:i,ref:o,config:s}):o}function ip({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){return Nn(n.type)||M("invalid",n,r)===null?i:[pO(e,t),i]}function pO(e,t){const n=Ju(e,!0),r=di(t)==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function Ju(e,t=!0){return Wu(P(e)?e:w(e,{expr:"datum"}),!t)}function gO(e){const{datum:t}=e;return pi(t)?Fr(t):`${JSON.stringify(t)}`}function Jn(e,t,n,i){const r={};if(t&&(r.scale=t),Tn(e)){const{datum:s}=e;pi(s)?r.signal=Fr(s):T(s)?r.signal=s.signal:qr(s)?r.signal=s.expr:r.value=s}else r.field=w(e,n);if(i){const{offset:s,band:o}=i;s&&(r.offset=s),o&&(r.band=o)}return r}function Ds({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,band:s=.5}){const o=0<s&&s<1?"datum":void 0,a=w(t,{expr:o,suffix:r}),u=n!==void 0?w(n,{expr:o}):w(t,{suffix:"end",expr:o}),l={};if(s===0||s===1){l.scale=e;const c=s===0?a:u;l.field=c}else{const c=`${s} * ${a} + ${1-s} * ${u}`;l.signal=`scale("${e}", ${c})`}return i&&(l.offset=i),l}function rp({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:u,defaultRef:l,band:c}){var f;if(t){if(k(t)){if(Je(t)){c=c!=null?c:Xr({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:a,config:r,isMidPoint:!0});const{bin:p,timeUnit:g,type:m}=t;if(J(p)||c&&g&&m===Ii)return a&&a.impute?Jn(t,s,{binSuffix:"mid"},{offset:u}):c?Ds({scaleName:s,fieldOrDatumDef:t,band:c,offset:u}):Jn(t,s,Yr(t,e)?{binSuffix:"range"}:{},{offset:u});if(Se(p)){if(C(n))return Ds({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:u});O(Bd(e===Z?ft:jt))}}const d=o==null?void 0:o.get("type");return Jn(t,s,Ie(d)?{binSuffix:"range"}:{},{offset:u,band:d==="band"?(f=c!=null?c:t.band)!==null&&f!==void 0?f:.5:void 0})}else if(ut(t)){const d=t.value,p=u?{offset:u}:{};return Object.assign(Object.assign({},vr(e,d)),p)}}return $h(l)&&(l=l()),l&&Object.assign(Object.assign({},l),u?{offset:u}:{})}function vr(e,t){return D(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:D(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:Q(t)}function ri(e){return e&&e!=="number"&&e!=="time"}function sp(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}const hO=" \u2013 ";function Ku({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s}){var o,a;if(ri(n))return Qu({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:s});const u=op(e,i,r);if(Ri(e)){const l=bO(u,C(e)?(o=_e(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0,t,s.timeFormat,Oo(e)&&((a=e.scale)===null||a===void 0?void 0:a.type)===oe.UTC);return l?{signal:l}:void 0}if(t=lp(pn(e),t,s),C(e)&&J(e.bin)){const l=w(e,{expr:i,binSuffix:"end"});return{signal:ho(u,l,t,n,s)}}else return t||pn(e)==="quantitative"?{signal:`${cp(u,t)}`}:{signal:`isValid(${u}) ? ${u} : ""+${u}`}}function op(e,t,n){return C(e)?n?`${w(e,{expr:t,suffix:"end"})}-${w(e,{expr:t,suffix:"start"})}`:w(e,{expr:t}):gO(e)}function Qu({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s,field:o}){if(o=o!=null?o:op(e,i,r),C(e)&&J(e.bin)){const a=w(e,{expr:i,binSuffix:"end"});return{signal:ho(o,a,t,n,s)}}return{signal:sp(n,o,t)}}function ap(e,t,n,i,r,s){var o;if(!ri(i)){if(Ri(e)){const a=C(e)?(o=_e(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0;return mO(n,a,r,s)}return lp(t,n,r)}}function up(e,t,n){if(e&&(T(e)||e==="number"||e==="time"))return e;if(Ri(t)&&n!=="time"&&n!=="utc")return"time"}function lp(e,t,n){if(P(t))return t;if(e===ii)return n.numberFormat}function mO(e,t,n,i){return e||(t?{signal:Hd(t)}:i?void 0:n.timeFormat)}function cp(e,t){return`format(${e}, "${t||""}")`}function Bc(e,t,n,i){var r;return ri(n)?sp(n,e,t):cp(e,(r=P(t)?t:void 0)!==null&&r!==void 0?r:i.numberFormat)}function ho(e,t,n,i,r){const s=Bc(e,n,i,r),o=Bc(t,n,i,r);return`${Wu(e,!1)} ? "null" : ${s} + "${hO}" + ${o}`}function bO(e,t,n,i,r){return!t||n?(n=P(n)?n:i,`${r?"utc":"time"}Format(${e}, '${n}')`):vv(t,e,r)}const mo="min",yO={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function zc(e){return e in yO}function fp(e){return!!e&&!!e.encoding}function At(e){return!!e&&(e.op==="count"||!!e.field)}function dp(e){return!!e&&j(e)}function Vr(e){return"row"in e||"column"in e}function Zu(e){return!!e&&"header"in e}function bo(e){return"facet"in e}var Ra=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function vO(e){return e.selection}function OO(e){return e&&!P(e)&&"repeat"in e}function Mc(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function el(e){return"sort"in e}function Xr({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:r,config:s,isMidPoint:o}){if(k(t)&&t.band!==void 0)return t.band;if(C(t)){const{timeUnit:a,bin:u}=t;if(a&&!n)return o?si("timeUnitBandPosition",i,s):Rc(i.type)?si("timeUnitBand",i,s):0;if(J(u))return Rc(i.type)&&!o?1:.5}if((r==null?void 0:r.fieldChannel)===e&&o)return .5}function tl(e,t,n,i,r,s){return J(t.bin)||t.timeUnit&&Je(t)&&t.type==="temporal"?!!Xr({channel:e,fieldDef:t,fieldDef2:n,stack:i,markDef:r,config:s}):!1}function nl(e){return!!e&&"condition"in e}function yo(e){const t=e&&e.condition;return!!t&&!j(t)&&C(t)}function vo(e){const t=e&&e.condition;return!!t&&!j(t)&&k(t)}function EO(e){const t=e&&e.condition;return!!t&&(j(t)||ut(t))}function C(e){return!!e&&(!!e.field||e.aggregate==="count")}function pn(e){return e&&e.type}function Tn(e){return!!e&&"datum"in e}function xt(e){return Je(e)&&mp(e)||La(e)}function La(e){return Tn(e)&&ae(e.datum)}function k(e){return C(e)||Tn(e)}function Je(e){return!!e&&("field"in e||e.aggregate==="count")&&"type"in e}function ut(e){return e&&"value"in e&&"value"in e}function Oo(e){return!!e&&("scale"in e||"sort"in e)}function il(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function pp(e){return!!e&&"legend"in e}function gp(e){return!!e&&("format"in e||"formatType"in e)}function xO(e){return We(e,["legend","axis","header","scale"])}function AO(e){return"op"in e}function w(e,t={}){var n,i,r;let s=e.field;const o=t.prefix;let a=t.suffix,u="";if(wO(e))s=yd("count");else{let l;if(!t.nofn)if(AO(e))l=e.op;else{const{bin:c,aggregate:f,timeUnit:d}=e;J(c)?(l=Td(c),a=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((i=t.suffix)!==null&&i!==void 0?i:"")):f?wn(f)?(u=`["${s}"]`,s=`argmax_${f.argmax}`):Zt(f)?(u=`["${s}"]`,s=`argmin_${f.argmin}`):l=String(f):d&&(l=Ov(d),a=(!D(["range","mid"],t.binSuffix)&&t.binSuffix||"")+((r=t.suffix)!==null&&r!==void 0?r:""))}l&&(s=s?`${l}_${s}`:l)}return a&&(s=`${s}_${a}`),o&&(s=`${o}_${s}`),t.forAs?wu(s):t.expr?hd(s,t.expr)+u:Qt(s)+u}function hp(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return C(e)&&!!e.bin;case"temporal":return!1}throw new Error(Pd(e.type))}function mp(e){return!hp(e)}function wO(e){return e.aggregate==="count"}function SO(e,t){var n;const{field:i,bin:r,timeUnit:s,aggregate:o}=e;if(o==="count")return t.countTitle;if(J(r))return`${i} (binned)`;if(s){const a=(n=_e(s))===null||n===void 0?void 0:n.unit;if(a)return`${i} (${Pu(a).join("-")})`}else if(o)return wn(o)?`${i} for max ${o.argmax}`:Zt(o)?`${i} for min ${o.argmin}`:`${Lr(o)} of ${i}`;return i}function CO(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(wn(t))return`${r} for argmax(${t.argmax})`;if(Zt(t))return`${r} for argmin(${t.argmin})`;const s=_e(i),o=t||(s==null?void 0:s.unit)||(s==null?void 0:s.maxbins)&&"timeunit"||J(n)&&"bin";return o?o.toUpperCase()+"("+r+")":r}const bp=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return CO(e);default:return SO(e,t)}};let yp=bp;function vp(e){yp=e}function FO(){vp(bp)}function ji(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,s;const o=(r=rl(e))===null||r===void 0?void 0:r.title;if(!C(e))return o;const a=e,u=i?sl(a,t):void 0;return n?se(o,a.title,u):(s=o!=null?o:a.title)!==null&&s!==void 0?s:u}function rl(e){if(il(e)&&e.axis)return e.axis;if(pp(e)&&e.legend)return e.legend;if(Zu(e)&&e.header)return e.header}function sl(e,t){return yp(e,t)}function Ns(e){var t;if(gp(e)){const{format:n,formatType:i}=e;return{format:n,formatType:i}}else{const n=(t=rl(e))!==null&&t!==void 0?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function _O(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(el(e)&&j(e.sort))return"ordinal";const{aggregate:i,bin:r,timeUnit:s}=e;if(s)return"temporal";if(r||i&&!wn(i)&&!Zt(i))return"quantitative";if(Oo(e)&&((n=e.scale)===null||n===void 0?void 0:n.type))switch(Pa[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function Ft(e){if(C(e))return e;if(yo(e))return e.condition}function le(e){if(k(e))return e;if(vo(e))return e.condition}function Op(e,t,n,i={}){if(P(e)||ae(e)||Hi(e)){const r=P(e)?"string":ae(e)?"number":"boolean";return O(wy(t,r,e)),{value:e}}return k(e)?Ts(e,t,n,i):vo(e)?Object.assign(Object.assign({},e),{condition:Ts(e.condition,t,n,i)}):e}function Ts(e,t,n,i){if(gp(e)){const{format:r,formatType:s}=e,o=Ra(e,["format","formatType"]);if(ri(s)&&!n.customFormatTypes)return O(Tc(t)),Ts(o,t,n,i)}else{const r=il(e)?"axis":pp(e)?"legend":Zu(e)?"header":null;if(r&&e[r]){const s=e[r],{format:o,formatType:a}=s,u=Ra(s,["format","formatType"]);if(ri(a)&&!n.customFormatTypes)return O(Tc(t)),Ts(Object.assign(Object.assign({},e),{[r]:u}),t,n,i)}}return C(e)?ol(e,t,i):$O(e)}function $O(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=ae(n)?"quantitative":P(n)?"nominal":pi(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}function ol(e,t,{compositeMark:n=!1}={}){const{aggregate:i,timeUnit:r,bin:s,field:o}=e,a=Object.assign({},e);if(!n&&i&&!Su(i)&&!wn(i)&&!Zt(i)&&(O(Cy(i)),delete a.aggregate),r&&(a.timeUnit=_e(r)),o&&(a.field=`${o}`),J(s)&&(a.bin=Eo(s,t)),Se(s)&&!Ct(t)&&O(nv(t)),Je(a)){const{type:u}=a,l=jv(u);u!==l&&(a.type=l),u!=="quantitative"&&Ad(i)&&(O(Sy(u,i)),a.type="quantitative")}else if(!$d(t)){const u=_O(a,t);a.type=u}if(Je(a)){const{compatible:u,warning:l}=jO(a,t)||{};u===!1&&O(l)}if(el(a)&&P(a.sort)){const{sort:u}=a;if(zc(u))return Object.assign(Object.assign({},a),{sort:{encoding:u}});const l=u.substr(1);if(u.charAt(0)==="-"&&zc(l))return Object.assign(Object.assign({},a),{sort:{encoding:l,order:"descending"}})}if(Zu(a)){const{header:u}=a,{orient:l}=u,c=Ra(u,["orient"]);if(l)return Object.assign(Object.assign({},a),{header:Object.assign(Object.assign({},c),{labelOrient:u.labelOrient||l,titleOrient:u.titleOrient||l})})}return a}function Eo(e,t){return Hi(e)?{maxbins:Cc(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?Object.assign(Object.assign({},e),{maxbins:Cc(t)}):e}const Rn={compatible:!0};function jO(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case Vt:case Xt:case to:return mp(e)?{compatible:!1,warning:$y(t)}:Rn;case Z:case ce:case ke:case kt:case Pt:case Mr:case Wr:case no:case ni:case io:case ro:case fi:case dt:case Dt:case so:return Rn;case Tt:case Ve:case Nt:case pt:return n!==ii?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:Rn;case sn:case Sn:case Cn:case Fn:case rn:case nn:case tn:case ft:case jt:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:Rn;case _n:return D(["ordinal","nominal"],e.type)?Rn:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case Pe:return D(["ordinal","nominal","geojson"],e.type)?Rn:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case Ur:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:Rn}}function Ri(e){const{formatType:t}=Ns(e);return t==="time"||!t&&DO(e)}function DO(e){return e&&(e.type==="temporal"||C(e)&&!!e.timeUnit)}function xo(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var s;const o=t&&((s=_e(t))===null||s===void 0?void 0:s.unit);let a=o||n==="temporal",u;return qr(e)?u=e.expr:T(e)?u=e.signal:pi(e)?(a=!0,u=Fr(e)):(P(e)||ae(e))&&a&&(u=`datetime(${JSON.stringify(e)})`,hv(o)&&(ae(e)&&e<1e4||P(e)&&isNaN(Date.parse(e)))&&(u=Fr({[o]:e}))),u?i&&a?`time(${u})`:u:r?void 0:JSON.stringify(e)}function Ep(e,t){const{type:n}=e;return t.map(i=>{const r=xo(i,{timeUnit:C(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return r!==void 0?{signal:r}:i})}function Yr(e,t){return J(e.bin)?jn(t)&&D(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}var NO=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function xp(e){const{anchor:t,frame:n,offset:i,orient:r,color:s,subtitleColor:o,subtitleFont:a,subtitleFontSize:u,subtitleFontStyle:l,subtitleFontWeight:c,subtitleLineHeight:f,subtitlePadding:d}=e,p=NO(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),g=Object.assign(Object.assign({},p),s?{fill:s}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),h=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),a?{subtitleFont:a}:{}),u?{subtitleFontSize:u}:{}),l?{subtitleFontStyle:l}:{}),c?{subtitleFontWeight:c}:{}),f?{subtitleLineHeight:f}:{}),d?{subtitlePadding:d}:{}),x=Ni(g,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:g,subtitleMarkConfig:x,nonMark:m,subtitle:h}}function gn(e){return P(e)||j(e)&&P(e[0])}var al=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Ap(e){const t=j(e.condition)?e.condition.map(Uc):Uc(e.condition);return Object.assign(Object.assign({},Ce(e)),{condition:t})}function Ce(e){if(qr(e)){const{expr:t}=e,n=al(e,["expr"]);return Object.assign({signal:t},n)}return e}function Uc(e){if(qr(e)){const{expr:t}=e,n=al(e,["expr"]);return Object.assign({signal:t},n)}return e}function Q(e){if(qr(e)){const{expr:t}=e,n=al(e,["expr"]);return Object.assign({signal:t},n)}return T(e)?e:e!==void 0?{value:e}:void 0}function Wc(e){return T(e)?e.signal:B(e.value)}function Yt(e){return T(e)?e.signal:e==null?null:B(e)}function TO(e,t,n){for(const i of n){const r=si(i,t.markDef,t.config);r!==void 0&&(e[i]=Q(r))}return e}function wp(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function M(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:s}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:s&&(!r||r===e)?void 0:si(e,t,n,i)}function si(e,t,n,{vgChannel:i}={}){return se(i?ks(e,t,n.style):void 0,ks(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function ks(e,t,n){return Sp(e,wp(t),n)}function Sp(e,t,n){t=re(t);let i;for(const r of t){const s=n[r];s&&s[e]!==void 0&&(i=s[e])}return i}function Cp(e,t){return re(e).reduce((n,i)=>{var r;return n.field.push(w(i,t)),n.order.push((r=i.sort)!==null&&r!==void 0?r:"ascending"),n},{field:[],order:[]})}function Fp(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(Xi(r,i))return;n.push(i)}),n}function _p(e,t){return Xi(e,t)||!t?e:e?[...re(e),...re(t)].join(", "):t}function $p(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((gn(n)||T(n))&&(gn(i)||T(i)))return{explicit:e.explicit,value:_p(n,i)};if(gn(n)||T(n))return{explicit:e.explicit,value:n};if(gn(i)||T(i))return{explicit:e.explicit,value:i};if(!gn(n)&&!T(n)&&!gn(i)&&!T(i))return{explicit:e.explicit,value:Fp(n,i)};throw new Error("It should never reach here")}function on(e){return"mark"in e}class Ao{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return on(t)?dO(t.mark)===this.name:!1}}var kO=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Kn(e,t){const n=e&&e[t];return n?j(n)?Ti(n,i=>!!i.field):C(n)||yo(n):!1}function ul(e){return Ti(Vb,t=>{if(Kn(e,t)){const n=e[t];if(j(n))return Ti(n,i=>!!i.aggregate);{const i=Ft(n);return i&&!!i.aggregate}}return!1})}function jp(e,t){const n=[],i=[],r=[],s=[],o={};return ll(e,(a,u)=>{if(C(a)){const{field:l,aggregate:c,bin:f,timeUnit:d}=a,p=kO(a,["field","aggregate","bin","timeUnit"]);if(c||d||f){const g=rl(a),m=g&&g.title;let h=w(a,{forAs:!0});const x=Object.assign(Object.assign(Object.assign({},m?[]:{title:ji(a,t,{allowDisabling:!0})}),p),{field:h});if(c){let v;if(wn(c)?(v="argmax",h=w({op:"argmax",field:c.argmax},{forAs:!0}),x.field=`${h}.${l}`):Zt(c)?(v="argmin",h=w({op:"argmin",field:c.argmin},{forAs:!0}),x.field=`${h}.${l}`):c!=="boxplot"&&c!=="errorbar"&&c!=="errorband"&&(v=c),v){const S={op:v,as:h};l&&(S.field=l),s.push(S)}}else if(n.push(h),Je(a)&&J(f)){if(i.push({bin:f,field:l,as:h}),n.push(w(a,{binSuffix:"end"})),Yr(a,u)&&n.push(w(a,{binSuffix:"range"})),Ct(u)){const v={field:h+"_end"};o[u+"2"]=v}x.bin="binned",$d(u)||(x.type=ii)}else if(d){r.push({timeUnit:d,field:l,as:h});const v=Je(a)&&a.type!==Ii&&"time";v&&(u===Mr||u===ni?x.formatType=v:ny(u)?x.legend=Object.assign({formatType:v},x.legend):Ct(u)&&(x.axis=Object.assign({formatType:v},x.axis)))}o[u]=x}else n.push(l),o[u]=e[u]}else o[u]=e[u]}),{bins:i,timeUnits:r,aggregate:s,groupby:n,encoding:o}}function PO(e,t,n){const i=ry(t,n);if(i){if(i==="binned"){const r=e[t===ft?Z:ce];return!!(C(r)&&C(e[t])&&Se(r.bin))}}else return!1;return!0}function IO(e,t,n,i){return y(e).reduce((r,s)=>{if(!_d(s))return O(_y(s)),r;const o=e[s];if(s==="angle"&&t==="arc"&&!e.theta&&(O(Ay),s=dt),!PO(e,s,t))return O(lo(s,t)),r;if(s===rn&&t==="line"){const a=Ft(e[s]);if(a==null?void 0:a.aggregate)return O(Fy),r}if(s===ke&&(n?"fill"in e:"stroke"in e))return O(Id("encoding",{fill:"fill"in e,stroke:"stroke"in e})),r;if(s===Wr||s===Ur&&!j(o)&&!ut(o)||s===ni&&j(o))o&&(r[s]=re(o).reduce((a,u)=>(C(u)?a.push(ol(u,s)):O(Ta(u,s)),a),[]));else{if(s===ni&&o===null)r[s]=null;else if(!C(o)&&!Tn(o)&&!ut(o)&&!nl(o)&&!T(o))return O(Ta(o,s)),r;r[s]=Op(o,s,i)}return r},{})}function wo(e,t){const n={};for(const i of y(e)){const r=Op(e[i],i,t,{compositeMark:!0});n[i]=r}return n}function RO(e){const t=[];for(const n of y(e))if(Kn(e,n)){const i=e[n],r=re(i);for(const s of r)C(s)?t.push(s):yo(s)&&t.push(s.condition)}return t}function ll(e,t,n){if(!!e)for(const i of y(e)){const r=e[i];if(j(r))for(const s of r)t.call(n,s,i);else t.call(n,r,i)}}function LO(e,t,n,i){return e?y(e).reduce((r,s)=>{const o=e[s];return j(o)?o.reduce((a,u)=>t.call(i,a,u,s),r):t.call(i,r,o,s)},n):n}function Dp(e,t){return y(t).reduce((n,i)=>{switch(i){case Z:case ce:case io:case so:case ro:case ft:case jt:case dt:case nn:case Dt:case tn:case Nt:case Tt:case pt:case Ve:case Mr:case Pe:case fi:case ni:return n;case Ur:if(e==="line"||e==="trail")return n;case Wr:case no:{const r=t[i];if(j(r)||C(r))for(const s of re(r))s.aggregate||n.push(w(s,{}));return n}case rn:if(e==="trail")return n;case ke:case kt:case Pt:case sn:case Sn:case Cn:case _n:case Fn:{const r=Ft(t[i]);return r&&!r.aggregate&&n.push(w(r,{})),n}}},[])}var Np=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function BO(e){const{tooltip:t}=e,n=Np(e,["tooltip"]);if(!t)return{filteredEncoding:n};let i,r;if(j(t)){for(const s of t)s.aggregate?(i||(i=[]),i.push(s)):(r||(r=[]),r.push(s));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return j(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function Ba(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:o,titlePrefix:a})=>{const u=i?` of ${cl(t)}`:"";return{field:o+t.field,type:t.type,title:T(a)?{signal:a+`"${escape(u)}"`}:a+u}}),s=RO(n).map(xO);return{tooltip:[...r,...Et(s,R)]}}function cl(e){const{title:t,field:n}=e;return se(t,n)}function fl(e,t,n,i,r){const{scale:s,axis:o}=n;return({partName:a,mark:u,positionPrefix:l,endPositionPrefix:c=void 0,extraEncoding:f={}})=>{const d=cl(n);return Tp(e,a,r,{mark:u,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:l+"_"+n.field,type:n.type},d!==void 0?{title:d}:{}),s!==void 0?{scale:s}:{}),o!==void 0?{axis:o}:{})},P(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),i),f)})}}function Tp(e,t,n,i){const{clip:r,color:s,opacity:o}=e,a=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),r?{clip:r}:{}),s?{color:s}:{}),o?{opacity:o}:{}),en(i.mark)?i.mark:{type:i.mark}),{style:`${a}-${t}`}),Hi(e[t])?{}:e[t])})]:[]}function kp(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",s=i[r],o=i[r+"2"],a=i[r+"Error"],u=i[r+"Error2"];return{continuousAxisChannelDef:os(s,n),continuousAxisChannelDef2:os(o,n),continuousAxisChannelDefError:os(a,n),continuousAxisChannelDefError2:os(u,n),continuousAxis:r}}function os(e,t){if(e&&e.aggregate){const{aggregate:n}=e,i=Np(e,["aggregate"]);return n!==t&&O(tv(n,t)),i}else return e}function Pp(e,t){const{mark:n,encoding:i}=e,{x:r,y:s}=i;if(en(n)&&n.orient)return n.orient;if(xt(r)){if(xt(s)){const o=C(r)&&r.aggregate,a=C(s)&&s.aggregate;if(!o&&a===t)return"vertical";if(!a&&o===t)return"horizontal";if(o===t&&a===t)throw new Error("Both x and y cannot have aggregate");return Ri(s)&&!Ri(r)?"horizontal":"vertical"}return"horizontal"}else{if(xt(s))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}}var Es=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Ps="boxplot",zO=["box","median","outliers","rule","ticks"],MO=new Ao(Ps,Rp);function Ip(e){return ae(e)?"tukey":e}function Rp(e,{config:t}){var n,i;e=Object.assign(Object.assign({},e),{encoding:wo(e.encoding,t)});const{mark:r,encoding:s,selection:o,projection:a}=e,u=Es(e,["mark","encoding","selection","projection"]),l=en(r)?r:{type:r};o&&O(kd("boxplot"));const c=(n=l.extent)!==null&&n!==void 0?n:t.boxplot.extent,f=M("size",l,t),d=Ip(c),{bins:p,timeUnits:g,transform:m,continuousAxisChannelDef:h,continuousAxis:x,groupby:v,aggregate:S,encodingWithoutContinuousAxis:F,ticksOrient:E,boxOrient:$,customTooltipWithoutAggregatedField:A}=UO(e,c,t),{color:N,size:U}=F,K=Es(F,["color","size"]),Ae=cn=>fl(l,x,h,cn,t.boxplot),Re=Ae(K),Qe=Ae(F),ee=Ae(Object.assign(Object.assign({},K),U?{size:U}:{})),Le=Ba([{fieldPrefix:d==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:d==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],h,F),ge={type:"tick",color:"black",opacity:1,orient:E,invalid:null,aria:!1},he=d==="min-max"?Le:Ba([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],h,F),Be=[...Re({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:he}),...Re({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:he}),...Re({partName:"ticks",mark:ge,positionPrefix:"lower_whisker",extraEncoding:he}),...Re({partName:"ticks",mark:ge,positionPrefix:"upper_whisker",extraEncoding:he})],Ze=[...d!=="tukey"?Be:[],...Qe({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:$,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:Le}),...ee({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},ue(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:E,aria:!1}),positionPrefix:"mid_box",extraEncoding:Le})];if(d==="min-max")return Object.assign(Object.assign({},u),{transform:((i=u.transform)!==null&&i!==void 0?i:[]).concat(m),layer:Ze});const Bt=`datum["lower_box_${h.field}"]`,yi=`datum["upper_box_${h.field}"]`,ht=`(${yi} - ${Bt})`,vi=`${Bt} - ${c} * ${ht}`,mt=`${yi} + ${c} * ${ht}`,Pn=`datum["${h.field}"]`,Oi={joinaggregate:Lp(h.field),groupby:v},Ei={transform:[{filter:`(${vi} <= ${Pn}) && (${Pn} <= ${mt})`},{aggregate:[{op:"min",field:h.field,as:"lower_whisker_"+h.field},{op:"max",field:h.field,as:"upper_whisker_"+h.field},{op:"min",field:"lower_box_"+h.field,as:"lower_box_"+h.field},{op:"max",field:"upper_box_"+h.field,as:"upper_box_"+h.field},...S],groupby:v}],layer:Be},In=Es(K,["tooltip"]),{scale:un,axis:nr}=h,ir=cl(h),ln=We(nr,["title"]),rr=Tp(l,"outliers",t.boxplot,{transform:[{filter:`(${Pn} < ${vi}) || (${Pn} > ${mt})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[x]:Object.assign(Object.assign(Object.assign({field:h.field,type:h.type},ir!==void 0?{title:ir}:{}),un!==void 0?{scale:un}:{}),G(ln)?{}:{axis:ln})},In),N?{color:N}:{}),A?{tooltip:A}:{})})[0];let bt;const Yo=[...p,...g,Oi];return rr?bt={transform:Yo,layer:[rr,Ei]}:(bt=Ei,bt.transform.unshift(...Yo)),Object.assign(Object.assign({},u),{layer:[bt,{transform:m,layer:Ze}]})}function Lp(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}function UO(e,t,n){const i=Pp(e,Ps),{continuousAxisChannelDef:r,continuousAxis:s}=kp(e,i,Ps),o=r.field,a=Ip(t),u=[...Lp(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:(a==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(a==="min-max"?"upper_whisker_":"max_")+o}],l=a==="min-max"||a==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],c=e.encoding,f=s;c[f];const d=Es(c,[typeof f=="symbol"?f:f+""]),{customTooltipWithoutAggregatedField:p,filteredEncoding:g}=BO(d),{bins:m,timeUnits:h,aggregate:x,groupby:v,encoding:S}=jp(g,n),F=i==="vertical"?"horizontal":"vertical",E=i,$=[...m,...h,{aggregate:[...x,...u],groupby:v},...l];return{bins:m,timeUnits:h,transform:$,groupby:v,aggregate:x,continuousAxisChannelDef:r,continuousAxis:s,encodingWithoutContinuousAxis:S,ticksOrient:F,boxOrient:E,customTooltipWithoutAggregatedField:p}}var Gc=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const dl="errorbar",WO=["ticks","rule"],GO=new Ao(dl,Bp);function Bp(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:wo(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:u,tooltipEncoding:l}=zp(e,dl,t);delete s.size;const c=fl(a,r,i,s,t.errorbar),f=a.thickness,d=a.size,p=Object.assign(Object.assign({type:"tick",orient:o,aria:!1},f!==void 0?{thickness:f}:{}),d!==void 0?{size:d}:{}),g=[...c({partName:"ticks",mark:p,positionPrefix:"lower",extraEncoding:l}),...c({partName:"ticks",mark:p,positionPrefix:"upper",extraEncoding:l}),...c({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},f!==void 0?{size:f}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},u),{transform:n}),g.length>1?{layer:g}:Object.assign({},g[0]))}function HO(e,t){const{encoding:n}=e;if(qO(n))return{orient:Pp(e,t),inputType:"raw"};const i=VO(n),r=XO(n),s=n.x,o=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const a=n.x2,u=n.y2;if(k(a)&&k(u))throw new Error(`${t} cannot have both x2 and y2`);if(k(a)){if(xt(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(k(u)){if(xt(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const a=n.xError,u=n.xError2,l=n.yError,c=n.yError2;if(k(u)&&!k(a))throw new Error(`${t} cannot have xError2 without xError`);if(k(c)&&!k(l))throw new Error(`${t} cannot have yError2 without yError`);if(k(a)&&k(l))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(k(a)){if(xt(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(k(l)){if(xt(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function qO(e){return(k(e.x)||k(e.y))&&!k(e.x2)&&!k(e.y2)&&!k(e.xError)&&!k(e.xError2)&&!k(e.yError)&&!k(e.yError2)}function VO(e){return k(e.x2)||k(e.y2)}function XO(e){return k(e.xError)||k(e.xError2)||k(e.yError)||k(e.yError2)}function zp(e,t,n){var i;const{mark:r,encoding:s,selection:o,projection:a}=e,u=Gc(e,["mark","encoding","selection","projection"]),l=en(r)?r:{type:r};o&&O(kd(t));const{orient:c,inputType:f}=HO(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:p,continuousAxisChannelDefError:g,continuousAxisChannelDefError2:m,continuousAxis:h}=kp(e,c,t),{errorBarSpecificAggregate:x,postAggregateCalculates:v,tooltipSummary:S,tooltipTitleWithFieldName:F}=YO(l,d,p,g,m,f,t,n),E=s,$=h;E[$];const A=h==="x"?"x2":"y2";E[A];const N=h==="x"?"xError":"yError";E[N];const U=h==="x"?"xError2":"yError2";E[U];const K=Gc(E,[typeof $=="symbol"?$:$+"",typeof A=="symbol"?A:A+"",typeof N=="symbol"?N:N+"",typeof U=="symbol"?U:U+""]),{bins:Ae,timeUnits:Re,aggregate:Qe,groupby:ee,encoding:Le}=jp(K,n),ge=[...Qe,...x],he=f!=="raw"?[]:ee,Be=Ba(S,d,Le,F);return{transform:[...(i=u.transform)!==null&&i!==void 0?i:[],...Ae,...Re,...ge.length===0?[]:[{aggregate:ge,groupby:he}],...v],groupby:he,continuousAxisChannelDef:d,continuousAxis:h,encodingWithoutContinuousAxis:Le,ticksOrient:c==="vertical"?"horizontal":"vertical",markDef:l,outerSpec:u,tooltipEncoding:Be}}function YO(e,t,n,i,r,s,o,a){let u=[],l=[];const c=t.field;let f,d=!1;if(s==="raw"){const p=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":a.errorbar.center,g=e.extent?e.extent:p==="mean"?"stderr":"iqr";if(p==="median"!=(g==="iqr")&&O(ev(p,g,o)),g==="stderr"||g==="stdev")u=[{op:g,field:c,as:"extent_"+c},{op:p,field:c,as:"center_"+c}],l=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],f=[{fieldPrefix:"center_",titlePrefix:Lr(p)},{fieldPrefix:"upper_",titlePrefix:Hc(p,g,"+")},{fieldPrefix:"lower_",titlePrefix:Hc(p,g,"-")}],d=!0;else{let m,h,x;g==="ci"?(m="mean",h="ci0",x="ci1"):(m="median",h="q1",x="q3"),u=[{op:h,field:c,as:"lower_"+c},{op:x,field:c,as:"upper_"+c},{op:m,field:c,as:"center_"+c}],f=[{fieldPrefix:"upper_",titlePrefix:ji({field:c,aggregate:x,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:ji({field:c,aggregate:h,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:ji({field:c,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&O(Zy(e.center,e.extent)),s==="aggregated-upper-lower"?(f=[],l=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):s==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:c}],l=[{calculate:`datum["${c}"] + datum["${i.field}"]`,as:"upper_"+c}],r?l.push({calculate:`datum["${c}"] + datum["${r.field}"]`,as:"lower_"+c}):l.push({calculate:`datum["${c}"] - datum["${i.field}"]`,as:"lower_"+c}));for(const p of l)f.push({fieldPrefix:p.as.substring(0,6),titlePrefix:ti(ti(p.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:u,tooltipSummary:f,tooltipTitleWithFieldName:d}}function Hc(e,t,n){return Lr(e)+" "+n+" "+t}const pl="errorband",JO=["band","borders"],KO=new Ao(pl,Mp);function Mp(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:wo(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:u}=zp(e,pl,t),l=o,c=fl(l,r,i,s,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},p={type:f?"line":"rule"};const g=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),g),{ariaRoleDescription:"errorband"}),p=Object.assign(Object.assign(Object.assign({},p),g),{aria:!1})):l.interpolate?O(Pc("interpolate")):l.tension&&O(Pc("tension")),Object.assign(Object.assign({},a),{transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...c({partName:"borders",mark:p,positionPrefix:"lower",extraEncoding:u}),...c({partName:"borders",mark:p,positionPrefix:"upper",extraEncoding:u})]})}const Up={};function gl(e,t,n){const i=new Ao(e,t);Up[e]={normalizer:i,parts:n}}function QO(){return y(Up)}gl(Ps,Rp,zO);gl(dl,Bp,WO);gl(pl,Mp,JO);const ZO=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],Wp={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},Gp={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},e1=y(Wp),t1=y(Gp),n1={header:1,headerRow:1,headerColumn:1,headerFacet:1},Hp=y(n1),qp=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],i1={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},r1={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1};var s1=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Vp(e){const t=[];for(const n of e||[]){const{expr:i,bind:r}=n,s=s1(n,["expr","bind"]);if(r&&i){const o=Object.assign(Object.assign({},s),{bind:r,init:i});t.push(o)}else{const o=Object.assign(Object.assign(Object.assign({},s),i?{update:i}:{}),r?{bind:r}:{});t.push(o)}}return t}const Li="_vgsid_",o1={single:{on:"click",fields:[Li],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[Li],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function hl(e){return!!e&&(e==="legend"||!!e.legend)}function oa(e){return hl(e)&&ue(e)}function a1(e){return So(e)||bl(e)||ml(e)}function ml(e){return"concat"in e}function So(e){return"vconcat"in e}function bl(e){return"hconcat"in e}function _t(e){return ue(e)&&e.step!==void 0}function qc(e){return e.view||e.width||e.height}const Vc=20,u1={align:1,bounds:1,center:1,columns:1,spacing:1},l1=y(u1);function c1(e,t,n){var i,r;const s=n[t],o={},{spacing:a,columns:u}=s;a!==void 0&&(o.spacing=a),u!==void 0&&(bo(e)&&!Vr(e.facet)||ml(e))&&(o.columns=u),So(e)&&(o.columns=1);for(const l of l1)if(e[l]!==void 0)if(l==="spacing"){const c=e[l];o[l]=ae(c)?c:{row:(i=c.row)!==null&&i!==void 0?i:a,column:(r=c.column)!==null&&r!==void 0?r:a}}else o[l]=e[l];return o}var f1=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function za(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function Is(e,t){const n=_r(e,t);return _t(n)?n.step:yl}function _r(e,t){var n;const i=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return se(i,{step:e.step})}const yl=20,d1={continuousWidth:200,continuousHeight:200,step:yl},p1={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:d1,mark:oO,arc:{},area:{},bar:lO,circle:{},geoshape:{},image:{},line:{},point:{},rect:cO,rule:{color:"black"},square:{},text:{color:"black"},tick:fO,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:Gv,projection:{},legend:i1,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:o1,style:{},title:{},facet:{spacing:Vc},concat:{spacing:Vc}},zt=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],Xc={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},Yc={blue:zt[0],orange:zt[1],red:zt[2],teal:zt[3],green:zt[4],yellow:zt[5],purple:zt[6],pink:zt[7],brown:zt[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function g1(e={}){return{signals:[{name:"color",value:ue(e)?Object.assign(Object.assign({},Yc),e):Yc}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function h1(e){return{signals:[{name:"fontSize",value:ue(e)?Object.assign(Object.assign({},Xc),e):Xc}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function m1(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function Xp(e){const t=y(e||{}),n={};for(const i of t){const r=e[i];n[i]=Br(r)?Ap(r):Ce(r)}return n}function b1(e){const t=y(e),n={};for(const i of t)n[i]=Xp(e[i]);return n}const y1=[...tp,...xd,...Hp,"background","padding","legend","lineBreak","scale","style","title","view"];function Yp(e={}){const{color:t,font:n,fontSize:i}=e,r=f1(e,["color","font","fontSize"]),s=qs({},p1,n?m1(n):{},t?g1(t):{},i?h1(i):{},r||{}),o=We(s,y1);for(const a of["background","lineBreak","padding"])s[a]&&(o[a]=Ce(s[a]));for(const a of tp)s[a]&&(o[a]=it(s[a]));for(const a of xd)s[a]&&(o[a]=Xp(s[a]));for(const a of Hp)s[a]&&(o[a]=it(s[a]));return s.legend&&(o.legend=it(s.legend)),s.scale&&(o.scale=it(s.scale)),s.style&&(o.style=b1(s.style)),s.title&&(o.title=it(s.title)),s.view&&(o.view=it(s.view)),o}const v1=["view",...ep],O1=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],E1=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},sO);function x1(e){e=I(e);for(const t of O1)delete e[t];if(e.axis)for(const t in e.axis)Br(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of ZO)delete e.legend[t];if(e.mark){for(const t of Lc)delete e.mark[t];e.mark.tooltip&&ue(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(Vp(e.params)),delete e.params);for(const t of v1){for(const i of Lc)delete e[t][i];const n=E1[t];if(n)for(const i of n)delete e[t][i];w1(e,t)}for(const t of QO())delete e[t];A1(e);for(const t in e)ue(e[t])&&G(e[t])&&delete e[t];return G(e)?void 0:e}function A1(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=xp(e.title);G(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),G(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),G(i)?delete e.title:e.title=i}function w1(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const s=Object.assign(Object.assign({},r),e.style[n!=null?n:t]);G(s)||(e.style[n!=null?n:t]=s),i||delete e[t]}function Co(e){return"layer"in e}function S1(e){return"repeat"in e}function C1(e){return!j(e.repeat)&&e.repeat.layer}var F1=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class _1{map(t,n){return bo(t)?this.mapFacet(t,n):S1(t)?this.mapRepeat(t,n):bl(t)?this.mapHConcat(t,n):So(t)?this.mapVConcat(t,n):ml(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(Co(t))return this.mapLayer(t,n);if(on(t))return this.mapUnit(t,n);throw new Error(ju(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(i=>this.mapLayerOrUnit(i,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(i=>this.map(i,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(i=>this.map(i,n))})}mapConcat(t,n){const{concat:i}=t,r=F1(t,["concat"]);return Object.assign(Object.assign({},r),{concat:i.map(s=>this.map(s,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const $1={zero:1,center:1,normalize:1};function j1(e){return e in $1}const D1=new Set([Kd,fo,co,js,go,Vu,Xu,po,Qd,qu]),N1=new Set([fo,co,Kd]);function Jc(e,t){var n,i;const r=t==="x"?"y":"radius",s=e[t],o=e[r];if(C(s)&&C(o))if(pn(s)==="quantitative"&&pn(o)==="quantitative"){if(s.stack)return t;if(o.stack)return r;const a=C(s)&&!!s.aggregate,u=C(o)&&!!o.aggregate;if(a!==u)return a?t:r;{const l=(n=s.scale)===null||n===void 0?void 0:n.type,c=(i=o.scale)===null||i===void 0?void 0:i.type;if(l&&l!=="linear")return r;if(c&&c!=="linear")return t}}else{if(pn(s)==="quantitative")return t;if(pn(o)==="quantitative")return r}else{if(pn(s)==="quantitative")return t;if(pn(o)==="quantitative")return r}}function T1(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function Jp(e,t,n={}){const i=en(e)?e.type:e;if(!D1.has(i))return null;const r=Jc(t,"x")||Jc(t,"theta");if(!r)return null;const s=t[r],o=C(s)?w(s,{}):void 0;let a=T1(r),u=t[a],l=C(u)?w(u,{}):void 0;l===o&&(l=void 0,u=void 0,a=void 0);const c=Zb.reduce((d,p)=>{if(p!=="tooltip"&&Kn(t,p)){const g=t[p];for(const m of re(g)){const h=Ft(m);if(h.aggregate)continue;const x=w(h,{});(!x||x!==l)&&d.push({channel:p,fieldDef:h})}}return d},[]);let f;if(s.stack!==void 0?Hi(s.stack)?f=s.stack?"zero":null:f=s.stack:c.length>0&&N1.has(i)&&(f="zero"),!f||!j1(f)||ul(t)&&c.length===0)return null;if(s.scale&&s.scale.type&&s.scale.type!==oe.LINEAR){if(n.disallowNonLinearStack)return null;O(Jy(s.scale.type))}return k(t[It(r)])?(s.stack!==void 0&&O(Yy(r)),null):(C(s)&&s.aggregate&&!D(zb,s.aggregate)&&O(Ky(s.aggregate)),{groupbyChannel:u?a:void 0,groupbyField:l,fieldChannel:r,impute:s.impute===null?!1:Nn(i),stackBy:c,offset:f})}var Kp=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function k1(e){const t=Kp(e,["point","line"]);return y(t).length>1?t:t.type}function P1(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:We(e[t],["point","line"])}));return e}function aa(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?ue(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?ue(t.point)?t.point:{}:void 0}function Kc(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class I1{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(on(t)){const{mark:i,encoding:r}=t,s=en(i)?i:{type:i};switch(s.type){case"line":case"rule":case"trail":return!!aa(s,n[s.type],r);case"area":return!!aa(s,n[s.type],r)||!!Kc(s,n[s.type])}}return!1}run(t,n,i){const{config:r}=n,{selection:s,projection:o,mark:a,encoding:u}=t,l=Kp(t,["selection","projection","mark","encoding"]),c=wo(u,r),f=en(a)?a:{type:a},d=aa(f,r[f.type],c),p=f.type==="area"&&Kc(f,r[f.type]),g=[Object.assign(Object.assign({},s?{selection:s}:{}),{mark:k1(Object.assign(Object.assign({},f.type==="area"&&f.opacity===void 0&&f.fillOpacity===void 0?{opacity:.7}:{}),f)),encoding:We(c,["shape"])})],m=Jp(f,c);let h=c;if(m){const{fieldChannel:x,offset:v}=m;h=Object.assign(Object.assign({},c),{[x]:Object.assign(Object.assign({},c[x]),v?{stack:v}:{})})}return p&&g.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"line"},Ni(f,["clip","interpolate","tension","tooltip"])),p),encoding:h})),d&&g.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},Ni(f,["clip","tooltip"])),d),encoding:h})),i(Object.assign(Object.assign({},l),{layer:g}),Object.assign(Object.assign({},n),{config:P1(r)}))}}var Qc=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class R1{constructor(){this.name="RangeStep"}hasMatchingType(t){var n;if(on(t)&&t.encoding)for(const i of Xe){const r=t.encoding[i];if(r&&k(r)&&((n=r==null?void 0:r.scale)===null||n===void 0?void 0:n.rangeStep))return!0}return!1}run(t){var n;const i={};let r=Object.assign({},t.encoding);for(const s of Xe){const o=Rt(s),a=r[s];if(a&&k(a)&&((n=a==null?void 0:a.scale)===null||n===void 0?void 0:n.rangeStep)){const{scale:u}=a,l=Qc(a,["scale"]),c=u,f=Qc(c,["rangeStep"]);i[o]={step:u.rangeStep},O(ky),r=Object.assign(Object.assign({},r),{[s]:Object.assign(Object.assign({},l),G(f)?{}:{scale:f})})}}return Object.assign(Object.assign(Object.assign({},i),t),{encoding:r})}}var L1=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function B1(e,t){return t?Vr(e)?Zp(e,t):Qp(e,t):e}function ua(e,t){return t?Zp(e,t):e}function Ma(e,t,n){const i=t[e];if(OO(i)){if(i.repeat in n)return Object.assign(Object.assign({},t),{[e]:n[i.repeat]});O(my(i.repeat));return}return t}function Qp(e,t){if(e=Ma("field",e,t),e!==void 0){if(e===null)return null;if(el(e)&&At(e.sort)){const n=Ma("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function Zc(e,t){if(C(e))return Qp(e,t);{const n=Ma("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function ef(e,t){if(k(e)){const n=Zc(e,t);if(n)return n;if(nl(e))return{condition:e.condition}}else{if(vo(e)){const n=Zc(e.condition,t);return n?Object.assign(Object.assign({},e),{condition:n}):L1(e,["condition"])}return e}}function Zp(e,t){const n={};for(const i in e)if(Si(e,i)){const r=e[i];if(j(r))n[i]=r.map(s=>ef(s,t)).filter(s=>s);else{const s=ef(r,t);s!==void 0&&(n[i]=s)}}return n}class z1{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(on(t)){const{encoding:n,mark:i}=t;if(i==="line")for(const r of Kb){const s=di(r),o=n[s];if(n[r]&&(C(o)&&!Se(o.bin)||Tn(o)))return!0}}return!1}run(t,n,i){const{encoding:r}=t;return O(Ny(!!r.x2,!!r.y2)),i(Object.assign(Object.assign({},t),{mark:"rule"}),n)}}var fn=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class M1 extends _1{constructor(){super(...arguments);this.nonFacetUnitNormalizers=[MO,GO,KO,new I1,new z1,new R1]}map(t,n){if(on(t)){const i=Kn(t.encoding,Vt),r=Kn(t.encoding,Xt),s=Kn(t.encoding,to);if(i||r||s)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:i,parentProjection:r}=n,s=ua(t.encoding,n.repeater),o=Object.assign(Object.assign({},t),s?{encoding:s}:{});if(i||r)return this.mapUnitWithParentEncodingOrProjection(o,n);const a=this.mapLayerOrUnit.bind(this);for(const u of this.nonFacetUnitNormalizers)if(u.hasMatchingType(o,n.config))return u.run(o,n,a);return o}mapRepeat(t,n){return C1(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:i,spec:r}=t,s=fn(t,["repeat","spec"]),{row:o,column:a,layer:u}=i,{repeater:l={},repeaterPrefix:c=""}=n;return o||a?this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},o?{row:o}:{}),a?{column:a}:{}),spec:{repeat:{layer:u},spec:r}}),n):Object.assign(Object.assign({},s),{layer:u.map(f=>{const d=Object.assign(Object.assign({},l),{layer:f}),p=(r.name||"")+c+`child__layer_${Y(f)}`,g=this.mapLayerOrUnit(r,Object.assign(Object.assign({},n),{repeater:d,repeaterPrefix:p}));return g.name=p,g})})}mapNonLayerRepeat(t,n){var i;const{repeat:r,spec:s,data:o}=t,a=fn(t,["repeat","spec","data"]);!j(r)&&t.columns&&(t=We(t,["columns"]),O(Dc("repeat")));const u=[],{repeater:l={},repeaterPrefix:c=""}=n,f=!j(r)&&r.row||[l?l.row:null],d=!j(r)&&r.column||[l?l.column:null],p=j(r)&&r||[l?l.repeat:null];for(const m of p)for(const h of f)for(const x of d){const v={repeat:m,row:h,column:x,layer:l.layer},S=(s.name||"")+c+"child__"+(j(r)?`${Y(m)}`:(r.row?`row_${Y(h)}`:"")+(r.column?`column_${Y(x)}`:"")),F=this.map(s,Object.assign(Object.assign({},n),{repeater:v,repeaterPrefix:S}));F.name=S,u.push(We(F,["data"]))}const g=j(r)?t.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:(i=s.data)!==null&&i!==void 0?i:o,align:"all"},a),{columns:g,concat:u})}mapFacet(t,n){const{facet:i}=t;return Vr(i)&&t.columns&&(t=We(t,["columns"]),O(Dc("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:i,projection:r}=t,{parentEncoding:s,parentProjection:o,config:a}=n,u=nf({parentProjection:o,projection:r}),l=tf({parentEncoding:s,encoding:ua(i,n.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),u?{projection:u}:{}),l?{encoding:l}:{}),{config:a})}mapFacetedUnit(t,n){const i=t.encoding,{row:r,column:s,facet:o}=i,a=fn(i,["row","column","facet"]),{mark:u,width:l,projection:c,height:f,view:d,selection:p,encoding:g}=t,m=fn(t,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:h,layout:x}=this.getFacetMappingAndLayout({row:r,column:s,facet:o},n),v=ua(a,n.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},m),x),{facet:h,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),f?{height:f}:{}),d?{view:d}:{}),c?{projection:c}:{}),{mark:u,encoding:v}),p?{selection:p}:{})}),n)}getFacetMappingAndLayout(t,n){var i;const{row:r,column:s,facet:o}=t;if(r||s){o&&O(jy([...r?[Vt]:[],...s?[Xt]:[]]));const a={},u={};for(const l of[Vt,Xt]){const c=t[l];if(c){const f=fn(c,["align","center","spacing","columns"]);a[l]=f;for(const d of["align","center","spacing"])c[d]!==void 0&&(u[d]=(i=u[d])!==null&&i!==void 0?i:{},u[d][l]=c[d])}}return{facetMapping:a,layout:u}}else{const{align:a,center:u,spacing:l,columns:c}=o,f=fn(o,["align","center","spacing","columns"]);return{facetMapping:B1(f,n.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},a?{align:a}:{}),u?{center:u}:{}),l?{spacing:l}:{}),c?{columns:c}:{})}}}mapLayer(t,n){var{parentEncoding:i,parentProjection:r}=n,s=fn(n,["parentEncoding","parentProjection"]);const{encoding:o,projection:a}=t,u=fn(t,["encoding","projection"]),l=Object.assign(Object.assign({},s),{parentEncoding:tf({parentEncoding:i,encoding:o,layer:!0}),parentProjection:nf({parentProjection:r,projection:a})});return super.mapLayer(u,l)}}function tf({parentEncoding:e,encoding:t={},layer:n}){let i={};if(e){const r=new Set([...y(e),...y(t)]);for(const s of r){const o=t[s],a=e[s];if(k(o)){const u=Object.assign(Object.assign({},a),o);i[s]=u}else vo(o)?i[s]=Object.assign(Object.assign({},o),{condition:Object.assign(Object.assign({},a),o.condition)}):o||o===null?i[s]=o:(n||ut(a)||T(a)||k(a)||j(a))&&(i[s]=a)}}else i=t;return!i||G(i)?void 0:i}function nf(e){const{parentProjection:t,projection:n}=e;return t&&n&&O(xy({parentProjection:t,projection:n})),n!=null?n:t}function eg(e,t){t===void 0&&(t=Yp(e.config));const n=W1(e,t),{width:i,height:r}=e,s=G1(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const U1=new M1;function W1(e,t={}){return U1.map(e,{config:t})}function rf(e){return P(e)?{type:e}:e!=null?e:{}}function G1(e,t,n){let{width:i,height:r}=t;const s=on(e)||Co(e),o={};s?i=="container"&&r=="container"?(o.type="fit",o.contains="padding"):i=="container"?(o.type="fit-x",o.contains="padding"):r=="container"&&(o.type="fit-y",o.contains="padding"):(i=="container"&&(O(Fc("width")),i=void 0),r=="container"&&(O(Fc("height")),r=void 0));const a=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?rf(n.autosize):{}),rf(e.autosize));if(a.type==="fit"&&!s&&(O(ay),a.type="pad"),i=="container"&&!(a.type=="fit"||a.type=="fit-x")&&O(_c("width")),r=="container"&&!(a.type=="fit"||a.type=="fit-y")&&O(_c("height")),!Xi(a,{type:"pad"}))return a}function H1(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function q1(e){return e?`fit-${oo(e)}`:"fit"}const V1=["background","padding"];function sf(e,t){const n={};for(const i of V1)e&&e[i]!==void 0&&(n[i]=Ce(e[i]));return t&&(n.params=e.params),n}class an{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new an(I(this.explicit),I(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return se(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,n){n.value!==void 0&&this.set(t,n.value,n.explicit)}set(t,n,i){return delete this[i?"implicit":"explicit"][t],this[i?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,n){n.explicit[t]!==void 0?this.set(t,n.explicit[t],!0):n.implicit[t]!==void 0&&this.set(t,n.implicit[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of y(t.combine())){const i=t.getWithExplicit(n);this.setWithExplicit(n,i)}}}function Wt(e){return{explicit:!0,value:e}}function Me(e){return{explicit:!1,value:e}}function tg(e){return(t,n,i,r)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:Fo(t,n,i,r)}}function Fo(e,t,n,i){return e.explicit&&t.explicit&&O(Uy(n,i,e.value,t.value)),e}function On(e,t,n,i,r=Fo){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Xi(e.value,t.value)?e:r(e,t,n,i)}class X1 extends an{constructor(t={},n={},i=!1){super(t,n);this.explicit=t,this.implicit=n,this.parseNothing=i}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function $r(e){return"url"in e}function Rs(e){return"values"in e}function ng(e){return"name"in e&&!$r(e)&&!Rs(e)&&!Qn(e)}function Qn(e){return e&&(ig(e)||rg(e)||vl(e))}function ig(e){return"sequence"in e}function rg(e){return"sphere"in e}function vl(e){return"graticule"in e}var q;(function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"})(q||(q={}));function sg(e){return"filter"in e}function Y1(e){return(e==null?void 0:e.stop)!==void 0}function J1(e){return"lookup"in e}function K1(e){return"data"in e}function Q1(e){return"selection"in e}function Z1(e){return"pivot"in e}function eE(e){return"density"in e}function tE(e){return"quantile"in e}function nE(e){return"regression"in e}function iE(e){return"loess"in e}function rE(e){return"sample"in e}function sE(e){return"window"in e}function oE(e){return"joinaggregate"in e}function aE(e){return"flatten"in e}function uE(e){return"calculate"in e}function lE(e){return"bin"in e}function cE(e){return"impute"in e}function fE(e){return"timeUnit"in e}function dE(e){return"aggregate"in e}function pE(e){return"stack"in e}function gE(e){return"fold"in e}function hE(e){return e.map(t=>sg(t)?{filter:Os(t.filter,$v)}:t)}function Ji(e,t,n,i){const r=nl(t)&&t.condition,s=i(t);if(r){const a=re(r).map(u=>{const l=i(u),c=vO(u)?Dg(e,u.selection):Ms(e,u.test);return Object.assign({test:c},l)});return{[n]:[...a,...s!==void 0?[s]:[]]}}else return s!==void 0?{[n]:s}:{}}function Ol(e,t="text"){const n=e.encoding[t];return Ji(e,n,t,i=>_o(i,e.config))}function _o(e,t,n="datum"){if(e){if(ut(e))return Q(e.value);if(k(e)){const{format:i,formatType:r}=Ns(e);return Ku({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}}function og(e,t={}){const{encoding:n,markDef:i,config:r,stack:s}=e,o=n.tooltip;if(j(o))return{tooltip:of({tooltip:o},s,r,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return Ji(e,o,"tooltip",u=>{const l=_o(u,r,a);if(l)return l;if(u===null)return;let c=M("tooltip",i,r);if(c===!0&&(c={content:"encoding"}),P(c))return{value:c};if(ue(c))return T(c)?c:c.content==="encoding"?of(n,s,r,t):{signal:a}})}}function ag(e,t,n,{reactiveGeom:i}={}){const r={},s=i?"datum.datum":"datum",o=[];function a(l,c){const f=di(c),d=Je(l)?l:Object.assign(Object.assign({},l),{type:e[f].type}),p=d.title||sl(d,n),g=re(p).join(", ");let m;if(Ct(c)){const h=c==="x"?"x2":"y2",x=Ft(e[h]);if(Se(d.bin)&&x){const v=w(d,{expr:s}),S=w(x,{expr:s}),{format:F,formatType:E}=Ns(d);m=ho(v,S,F,E,n),r[h]=!0}else if(t&&t.fieldChannel===c&&t.offset==="normalize"){const{format:v,formatType:S}=Ns(d);m=Ku({fieldOrDatumDef:d,format:v,formatType:S,expr:s,config:n,normalizeStack:!0}).signal}}m=m!=null?m:_o(d,n,s).signal,o.push({channel:c,key:g,value:m})}ll(e,(l,c)=>{C(l)?a(l,c):yo(l)&&a(l.condition,c)});const u={};for(const{channel:l,key:c,value:f}of o)!r[l]&&!u[c]&&(u[c]=f);return u}function of(e,t,n,{reactiveGeom:i}={}){const r=ag(e,t,n,{reactiveGeom:i}),s=Rr(r).map(([o,a])=>`"${o}": ${a}`);return s.length>0?{signal:`{${s.join(", ")}}`}:void 0}function mE(e){const{markDef:t,config:n}=e,i=M("aria",t,n);return i===!1?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),bE(e)),yE(e))}function bE(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=M("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in Sv?{}:{ariaRoleDescription:{value:t}}}function yE(e){const{encoding:t,markDef:n,config:i,stack:r}=e,s=t.description;if(s)return Ji(e,s,"description",u=>_o(u,e.config));const o=M("description",n,i);if(o!=null)return{description:Q(o)};if(i.aria===!1)return{};const a=ag(t,r,i);if(!G(a))return{description:{signal:Rr(a).map(([u,l],c)=>`"${c>0?"; ":""}${u}: " + (${l})`).join(" + ")}}}function de(e,t,n={}){const{markDef:i,encoding:r,config:s}=t,{vgChannel:o}=n;let{defaultRef:a,defaultValue:u}=n;a===void 0&&(u=u!=null?u:M(e,i,s,{vgChannel:o,ignoreVgConfig:!0}),u!==void 0&&(a=Q(u)));const l=r[e];return Ji(t,l,o!=null?o:e,c=>rp({channel:e,channelDef:c,markDef:i,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function ug(e,t={filled:void 0}){var n,i,r,s;const{markDef:o,encoding:a,config:u}=e,{type:l}=o,c=(n=t.filled)!==null&&n!==void 0?n:M("filled",o,u),f=D(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,d=(r=(i=M(c===!0?"color":void 0,o,u,{vgChannel:"fill"}))!==null&&i!==void 0?i:u.mark[c===!0&&"color"])!==null&&r!==void 0?r:f,p=(s=M(c===!1?"color":void 0,o,u,{vgChannel:"stroke"}))!==null&&s!==void 0?s:u.mark[c===!1&&"color"],g=c?"fill":"stroke",m=Object.assign(Object.assign({},d?{fill:Q(d)}:{}),p?{stroke:Q(p)}:{});return o.color&&(c?o.fill:o.stroke)&&O(Id("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},m),de("color",e,{vgChannel:g,defaultValue:c?d:p})),de("fill",e,{defaultValue:a.fill?d:void 0})),de("stroke",e,{defaultValue:a.stroke?p:void 0}))}function vE(e){const{encoding:t,mark:n}=e,i=t.order;return!Nn(n)&&ut(i)?Ji(e,i,"zindex",r=>Q(r.value)):{}}function jr(e,t){const n=Qb(e),i=t[n];if(i)return i}function ve(e,t,{defaultPos:n,vgChannel:i,isMidPoint:r}){const{encoding:s,markDef:o,config:a,stack:u}=t,l=s[e],c=s[It(e)],f=t.scaleName(e),d=t.getScaleComponent(e),p=jr(e,o),g=El({model:t,defaultPos:n,channel:e,scaleName:f,scale:d}),m=!l&&Ct(e)&&(s.latitude||s.longitude)?{field:t.getName(e)}:OE({channel:e,channelDef:l,channel2Def:c,markDef:o,config:a,isMidPoint:r,scaleName:f,scale:d,stack:u,offset:p,defaultRef:g});return m?{[i||e]:m}:void 0}function OE(e){const{channel:t,channelDef:n,isMidPoint:i,scaleName:r,stack:s,offset:o,markDef:a,config:u}=e;if(k(n)&&s&&t===s.fieldChannel){if(C(n)){const l=Xr({channel:t,fieldDef:n,isMidPoint:i,markDef:a,stack:s,config:u});if(l!==void 0)return Ds({scaleName:r,fieldOrDatumDef:n,startSuffix:"start",band:l,offset:o})}return Jn(n,r,{suffix:"end"},{offset:o})}return Yu(e)}function El({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:s,config:o}=e;return()=>{const a=di(n),u=vn(n),l=M(n,s,o,{vgChannel:u});if(l!==void 0)return vr(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const c=r.get("type");if(!D([oe.LOG,oe.TIME,oe.UTC],c)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const c=e[Rt(n)];return Object.assign(Object.assign({},c),{mult:.5})}}}}const EE={left:"x",center:"xc",right:"x2"},xE={top:"y",middle:"yc",bottom:"y2"};function lg(e,t,n,i="middle"){if(e==="radius"||e==="theta")return vn(e);const r=e==="x"?"align":"baseline",s=M(r,t,n);let o;return T(s)?(O(Dy(r)),o=void 0):o=s,e==="x"?EE[o||(i==="top"?"left":"center")]:xE[o||i]}function Ls(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?cg(e,t,{defaultPos:n,defaultPos2:i}):ve(e,t,{defaultPos:n})}function cg(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:s}=t,o=It(e),a=Rt(e),u=AE(t,i,o),l=u[a]?lg(e,r,s):vn(e);return Object.assign(Object.assign({},ve(e,t,{defaultPos:n,vgChannel:l})),u)}function AE(e,t,n){const{encoding:i,mark:r,markDef:s,stack:o,config:a}=e,u=di(n),l=Rt(n),c=vn(n),f=i[u],d=e.scaleName(u),p=e.getScaleComponent(u),g=n in i||n in s?jr(n,e.markDef):jr(u,e.markDef);if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude))return{[c]:{field:e.getName(n)}};const m=wE({channel:n,channelDef:f,channel2Def:i[n],markDef:s,config:a,scaleName:d,scale:p,stack:o,offset:g,defaultRef:void 0});return m!==void 0?{[c]:m}:as(n,s)||as(n,{[n]:ks(n,s,a.style),[l]:ks(l,s,a.style)})||as(n,a[r])||as(n,a.mark)||{[c]:El({model:e,defaultPos:t,channel:n,scaleName:d,scale:p})()}}function wE({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:u,defaultRef:l}){return k(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?Jn(t,s,{suffix:"start"},{offset:u}):Yu({channel:e,channelDef:n,scaleName:s,scale:o,stack:a,markDef:i,config:r,offset:u,defaultRef:l})}function as(e,t){const n=Rt(e),i=vn(e);if(t[i]!==void 0)return{[i]:vr(e,t[i])};if(t[e]!==void 0)return{[i]:vr(e,t[e])};if(t[n])return{[n]:vr(e,t[n])}}function En(e,t,n){var i,r,s,o;const{config:a,encoding:u,markDef:l,stack:c}=e,f=It(t),d=Rt(t),p=u[t],g=u[f],m=e.getScaleComponent(t),h=m?m.get("type"):void 0,x=e.scaleName(t),v=l.orient,S=(r=(i=u[d])!==null&&i!==void 0?i:u.size)!==null&&r!==void 0?r:M("size",l,a,{vgChannel:d}),F=n==="bar"&&(t==="x"?v==="vertical":v==="horizontal");if(C(p)&&(J(p.bin)||Se(p.bin)||p.timeUnit&&!g)&&!S&&!Ie(h)){const E=Xr({channel:t,fieldDef:p,stack:c,markDef:l,config:a}),$=(s=e.component.axes[t])===null||s===void 0?void 0:s[0],A=(o=$==null?void 0:$.get("translate"))!==null&&o!==void 0?o:.5;return FE({fieldDef:p,fieldDef2:g,channel:t,markDef:l,scaleName:x,band:E,axisTranslate:A,spacing:Ct(t)?M("binSpacing",l,a):void 0,reverse:m.get("reverse"),config:a})}else return(k(p)&&Ie(h)||F)&&!g?CE(n,p,t,e):cg(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function SE(e,t,n,i,r,s){if(i){const u=i.get("type");if(u==="point"||u==="band"){if(r[e].discreteBandSize!==void 0)return{value:r[e].discreteBandSize};if(u===oe.POINT){const l=i.get("range");return Dn(l)&&ae(l.step)?{value:l.step-2}:{value:yl-2}}else return{scale:n,band:s}}else return{value:r[e].continuousBandSize}}const o=Is(r.view,t),a=se(r[e].discreteBandSize,o-2);return a!==void 0?{value:a}:void 0}function CE(e,t,n,i){var r;const{markDef:s,encoding:o,config:a,stack:u}=i,l=s.orient,c=i.scaleName(n),f=i.getScaleComponent(n),d=Rt(n),p=It(n),g=l==="horizontal"&&n==="y"||l==="vertical"&&n==="x",m=M(g?"size":d,s,a,{vgChannel:d});let h;(o.size||m!==void 0)&&(g?h=de("size",i,{vgChannel:d,defaultValue:m}):O(By(s.type)));const x=(r=k(t)?Xr({channel:n,fieldDef:t,markDef:s,stack:u,config:a}):void 0)!==null&&r!==void 0?r:1;h=h||{[d]:SE(e,d,c,f,a,x)};const v=(f==null?void 0:f.get("type"))!=="band"||!("band"in h[d]),S=lg(n,s,a,v?"middle":"top"),F=jr(n,s),E=Yu({channel:n,channelDef:t,markDef:s,config:a,scaleName:c,scale:f,stack:u,offset:F,defaultRef:El({model:i,defaultPos:"mid",channel:n,scaleName:c,scale:f}),band:v?.5:(1-x)/2});if(d)return Object.assign({[S]:E},h);{const $=vn(p),A=h[d],N=F?Object.assign(Object.assign({},A),{offset:F}):A;return{[S]:E,[$]:j(E)?[E[0],Object.assign(Object.assign({},E[1]),{offset:N})]:Object.assign(Object.assign({},E),{offset:N})}}}function cr(e,t,n,i,r){if(Sd(e))return 0;const s=e==="x"||e==="y2"?-t/2:t/2;if(T(n)||T(r)||T(i)){const o=Yt(n),a=Yt(r),u=Yt(i),l=u?`${u} + `:"",c=o?`(${o} ? -1 : 1) * `:"",f=a?`(${a} + ${s})`:s;return{signal:l+c+f}}else return r=r||0,i+(n?-r-s:+r+s)}function FE({fieldDef:e,fieldDef2:t,channel:n,band:i,scaleName:r,markDef:s,spacing:o=0,axisTranslate:a,reverse:u,config:l}){const c=It(n),f=vn(n),d=vn(c),p=jr(n,s);if(J(e.bin)||e.timeUnit)return{[d]:af({channel:n,fieldDef:e,scaleName:r,markDef:s,band:(1-i)/2,offset:cr(c,o,u,a,p),config:l}),[f]:af({channel:n,fieldDef:e,scaleName:r,markDef:s,band:1-(1-i)/2,offset:cr(n,o,u,a,p),config:l})};if(Se(e.bin)){const g=Jn(e,r,{},{offset:cr(c,o,u,a,p)});if(C(t))return{[d]:g,[f]:Jn(t,r,{},{offset:cr(n,o,u,a,p)})};if(Gr(e.bin)&&e.bin.step)return{[d]:g,[f]:{signal:`scale("${r}", ${w(e,{expr:"datum"})} + ${e.bin.step})`,offset:cr(n,o,u,a,p)}}}O(Bd(c))}function af({channel:e,fieldDef:t,scaleName:n,markDef:i,band:r,offset:s,config:o}){const a=Ds({scaleName:n,fieldOrDatumDef:t,band:r,offset:s});return ip({fieldDef:t,channel:e,markDef:i,ref:a,config:o})}const _E=new Set(["aria"]);function Ke(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?ug(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},$E(e.markDef,t)),uf(e,"fill",n)),uf(e,"stroke",i)),de("opacity",e)),de("fillOpacity",e)),de("strokeOpacity",e)),de("strokeWidth",e)),de("strokeDash",e)),vE(e)),og(e)),Ol(e,"href")),mE(e))}function uf(e,t,n){const{config:i,mark:r,markDef:s}=e;if(M("invalid",s,i)==="hide"&&n&&!Nn(r)){const a=jE(e,{invalid:!0,channels:ao});if(a)return{[t]:[{test:a,value:null},...re(n)]}}return n?{[t]:n}:{}}function $E(e,t){return wv.reduce((n,i)=>(!_E.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=Q(e[i])),n),{})}function jE(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const u=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&Ye(u)&&(s[l]=!0)}return s},{}),r=y(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>Ju(o,t)).join(` ${s} `)}}function xl(e){const{config:t,markDef:n}=e;if(M("invalid",n,t)){const r=DE(e,{channels:Xe});if(r)return{defined:{signal:r}}}return{}}function DE(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const u=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&Ye(u)&&(s[l]=!0)}return s},{}),r=y(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>Ju(o,t)).join(` ${s} `)}}function lf(e,t){if(t!==void 0)return{[e]:Q(t)}}const la="voronoi",fg={has:e=>e.type!=="interval"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(la)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,s=e.mark;if(Nn(s))return O(ly(s)),n;const o={name:e.getName(la),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},og(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,u=!1;return n.forEach((l,c)=>{var f;const d=(f=l.name)!==null&&f!==void 0?f:"";d===e.component.mark[0].name?a=c:d.indexOf(la)>=0&&(u=!0)}),u||n.splice(a+1,0,o),n}};class H{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.indexOf(t)>-1){O(vy);return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const i of this._children)i.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=n,t.parent=this}}class Fe extends H{constructor(t,n,i,r){super(t,n);this.type=i,this.refCounts=r,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName="clone_"+this.debugName,t._source=this._source,t._name="clone_"+this._name,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${bd()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}var cf=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class wt extends H{constructor(t,n){super(t);this.formula=n}clone(){return new wt(null,I(this.formula))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s,o)=>{const{field:a,timeUnit:u}=s,l=te(n)?n.encoding[It(o)]:void 0,c=te(n)&&tl(o,s,l,n.stack,n.markDef,n.config);if(u){const f=w(s,{forAs:!0});r[R({as:f,field:a,timeUnit:u})]=Object.assign({as:f,field:a,timeUnit:u},c?{band:!0}:{})}return r},{});return G(i)?null:new wt(t,i)}static makeFromTransform(t,n){const i=Object.assign({},n),{timeUnit:r}=i,s=cf(i,["timeUnit"]),o=_e(r),a=Object.assign(Object.assign({},s),{timeUnit:o});return new wt(t,{[R(a)]:a})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)(!this.formula[n]||t.formula[n].band)&&(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}removeFormulas(t){const n={};for(const[i,r]of Rr(this.formula))t.has(r.as)||(n[i]=r);this.formula=n}producedFields(){return new Set(qt(this.formula).map(t=>t.as))}dependentFields(){return new Set(qt(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${R(this.formula)}`}assemble(){const t=[];for(const n of qt(this.formula)){const{field:i,as:r,timeUnit:s}=n,o=_e(s),{unit:a,utc:u}=o,l=cf(o,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:Qt(i),type:"timeunit"},a?{units:Pu(a)}:{}),u?{timezone:"utc"}:{}),l),{as:[r,`${r}_end`]}))}return t}}var NE=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Jr="_tuple_fields";class TE{constructor(...t){this.items=t,this.hasChannel={},this.hasField={}}}const kE={has:()=>!0,parse:(e,t,n)=>{var i,r,s;const o=t.name,a=(i=t.project)!==null&&i!==void 0?i:t.project=new TE,u={},l={},c=new Set,f=(d,p)=>{const g=p==="visual"?d.channel:d.field;let m=Y(`${o}_${g}`);for(let h=1;c.has(m);h++)m=Y(`${o}_${g}_${h}`);return c.add(m),{[p]:m}};if(!n.fields&&!n.encodings){const d=e.config.selection[n.type];if(n.init)for(const p of re(n.init))for(const g of y(p))Jb(g)?(n.encodings||(n.encodings=[])).push(g):n.type==="interval"?(O(hy),n.encodings=d.encodings):(n.fields||(n.fields=[])).push(g);else n.encodings=d.encodings,n.fields=d.fields}for(const d of(r=n.fields)!==null&&r!==void 0?r:[]){const p={type:"E",field:d};p.signals=Object.assign({},f(p,"data")),a.items.push(p),a.hasField[d]=p}for(const d of(s=n.encodings)!==null&&s!==void 0?s:[]){const p=e.fieldDef(d);if(p){let g=p.field;if(p.aggregate){O(uy(d,p.aggregate));continue}else if(!g){O(jc(d));continue}if(p.timeUnit){g=e.vgField(d);const m={timeUnit:p.timeUnit,as:g,field:p.field};l[R(m)]=m}if(!u[g]){let m="E";if(t.type==="interval"){const x=e.getScaleComponent(d).get("type");Ye(x)&&(m="R")}else p.bin&&(m="R-RE");const h={field:g,channel:d,type:m};h.signals=Object.assign(Object.assign({},f(h,"data")),f(h,"visual")),a.items.push(u[g]=h),a.hasField[g]=a.hasChannel[d]=u[g]}}else O(jc(d))}if(n.init){const d=p=>a.items.map(g=>p[g.channel]!==void 0?p[g.channel]:p[g.field]);if(n.type==="interval")t.init=d(n.init);else{const p=re(n.init);t.init=p.map(d)}}G(l)||(a.timeUnit=new wt(null,l))},signals:(e,t,n)=>{const i=t.name+Jr;return n.filter(s=>s.name===i).length>0?n:n.concat({name:i,value:t.project.items.map(s=>{const o=NE(s,["signals","hasLegend"]);return o.field=Qt(o.field),o})})}},dg={has:e=>e.type==="single"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!hl(e.bind),parse:(e,t,n,i)=>{i.on||delete t.events,i.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,s=t.bind,o=t.init&&t.init[0],a=fg.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((u,l)=>{var c,f;const d=Y(`${i}_${u.field}`);n.filter(g=>g.name===d).length||n.unshift(Object.assign(Object.assign({name:d},o?{init:Bi(o[l])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${B(u.field)}] : null`}]:[],bind:(f=(c=s[u.field])!==null&&c!==void 0?c:s[u.channel])!==null&&f!==void 0?f:s}))}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.filter(l=>l.name===i+$t)[0],o=i+Jr,a=r.items.map(l=>Y(`${i}_${l.field}`)),u=a.map(l=>`${l} !== null`).join(" && ");return a.length&&(s.update=`${u} ? {fields: ${o}, values: [${a.join(", ")}]} : null`),delete s.value,delete s.on,n}},Bs="_toggle",pg={has:e=>e.type==="multi"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+Bs,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+$t,i=t.name+Bs;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${Jt(e)}}, `)+`${i} ? ${n} : null`}},PE={has:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t,n)=>{n.clear&&(t.clear=P(n.clear)?qi(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(dg.has(t))for(const i of t.project.items){const r=n.findIndex(s=>s.name===Y(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,s){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const r of t.project.items){const s=n.findIndex(o=>o.name===r.signals.visual);if(i(s,"[0, 0]"),s===-1){const o=n.findIndex(a=>a.name===r.signals.data);i(o,"null")}}else{let r=n.findIndex(s=>s.name===t.name+$t);i(r,"null"),pg.has(t)&&(r=n.findIndex(s=>s.name===t.name+Bs),i(r,"false"))}return n}},xn={has:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!jn(r))continue;const s=e.getScaleComponent(r),o=s?s.get("type"):void 0;if(!s||!Ye(o)){O(fy);continue}const a={selection:t.name,field:i.field};s.set("selectionExtent",a,!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(o=>n.filter(a=>a.name===o.signals.data).length===0);if(!e.parent||Wa(e)||i.length===0)return n;const r=n.filter(o=>o.name===t.name)[0];let s=r.update;if(s.indexOf(xg)>=0)r.update=`{${i.map(o=>`${B(o.field)}: ${o.signals.data}`).join(", ")}}`;else{for(const o of i){const a=`${B(o.field)}: ${o.signals.data}`;s.indexOf(a)<0&&(s=`${s.substring(0,s.length-1)}, ${a}}`)}r.update=s}return n.concat(i.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!Wa(e))for(const i of t.scales){const r=n.filter(s=>s.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function Ua(e,t){return`domain(${B(e.scaleName(t))})`}function Wa(e){var t;return e.parent&&er(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:Wa(e.parent.parent))}const gg={has:e=>{const t=e.resolve==="global"&&e.bind&&hl(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==Li;return t&&!n&&O(dy),t&&n},parse:(e,t,n,i)=>{var r;if(i.on||delete t.events,i.clear||delete t.clear,i.on||i.clear){const a='event.item && indexof(event.item.mark.role, "legend") < 0';for(const u of t.events)u.filter=re((r=u.filter)!==null&&r!==void 0?r:[]),u.filter.indexOf(a)<0&&u.filter.push(a)}const s=oa(t.bind)?t.bind.legend:"click",o=P(s)?qi(s,"view"):re(s);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=oa(t.bind)&&t.bind.legend,s=o=>a=>{const u=I(a);return u.markname=o,u};for(const o of t.project.items){if(!o.hasLegend)continue;const a=`${Y(o.field)}_legend`,u=`${i}_${a}`;if(n.filter(c=>c.name===u).length===0){const c=r.merge.map(s(`${a}_symbols`)).concat(r.merge.map(s(`${a}_labels`))).concat(r.merge.map(s(`${a}_entries`)));n.unshift(Object.assign(Object.assign({name:u},t.init?{}:{value:null}),{on:[{events:c,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${u}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.find(d=>d.name===i+$t),o=i+Jr,a=r.items.filter(d=>d.hasLegend).map(d=>Y(`${i}_${Y(d.field)}_legend`)),l=`${a.map(d=>`${d} !== null`).join(" && ")} ? {fields: ${o}, values: [${a.join(", ")}]} : null`;t.events&&a.length>0?s.on.push({events:a.map(d=>({signal:d})),update:l}):a.length>0&&(s.update=l,delete s.value,delete s.on);const c=n.find(d=>d.name===i+Bs),f=oa(t.bind)&&t.bind.legend;return c&&(t.events?c.on.push(Object.assign(Object.assign({},c.on[0]),{events:f})):c.on[0].events=f),n}};function IE(e,t,n){var i;const r=(i=e.fieldDef(t))===null||i===void 0?void 0:i.field;gi(e,s=>{var o,a;const u=(o=s.project.hasField[r])!==null&&o!==void 0?o:s.project.hasChannel[t];if(u&&gg.has(s)){const l=(a=n.get("selections"))!==null&&a!==void 0?a:[];l.push(s.name),n.set("selections",l,!1),u.hasLegend=!0}})}const hg="_translate_anchor",mg="_translate_delta",RE={has:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=xn.has(t),s=i+hg,{x:o,y:a}=t.project.hasChannel;let u=qi(t.translate,"scope");return r||(u=u.map(l=>(l.between[0].markname=i+Or,l))),n.push({name:s,value:{},on:[{events:u.map(l=>l.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?", extent_x: "+(r?Ua(e,Z):`slice(${o.signals.visual})`):"")+(a!==void 0?", extent_y: "+(r?Ua(e,ce):`slice(${a.signals.visual})`):"")+"}"}]},{name:i+mg,value:{},on:[{events:u,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),o!==void 0&&ff(e,t,o,"width",n),a!==void 0&&ff(e,t,a,"height",n),n}};function ff(e,t,n,i,r){var s;const o=t.name,a=o+hg,u=o+mg,l=n.channel,c=xn.has(t),f=r.filter(F=>F.name===n.signals[c?"data":"visual"])[0],d=e.getSizeSignalRef(i).signal,p=e.getScaleComponent(l),g=p.get("type"),m=c&&l===Z?"-":"",h=`${a}.extent_${l}`,x=`${m}${u}.${l} / `+(c?`${d}`:`span(${h})`),S=`${c?g==="log"?"panLog":g==="pow"?"panPow":"panLinear":"panLinear"}(${h}, ${x}`+(c&&g==="pow"?`, ${(s=p.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";f.on.push({events:{signal:u},update:c?S:`clampRange(${S}, 0, ${d})`})}const bg="_zoom_anchor",yg="_zoom_delta",LE={has:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=xn.has(t),s=i+yg,{x:o,y:a}=t.project.hasChannel,u=B(e.scaleName(Z)),l=B(e.scaleName(ce));let c=qi(t.zoom,"scope");return r||(c=c.map(f=>(f.markname=i+Or,f))),n.push({name:i+bg,on:[{events:c,update:r?"{"+[u?`x: invert(${u}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(f=>!!f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&df(e,t,o,"width",n),a!==void 0&&df(e,t,a,"height",n),n}};function df(e,t,n,i,r){var s;const o=t.name,a=n.channel,u=xn.has(t),l=r.filter(v=>v.name===n.signals[u?"data":"visual"])[0],c=e.getSizeSignalRef(i).signal,f=e.getScaleComponent(a),d=f.get("type"),p=u?Ua(e,a):l.name,g=o+yg,m=`${o}${bg}.${a}`,x=`${u?d==="log"?"zoomLog":d==="pow"?"zoomPow":"zoomLinear":"zoomLinear"}(${p}, ${m}, ${g}`+(u&&d==="pow"?`, ${(s=f.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";l.on.push({events:{signal:g},update:u?x:`clampRange(${x}, 0, ${c})`})}const BE=[kE,pg,xn,gg,RE,LE,dg,fg,PE];function $o(e,t){for(const n of BE)n.has(e)&&t(n)}var zE=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Bi(e,t=!0,n=jh){if(j(e)){const i=e.map(r=>Bi(r,t,n));return t?`[${i.join(", ")}]`:i}else if(pi(e))return n(t?Fr(e):pv(e));return t?n(JSON.stringify(e)):e}function ME(e,t){return gi(e,(n,i)=>{const r=n.name;let s=i.modifyExpr(e,n);t.push(...i.signals(e,n)),$o(n,o=>{o.signals&&(t=o.signals(e,n,t)),o.modifyExpr&&(s=o.modifyExpr(e,n,s))}),t.push({name:r+QE,on:[{events:{signal:n.name+$t},update:`modify(${B(n.name+oi)}, ${s})`}]})}),Al(t)}function UE(e,t){if(e.component.selection&&y(e.component.selection).length){const n=B(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:qi("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return Al(t)}function WE(e,t){let n=!1;return gi(e,(i,r)=>{const s=i.name,o=B(s+oi);if(t.filter(u=>u.name===s).length===0){const u=i.resolve==="global"?"union":i.resolve,l=i.type==="multi"?", true)":")";t.push({name:i.name,update:`${xg}(${o}, ${B(u)}${l}`})}n=!0,r.topLevelSignals&&(t=r.topLevelSignals(e,i,t)),$o(i,u=>{u.topLevelSignals&&(t=u.topLevelSignals(e,i,t))})}),n&&t.filter(r=>r.name==="unit").length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),Al(t)}function GE(e,t){const n=[...t];return gi(e,i=>{const r={name:i.name+oi};if(i.init){const o=i.project.items.map(u=>zE(u,["signals"])),a=i.init.map(u=>Bi(u,!1));r.values=i.type==="interval"?[{unit:Jt(e,{escape:!1}),fields:o,values:a}]:a.map(u=>({unit:Jt(e,{escape:!1}),fields:o,values:u}))}n.filter(o=>o.name===i.name+oi).length||n.push(r)}),n}function vg(e,t){return gi(e,(n,i)=>{t=i.marks?i.marks(e,n,t):t,$o(n,r=>{r.marks&&(t=r.marks(e,n,t))})}),t}function HE(e,t){for(const n of e.children)te(n)&&(t=vg(n,t));return t}function qE(e,t){const n=t.selection,i=e.getSelectionComponent(n,Y(n));return{signal:Ng(i,t)}}function Al(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}var VE=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Or="_brush",Ga="_scale_trigger",XE={signals:(e,t)=>{const n=t.name,i=n+Jr,r=xn.has(t),s=[],o=[],a=[];if(t.translate&&!r){const c=`!event.item || event.item.mark.name !== ${B(n+Or)}`;Og(t,(f,d)=>{var p;const g=re((p=d.between[0].filter)!==null&&p!==void 0?p:d.between[0].filter=[]);return g.indexOf(c)<0&&g.push(c),f})}t.project.items.forEach((c,f)=>{const d=c.channel;if(d!==Z&&d!==ce){O("Interval selections only support x and y encoding channels.");return}const p=t.init?t.init[f]:null,g=YE(e,t,c,p),m=c.signals.data,h=c.signals.visual,x=B(e.scaleName(d)),v=e.getScaleComponent(d).get("type"),S=Ye(v)?"+":"";s.push(...g),o.push(m),a.push({scaleName:e.scaleName(d),expr:`(!isArray(${m}) || (${S}invert(${x}, ${h})[0] === ${S}${m}[0] && ${S}invert(${x}, ${h})[1] === ${S}${m}[1]))`})}),r||s.push({name:n+Ga,value:{},on:[{events:a.map(c=>({scale:c.scaleName})),update:a.map(c=>c.expr).join(" && ")+` ? ${n+Ga} : {}`}]});const u=t.init,l=`unit: ${Jt(e)}, fields: ${i}, values`;return s.concat(Object.assign(Object.assign({name:n+$t},u?{init:`{${l}: ${Bi(u)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${l}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>t.name+$t+", "+(t.resolve==="global"?"true":`{unit: ${Jt(e)}}`),marks:(e,t,n)=>{const i=t.name,{x:r,y:s}=t.project.hasChannel,o=r&&r.signals.visual,a=s&&s.signals.visual,u=`data(${B(t.name+oi)})`;if(xn.has(t))return n;const l={x:r!==void 0?{signal:`${o}[0]`}:{value:0},y:s!==void 0?{signal:`${a}[0]`}:{value:0},x2:r!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const h of y(l))l[h]=[Object.assign({test:`${u}.length && ${u}[0].unit === ${Jt(e)}`},l[h]),{value:0}];const c=t.mark,{fill:f,fillOpacity:d,cursor:p}=c,g=VE(c,["fill","fillOpacity","cursor"]),m=y(g).reduce((h,x)=>(h[x]=[{test:[r!==void 0&&`${o}[0] !== ${o}[1]`,s!==void 0&&`${a}[0] !== ${a}[1]`].filter(v=>v).join(" && "),value:g[x]},{value:null}],h),{});return[{name:i+Or+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:l}},...n,{name:i+Or,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},p?{cursor:{value:p}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),m)}}]}};function YE(e,t,n,i){const r=n.channel,s=n.signals.visual,o=n.signals.data,a=xn.has(t),u=B(e.scaleName(r)),l=e.getScaleComponent(r),c=l?l.get("type"):void 0,f=m=>`scale(${u}, ${m})`,d=e.getSizeSignalRef(r===Z?"width":"height").signal,p=`${r}(unit)`,g=Og(t,(m,h)=>[...m,{events:h.between[0],update:`[${p}, ${p}]`},{events:h,update:`[${s}[0], clamp(${p}, 0, ${d})]`}]);return g.push({events:{signal:t.name+Ga},update:Ye(c)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),a?[{name:o,on:[]}]:[Object.assign(Object.assign({name:s},i?{init:Bi(i,!0,f)}:{value:[]}),{on:g}),Object.assign(Object.assign({name:o},i?{init:Bi(i)}:{}),{on:[{events:{signal:s},update:`${s}[0] === ${s}[1] ? null : invert(${u}, ${s})`}]})]}function Og(e,t){return e.events.reduce((n,i)=>i.between?t(n,i):(O(`${i} is not an ordered event stream for interval selections.`),n),[])}function Eg(e,t){const n=t.name,i=n+Jr,r=t.project,s="(item().isVoronoi ? datum.datum : datum)",o=r.items.map(l=>{const c=e.fieldDef(l.channel);return c&&c.bin?`[${s}[${B(e.vgField(l.channel,{}))}], ${s}[${B(e.vgField(l.channel,{binSuffix:"end"}))}]]`:`${s}[${B(l.field)}]`}).join(", "),a=`unit: ${Jt(e)}, fields: ${i}, values`,u=t.events;return[{name:n+$t,on:u?[{events:u,update:`datum && item().mark.marktype !== 'group' ? {${a}: [${o}]} : null`,force:!0}]:[]}]}const JE={signals:Eg,modifyExpr:(e,t)=>t.name+$t+", "+(t.resolve==="global"?"null":`{unit: ${Jt(e)}}`)},KE={signals:Eg,modifyExpr:(e,t)=>t.name+$t+", "+(t.resolve==="global"?"true":`{unit: ${Jt(e)}}`)},oi="_store",$t="_tuple",QE="_modify",xg="vlSelectionResolve",ZE={single:KE,multi:JE,interval:XE};function gi(e,t){const n=e.component.selection;if(n){for(const i of qt(n))if(t(i,ZE[i.type])===!0)break}}function ex(e){let t=e.parent;for(;t&&!at(t);)t=t.parent;return t}function Jt(e,{escape:t}={escape:!0}){let n=t?B(e.name):e.name;const i=ex(e);if(i){const{facet:r}=i;for(const s of qe)r[s]&&(n+=` + '__facet_${s}_' + (facet[${B(i.vgField(s))}])`)}return n}function wl(e){let t=!1;return gi(e,n=>{t=t||n.project.items.some(i=>i.field===Li)}),t}const tx="RawCode",nx="Literal",ix="Property",rx="Identifier",sx="ArrayExpression",ox="BinaryExpression",ax="CallExpression",ux="ConditionalExpression",lx="LogicalExpression",cx="MemberExpression",fx="ObjectExpression",dx="UnaryExpression";function gt(e){this.type=e}gt.prototype.visit=function(e){let t,n,i;if(e(this))return 1;for(t=px(this),n=0,i=t.length;n<i;++n)if(t[n].visit(e))return 1};function px(e){switch(e.type){case sx:return e.elements;case ox:case lx:return[e.left,e.right];case ax:return[e.callee].concat(e.arguments);case ux:return[e.test,e.consequent,e.alternate];case cx:return[e.object,e.property];case fx:return e.properties;case ix:return[e.key,e.value];case dx:return[e.argument];case rx:case nx:case tx:default:return[]}}var Lt,_,b,Ee,W,jo=1,Kr=2,ai=3,kn=4,Do=5,hi=6,Ne=7,Qr=8,gx=9;Lt={};Lt[jo]="Boolean";Lt[Kr]="<end>";Lt[ai]="Identifier";Lt[kn]="Keyword";Lt[Do]="Null";Lt[hi]="Numeric";Lt[Ne]="Punctuator";Lt[Qr]="String";Lt[gx]="RegularExpression";var hx="ArrayExpression",mx="BinaryExpression",bx="CallExpression",yx="ConditionalExpression",Ag="Identifier",vx="Literal",Ox="LogicalExpression",Ex="MemberExpression",xx="ObjectExpression",Ax="Property",wx="UnaryExpression",pe="Unexpected token %0",Sx="Unexpected number",Cx="Unexpected string",Fx="Unexpected identifier",_x="Unexpected reserved word",$x="Unexpected end of input",Ha="Invalid regular expression",ca="Invalid regular expression: missing /",wg="Octal literals are not allowed in strict mode.",jx="Duplicate data property in object literal not allowed in strict mode",be="ILLEGAL",Dr="Disabled.",Dx=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),Nx=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function No(e,t){if(!e)throw new Error("ASSERT: "+t)}function Gt(e){return e>=48&&e<=57}function Sl(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Er(e){return"01234567".indexOf(e)>=0}function Tx(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Nr(e){return e===10||e===13||e===8232||e===8233}function Zr(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&Dx.test(String.fromCharCode(e))}function zs(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&Nx.test(String.fromCharCode(e))}const kx={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Sg(){for(;b<Ee;){const e=_.charCodeAt(b);if(Tx(e)||Nr(e))++b;else break}}function qa(e){var t,n,i,r=0;for(n=e==="u"?4:2,t=0;t<n;++t)b<Ee&&Sl(_[b])?(i=_[b++],r=r*16+"0123456789abcdef".indexOf(i.toLowerCase())):L({},pe,be);return String.fromCharCode(r)}function Px(){var e,t,n,i;for(e=_[b],t=0,e==="}"&&L({},pe,be);b<Ee&&(e=_[b++],!!Sl(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&L({},pe,be),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,i=(t-65536&1023)+56320,String.fromCharCode(n,i))}function Cg(){var e,t;for(e=_.charCodeAt(b++),t=String.fromCharCode(e),e===92&&(_.charCodeAt(b)!==117&&L({},pe,be),++b,e=qa("u"),(!e||e==="\\"||!Zr(e.charCodeAt(0)))&&L({},pe,be),t=e);b<Ee&&(e=_.charCodeAt(b),!!zs(e));)++b,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),_.charCodeAt(b)!==117&&L({},pe,be),++b,e=qa("u"),(!e||e==="\\"||!zs(e.charCodeAt(0)))&&L({},pe,be),t+=e);return t}function Ix(){var e,t;for(e=b++;b<Ee;){if(t=_.charCodeAt(b),t===92)return b=e,Cg();if(zs(t))++b;else break}return _.slice(e,b)}function Rx(){var e,t,n;return e=b,t=_.charCodeAt(b)===92?Cg():Ix(),t.length===1?n=ai:kx.hasOwnProperty(t)?n=kn:t==="null"?n=Do:t==="true"||t==="false"?n=jo:n=ai,{type:n,value:t,start:e,end:b}}function fa(){var e=b,t=_.charCodeAt(b),n,i=_[b],r,s,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++b,{type:Ne,value:String.fromCharCode(t),start:e,end:b};default:if(n=_.charCodeAt(b+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return b+=2,{type:Ne,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:b};case 33:case 61:return b+=2,_.charCodeAt(b)===61&&++b,{type:Ne,value:_.slice(e,b),start:e,end:b}}}if(o=_.substr(b,4),o===">>>=")return b+=4,{type:Ne,value:o,start:e,end:b};if(s=o.substr(0,3),s===">>>"||s==="<<="||s===">>=")return b+=3,{type:Ne,value:s,start:e,end:b};if(r=s.substr(0,2),i===r[1]&&"+-<>&|".indexOf(i)>=0||r==="=>")return b+=2,{type:Ne,value:r,start:e,end:b};if(r==="//"&&L({},pe,be),"<>=!+-*%&|^/".indexOf(i)>=0)return++b,{type:Ne,value:i,start:e,end:b};L({},pe,be)}function Lx(e){let t="";for(;b<Ee&&Sl(_[b]);)t+=_[b++];return t.length===0&&L({},pe,be),Zr(_.charCodeAt(b))&&L({},pe,be),{type:hi,value:parseInt("0x"+t,16),start:e,end:b}}function Bx(e){let t="0"+_[b++];for(;b<Ee&&Er(_[b]);)t+=_[b++];return(Zr(_.charCodeAt(b))||Gt(_.charCodeAt(b)))&&L({},pe,be),{type:hi,value:parseInt(t,8),octal:!0,start:e,end:b}}function pf(){var e,t,n;if(n=_[b],No(Gt(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=b,e="",n!=="."){if(e=_[b++],n=_[b],e==="0"){if(n==="x"||n==="X")return++b,Lx(t);if(Er(n))return Bx(t);n&&Gt(n.charCodeAt(0))&&L({},pe,be)}for(;Gt(_.charCodeAt(b));)e+=_[b++];n=_[b]}if(n==="."){for(e+=_[b++];Gt(_.charCodeAt(b));)e+=_[b++];n=_[b]}if(n==="e"||n==="E")if(e+=_[b++],n=_[b],(n==="+"||n==="-")&&(e+=_[b++]),Gt(_.charCodeAt(b)))for(;Gt(_.charCodeAt(b));)e+=_[b++];else L({},pe,be);return Zr(_.charCodeAt(b))&&L({},pe,be),{type:hi,value:parseFloat(e),start:t,end:b}}function zx(){var e="",t,n,i,r,s=!1;for(t=_[b],No(t==="'"||t==='"',"String literal must starts with a quote"),n=b,++b;b<Ee;)if(i=_[b++],i===t){t="";break}else if(i==="\\")if(i=_[b++],!i||!Nr(i.charCodeAt(0)))switch(i){case"u":case"x":_[b]==="{"?(++b,e+=Px()):e+=qa(i);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:Er(i)?(r="01234567".indexOf(i),r!==0&&(s=!0),b<Ee&&Er(_[b])&&(s=!0,r=r*8+"01234567".indexOf(_[b++]),"0123".indexOf(i)>=0&&b<Ee&&Er(_[b])&&(r=r*8+"01234567".indexOf(_[b++]))),e+=String.fromCharCode(r)):e+=i;break}else i==="\r"&&_[b]===`
`&&++b;else{if(Nr(i.charCodeAt(0)))break;e+=i}return t!==""&&L({},pe,be),{type:Qr,value:e,octal:s,start:n,end:b}}function Mx(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(i,r)=>{if(parseInt(r,16)<=1114111)return"x";L({},Ha)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{L({},Ha)}try{return new RegExp(e,t)}catch{return null}}function Ux(){var e,t,n,i,r;for(e=_[b],No(e==="/","Regular expression literal must start with a slash"),t=_[b++],n=!1,i=!1;b<Ee;)if(e=_[b++],t+=e,e==="\\")e=_[b++],Nr(e.charCodeAt(0))&&L({},ca),t+=e;else if(Nr(e.charCodeAt(0)))L({},ca);else if(n)e==="]"&&(n=!1);else if(e==="/"){i=!0;break}else e==="["&&(n=!0);return i||L({},ca),r=t.substr(1,t.length-2),{value:r,literal:t}}function Wx(){var e,t,n;for(t="",n="";b<Ee&&(e=_[b],!!zs(e.charCodeAt(0)));)++b,e==="\\"&&b<Ee?L({},pe,be):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&L({},Ha,n),{value:n,literal:t}}function Gx(){var e,t,n,i;return W=null,Sg(),e=b,t=Ux(),n=Wx(),i=Mx(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:b}}function Hx(e){return e.type===ai||e.type===kn||e.type===jo||e.type===Do}function Fg(){if(Sg(),b>=Ee)return{type:Kr,start:b,end:b};const e=_.charCodeAt(b);return Zr(e)?Rx():e===40||e===41||e===59?fa():e===39||e===34?zx():e===46?Gt(_.charCodeAt(b+1))?pf():fa():Gt(e)?pf():fa()}function Te(){const e=W;return b=e.end,W=Fg(),b=e.end,e}function _g(){const e=b;W=Fg(),b=e}function qx(e){const t=new gt(hx);return t.elements=e,t}function gf(e,t,n){const i=new gt(e==="||"||e==="&&"?Ox:mx);return i.operator=e,i.left=t,i.right=n,i}function Vx(e,t){const n=new gt(bx);return n.callee=e,n.arguments=t,n}function Xx(e,t,n){const i=new gt(yx);return i.test=e,i.consequent=t,i.alternate=n,i}function Cl(e){const t=new gt(Ag);return t.name=e,t}function pr(e){const t=new gt(vx);return t.value=e.value,t.raw=_.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function hf(e,t,n){const i=new gt(Ex);return i.computed=e==="[",i.object=t,i.property=n,i.computed||(n.member=!0),i}function Yx(e){const t=new gt(xx);return t.properties=e,t}function mf(e,t,n){const i=new gt(Ax);return i.key=t,i.value=n,i.kind=e,i}function Jx(e,t){const n=new gt(wx);return n.operator=e,n.argument=t,n.prefix=!0,n}function L(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,(s,o)=>(No(o<i.length,"Message reference must be in range"),i[o]));throw n=new Error(r),n.index=b,n.description=r,n}function To(e){e.type===Kr&&L(e,$x),e.type===hi&&L(e,Sx),e.type===Qr&&L(e,Cx),e.type===ai&&L(e,Fx),e.type===kn&&L(e,_x),L(e,pe,e.value)}function xe(e){const t=Te();(t.type!==Ne||t.value!==e)&&To(t)}function X(e){return W.type===Ne&&W.value===e}function da(e){return W.type===kn&&W.value===e}function Kx(){const e=[];for(b=W.start,xe("[");!X("]");)X(",")?(Te(),e.push(null)):(e.push(ui()),X("]")||xe(","));return Te(),qx(e)}function bf(){b=W.start;const e=Te();return e.type===Qr||e.type===hi?(e.octal&&L(e,wg),pr(e)):Cl(e.value)}function Qx(){var e,t,n,i;if(b=W.start,e=W,e.type===ai)return n=bf(),xe(":"),i=ui(),mf("init",n,i);if(e.type===Kr||e.type===Ne)To(e);else return t=bf(),xe(":"),i=ui(),mf("init",t,i)}function Zx(){var e=[],t,n,i,r={},s=String;for(b=W.start,xe("{");!X("}");)t=Qx(),t.key.type===Ag?n=t.key.name:n=s(t.key.value),i="$"+n,Object.prototype.hasOwnProperty.call(r,i)?L({},jx):r[i]=!0,e.push(t),X("}")||xe(",");return xe("}"),Yx(e)}function eA(){xe("(");const e=Fl();return xe(")"),e}const tA={if:1};function nA(){var e,t,n;if(X("("))return eA();if(X("["))return Kx();if(X("{"))return Zx();if(e=W.type,b=W.start,e===ai||tA[W.value])n=Cl(Te().value);else if(e===Qr||e===hi)W.octal&&L(W,wg),n=pr(Te());else{if(e===kn)throw new Error(Dr);e===jo?(t=Te(),t.value=t.value==="true",n=pr(t)):e===Do?(t=Te(),t.value=null,n=pr(t)):X("/")||X("/=")?(n=pr(Gx()),_g()):To(Te())}return n}function iA(){const e=[];if(xe("("),!X(")"))for(;b<Ee&&(e.push(ui()),!X(")"));)xe(",");return xe(")"),e}function rA(){b=W.start;const e=Te();return Hx(e)||To(e),Cl(e.value)}function sA(){return xe("."),rA()}function oA(){xe("[");const e=Fl();return xe("]"),e}function aA(){var e,t,n;for(e=nA();;)if(X("."))n=sA(),e=hf(".",e,n);else if(X("("))t=iA(),e=Vx(e,t);else if(X("["))n=oA(),e=hf("[",e,n);else break;return e}function yf(){const e=aA();if(W.type===Ne&&(X("++")||X("--")))throw new Error(Dr);return e}function xs(){var e,t;if(W.type!==Ne&&W.type!==kn)t=yf();else{if(X("++")||X("--"))throw new Error(Dr);if(X("+")||X("-")||X("~")||X("!"))e=Te(),t=xs(),t=Jx(e.value,t);else{if(da("delete")||da("void")||da("typeof"))throw new Error(Dr);t=yf()}}return t}function vf(e){let t=0;if(e.type!==Ne&&e.type!==kn)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function uA(){var e,t,n,i,r,s,o,a,u,l;if(e=W,u=xs(),i=W,r=vf(i),r===0)return u;for(i.prec=r,Te(),t=[e,W],o=xs(),s=[u,i,o];(r=vf(W))>0;){for(;s.length>2&&r<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),t.pop(),n=gf(a,u,o),s.push(n);i=Te(),i.prec=r,s.push(i),t.push(W),n=xs(),s.push(n)}for(l=s.length-1,n=s[l],t.pop();l>1;)t.pop(),n=gf(s[l-1].value,s[l-2],n),l-=2;return n}function ui(){var e,t,n;return e=uA(),X("?")&&(Te(),t=ui(),xe(":"),n=ui(),e=Xx(e,t,n)),e}function Fl(){const e=ui();if(X(","))throw new Error(Dr);return e}function lA(e){_=e,b=0,Ee=_.length,W=null,_g();const t=Fl();if(W.type!==Kr)throw new Error("Unexpect token after expression.");return t}function Va(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...Va(e.object)),t.push(...Va(e.property))),t)}function $g(e){return e.object.type==="MemberExpression"?$g(e.object):e.object.name==="datum"}function jg(e){const t=lA(e),n=new Set;return t.visit(i=>{i.type==="MemberExpression"&&$g(i)&&n.add(Va(i).slice(1).join("."))}),n}class Ki extends H{constructor(t,n,i){super(t);this.model=n,this.filter=i,this.expr=Ms(this.model,this.filter,this),this._dependentFields=jg(this.expr)}clone(){return new Ki(null,this.model,I(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}var cA=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function fA(e,t){var n;const i={},r=e.config.selection;for(const s of y(t!=null?t:{})){const o=I(t[s]),a=r[o.type],u=cA(a,["fields","encodings"]);for(const f in u)f==="encodings"&&o.fields||f==="fields"&&o.encodings||(f==="mark"&&(o[f]=Object.assign(Object.assign({},u[f]),o[f])),(o[f]===void 0||o[f]===!0)&&(o[f]=(n=u[f])!==null&&n!==void 0?n:o[f]));const l=Y(s),c=i[l]=Object.assign(Object.assign({},o),{name:l,events:P(o.on)?qi(o.on,"scope"):I(o.on)});$o(c,f=>{f.has(c)&&f.parse&&f.parse(e,c,o,t[s])})}return i}function Dg(e,t,n,i="datum"){const r=[];function s(a){const u=Y(a),l=e.getSelectionComponent(u,a),c=B(u+oi);if(l.project.timeUnit){const f=n!=null?n:e.component.data.raw,d=l.project.timeUnit.clone();f.parent?d.insertAsParentOf(f):f.parent=d}return l.empty!=="none"&&r.push(c),`vlSelectionTest(${c}, ${i}`+(l.resolve==="global"?")":`, ${B(l.resolve)})`)}const o=_i(t,s);return(r.length?"!("+r.map(a=>`length(data(${a}))`).join(" || ")+") || ":"")+`(${o})`}function Ng(e,t){const n=t.encoding;let i=t.field;if(!n&&!i)i=e.project.items[0].field,e.project.items.length>1&&O(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${B(i)}.`);else if(n&&!i){const r=e.project.items.filter(s=>s.channel===n);!r.length||r.length>1?(i=e.project.items[0].field,O((r.length?"Multiple ":"No ")+`matching ${B(n)} encoding found for selection ${B(t.selection)}. Using "field": ${B(i)}.`)):i=r[0].field}return`${e.name}[${B(i)}]`}function dA(e,t){gi(e,n=>{const i=n.name,r=e.getName(`lookup_${i}`);e.component.data.outputNodes[r]=n.materialized=new Fe(new Ki(t,e,{selection:i}),r,q.Lookup,e.component.data.outputNodeRefCounts)})}function Ms(e,t,n){return _i(t,i=>P(i)?i:Cv(i)?Dg(e,i.selection,n):Vd(i))}var us=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function pA(e,t){if(!!e)return j(e)&&!gn(e)?e.map(n=>sl(n,t)).join(", "):e}function pa(e,t,n,i){var r,s,o;e.encode=(r=e.encode)!==null&&r!==void 0?r:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=i}function gr(e,t,n,i={header:!1}){var r,s;const o=e.combine(),{disable:a,orient:u,scale:l,labelExpr:c,title:f,zindex:d}=o,p=us(o,["disable","orient","scale","labelExpr","title","zindex"]);if(!a){for(const g in p){const m=Tb[g],h=p[g];if(m&&m!==t&&m!=="both")delete p[g];else if(Br(h)){const{condition:x}=h,v=us(h,["condition"]),S=re(x),F=wc[g];if(F){const{vgProp:E,part:$}=F,A=[...S.map(N=>{const{test:U}=N,K=us(N,["test"]);return Object.assign({test:Ms(null,U)},K)}),v];pa(p,$,E,A),delete p[g]}else if(F===null){const E={signal:S.map($=>{const{test:A}=$,N=us($,["test"]);return`${Ms(null,A)} ? ${Wc(N)} : `}).join("")+Wc(v)};p[g]=E}}else if(T(h)){const x=wc[g];if(x){const{vgProp:v,part:S}=x;pa(p,S,v,h),delete p[g]}}}if(t==="grid"){if(!p.grid)return;if(p.encode){const{grid:g}=p.encode;p.encode=Object.assign({},g?{grid:g}:{}),G(p.encode)&&delete p.encode}return Object.assign(Object.assign({scale:l,orient:u},p),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:se(d,0)})}else{if(!i.header&&e.mainExtracted)return;if(c!==void 0){let m=c;((s=(r=p.encode)===null||r===void 0?void 0:r.labels)===null||s===void 0?void 0:s.update)&&T(p.encode.labels.update.text)&&(m=ti(c,"datum.label",p.encode.labels.update.text.signal)),pa(p,"labels","text",{signal:m})}if(p.labelAlign===null&&delete p.labelAlign,p.encode){for(const m of Od)e.hasAxisPart(m)||delete p.encode[m];G(p.encode)&&delete p.encode}const g=pA(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:u,grid:!1},g?{title:g}:{}),p),n.aria===!1?{aria:!1}:{}),{zindex:se(d,0)})}}}function Tg(e){const{axes:t}=e.component,n=[];for(const i of Xe)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const s=i==="x"?"height":"width",o=e.getSizeSignalRef(s).signal;s!==o&&n.push({name:s,update:o})}}return n}function gA(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>gr(r,"grid",t)),...i.map(r=>gr(r,"grid",t)),...n.map(r=>gr(r,"main",t)),...i.map(r=>gr(r,"main",t))].filter(r=>r)}function Of(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const s=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},a=t[n==="x"?"axisTop":"axisRight"]||{},u=new Set([...y(o),...y(a)]),l={};for(const c of u.values())l[c]={signal:`${i.signal} === "${s}" ? ${Yt(o[c])} : ${Yt(a[c])}`};return l}return t[r]})])}function hA(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:Rv(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",o=T(n)?"axisOrient":"axis"+Lr(n),a=[...r,...r.map(l=>s+l.substr(4))],u=["axis",o,s];return{vlOnlyAxisConfig:Of(a,i,e,n),vgAxisConfig:Of(u,i,e,n),axisConfigStyle:mA([...u,...a],i)}}function mA(e,t){var n;const i=[{}];for(const r of e){let s=(n=t[r])===null||n===void 0?void 0:n.style;if(s){s=re(s);for(const o of s)i.push(t.style[o])}}return Object.assign.apply(null,i)}function Xa(e,t,n,i={}){var r;const s=Sp(e,n,t);if(s!==void 0)return{configFrom:"style",configValue:s};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((r=i[o])===null||r===void 0?void 0:r[e])!==void 0)return{configFrom:o,configValue:i[o][e]};return{}}const Ef={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:r}=n;return ap(e,e.type,i,r,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return up(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return C(e)&&Se(e.bin)?!1:(i=t.grid)!==null&&i!==void 0?i:bA(n,e)},gridScale:({model:e,channel:t})=>yA(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||Pg(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||kg(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return(i=e.labelFlush)!==null&&i!==void 0?i:OA(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return(i=e.labelOverlap)!==null&&i!==void 0?i:EA(t.type,n,C(t)&&!!t.timeUnit,C(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var s;const o=e==="x"?"width":e==="y"?"height":void 0,a=o?t.getSizeSignalRef(o):void 0;return(s=n.tickCount)!==null&&s!==void 0?s:AA({fieldOrDatumDef:i,scaleType:r,size:a,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=Ig(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),s=n==="x"?"x2":"y2",o=t.fieldDef(s);return Fp(r?[Mc(r)]:[],C(o)?[Mc(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>wA(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return(i=e.zindex)!==null&&i!==void 0?i:SA(n,t)}};function bA(e,t){return!Ie(e)&&C(t)&&!J(t==null?void 0:t.bin)}function yA(e,t){const n=t==="x"?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}function vA(e,t,n,i,r){const s=t==null?void 0:t.labelAngle;if(s!==void 0)return T(s)?s:Cr(s);{const{configValue:o}=Xa("labelAngle",i,t==null?void 0:t.style,r);return o!==void 0?Cr(o):n===Z&&D([Hu,Gu],e.type)&&!(C(e)&&e.timeUnit)?270:void 0}}function Ya(e){return`(((${e.signal} % 360) + 360) % 360)`}function kg(e,t,n,i){if(e!==void 0)if(n==="x"){if(T(e)){const r=Ya(e),s=T(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${s} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(T(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==(t==="top")?"bottom":"top"}else{if(T(e)){const r=Ya(e),s=T(t)?`(${t.signal} === "left")`:t==="left";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${i?'"middle"':"null"} : (45 <= ${r} && ${r} <= 135) === ${s} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(T(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==(t==="left")?"top":"bottom"}}function Pg(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,s=i?"bottom":"left";if(T(e)){const o=Ya(e),a=T(t)?`(${t.signal} === "${s}")`:t===s;return{signal:`(${r?"("+o+" + 90)":o} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${o} && ${o} < ${180+r}) === ${a} ? "left" : "right"`}}if((e+r)%180===0)return i?null:"center";if(T(t)){const o=r<e&&e<180+r?"===":"!==";return{signal:`${`${t.signal} ${o} "${s}"`} ? "left" : "right"`}}return(r<e&&e<180+r)==(t===s)?"left":"right"}function OA(e,t){if(t==="x"&&D(["quantitative","temporal"],e))return!0}function EA(e,t,n,i){if(n&&!ue(i)||e!=="nominal"&&e!=="ordinal")return t==="log"||t==="symlog"?"greedy":!0}function xA(e){return e==="x"?"bottom":"left"}function AA({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!Ie(t)&&t!=="log"){if(C(e)){if(J(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&D(["month","hours","day","quarter"],(r=_e(e.timeUnit))===null||r===void 0?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}}function Ig(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),s=i?i.title:void 0,o=r?r.title:void 0;if(s&&o)return _p(s,o);if(s)return s;if(o)return o;if(s!==void 0)return s;if(o!==void 0)return o}function wA(e,t){const n=e.values;if(j(n))return Ep(t,n);if(T(n))return n}function SA(e,t){return e==="rect"&&hp(t)?1:0}class zi extends H{constructor(t,n){super(t);this.transform=n,this._dependentFields=jg(this.transform.calculate)}clone(){return new zi(null,I(this.transform))}static parseAllForSortIndex(t,n){return n.forEachFieldDef((i,r)=>{if(!!Oo(i)&&dp(i.sort)){const{field:s,timeUnit:o}=i,a=i.sort,u=a.map((l,c)=>`${Vd({field:s,timeUnit:o,equal:l})} ? ${c} : `).join("")+a.length;t=new zi(t,{calculate:u,as:Mi(i,r,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${R(this.transform)}`}}function Mi(e,t,n){return w(e,Object.assign({prefix:t,suffix:"sort_index"},n!=null?n:{}))}function ko(e,t){return D(["top","bottom"],t)?"column":D(["left","right"],t)||e==="row"?"row":"column"}function Ui(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return se((t||{})[e],r[e],n.header[e])}function Po(e,t,n,i){const r={};for(const s of e){const o=Ui(s,t||{},n,i);o!==void 0&&(r[s]=o)}return r}const _l=["row","column"],$l=["header","footer"];function CA(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=Po(["titleAnchor","titleAngle","titleOrient"],r.header,i,t),u=ko(t,a),l=Cr(o);return{name:`${t}-title`,type:"group",role:`${u}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),Lg(l,u)),Rg(u,l,s)),Bg(i,r,t,e1,Wp))}}function Rg(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=Pg(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function Lg(e,t){const n=kg(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function FA(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of $l)if(n[r])for(const s of n[r]){const o=$A(e,t,r,n,s);o!=null&&i.push(o)}return i}function _A(e,t){var n;const{sort:i}=e;return At(i)?{field:w(i,{expr:"datum"}),order:(n=i.order)!==null&&n!==void 0?n:"ascending"}:j(i)?{field:Mi(e,t,{expr:"datum"}),order:"ascending"}:{field:w(e,{expr:"datum"}),order:i!=null?i:"ascending"}}function Ja(e,t,n){const{format:i,formatType:r,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:u}=Po(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),l=Ku({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,c=ko(t,a);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:u?ti(ti(u,"datum.label",l),"datum.value",w(e,{expr:"parent"})):l}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),Lg(s,c)),Rg(c,s,o)),Bg(n,e,t,t1,Gp))}function $A(e,t,n,i,r){if(r){let s=null;const{facetFieldDef:o}=i,a=e.config?e.config:void 0;if(o&&r.labels){const{labelOrient:f}=Po(["labelOrient"],o.header,a,t);(t==="row"&&!D(["top","bottom"],f)||t==="column"&&!D(["left","right"],f))&&(s=Ja(o,t,a))}const u=at(e)&&!Vr(e.facet),l=r.axes,c=(l==null?void 0:l.length)>0;if(s||c){const f=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:_A(o,t)}:{}),c&&u?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),s?{title:s}:{}),r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{}),c?{axes:l}:{})}}return null}const jA={column:{start:0,end:1},row:{start:1,end:0}};function DA(e,t){return jA[t][e]}function NA(e,t){const n={};for(const i of qe){const r=e[i];if(r==null?void 0:r.facetFieldDef){const{titleAnchor:s,titleOrient:o}=Po(["titleAnchor","titleOrient"],r.facetFieldDef.header,t,i),a=ko(i,o),u=DA(s,a);u!==void 0&&(n[a]=u)}}return G(n)?void 0:n}function Bg(e,t,n,i,r){const s={};for(const o of i){if(!r[o])continue;const a=Ui(o,t==null?void 0:t.header,e,n);a!==void 0&&(s[r[o]]=a)}return s}function jl(e){return[...ls(e,"width"),...ls(e,"height"),...ls(e,"childWidth"),...ls(e,"childHeight")]}function ls(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const s=e.getScaleComponent(n);if(s){const o=s.get("type"),a=s.get("range");if(Ie(o)&&Dn(a)){const u=e.scaleName(n);return at(e.parent)&&e.parent.component.resolve.scale[n]==="independent"?[xf(u,a)]:[xf(u,a),{name:r,update:zg(u,s,`domain('${u}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const s=r.endsWith("width"),o=s?"containerSize()[0]":"containerSize()[1]",a=za(e.config.view,s?"width":"height"),u=`isFinite(${o}) ? ${o} : ${a}`;return[{name:r,init:u,on:[{update:u,events:"window:resize"}]}]}else return[{name:r,value:i}]}function xf(e,t){return{name:e+"_step",value:t.step}}function zg(e,t,n){const i=t.get("type"),r=t.get("padding"),s=se(t.get("paddingOuter"),r);let o=t.get("paddingInner");return o=i==="band"?o!==void 0?o:r:1,`bandspace(${n}, ${Yt(o)}, ${Yt(s)}) * ${e}_step`}function Mg(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function Ug(e,t){return y(e).reduce((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),Ji(t,r,i,s=>Q(s.value)))},{})}function TA(e,t){if(er(t)||at(t))return"shared";if(Rl(t))return Ct(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function Dl(e,t){const n=e.scale[t],i=Ct(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&O(Gy(t)),"independent"):e[i][t]||"shared"}const kA=Object.assign(Object.assign({},r1),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),Wg=y(kA);class PA extends an{}const Af={symbols:IA,gradient:RA,labels:LA,entries:BA};function IA(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:s}){var o,a,u,l,c,f,d,p;if(s!=="symbol")return;const{markDef:g,encoding:m,config:h,mark:x}=n,v=g.filled&&x!=="trail";let S=Object.assign(Object.assign({},TO({},n,iO)),ug(n,{filled:v}));const F=(o=r.get("symbolOpacity"))!==null&&o!==void 0?o:h.legend.symbolOpacity,E=(a=r.get("symbolFillColor"))!==null&&a!==void 0?a:h.legend.symbolFillColor,$=(u=r.get("symbolStrokeColor"))!==null&&u!==void 0?u:h.legend.symbolStrokeColor,A=F===void 0?(l=Gg(m.opacity))!==null&&l!==void 0?l:g.opacity:void 0;if(S.fill){if(i==="fill"||v&&i===ke)delete S.fill;else if(S.fill.field)E?delete S.fill:(S.fill=Q((c=h.legend.symbolBaseFillColor)!==null&&c!==void 0?c:"black"),S.fillOpacity=Q(A!=null?A:1));else if(j(S.fill)){const N=(p=(d=Ka((f=m.fill)!==null&&f!==void 0?f:m.color))!==null&&d!==void 0?d:g.fill)!==null&&p!==void 0?p:v&&g.color;N&&(S.fill=Q(N))}}if(S.stroke){if(i==="stroke"||!v&&i===ke)delete S.stroke;else if(S.stroke.field||$)delete S.stroke;else if(j(S.stroke)){const N=se(Ka(m.stroke||m.color),g.stroke,v?g.color:void 0);N&&(S.stroke={value:N})}}if(i!==sn){const N=C(t)&&qg(n,r,t);N?S.opacity=[Object.assign({test:N},Q(A!=null?A:1)),Q(h.legend.unselectedOpacity)]:A&&(S.opacity=Q(A))}return S=Object.assign(Object.assign({},S),e),G(S)?void 0:S}function RA(e,{model:t,legendType:n,legendCmpt:i}){var r;if(n!=="gradient")return;const{config:s,markDef:o,encoding:a}=t;let u={};const c=((r=i.get("gradientOpacity"))!==null&&r!==void 0?r:s.legend.gradientOpacity)===void 0?Gg(a.opacity)||o.opacity:void 0;return c&&(u.opacity=Q(c)),u=Object.assign(Object.assign({},u),e),G(u)?void 0:u}function LA(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const s=n.legend(i)||{},o=n.config,a=C(t)?qg(n,r,t):void 0,u=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:l,formatType:c}=s,f=ri(c)?Qu({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:c,config:o}):void 0,d=Object.assign(Object.assign(Object.assign({},u?{opacity:u}:{}),f?{text:f}:{}),e);return G(d)?void 0:d}function BA(e,{legendCmpt:t}){const n=t.get("selections");return(n==null?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}function Gg(e){return Hg(e,(t,n)=>Math.max(t,n.value))}function Ka(e){return Hg(e,(t,n)=>se(t,n.value))}function Hg(e,t){if(EO(e))return re(e.condition).reduce(t,e.value);if(ut(e))return e.value}function qg(e,t,n){const i=t.get("selections");if(!(i==null?void 0:i.length))return;const r=B(n.field);return i.map(s=>`(!length(data(${B(Y(s)+oi)})) || (${s}[${r}] && indexof(${s}[${r}], datum.value) >= 0))`).join(" || ")}const wf={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return ap(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return up(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:r}=e;return(n=(t=i.gradientLength)!==null&&t!==void 0?t:r.gradientLength)!==null&&n!==void 0?n:qA(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return(r=(i=e.labelOverlap)!==null&&i!==void 0?i:t.labelOverlap)!==null&&r!==void 0?r:VA(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return(r=e.symbolType)!==null&&r!==void 0?r:MA(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>ji(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if($i(n)&&st(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>zA(t,e)};function zA(e,t){const n=e.values;if(j(n))return Ep(t,n);if(T(n))return n}function MA(e,t,n,i){var r;if(t!=="shape"){const s=(r=Ka(n))!==null&&r!==void 0?r:i;if(s)return s}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function UA(e){const{legend:t}=e;return se(t.type,WA(e))}function WA({channel:e,timeUnit:t,scaleType:n}){if($i(e)){if(D(["quarter","month","day"],t))return"symbol";if(st(n))return"gradient"}return"symbol"}function GA({legendConfig:e,legendType:t,orient:n,legend:i}){var r,s;return(s=(r=i.direction)!==null&&r!==void 0?r:e[t?"gradientDirection":"symbolDirection"])!==null&&s!==void 0?s:HA(n,t)}function HA(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function qA({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:u}=e;if(st(r))return n==="horizontal"?i==="top"||i==="bottom"?Sf(t,"width",o,s):o:Sf(t,"height",u,a)}function Sf(e,t,n,i){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${i})`}}function VA(e){if(D(["quantile","threshold","log","symlog"],e))return"greedy"}function Vg(e){const t=te(e)?XA(e):QA(e);return e.component.legends=t,t}function XA(e){const{encoding:t}=e,n={};for(const i of[ke,...qp]){const r=le(t[i]);!r||!e.getScaleComponent(i)||i===Pe&&C(r)&&r.type===Yi||(n[i]=KA(e,i))}return n}function YA(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function JA(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n==null?void 0:n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function KA(e,t){var n,i,r;let s=e.legend(t);const{markDef:o,encoding:a,config:u}=e,l=u.legend,c=new PA({},YA(e,t));IE(e,t,c);const f=s!==void 0?!s:l.disable;if(c.set("disable",f,s!==void 0),f)return c;s=s||{};const d=e.getScaleComponent(t).get("type"),p=le(a[t]),g=C(p)?(n=_e(p.timeUnit))===null||n===void 0?void 0:n.unit:void 0,m=s.orient||u.legend.orient||"right",h=UA({legend:s,channel:t,timeUnit:g,scaleType:d}),x=GA({legend:s,legendType:h,orient:m,legendConfig:l}),v={legend:s,channel:t,model:e,markDef:o,encoding:a,fieldOrDatumDef:p,legendConfig:l,config:u,scaleType:d,orient:m,legendType:h,direction:x};for(const A of Wg){if(h==="gradient"&&A.startsWith("symbol")||h==="symbol"&&A.startsWith("gradient"))continue;const N=A in wf?wf[A](v):s[A];if(N!==void 0){const U=JA(N,A,s,e.fieldDef(t));(U||u.legend[A]===void 0)&&c.set(A,N,U)}}const S=(i=s==null?void 0:s.encoding)!==null&&i!==void 0?i:{},F=c.get("selections"),E={},$={fieldOrDatumDef:p,model:e,channel:t,legendCmpt:c,legendType:h};for(const A of["labels","legend","title","symbols","gradient","entries"]){const N=Ug((r=S[A])!==null&&r!==void 0?r:{},e),U=A in Af?Af[A](N,$):N;U!==void 0&&!G(U)&&(E[A]=Object.assign(Object.assign(Object.assign({},(F==null?void 0:F.length)&&C(p)?{name:`${Y(p.field)}_legend_${A}`}:{}),(F==null?void 0:F.length)?{interactive:!!F}:{}),{update:U}))}return G(E)||c.set("encode",E,!!(s==null?void 0:s.encoding)),c}function QA(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){Vg(i);for(const r of y(i.component.legends))n.legend[r]=Dl(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=Xg(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of y(t))for(const r of e.children)!r.component.legends[i]||n.legend[i]==="shared"&&delete r.component.legends[i];return t}function Xg(e,t){var n,i,r,s;if(!e)return t.clone();const o=e.getWithExplicit("orient"),a=t.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;let u=!1;for(const l of Wg){const c=On(e.getWithExplicit(l),t.getWithExplicit(l),l,"legend",(f,d)=>{switch(l){case"symbolType":return ZA(f,d);case"title":return $p(f,d);case"type":return u=!0,Me("symbol")}return Fo(f,d,l,"legend")});e.setWithExplicit(l,c)}return u&&(((i=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||i===void 0?void 0:i.gradient)&&Fs(e.implicit,["encode","gradient"]),((s=(r=e.explicit)===null||r===void 0?void 0:r.encode)===null||s===void 0?void 0:s.gradient)&&Fs(e.explicit,["encode","gradient"])),e}function ZA(e,t){return t.value==="circle"?t:e}var ew=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function tw(e,t,n,i){var r,s,o;e.encode=(r=e.encode)!==null&&r!==void 0?r:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=i}function Yg(e){const t=e.component.legends,n={};for(const r of y(t)){const s=e.getScaleComponent(r),o=V(s.get("domains"));if(n[o])for(const a of n[o])Xg(a,t[r])||n[o].push(t[r]);else n[o]=[t[r].clone()]}return qt(n).flat().map(r=>nw(r,e.config)).filter(r=>r!==void 0)}function nw(e,t){var n,i,r;const s=e.combine(),{disable:o,labelExpr:a,selections:u}=s,l=ew(s,["disable","labelExpr","selections"]);if(!o){if(t.aria===!1&&l.aria==null&&(l.aria=!1),(n=l.encode)===null||n===void 0?void 0:n.symbols){const c=l.encode.symbols.update;c.fill&&c.fill.value!=="transparent"&&!c.stroke&&!l.stroke&&(c.stroke={value:"transparent"});for(const f of qp)l[f]&&delete c[f]}if(l.title||delete l.title,a!==void 0){let c=a;((r=(i=l.encode)===null||i===void 0?void 0:i.labels)===null||r===void 0?void 0:r.update)&&T(l.encode.labels.update.text)&&(c=ti(a,"datum.label",l.encode.labels.update.text.signal)),tw(l,"labels","text",{signal:c})}return l}}function iw(e){return er(e)||Rl(e)?rw(e):Jg(e)}function rw(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),Jg(e))}function Jg(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},s=t.data.reduce((o,a)=>{const u=T(a)?a.signal:`data('${e.lookupDataSource(a)}')`;return D(o,u)||o.push(u),o},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}else return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const sw=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class Kg extends an{constructor(t,n,i,r){super(Object.assign({},n),{name:t});this.specifiedProjection=n,this.size=i,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function Qg(e){e.component.projection=te(e)?ow(e):lw(e)}function ow(e){var t;if(e.hasProjection){const n=e.specifiedProjection,i=!(n&&(n.scale!=null||n.translate!=null)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,s=i?aw(e):void 0;return new Kg(e.projectionName(!0),Object.assign(Object.assign({},(t=e.config.projection)!==null&&t!==void 0?t:{}),n!=null?n:{}),r,s)}}function aw(e){const t=[],{encoding:n}=e;for(const i of[[Tt,Nt],[Ve,pt]])(le(n[i[0]])||le(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(Pe)&&e.typedFieldDef(Pe).type===Yi&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(q.Main)),t}function uw(e,t){const n=Ou(sw,r=>!!(!Si(e.explicit,r)&&!Si(t.explicit,r)||Si(e.explicit,r)&&Si(t.explicit,r)&&V(e.get(r))===V(t.get(r))));if(V(e.size)===V(t.size)){if(n)return e;if(V(e.explicit)===V({}))return t;if(V(t.explicit)===V({}))return e}return null}function lw(e){if(e.children.length===0)return;let t;for(const i of e.children)Qg(i);const n=Ou(e.children,i=>{const r=i.component.projection;if(r)if(t){const s=uw(t,r);return s&&(t=s),!!s}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new Kg(i,t.specifiedProjection,t.size,I(t.data));for(const s of e.children){const o=s.component.projection;o&&(o.isFit&&r.data.push(...s.component.projection.data),s.renameProjection(o.get("name"),i),o.merged=!0)}return r}}var cw=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function fw(e,t,n,i){var r,s;if(Yr(t,n)){const o=te(e)?(s=(r=e.axis(n))!==null&&r!==void 0?r:e.legend(n))!==null&&s!==void 0?s:{}:{},a=w(t,{expr:"datum"}),u=w(t,{expr:"datum",binSuffix:"end"});return{formulaAs:w(t,{binSuffix:"range",forAs:!0}),formula:ho(a,u,o.format,o.formatType,i)}}return{}}function Zg(e,t){return`${Td(e)}_${t}`}function dw(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function Nl(e,t,n){var i;const r=(i=Eo(n,void 0))!==null&&i!==void 0?i:{},s=Zg(r,t);return e.getName(`${s}_bins`)}function pw(e){return"as"in e}function Cf(e,t,n){let i,r;pw(e)?i=P(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[w(e,{forAs:!0}),w(e,{binSuffix:"end",forAs:!0})];const s=Object.assign({},Eo(t,void 0)),o=Zg(s,e.field),{signal:a,extentSignal:u}=dw(n,o);if(uo(s.extent)){const c=s.extent,f=c.selection;r=Ng(n.getSelectionComponent(Y(f),f),c),delete s.extent}const l=Object.assign(Object.assign(Object.assign({bin:s,field:e.field,as:[i]},a?{signal:a}:{}),u?{extentSignal:u}:{}),r?{span:r}:{});return{key:o,binComponent:l}}class St extends H{constructor(t,n){super(t);this.bins=n}clone(){return new St(null,I(this.bins))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s,o)=>{if(Je(s)&&J(s.bin)){const{key:a,binComponent:u}=Cf(s,s.bin,n);r[a]=Object.assign(Object.assign(Object.assign({},u),r[a]),fw(n,s,o,n.config))}return r},{});return G(i)?null:new St(t,i)}static makeFromTransform(t,n,i){const{key:r,binComponent:s}=Cf(n,n.bin,i);return new St(t,{[r]:s})}merge(t,n){for(const i of y(t.bins))i in this.bins?(n(t.bins[i].signal,this.bins[i].signal),this.bins[i].as=Et([...this.bins[i].as,...t.bins[i].as],R)):this.bins[i]=t.bins[i];for(const i of t.children)t.removeChild(i),i.parent=this;t.remove()}producedFields(){return new Set(qt(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(qt(this.bins).map(t=>t.field))}hash(){return`Bin ${R(this.bins)}`}assemble(){return qt(this.bins).flatMap(t=>{const n=[],[i,...r]=t.as,s=t.bin,{extent:o}=s,a=cw(s,["extent"]),u=Object.assign(Object.assign(Object.assign({type:"bin",field:Qt(t.field),as:i,signal:t.signal},uo(o)?{extent:null}:{extent:o}),t.span?{span:{signal:`span(${t.span})`}}:{}),a);!o&&t.extentSignal&&(n.push({type:"extent",field:Qt(t.field),signal:t.extentSignal}),u.extent={signal:t.extentSignal}),n.push(u);for(const l of r)for(let c=0;c<2;c++)n.push({type:"formula",expr:w({field:i[c]},{expr:"datum"}),as:l[c]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}function gw(e,t,n,i){const r=te(i)?i.encoding[It(t)]:void 0;if(Je(n)&&te(i)&&tl(t,n,r,i.stack,i.markDef,i.config))e.add(w(n,{})),e.add(w(n,{suffix:"end"})),n.bin&&Yr(n,t)&&e.add(w(n,{binSuffix:"range"}));else if(Hb(t)){const s=Gb(t);e.add(i.getName(s))}else e.add(w(n));return e}function hw(e,t){var n;for(const i of y(t)){const r=t[i];for(const s of y(r))i in e?e[i][s]=new Set([...(n=e[i][s])!==null&&n!==void 0?n:[],...r[s]]):e[i]={[s]:r[s]}}}class ot extends H{constructor(t,n,i){super(t);this.dimensions=n,this.measures=i}clone(){return new ot(null,new Set(this.dimensions),I(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let i=!1;n.forEachFieldDef(o=>{o.aggregate&&(i=!0)});const r={},s=new Set;return!i||(n.forEachFieldDef((o,a)=>{var u,l,c,f;const{aggregate:d,field:p}=o;if(d)if(d==="count")r["*"]=(u=r["*"])!==null&&u!==void 0?u:{},r["*"].count=new Set([w(o,{forAs:!0})]);else{if(Zt(d)||wn(d)){const g=Zt(d)?"argmin":"argmax",m=d[g];r[m]=(l=r[m])!==null&&l!==void 0?l:{},r[m][g]=new Set([w({op:g,field:m},{forAs:!0})])}else r[p]=(c=r[p])!==null&&c!==void 0?c:{},r[p][d]=new Set([w(o,{forAs:!0})]);jn(a)&&n.scaleDomain(a)==="unaggregated"&&(r[p]=(f=r[p])!==null&&f!==void 0?f:{},r[p].min=new Set([w({field:p,aggregate:"min"},{forAs:!0})]),r[p].max=new Set([w({field:p,aggregate:"max"},{forAs:!0})]))}else gw(s,a,o,n)}),s.size+y(r).length===0)?null:new ot(t,s,r)}static makeFromTransform(t,n){var i,r,s;const o=new Set,a={};for(const u of n.aggregate){const{op:l,field:c,as:f}=u;l&&(l==="count"?(a["*"]=(i=a["*"])!==null&&i!==void 0?i:{},a["*"].count=new Set([f||w(u,{forAs:!0})])):(a[c]=(r=a[c])!==null&&r!==void 0?r:{},a[c][l]=new Set([f||w(u,{forAs:!0})])))}for(const u of(s=n.groupby)!==null&&s!==void 0?s:[])o.add(u);return o.size+y(a).length===0?null:new ot(t,o,a)}merge(t){return gd(this.dimensions,t.dimensions)?(hw(this.measures,t.measures),!0):(ov("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...y(this.measures)])}producedFields(){const t=new Set;for(const n of y(this.measures))for(const i of y(this.measures[n])){const r=this.measures[n][i];r.size===0?t.add(`${i}_${n}`):r.forEach(t.add,t)}return t}hash(){return`Aggregate ${R({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],i=[];for(const s of y(this.measures))for(const o of y(this.measures[s]))for(const a of this.measures[s][o])i.push(a),t.push(o),n.push(s==="*"?null:Qt(s));return{type:"aggregate",groupby:[...this.dimensions].map(Qt),ops:t,fields:n,as:i}}}class Qi extends H{constructor(t,n,i,r){super(t);this.model=n,this.name=i,this.data=r;for(const s of qe){const o=n.facet[s];if(o){const{bin:a,sort:u}=o;this[s]=Object.assign({name:n.getName(`${s}_domain`),fields:[w(o),...J(a)?[w(o,{binSuffix:"end"})]:[]]},At(u)?{sortField:u}:j(u)?{sortIndexField:Mi(o,s)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of qe)this[n]&&(t+=` ${n.charAt(0)}:${R(this[n])}`);return t}get fields(){var t;const n=[];for(const i of qe)((t=this[i])===null||t===void 0?void 0:t.fields)&&n.push(...this[i].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of qe)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of Xe){const i=this.childModel.component.scales[n];if(i&&!i.merged){const r=i.get("type"),s=i.get("range");if(Ie(r)&&Dn(s)){const o=Io(this.childModel,n),a=Il(o);a?t[n]=a:O(Du(n))}}}return t}assembleRowColumnHeaderData(t,n,i){const r={row:"y",column:"x"}[t],s=[],o=[],a=[];i&&i[r]&&(n?(s.push(`distinct_${i[r]}`),o.push("max")):(s.push(i[r]),o.push("distinct")),a.push(`distinct_${i[r]}`));const{sortField:u,sortIndexField:l}=this[t];if(u){const{op:c=mo,field:f}=u;s.push(f),o.push(c),a.push(w(u,{forAs:!0}))}else l&&(s.push(l),o.push("max"),a.push(l));return{name:this[t].name,source:n!=null?n:this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},s.length?{fields:s,ops:o,as:a}:{})]}}assembleFacetHeaderData(t){var n,i;const{columns:r}=this.model.layout,{layoutHeaders:s}=this.model.component,o=[],a={};for(const c of _l){for(const f of $l){const d=(n=s[c]&&s[c][f])!==null&&n!==void 0?n:[];for(const p of d)if(((i=p.axes)===null||i===void 0?void 0:i.length)>0){a[c]=!0;break}}if(a[c]){const f=`length(data("${this.facet.name}"))`,d=c==="row"?r?{signal:`ceil(${f} / ${r})`}:1:r?{signal:`min(${f}, ${r})`}:{signal:f};o.push({name:`${this.facet.name}_${c}`,transform:[{type:"sequence",start:0,stop:d}]})}}const{row:u,column:l}=a;return(u||l)&&o.unshift(this.assembleRowColumnHeaderData("facet",null,t)),o}assemble(){var t,n;const i=[];let r=null;const s=this.getChildIndependentFieldsWithStep(),{column:o,row:a,facet:u}=this;if(o&&a&&(s.x||s.y)){r=`cross_${this.column.name}_${this.row.name}`;const l=[].concat((t=s.x)!==null&&t!==void 0?t:[],(n=s.y)!==null&&n!==void 0?n:[]),c=l.map(()=>"distinct");i.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:c}]})}for(const l of[Xt,Vt])this[l]&&i.push(this.assembleRowColumnHeaderData(l,r,s));if(u){const l=this.assembleFacetHeaderData(s);l&&i.push(...l)}return i}}function Ff(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function mw(e,t){const n=Au(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.indexOf("date:")===0){const i=Ff(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.indexOf("utc:")===0){const i=Ff(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return O(yy(t)),null}function bw(e){const t={};return vs(e.filter,n=>{var i;if(qd(n)){let r=null;Iu(n)?r=Ce(n.equal):Lu(n)?r=Ce(n.lte):Ru(n)?r=Ce(n.lt):Bu(n)?r=Ce(n.gt):zu(n)?r=Ce(n.gte):Mu(n)?r=n.range[0]:Uu(n)&&(r=((i=n.oneOf)!==null&&i!==void 0?i:n.in)[0]),r&&(pi(r)?t[n.field]="date":ae(r)?t[n.field]="number":P(r)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function yw(e){const t={};function n(i){Ri(i)?t[i.field]="date":i.type==="quantitative"&&Bb(i.aggregate)?t[i.field]="number":ki(i.field)>1?i.field in t||(t[i.field]="flatten"):Oo(i)&&At(i.sort)&&ki(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((te(e)||at(e))&&e.forEachFieldDef((i,r)=>{if(Je(i))n(i);else{const s=di(r),o=e.fieldDef(s);n(Object.assign(Object.assign({},i),{type:o.type}))}}),te(e)){const{mark:i,markDef:r,encoding:s}=e;if(Nn(i)&&!e.encoding.order){const o=r.orient==="horizontal"?"y":"x",a=s[o];C(a)&&a.type==="quantitative"&&!(a.field in t)&&(t[a.field]="number")}}return t}function vw(e){const t={};if(te(e)&&e.component.selection)for(const n of y(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&ki(r.field)>1&&(t[r.field]="flatten")}return t}class Oe extends H{constructor(t,n){super(t);this._parse=n}clone(){return new Oe(null,I(this._parse))}hash(){return`Parse ${R(this._parse)}`}static makeExplicit(t,n,i){let r={};const s=n.data;return!Qn(s)&&s&&s.format&&s.format.parse&&(r=s.format.parse),this.makeWithAncestors(t,r,{},i)}static makeWithAncestors(t,n,i,r){for(const a of y(i)){const u=r.getWithExplicit(a);u.value!==void 0&&(u.explicit||u.value===i[a]||u.value==="derived"||i[a]==="flatten"?delete i[a]:O(Nc(a,i[a],u.value)))}for(const a of y(n)){const u=r.get(a);u!==void 0&&(u===n[a]?delete n[a]:O(Nc(a,n[a],u)))}const s=new an(n,i);r.copyAll(s);const o={};for(const a of y(s.combine())){const u=s.get(a);u!==null&&(o[a]=u)}return y(o).length===0||r.parseNothing?null:new Oe(t,o)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of y(this._parse)){const i=this._parse[n];ki(n)===1&&(t[n]=i)}return t}producedFields(){return new Set(y(this._parse))}dependentFields(){return new Set(y(this._parse))}assembleTransforms(t=!1){return y(this._parse).filter(n=>t?ki(n)>1:!0).map(n=>{const i=mw(n,this._parse[n]);return i?{type:"formula",expr:i,as:wu(n)}:null}).filter(n=>n!==null)}}class An extends H{clone(){return new An(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([Li])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Li}}}class es extends H{constructor(t,n){super(t);this.params=n}clone(){return new es(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${R(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class ts extends H{constructor(t,n){super(t);this.params=n}clone(){return new ts(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${R(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}class li extends H{constructor(t){super(null);t=t!=null?t:{name:"source"};let n;if(Qn(t)||(n=t.format?Object.assign({},We(t.format,["parse"])):{}),Rs(t))this._data={values:t.values};else if($r(t)){if(this._data={url:t.url},!n.type){let i=/(?:\.([^.]+))?$/.exec(t.url)[1];D(["json","csv","tsv","dsv","topojson"],i)||(i="json"),n.type=i}}else rg(t)?this._data={values:[{type:"Sphere"}]}:(ng(t)||Qn(t))&&(this._data={});this._generator=Qn(t),t.name&&(this._name=t.name),n&&!G(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var _f=globalThis&&globalThis.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},Ow=globalThis&&globalThis.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},hr;function Tl(e){return e instanceof li||e instanceof es||e instanceof ts}class kl{constructor(){hr.set(this,void 0),_f(this,hr,!1)}setModified(){_f(this,hr,!0)}get modifiedFlag(){return Ow(this,hr)}}hr=new WeakMap;class mi extends kl{getNodeDepths(t,n,i){i.set(t,n);for(const r of t.children)this.getNodeDepths(r,n+1,i);return i}optimize(t){const i=[...this.getNodeDepths(t,0,new Map).entries()].sort((r,s)=>s[1]-r[1]);for(const r of i)this.run(r[0]);return this.modifiedFlag}}class Pl extends kl{optimize(t){this.run(t);for(const n of t.children)this.optimize(n);return this.modifiedFlag}}class Ew extends Pl{mergeNodes(t,n){const i=n.shift();for(const r of n)t.removeChild(r),r.parent=i,r.remove()}run(t){const n=t.children.map(r=>r.hash()),i={};for(let r=0;r<n.length;r++)i[n[r]]===void 0?i[n[r]]=[t.children[r]]:i[n[r]].push(t.children[r]);for(const r of y(i))i[r].length>1&&(this.setModified(),this.mergeNodes(t,i[r]))}}class xw extends Pl{constructor(t){super();this.requiresSelectionId=t&&wl(t)}run(t){t instanceof An&&(this.requiresSelectionId&&(Tl(t.parent)||t.parent instanceof ot||t.parent instanceof Oe)||(this.setModified(),t.remove()))}}class Aw extends kl{optimize(t){return this.run(t,new Set),this.modifiedFlag}run(t,n){let i=new Set;t instanceof wt&&(i=t.producedFields(),Eu(i,n)&&(this.setModified(),t.removeFormulas(n),t.producedFields.length===0&&t.remove()));for(const r of t.children)this.run(r,new Set([...n,...i]))}}class ww extends Pl{constructor(){super()}run(t){t instanceof Fe&&!t.isRequired()&&(this.setModified(),t.remove())}}class Sw extends mi{run(t){if(!Tl(t)&&!(t.numChildren()>1)){for(const n of t.children)if(n instanceof Oe)if(t instanceof Oe)this.setModified(),t.merge(n);else{if(xu(t.producedFields(),n.dependentFields()))continue;this.setModified(),n.swapWithParent()}}}}class Cw extends mi{run(t){const n=[...t.children],i=t.children.filter(r=>r instanceof Oe);if(t.numChildren()>1&&i.length>=1){const r={},s=new Set;for(const o of i){const a=o.parse;for(const u of y(a))u in r?r[u]!==a[u]&&s.add(u):r[u]=a[u]}for(const o of s)delete r[o];if(!G(r)){this.setModified();const o=new Oe(t,r);for(const a of n){if(a instanceof Oe)for(const u of y(r))delete a.parse[u];t.removeChild(a),a.parent=o,a instanceof Oe&&y(a.parse).length===0&&a.remove()}}}}}class Fw extends mi{run(t){t instanceof Fe||t.numChildren()>0||t instanceof Qi||t instanceof li||(this.setModified(),t.remove())}}class _w extends mi{run(t){const n=t.children.filter(r=>r instanceof wt),i=n.pop();for(const r of n)this.setModified(),i.merge(r)}}class $w extends mi{run(t){const n=t.children.filter(r=>r instanceof ot),i={};for(const r of n){const s=R(r.groupBy);s in i||(i[s]=[]),i[s].push(r)}for(const r of y(i)){const s=i[r];if(s.length>1){const o=s.pop();for(const a of s)o.merge(a)&&(t.removeChild(a),a.parent=o,a.remove(),this.setModified())}}}}class jw extends mi{constructor(t){super();this.model=t}run(t){const n=!(Tl(t)||t instanceof Ki||t instanceof Oe||t instanceof An),i=[],r=[];for(const s of t.children)s instanceof St&&(n&&!xu(t.producedFields(),s.dependentFields())?i.push(s):r.push(s));if(i.length>0){const s=i.pop();for(const o of i)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified(),t instanceof St?t.merge(s,this.model.renameSignal.bind(this.model)):s.swapWithParent()}if(r.length>1){const s=r.pop();for(const o of r)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified()}}}class Dw extends mi{run(t){const n=[...t.children];if(!Ti(n,o=>o instanceof Fe)||t.numChildren()<=1)return;const r=[];let s;for(const o of n)if(o instanceof Fe){let a=o;for(;a.numChildren()===1;){const[u]=a.children;if(u instanceof Fe)a=u;else break}r.push(...a.children),s?(t.removeChild(o),o.parent=s.parent,s.parent.removeChild(s),s.parent=a,this.setModified()):s=a}else r.push(o);if(r.length){this.setModified();for(const o of r)o.parent.removeChild(o),o.parent=s}}}class bi extends H{constructor(t,n){super(t);this.transform=n}clone(){return new bi(null,I(this.transform))}addDimensions(t){this.transform.groupby=Et(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:w(t)}hash(){return`JoinAggregateTransform ${R(this.transform)}`}assemble(){const t=[],n=[],i=[];for(const s of this.transform.joinaggregate)n.push(s.op),i.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},r!==void 0?{groupby:r}:{})}}function Nw(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=w(i);return r&&t.push(r),t},[])}function Tw(e){return j(e)&&e.every(t=>P(t))&&e.length>1}class Kt extends H{constructor(t,n){super(t);this._stack=n}clone(){return new Kt(null,I(this._stack))}static makeFromTransform(t,n){const{stack:i,groupby:r,as:s,offset:o="zero"}=n,a=[],u=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),u.push(se(f.order,"ascending"));const l={field:a,order:u};let c;return Tw(s)?c=s:P(s)?c=[s,s+"_end"]:c=[n.stack+"_start",n.stack+"_end"],new Kt(t,{stackField:i,groupby:r,offset:o,sort:l,facetby:[],as:c})}static makeFromEncoding(t,n){const i=n.stack,{encoding:r}=n;if(!i)return null;const{groupbyChannel:s,fieldChannel:o,offset:a,impute:u}=i;let l;if(s){const p=r[s];l=Ft(p)}const c=Nw(n),f=n.encoding.order;let d;return j(f)||C(f)?d=Cp(f):d=c.reduce((p,g)=>(p.field.push(g),p.order.push(o==="y"?"descending":"ascending"),p),{field:[],order:[]}),new Kt(t,{dimensionFieldDef:l,stackField:n.vgField(o),facetby:[],stackby:c,sort:d,offset:a,impute:u,as:[n.vgField(o,{suffix:"start",forAs:!0}),n.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${R(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:t,impute:n,groupby:i}=this._stack;return t?t.bin?n?[w(t,{binSuffix:"mid"})]:[w(t,{}),w(t,{binSuffix:"end"})]:[w(t)]:i!=null?i:[]}assemble(){const t=[],{facetby:n,dimensionFieldDef:i,stackField:r,stackby:s,sort:o,offset:a,impute:u,as:l}=this._stack;if(u&&i){const{band:c=.5,bin:f}=i;f&&t.push({type:"formula",expr:`${c}*`+w(i,{expr:"datum"})+`+${1-c}*`+w(i,{expr:"datum",binSuffix:"end"}),as:w(i,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:r,groupby:[...s,...n],key:w(i,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:r,sort:o,as:l,offset:a}),t}}class Zi extends H{constructor(t,n){super(t);this.transform=n}clone(){return new Zi(null,I(this.transform))}addDimensions(t){this.transform.groupby=Et(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const i=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(i.add,i),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(r=>i.add(r.field)),this.transform.window.map(r=>r.field).filter(r=>r!==void 0).forEach(i.add,i),i}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:w(t)}hash(){return`WindowTransform ${R(this.transform)}`}assemble(){var t;const n=[],i=[],r=[],s=[];for(const d of this.transform.window)i.push(d.op),r.push(this.getDefaultName(d)),s.push(d.param===void 0?null:d.param),n.push(d.field===void 0?null:d.field);const o=this.transform.frame,a=this.transform.groupby;if(o&&o[0]===null&&o[1]===null&&i.every(d=>Su(d)))return Object.assign({type:"joinaggregate",as:r,ops:i,fields:n},a!==void 0?{groupby:a}:{});const u=[],l=[];if(this.transform.sort!==void 0)for(const d of this.transform.sort)u.push(d.field),l.push((t=d.order)!==null&&t!==void 0?t:"ascending");const c={field:u,order:l},f=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:s,as:r,ops:i,fields:n,sort:c},f!==void 0?{ignorePeers:f}:{}),a!==void 0?{groupby:a}:{}),o!==void 0?{frame:o}:{})}}function kw(e){function t(n){if(!(n instanceof Qi)){const i=n.clone();if(i instanceof Fe){const r=Za+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof ot||i instanceof Kt||i instanceof Zi||i instanceof bi)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function Qa(e){if(e instanceof Qi)if(e.numChildren()===1&&!(e.children[0]instanceof Fe)){const t=e.children[0];(t instanceof ot||t instanceof Kt||t instanceof Zi||t instanceof bi)&&t.addDimensions(e.fields),t.swapWithParent(),Qa(e)}else{const t=e.model.component.data.main;eh(t);const n=kw(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(Qa)}function eh(e){if(e instanceof Fe&&e.type===q.Main&&e.numChildren()===1){const t=e.children[0];t instanceof Qi||(t.swapWithParent(),eh(e))}}const Za="scale_",cs=5;function eu(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return!1;if(!eu(t.children))return!1}return!0}function et(e,t){let n=!1;for(const i of t)n=e.optimize(i)||n;return n}function $f(e,t,n){let i=e.sources,r=!1;return r=et(new ww,i)||r,r=et(new xw(t),i)||r,i=i.filter(s=>s.numChildren()>0),r=et(new Fw,i)||r,i=i.filter(s=>s.numChildren()>0),n||(r=et(new Sw,i)||r,r=et(new jw(t),i)||r,r=et(new Aw,i)||r,r=et(new Cw,i)||r,r=et(new $w,i)||r,r=et(new _w,i)||r,r=et(new Ew,i)||r,r=et(new Dw,i)||r),e.sources=i,r}function Pw(e,t){eu(e.sources);let n=0,i=0;for(let r=0;r<cs&&$f(e,t,!0);r++)n++;e.sources.map(Qa);for(let r=0;r<cs&&$f(e,t,!1);r++)i++;eu(e.sources),Math.max(n,i)===cs&&O(`Maximum optimization runs(${cs}) reached.`)}class Ge{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new Ge(()=>t(n))}}var Iw=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function th(e){te(e)?Rw(e):Lw(e)}function Rw(e){const t=e.component.scales;for(const n of y(t)){const i=zw(e,n);if(t[n].setWithExplicit("domains",i),Uw(e,n),e.component.data.isFaceted){let s=e;for(;!at(s)&&s.parent;)s=s.parent;if(s.component.resolve.scale[n]==="shared")for(const a of i.value)Ht(a)&&(a.data=Za+a.data.replace(Za,""))}}}function Lw(e){for(const n of e.children)th(n);const t=e.component.scales;for(const n of y(t)){let i,r=null;for(const s of e.children){const o=s.component.scales[n];if(o){i===void 0?i=o.getWithExplicit("domains"):i=On(i,o.getWithExplicit("domains"),"domains","scale",tu);const a=o.get("selectionExtent");r&&a&&r.selection!==a.selection&&O(gy),r=a}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function Bw(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:s}=jf(t,n);if(!r){O(s);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=jf(t,n);if(r)return"unaggregated"}return e}function zw(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=Bw(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:r})),t==="x"&&le(i.x2)?le(i.x)?On(dn(n,r,e,"x"),dn(n,r,e,"x2"),"domain","scale",tu):dn(n,r,e,"x2"):t==="y"&&le(i.y2)?le(i.y)?On(dn(n,r,e,"y"),dn(n,r,e,"y2"),"domain","scale",tu):dn(n,r,e,"y2"):dn(n,r,e,t)}function Mw(e,t,n){return e.map(i=>({signal:`{data: ${xo(i,{timeUnit:n,type:t})}}`}))}function ga(e,t,n){var i;const r=(i=_e(n))===null||i===void 0?void 0:i.unit;return t==="temporal"||r?Mw(e,t,r):[e]}function dn(e,t,n,i){const{encoding:r}=n,s=le(r[i]),{type:o}=s,a=s.timeUnit;if(qv(t)){const f=dn(e,void 0,n,i),d=ga(t.unionWith,o,a);return Wt([...f.value,...d])}else{if(T(t))return Wt([t]);if(t&&t!=="unaggregated"&&!Yd(t))return Wt(ga(t,o,a))}const u=n.stack;if(u&&i===u.fieldChannel){if(u.offset==="normalize")return Me([[0,1]]);const f=n.requestDataName(q.Main);return Me([{data:f,field:n.vgField(i,{suffix:"start"})},{data:f,field:n.vgField(i,{suffix:"end"})}])}const l=jn(i)&&C(s)?Ww(n,i,e):void 0;if(Tn(s)){const f=ga([s.datum],o,a);return Me(f)}const c=s;if(t==="unaggregated"){const f=n.requestDataName(q.Main),{field:d}=s;return Me([{data:f,field:w({field:d,aggregate:"min"})},{data:f,field:w({field:d,aggregate:"max"})}])}else if(J(c.bin)){if(Ie(e))return Me(e==="bin-ordinal"?[]:[{data:Sr(l)?n.requestDataName(q.Main):n.requestDataName(q.Raw),field:n.vgField(i,Yr(c,i)?{binSuffix:"range"}:{}),sort:l===!0||!ue(l)?{field:n.vgField(i,{}),op:"min"}:l}]);{const{bin:f}=c;if(J(f)){const d=Nl(n,c.field,f);return Me([new Ge(()=>{const p=n.getSignalName(d);return`[${p}.start, ${p}.stop]`})])}else return Me([{data:n.requestDataName(q.Main),field:n.vgField(i,{})}])}}else if(c.timeUnit&&D(["time","utc"],e)&&tl(i,c,te(n)?n.encoding[It(i)]:void 0,n.stack,n.markDef,n.config)){const f=n.requestDataName(q.Main);return Me([{data:f,field:n.vgField(i)},{data:f,field:n.vgField(i,{suffix:"end"})}])}else return Me(l?[{data:Sr(l)?n.requestDataName(q.Main):n.requestDataName(q.Raw),field:n.vgField(i),sort:l}]:[{data:n.requestDataName(q.Main),field:n.vgField(i)}])}function ha(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:n!=null?n:t?"sum":mo},i?{field:Qt(i)}:{}),r?{order:r}:{})}function Uw(e,t){var n;const i=e.component.scales[t],r=e.specifiedScales[t].domain,s=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,o=Yd(r)&&r,a=Gr(s)&&uo(s.extent)&&s.extent;(o||a)&&i.set("selectionExtent",o!=null?o:a,!0)}function Ww(e,t,n){if(!Ie(n))return;const i=e.fieldDef(t),r=i.sort;if(dp(r))return{op:"min",field:Mi(i,t),order:"ascending"};const{stack:s}=e,o=s?[...s.groupbyField?[s.groupbyField]:[],...s.stackBy.map(a=>a.fieldDef.field)]:void 0;if(At(r)){const a=s&&!D(o,r.field);return ha(r,a)}else if(fp(r)){const{encoding:a,order:u}=r,l=e.fieldDef(a),{aggregate:c,field:f}=l,d=s&&!D(o,f);if(Zt(c)||wn(c))return ha({field:w(l),order:u},d);if(Su(c)||!c)return ha({op:c,field:f,order:u},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(D(["ascending",void 0],r))return!0}}function jf(e,t){const{aggregate:n,type:i}=e;return n?P(n)&&!Ub[n]?{valid:!1,reason:Ry(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:Ly(e)}:{valid:!0}:{valid:!1,reason:Iy(e)}}function tu(e,t,n,i){return e.explicit&&t.explicit&&O(Wy(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function Gw(e){const t=Et(e.map(o=>Ht(o)?Iw(o,["sort"]):o),R),n=Et(e.map(o=>{if(Ht(o)){const a=o.sort;return a!==void 0&&!Sr(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}}).filter(o=>o!==void 0),R);if(t.length===0)return;if(t.length===1){const o=e[0];if(Ht(o)&&n.length>0){let a=n[0];if(n.length>1)O(kc),a=!0;else if(ue(a)&&"field"in a){const u=a.field;o.field===u&&(a=a.order?{order:a.order}:!0)}return Object.assign(Object.assign({},o),{sort:a})}return o}const i=Et(n.map(o=>Sr(o)||!("op"in o)||P(o.op)&&o.op in Rb?o:(O(Hy(o)),!0)),R);let r;i.length===1?r=i[0]:i.length>1&&(O(kc),r=!0);const s=Et(e.map(o=>Ht(o)?o.data:null),o=>o);return s.length===1&&s[0]!==null?Object.assign({data:s[0],fields:t.map(a=>a.field)},r?{sort:r}:{}):Object.assign({fields:t},r?{sort:r}:{})}function Il(e){if(Ht(e)&&P(e.field))return e.field;if(Ev(e)){let t;for(const n of e.fields)if(Ht(n)&&P(n.field)){if(!t)t=n.field;else if(t!==n.field)return O(qy),t}return O(Vy),t}else if(xv(e)){O(Xy);const t=e.fields[0];return P(t)?t:void 0}}function Io(e,t){const i=e.component.scales[t].get("domains").map(r=>(Ht(r)&&(r.data=e.lookupDataSource(r.data)),r));return Gw(i)}var Hw=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function nh(e){return er(e)||Rl(e)?e.children.reduce((t,n)=>t.concat(nh(n)),Df(e)):Df(e)}function Df(e){return y(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:s,type:o,selectionExtent:a,domains:u,range:l,reverse:c}=r,f=Hw(r,["name","type","selectionExtent","domains","range","reverse"]),d=qw(r.range,s,n,e);let p;a&&(p=qE(e,a));const g=Io(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:o},g?{domain:g}:{}),p?{domainRaw:p}:{}),{range:d}),c!==void 0?{reverse:c}:{}),f)),t},[])}function qw(e,t,n,i){if(Ct(n)){if(Dn(e))return{step:{signal:t+"_step"}}}else if(ue(e)&&Ht(e))return Object.assign(Object.assign({},e),{data:i.lookupDataSource(e.data)});return e}class ih extends an{constructor(t,n){super({},{name:t});this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:Ti(this.get("domains"),t=>j(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const Vw=["range","scheme"];function rh(e){return e==="x"?"width":e==="y"?"height":void 0}function Xw(e){const t=e.component.scales;for(const n of ao){const i=t[n];if(!i)continue;const r=Yw(n,e);i.setWithExplicit("range",r)}}function Nf(e,t){const n=e.fieldDef(t);if(n&&n.bin&&J(n.bin)){const i=Nl(e,n.field,n.bin),r=rh(t),s=e.getName(r);return new Ge(()=>{const o=e.getSignalName(i),a=`(${o}.stop - ${o}.start) / ${o}.step`;return`${e.getSignalName(s)} / (${a})`})}}function Yw(e,t){const n=t.specifiedScales[e],{size:i}=t,s=t.getScaleComponent(e).get("type");for(const l of Vw)if(n[l]!==void 0){const c=Ia(s,l),f=Jd(e,l);if(!c)O(Rd(s,l,e));else if(f)O(f);else switch(l){case"range":{const d=n.range;if(j(d)){if(Ct(e))return Wt(d.map(p=>{if(p==="width"||p==="height"){const g=t.getName(p),m=t.getSignalName.bind(t);return Ge.fromName(m,g)}return p}))}else if(ue(d))return Wt({data:t.requestDataName(q.Main),field:d.field,sort:{op:"min",field:t.vgField(e)}});return Wt(d)}case"scheme":return Wt(Jw(n[l]))}}if(e===Z||e===ce){const l=e===Z?"width":"height",c=i[l];if(_t(c)){if(Ie(s))return Wt({step:c.step});O(Ld(l))}}const{rangeMin:o,rangeMax:a}=n,u=Kw(e,t);return(o!==void 0||a!==void 0)&&Ia(s,"rangeMin")&&j(u)&&u.length===2?Wt([o!=null?o:u[0],a!=null?a:u[1]]):Me(u)}function Jw(e){return Hv(e)?Object.assign({scheme:e.name},We(e,["name"])):{scheme:e}}function Kw(e,t){const{size:n,config:i,mark:r,encoding:s}=t,o=t.getSignalName.bind(t),{type:a}=le(s[e]),l=t.getScaleComponent(e).get("type"),{domain:c,domainMid:f}=t.specifiedScales[e];switch(e){case Z:case ce:{if(D(["point","band"],l)){if(e===Z&&!n.width){const g=_r(i.view,"width");if(_t(g))return g}else if(e===ce&&!n.height){const g=_r(i.view,"height");if(_t(g))return g}}const d=rh(e),p=t.getName(d);return e===ce&&Ye(l)?[Ge.fromName(o,p),0]:[0,Ge.fromName(o,p)]}case rn:{const d=t.component.scales[e].get("zero"),p=sh(r,d,i),g=eS(r,n,t,i);return $s(l)?Zw(p,g,Qw(l,i,c,e)):[p,g]}case dt:return[0,Math.PI*2];case fi:return[0,360];case Dt:return[0,new Ge(()=>{const d=t.getSignalName("width"),p=t.getSignalName("height");return`min(${d},${p})/2`})];case Fn:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case _n:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Pe:return"symbol";case ke:case kt:case Pt:return l==="ordinal"?a==="nominal"?"category":"ordinal":f!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case sn:case Sn:case Cn:return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}function Qw(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&j(n)?n.length+1:(O(iv(i)),3)}}function Zw(e,t,n){const i=()=>{const r=Yt(t),s=Yt(e),o=`(${r} - ${s}) / (${n} - 1)`;return`sequence(${s}, ${r} + ${o}, ${o})`};return T(t)?new Ge(i):{signal:i()}}function sh(e,t,n){if(t)return T(t)?{signal:`${t.signal} ? 0 : ${sh(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(lo("size",e))}const Tf=.95;function eS(e,t,n,i){const r={x:Nf(n,"x"),y:Nf(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const s=kf(t,r,i.view);return ae(s)?s-1:new Ge(()=>`${s.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const s=kf(t,r,i.view);return ae(s)?Math.pow(Tf*s,2):new Ge(()=>`pow(${Tf} * ${s.signal}, 2)`)}}throw new Error(lo("size",e))}function kf(e,t,n){const i=_t(e.width)?e.width.step:Is(n,"width"),r=_t(e.height)?e.height.step:Is(n,"height");return t.x||t.y?new Ge(()=>`min(${[t.x?t.x.signal:i,t.y?t.y.signal:r].join(", ")})`):Math.min(i,r)}function oh(e,t){te(e)?tS(e,t):uh(e,t)}function tS(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:s,specifiedScales:o}=e;for(const a of y(n)){const u=o[a],l=n[a],c=e.getScaleComponent(a),f=le(r[a]),d=u[t],p=c.get("type"),g=c.get("padding"),m=c.get("paddingInner"),h=Ia(p,t),x=Jd(a,t);if(d!==void 0&&(h?x&&O(x):O(Rd(p,t,a))),h&&x===void 0)if(d!==void 0){const v=f.timeUnit,S=f.type;switch(t){case"domainMax":case"domainMin":pi(u[t])||S==="temporal"||v?l.set(t,{signal:xo(u[t],{type:S,timeUnit:v})},!0):l.set(t,u[t],!0);break;default:l.copyKeyFromObject(t,u)}}else{const v=t in Pf?Pf[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:p,scalePadding:g,scalePaddingInner:m,domain:u.domain,markDef:s,config:i}):i.scale[t];v!==void 0&&l.set(t,v,!1)}}}const Pf={bins:({model:e,fieldOrDatumDef:t})=>C(t)?nS(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>iS(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>rS(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>sS(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:i})=>oS(e,t,n.type,i.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:i,scalePaddingInner:r,config:s})=>aS(e,t,n,i.type,r,s.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=C(e)?e.sort:void 0;return uS(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r})=>lS(e,t,n,i,r)};function ah(e){te(e)?Xw(e):uh(e,"range")}function uh(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?ah(i):oh(i,t);for(const i of y(n)){let r;for(const s of e.children){const o=s.component.scales[i];if(o){const a=o.getWithExplicit(t);r=On(r,a,t,"scale",tg((u,l)=>{switch(t){case"range":return u.step&&l.step?u.step-l.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function nS(e,t){const n=t.bin;if(J(n)){const i=Nl(e,t.field,n);return new Ge(()=>e.getSignalName(i))}else if(Se(n)&&Gr(n)&&n.step!==void 0)return{step:n.step}}function iS(e,t){if(D([ke,kt,Pt],e)&&t!=="nominal")return"hcl"}function rS(e,t,n){var i;if(!(((i=Ft(n))===null||i===void 0?void 0:i.bin)||D([oe.TIME,oe.UTC],e)))return t in $n?!0:void 0}function sS(e,t,n,i,r,s){if(e in $n){if(st(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:a}=r;if(o==="bar"&&!(C(i)&&(i.bin||i.timeUnit))&&(a==="vertical"&&e==="x"||a==="horizontal"&&e==="y"))return s.continuousBandSize}if(t===oe.POINT)return n.pointPadding}}function oS(e,t,n,i){if(e===void 0&&t in $n){const{bandPaddingInner:r,barBandPaddingInner:s,rectBandPaddingInner:o}=i;return se(r,n==="bar"?s:o)}}function aS(e,t,n,i,r,s){if(e===void 0&&t in $n&&n===oe.BAND){const{bandPaddingOuter:o}=s;return se(o,T(r)?{signal:`${r.signal}/2`}:r/2)}}function uS(e,t,n,i){if(n==="x"&&i.xReverse!==void 0)return Ye(e)&&t==="descending"?T(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse;if(Ye(e)&&t==="descending")return!0}function lS(e,t,n,i,r){if(!!n&&n!=="unaggregated"&&Ye(r)){if(j(n)){const o=n[0],a=n[n.length-1];if(o<=0&&a>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!$s(r))return!0;if(!(C(t)&&t.bin)&&D([...Xe,...ey],e)){const{orient:o,type:a}=i;return!(D(["bar","area","line","trail"],a)&&(o==="horizontal"&&e==="y"||o==="vertical"&&e==="x"))}return!1}function cS(e,t,n,i){const r=fS(t,n,i),{type:s}=e;return jn(t)?s!==void 0?Kv(t,s)?C(n)&&!Jv(s,n.type)?(O(My(s,r)),r):s:(O(zy(t,s,r)),r):r:null}function fS(e,t,n){var i;switch(t.type){case"nominal":case"ordinal":if($i(e)||ra(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&O(sa(e,"ordinal")),"ordinal";if(e in $n){if(D(["rect","bar","image","rule"],n))return"band"}else if(n==="arc"&&e in $u)return"band";return t.band!==void 0||il(t)&&((i=t.axis)===null||i===void 0?void 0:i.tickBand)?"band":"point";case"temporal":return $i(e)?"time":ra(e)==="discrete"?(O(sa(e,"temporal")),"ordinal"):C(t)&&t.timeUnit&&_e(t.timeUnit).utc?"utc":"time";case"quantitative":return $i(e)?C(t)&&J(t.bin)?"bin-ordinal":"linear":ra(e)==="discrete"?(O(sa(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(Pd(t.type))}function dS(e,{ignoreRange:t}={}){lh(e),th(e);for(const n of Yv)oh(e,n);t||ah(e)}function lh(e){te(e)?e.component.scales=pS(e):e.component.scales=hS(e)}function pS(e){const{encoding:t,mark:n}=e;return ao.reduce((i,r)=>{const s=le(t[r]);if(s&&n===Zd&&r===Pe&&s.type===Yi)return i;let o=s&&s.scale;if(s&&o!==null&&o!==!1){o=o!=null?o:{};const a=cS(o,r,s,n);i[r]=new ih(e.scaleName(r+"",!0),{value:a,explicit:o.type===a})}return i},{})}const gS=tg((e,t)=>Ic(e)-Ic(t));function hS(e){var t;const n=e.component.scales={},i={},r=e.component.resolve;for(const s of e.children){lh(s);for(const o of y(s.component.scales))if(r.scale[o]=(t=r.scale[o])!==null&&t!==void 0?t:TA(o,e),r.scale[o]==="shared"){const a=i[o],u=s.component.scales[o].getWithExplicit("type");a?Nv(a.value,u.value)?i[o]=On(a,u,"type","scale",gS):(r.scale[o]="independent",delete i[o]):i[o]=u}}for(const s of y(i)){const o=e.scaleName(s,!0),a=i[s];n[s]=new ih(o,a);for(const u of e.children){const l=u.component.scales[s];l&&(u.renameScale(l.get("name"),o),l.merged=!0)}}return n}var ma=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class ba{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function te(e){return(e==null?void 0:e.type)==="unit"}function at(e){return(e==null?void 0:e.type)==="facet"}function Rl(e){return(e==null?void 0:e.type)==="concat"}function er(e){return(e==null?void 0:e.type)==="layer"}class Ll{constructor(t,n,i,r,s,o,a){var u,l;this.type=n,this.parent=i,this.config=s,this.children=[],this.correctDataNames=c=>(c.from&&c.from.data&&(c.from.data=this.lookupDataSource(c.from.data)),c.from&&c.from.facet&&c.from.facet.data&&(c.from.facet.data=this.lookupDataSource(c.from.facet.data)),c),this.parent=i,this.config=s,this.view=it(a),this.name=(u=t.name)!==null&&u!==void 0?u:r,this.title=gn(t.title)?{text:t.title}:t.title?this.initTitle(t.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new ba,this.projectionNameMap=i?i.projectionNameMap:new ba,this.signalNameMap=i?i.signalNameMap:new ba,this.data=t.data,this.description=t.description,this.transforms=hE((l=t.transform)!==null&&l!==void 0?l:[]),this.layout=n==="layer"||n==="unit"?{}:c1(t,n,s),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:bo(t)||i&&i.component.data.isFaceted&&t.data===void 0},layoutSize:new an,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?I(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}initTitle(t){const n=y(t),i={text:Ce(t.text)};for(const r of n)i[r]=Ce(t[r]);return i}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){dS(this)}parseProjection(){Qg(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){Vg(this)}assembleGroupStyle(){var t,n;if(this.type==="unit"||this.type==="layer")return(n=(t=this.view)===null||t===void 0?void 0:t.style)!==null&&n!==void 0?n:"cell"}assembleEncodeFromView(t){const n=ma(t,["style"]),i={};for(const r of y(n)){const s=n[r];s!==void 0&&(i[r]=Q(s))}return i}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=Q(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n!=null?n:{}):G(n)?void 0:n}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,i=ma(t,["spacing"]),{component:r,config:s}=this,o=NA(r.layoutHeaders,s);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),i),o?{titleBand:o}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const i of qe)t[i].title&&n.push(CA(this,i));for(const i of _l)n=n.concat(FA(this,i));return n}assembleAxes(){return gA(this.component.axes,this.config)}assembleLegends(){return Yg(this)}assembleProjections(){return iw(this)}assembleTitle(){var t,n,i;const r=(t=this.title)!==null&&t!==void 0?t:{},{encoding:s}=r,o=ma(r,["encoding"]),a=Object.assign(Object.assign(Object.assign({},xp(this.config.title).nonMark),o),s?{encode:{update:s}}:{});if(a.text)return D(["unit","layer"],this.type)?D(["middle",void 0],a.anchor)&&(a.frame=(n=a.frame)!==null&&n!==void 0?n:"group"):a.anchor=(i=a.anchor)!==null&&i!==void 0?i:"start",G(a)?void 0:a}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const i=this.assembleLayout();i&&(n.layout=i),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||at(this.parent)?nh(this):[];r.length>0&&(n.scales=r);const s=this.assembleAxes();s.length>0&&(n.axes=s);const o=this.assembleLegends();return o.length>0&&(n.legends=o),n}getName(t){return Y((this.name?this.name+"_":"")+t)}getDataName(t){return this.getName(q[t].toLowerCase())}requestDataName(t){const n=this.getDataName(t),i=this.component.data.outputNodeRefCounts;return i[n]=(i[n]||0)+1,n}getSizeSignalRef(t){if(at(this.parent)){const n=Mg(t),i=oo(n),r=this.component.scales[i];if(r&&!r.merged){const s=r.get("type"),o=r.get("range");if(Ie(s)&&Dn(o)){const a=r.get("name"),u=Io(this,i),l=Il(u);if(l){const c=w({aggregate:"distinct",field:l},{expr:"datum"});return{signal:zg(a,r,c)}}else return O(Du(i)),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){if(n)return this.getName(t);if(_d(t)&&jn(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t)))return this.scaleNameMap.get(this.getName(t))}projectionName(t){if(t)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let i=this.component.selection[t];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(t,n)),!i)throw new Error(cy(n));return i}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(i=>i.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(i=>i.hasOrientSignalRef()))}}class ch extends Ll{vgField(t,n={}){const i=this.fieldDef(t);if(!!i)return w(i,n)}reduceFieldDef(t,n){return LO(this.getMapping(),(i,r,s)=>{const o=Ft(r);return o?t(i,o,s):i},n)}forEachFieldDef(t,n){ll(this.getMapping(),(i,r)=>{const s=Ft(i);s&&t(s,r)},n)}}var mS=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Ro extends H{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=I(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"value",(s=o[1])!==null&&s!==void 0?s:"density"]}clone(){return new Ro(null,I(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${R(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,i=mS(t,["density"]);return Object.assign({type:"kde",field:n},i)}}class Tr extends H{constructor(t,n){super(t);this.filter=n}clone(){return new Tr(null,Object.assign({},this.filter))}static make(t,n){const{config:i,mark:r,markDef:s}=n;if(M("invalid",s,i)!=="filter")return null;const a=n.reduceFieldDef((u,l,c)=>{const f=jn(c)&&n.getScaleComponent(c);if(f){const d=f.get("type");Ye(d)&&l.aggregate!=="count"&&!Nn(r)&&(u[l.field]=l)}return u},{});return y(a).length?new Tr(t,a):null}dependentFields(){return new Set(y(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${R(this.filter)}`}assemble(){const t=y(this.filter).reduce((n,i)=>{const r=this.filter[i],s=w(r,{expr:"datum"});return r!==null&&(r.type==="temporal"?n.push(`(isDate(${s}) || (isValid(${s}) && isFinite(+${s})))`):r.type==="quantitative"&&(n.push(`isValid(${s})`),n.push(`isFinite(+${s})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class Lo extends H{constructor(t,n){super(t);this.transform=n,this.transform=I(n);const{flatten:i,as:r=[]}=this.transform;this.transform.as=i.map((s,o)=>{var a;return(a=r[o])!==null&&a!==void 0?a:s})}clone(){return new Lo(this.parent,I(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${R(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform;return{type:"flatten",fields:t,as:n}}}class Bo extends H{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=I(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"key",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new Bo(null,I(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${R(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform;return{type:"fold",fields:t,as:n}}}class Di extends H{constructor(t,n,i,r){super(t);this.fields=n,this.geojson=i,this.signal=r}clone(){return new Di(null,I(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let i=0;for(const r of[[Tt,Nt],[Ve,pt]]){const s=r.map(o=>{const a=le(n.encoding[o]);return C(a)?a.field:Tn(a)?{expr:`${a.datum}`}:ut(a)?{expr:`${a.value}`}:void 0});(s[0]||s[1])&&(t=new Di(t,s,null,n.getName(`geojson_${i++}`)))}if(n.channelHasField(Pe)){const r=n.typedFieldDef(Pe);r.type===Yi&&(t=new Di(t,null,r.field,n.getName(`geojson_${i++}`)))}return t}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter(P);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${R(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class kr extends H{constructor(t,n,i,r){super(t);this.projection=n,this.fields=i,this.as=r}clone(){return new kr(null,this.projection,I(this.fields),I(this.as))}static parseAll(t,n){if(!n.projectionName())return t;for(const i of[[Tt,Nt],[Ve,pt]]){const r=i.map(o=>{const a=le(n.encoding[o]);return C(a)?a.field:Tn(a)?{expr:`${a.datum}`}:ut(a)?{expr:`${a.value}`}:void 0}),s=i[0]===Ve?"2":"";(r[0]||r[1])&&(t=new kr(t,n.projectionName(),r,[n.getName("x"+s),n.getName("y"+s)]))}return t}dependentFields(){return new Set(this.fields.filter(P))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${R(this.fields)} ${R(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Zn extends H{constructor(t,n){super(t);this.transform=n}clone(){return new Zn(null,I(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:i,step:r}=t;return{signal:`sequence(${[n,i,...r?[r]:[]].join(",")})`}}static makeFromTransform(t,n){return new Zn(t,n)}static makeFromEncoding(t,n){const i=n.encoding,r=i.x,s=i.y;if(C(r)&&C(s)){const o=r.impute?r:s.impute?s:void 0;if(o===void 0)return;const a=r.impute?s:s.impute?r:void 0,{method:u,value:l,frame:c,keyvals:f}=o.impute,d=Dp(n.mark,i);return new Zn(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:o.field,key:a.field},u?{method:u}:{}),l!==void 0?{value:l}:{}),c?{frame:c}:{}),f!==void 0?{keyvals:f}:{}),d.length?{groupby:d}:{}))}return null}hash(){return`Impute ${R(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:i,method:r,groupby:s,value:o,frame:a=[null,null]}=this.transform,u=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},i?{keyvals:Y1(i)?this.processSequence(i):i}:{}),{method:"value"}),s?{groupby:s}:{}),{value:!r||r==="value"?o:null});if(r&&r!=="value"){const l=Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[r],fields:[t],frame:a,ignorePeers:!1},s?{groupby:s}:{}),c={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[u,l,c]}else return[u]}}var bS=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class zo extends H{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=I(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.loess]}clone(){return new zo(null,I(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${R(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:i}=t,r=bS(t,["loess","on"]);return Object.assign({type:"loess",x:i,y:n},r)}}class Pr extends H{constructor(t,n,i){super(t);this.transform=n,this.secondary=i}clone(){return new Pr(null,I(this.transform),this.secondary)}static make(t,n,i,r){const s=n.component.data.sources,{from:o}=i;let a=null;if(K1(o)){let u=ph(o.data,s);u||(u=new li(o.data),s.push(u));const l=n.getName(`lookup_${r}`);a=new Fe(u,l,q.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[l]=a}else if(Q1(o)){const u=o.selection;if(i=Object.assign({as:u},i),a=n.getSelectionComponent(Y(u),u).materialized,!a)throw new Error(py(u))}return new Pr(t,i,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?re(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${R({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:re(this.transform.as)}:{});else{let n=this.transform.as;P(n)||(O(Ey),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}var yS=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Mo extends H{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=I(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"prob",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new Mo(null,I(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${R(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,i=yS(t,["quantile"]);return Object.assign({type:"quantile",field:n},i)}}var vS=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Uo extends H{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=I(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.regression]}clone(){return new Uo(null,I(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${R(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:i}=t,r=vS(t,["regression","on"]);return Object.assign({type:"regression",x:i,y:n},r)}}class Wo extends H{constructor(t,n){super(t);this.transform=n}clone(){return new Wo(null,I(this.transform))}addDimensions(t){var n;this.transform.groupby=Et(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),i=>i)}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${R(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:i,limit:r,op:s}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},r!==void 0?{limit:r}:{}),s!==void 0?{op:s}:{}),i!==void 0?{groupby:i}:{})}}class Go extends H{constructor(t,n){super(t);this.transform=n}clone(){return new Go(null,I(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${R(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function fh(e){let t=0;function n(i,r){var s;if(i instanceof li&&!i.isGenerator&&!$r(i.data)&&(e.push(r),r={name:null,source:r.name,transform:[]}),i instanceof Oe&&(i.parent instanceof li&&!r.source?(r.format=Object.assign(Object.assign({},(s=r.format)!==null&&s!==void 0?s:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof Qi){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source;for(const o of i.assemble())e.push(o);return}switch((i instanceof es||i instanceof ts||i instanceof Tr||i instanceof Ki||i instanceof zi||i instanceof kr||i instanceof Di||i instanceof ot||i instanceof Pr||i instanceof Zi||i instanceof bi||i instanceof Bo||i instanceof Lo||i instanceof Ro||i instanceof zo||i instanceof Mo||i instanceof Uo||i instanceof An||i instanceof Go||i instanceof Wo)&&r.transform.push(i.assemble()),(i instanceof St||i instanceof wt||i instanceof Zn||i instanceof Kt)&&r.transform.push(...i.assemble()),i instanceof Fe&&(r.source&&r.transform.length===0?i.setSource(r.source):i.parent instanceof Fe?i.setSource(r.name):(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1&&(e.push(r),r={name:null,source:r.name,transform:[]}))),i.numChildren()){case 0:i instanceof Fe&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const a of i.children)n(a,{name:null,source:o,transform:[]});break}}}return n}function OS(e){const t=[],n=fh(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function ES(e,t){var n,i;const r=[],s=fh(r);let o=0;for(const u of e.sources){u.hasName()||(u.dataName=`source_${o++}`);const l=u.assemble();s(u,l)}for(const u of r)u.transform.length===0&&delete u.transform;let a=0;for(const[u,l]of r.entries())((n=l.transform)!==null&&n!==void 0?n:[]).length===0&&!l.source&&r.splice(a++,0,r.splice(u,1)[0]);for(const u of r)for(const l of(i=u.transform)!==null&&i!==void 0?i:[])l.type==="lookup"&&(l.from=e.outputNodes[l.from].getSource());for(const u of r)u.name in t&&(u.values=t[u.name]);return r}function xS(e){return e==="top"||e==="left"||T(e)?"header":"footer"}function AS(e){for(const t of qe)wS(e,t);If(e,"x"),If(e,"y")}function wS(e,t){var n;const{facet:i,config:r,child:s,component:o}=e;if(e.channelHasField(t)){const a=i[t],u=Ui("title",null,r,t);let l=ji(a,r,{allowDisabling:!0,includeDefault:u===void 0||!!u});s.component.layoutHeaders[t].title&&(l=j(l)?l.join(", "):l,l+=" / "+s.component.layoutHeaders[t].title,s.component.layoutHeaders[t].title=null);const c=Ui("labelOrient",a,r,t),f=(n=a.header)!==null&&n!==void 0?n:{},d=se(f.labels,r.header.labels,!0),p=D(["bottom","right"],c)?"footer":"header";o.layoutHeaders[t]={title:l,facetFieldDef:a,[p]:t==="facet"?[]:[dh(e,t,d)]}}}function dh(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function If(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:s}=e.component;if(s.axis[t]=Dl(s,t),s.axis[t]==="shared"){const o=t==="x"?"column":"row",a=r[o];for(const u of i.component.axes[t]){const l=xS(u.get("orient"));a[l]=(n=a[l])!==null&&n!==void 0?n:[dh(e,o,!1)];const c=gr(u,"main",e.config,{header:!0});c&&a[l][0].axes.push(c),u.mainExtracted=!0}}}}function SS(e){Bl(e),Us(e,"width"),Us(e,"height")}function CS(e){Bl(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";Us(e,t),Us(e,n)}function Bl(e){for(const t of e.children)t.parseLayoutSize()}function Us(e,t){const n=Mg(t),i=oo(n),r=e.component.resolve,s=e.component.layoutSize;let o;for(const a of e.children){const u=a.component.layoutSize.getWithExplicit(n),l=r.scale[i];if(l==="independent"&&u.value==="step"){o=void 0;break}if(o){if(l==="independent"&&o.value!==u.value){o=void 0;break}o=On(o,u,n,"")}else o=u}if(o){for(const a of e.children)e.renameSignal(a.getName(n),e.getName(t)),a.component.layoutSize.set(n,"merged",!1);s.setWithExplicit(t,o)}else s.setWithExplicit(t,{explicit:!1,value:void 0})}function FS(e){const{size:t,component:n}=e;for(const i of Xe){const r=Rt(i);if(t[r]){const s=t[r];n.layoutSize.set(r,_t(s)?"step":s,!0)}else{const s=_S(e,r);n.layoutSize.set(r,s,!1)}}}function _S(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const s=r.get("type"),o=r.get("range");if(Ie(s)){const a=_r(i.view,t);return Dn(o)||_t(a)?"step":a}else return za(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return za(i.view,t);{const s=_r(i.view,t);return _t(s)?s.step:s}}}var $S=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function nu(e,t,n){return w(t,Object.assign({suffix:`by_${w(e)}`},n!=null?n:{}))}class xr extends ch{constructor(t,n,i,r){super(t,"facet",n,i,r,t.resolve);this.child=Gl(t.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(t.facet)}initFacet(t){if(!Vr(t))return{facet:this.initFacetFieldDef(t,"facet")};const n=y(t),i={};for(const r of n){if(!D([Vt,Xt],r)){O(lo(r,"facet"));break}const s=t[r];if(s.field===void 0){O(Ta(s,r));break}i[r]=this.initFacetFieldDef(s,r)}return i}initFacetFieldDef(t,n){const{header:i}=t,r=$S(t,["header"]),s=ol(r,n);return i&&(s.header=it(i)),s}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=Ho(this),this.child.parseData()}parseLayoutSize(){Bl(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),AS(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,i;const r={};for(const s of qe)for(const o of $l){const a=this.component.layoutHeaders[s],u=a[o],{facetFieldDef:l}=a;if(l){const c=Ui("titleOrient",l.header,this.config,s);if(D(["right","bottom"],c)){const f=ko(s,c);r.titleAnchor=(t=r.titleAnchor)!==null&&t!==void 0?t:{},r.titleAnchor[f]="end"}}if(u==null?void 0:u[0]){const c=s==="row"?"height":"width",f=o==="header"?"headerBand":"footerBand";s!=="facet"&&!this.child.component.layoutSize.get(c)&&(r[f]=(n=r[f])!==null&&n!==void 0?n:{},r[f][s]=.5),a.title&&(r.offset=(i=r.offset)!==null&&i!==void 0?i:{},r.offset[s==="row"?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:t,row:n}=this.facet,i=t?this.columnDistinctSignal():n?1:void 0;let r="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),i?{columns:i}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof xr))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(t){return this.parent&&this.parent instanceof xr?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:w(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],i=[];if(this.child instanceof xr){if(this.child.channelHasField("column")){const r=w(this.child.facet.column);t.push(r),n.push("distinct"),i.push(`distinct_${r}`)}}else for(const r of Xe){const s=this.child.component.scales[r];if(s&&!s.merged){const o=s.get("type"),a=s.get("range");if(Ie(o)&&Dn(a)){const u=Io(this.child,r),l=Il(u);l?(t.push(l),n.push("distinct"),i.push(`distinct_${l}`)):O(Du(r))}}}return{fields:t,ops:n,as:i}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:i,column:r}=this.facet,{fields:s,ops:o,as:a}=this.getCardinalityAggregateForChild(),u=[];for(const c of qe){const f=this.facet[c];if(f){u.push(w(f));const{bin:d,sort:p}=f;if(J(d)&&u.push(w(f,{binSuffix:"end"})),At(p)){const{field:g,op:m=mo}=p,h=nu(f,p);i&&r?(s.push(h),o.push("max"),a.push(h)):(s.push(g),o.push(m),a.push(h))}else if(j(p)){const g=Mi(f,c);s.push(g),o.push("max"),a.push(g)}}}const l=!!i&&!!r;return Object.assign({name:t,data:n,groupby:u},l||s.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),s.length?{fields:s,ops:o,as:a}:{})}:{})}facetSortFields(t){const{facet:n}=this,i=n[t];return i?At(i.sort)?[nu(i,i.sort,{expr:"datum"})]:j(i.sort)?[Mi(i,t,{expr:"datum"})]:[w(i,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,i=n[t];if(i){const{sort:r}=i;return[(At(r)?r.order:!j(r)&&r)||"ascending"]}return[]}assembleLabelTitle(){var t;const{facet:n,config:i}=this;if(n.facet)return Ja(n.facet,"facet",i);const r={row:["top","bottom"],column:["left","right"]};for(const s of _l)if(n[s]){const o=Ui("labelOrient",(t=n[s])===null||t===void 0?void 0:t.header,i,s);if(D(r[s],o))return Ja(n[s],s,i)}}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,i=OS(n),r=t.assembleGroupEncodeEntry(!1),s=this.assembleLabelTitle()||t.assembleTitle(),o=t.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},s?{title:s}:{}),o?{style:o}:{}),{from:{facet:this.assembleFacet()},sort:{field:qe.map(u=>this.facetSortFields(u)).flat(),order:qe.map(u=>this.facetSortOrder(u)).flat()}}),i.length>0?{data:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup(UE(this,[])))]}getMapping(){return this.facet}}function jS(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const s of[n,i])if(At(s.sort)){const{field:o,op:a=mo}=s.sort;e=r=new bi(e,{joinaggregate:[{op:a,field:o,as:nu(s,s.sort,{forAs:!0})}],groupby:[w(s)]})}return r}return null}function ph(e,t){var n,i,r,s;for(const o of t){const a=o.data;if(e.name&&o.hasName()&&e.name!==o.dataName)continue;const u=(n=e.format)===null||n===void 0?void 0:n.mesh,l=(i=a.format)===null||i===void 0?void 0:i.feature;if(u&&l)continue;const c=(r=e.format)===null||r===void 0?void 0:r.feature;if((c||l)&&c!==l)continue;const f=(s=a.format)===null||s===void 0?void 0:s.mesh;if(!((u||f)&&u!==f)){if(Rs(e)&&Rs(a)){if(Xi(e.values,a.values))return o}else if($r(e)&&$r(a)){if(e.url===a.url)return o}else if(ng(e)&&e.name===o.dataName)return o}}return null}function DS(e,t){if(e.data||!e.parent){if(e.data===null){const i=new li({values:[]});return t.push(i),i}const n=ph(e.data,t);if(n)return Qn(e.data)||(n.data.format=pd({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new li(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function NS(e,t,n){var i,r;let s=0;for(const o of t.transforms){let a,u;if(uE(o))u=e=new zi(e,o),a="derived";else if(sg(o)){const l=bw(o);u=e=(i=Oe.makeWithAncestors(e,{},l,n))!==null&&i!==void 0?i:e,e=new Ki(e,t,o.filter)}else if(lE(o))u=e=St.makeFromTransform(e,o,t),a="number";else if(fE(o))a="date",n.getWithExplicit(o.field).value===void 0&&(e=new Oe(e,{[o.field]:a}),n.set(o.field,a,!1)),u=e=wt.makeFromTransform(e,o);else if(dE(o))u=e=ot.makeFromTransform(e,o),a="number",wl(t)&&(e=new An(e));else if(J1(o))u=e=Pr.make(e,t,o,s++),a="derived";else if(sE(o))u=e=new Zi(e,o),a="number";else if(oE(o))u=e=new bi(e,o),a="number";else if(pE(o))u=e=Kt.makeFromTransform(e,o),a="derived";else if(gE(o))u=e=new Bo(e,o),a="derived";else if(aE(o))u=e=new Lo(e,o),a="derived";else if(Z1(o))u=e=new Wo(e,o),a="derived";else if(rE(o))e=new Go(e,o);else if(cE(o))u=e=Zn.makeFromTransform(e,o),a="derived";else if(eE(o))u=e=new Ro(e,o),a="derived";else if(tE(o))u=e=new Mo(e,o),a="derived";else if(nE(o))u=e=new Uo(e,o),a="derived";else if(iE(o))u=e=new zo(e,o),a="derived";else{O(Oy(o));continue}if(u&&a!==void 0)for(const l of(r=u.producedFields())!==null&&r!==void 0?r:[])n.set(l,a,!1)}return e}function Ho(e){var t,n,i,r,s,o,a,u,l,c;let f=DS(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:p}=e.component.data,g=e.parent?e.parent.component.data.ancestorParse.clone():new X1,m=e.data;Qn(m)?(ig(m)?f=new ts(f,m.sequence):vl(m)&&(f=new es(f,m.graticule)),g.parseNothing=!0):((t=m==null?void 0:m.format)===null||t===void 0?void 0:t.parse)===null&&(g.parseNothing=!0),f=(n=Oe.makeExplicit(f,e,g))!==null&&n!==void 0?n:f,f=new An(f);const h=e.parent&&er(e.parent);(te(e)||at(e))&&h&&(f=(i=St.makeFromEncoding(f,e))!==null&&i!==void 0?i:f),e.transforms.length>0&&(f=NS(f,e,g));const x=vw(e),v=yw(e);f=(r=Oe.makeWithAncestors(f,{},Object.assign(Object.assign({},x),v),g))!==null&&r!==void 0?r:f,te(e)&&(f=Di.parseAll(f,e),f=kr.parseAll(f,e)),(te(e)||at(e))&&(h||(f=(s=St.makeFromEncoding(f,e))!==null&&s!==void 0?s:f),f=(o=wt.makeFromEncoding(f,e))!==null&&o!==void 0?o:f,f=zi.parseAllForSortIndex(f,e));const S=e.getDataName(q.Raw),F=new Fe(f,S,q.Raw,p);if(d[S]=F,f=F,te(e)){const N=ot.makeFromEncoding(f,e);N&&(f=N,wl(e)&&(f=new An(f))),f=(a=Zn.makeFromEncoding(f,e))!==null&&a!==void 0?a:f,f=(u=Kt.makeFromEncoding(f,e))!==null&&u!==void 0?u:f}te(e)&&(f=(l=Tr.make(f,e))!==null&&l!==void 0?l:f);const E=e.getDataName(q.Main),$=new Fe(f,E,q.Main,p);d[E]=$,f=$,te(e)&&dA(e,$);let A=null;if(at(e)){const N=e.getName("facet");f=(c=jS(f,e.facet))!==null&&c!==void 0?c:f,A=new Qi(f,e,N,$.getSource()),d[N]=A}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:p,raw:F,main:$,facetRoot:A,ancestorParse:g})}class TS extends Ll{constructor(t,n,i,r){var s,o,a,u;super(t,"concat",n,i,r,t.resolve);(((o=(s=t.resolve)===null||s===void 0?void 0:s.axis)===null||o===void 0?void 0:o.x)==="shared"||((u=(a=t.resolve)===null||a===void 0?void 0:a.axis)===null||u===void 0?void 0:u.y)==="shared")&&O(by),this.children=this.getChildren(t).map((l,c)=>Gl(l,this,this.getName("concat_"+c),void 0,r))}parseData(){this.component.data=Ho(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of y(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return So(t)?t.vconcat:bl(t)?t.hconcat:t.concat}parseLayoutSize(){CS(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=jl(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),i=t.assembleGroupStyle(),r=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),i?{style:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup())})}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}function kS(e){return e===!1||e===null}const PS=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},Ed),{labelExpr:1,encode:1}),gh=y(PS);class zl extends an{constructor(t={},n={},i=!1){super();this.explicit=t,this.implicit=n,this.mainExtracted=i}clone(){return new zl(I(this.explicit),I(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!kS(this.get(t))}hasOrientSignalRef(){return T(this.explicit.orient)}}function IS(e,t,n){var i;const{encoding:r,config:s}=e,o=(i=le(r[t]))!==null&&i!==void 0?i:le(r[It(t)]),a=e.axis(t)||{},{format:u,formatType:l}=a;return ri(l)?Object.assign({text:Qu({fieldOrDatumDef:o,field:"datum.value",format:u,formatType:l,config:s})},n):n}function RS(e){return Xe.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[GS(n,e)]),t),{})}const LS={bottom:"top",top:"bottom",left:"right",right:"left"};function BS(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const s of e.children){s.parseAxesAndHeaders();for(const o of y(s.component.axes))i.axis[o]=Dl(e.component.resolve,o),i.axis[o]==="shared"&&(n[o]=zS(n[o],s.component.axes[o]),n[o]||(i.axis[o]="independent",delete n[o]))}for(const s of Xe){for(const o of e.children)if(!!o.component.axes[s]){if(i.axis[s]==="independent"){n[s]=((t=n[s])!==null&&t!==void 0?t:[]).concat(o.component.axes[s]);for(const a of o.component.axes[s]){const{value:u,explicit:l}=a.getWithExplicit("orient");if(!T(u)){if(r[u]>0&&!l){const c=LS[u];r[u]>r[c]&&a.set("orient",c,!1)}r[u]++}}}delete o.component.axes[s]}if(i.axis[s]==="independent"&&n[s]&&n[s].length>1)for(const o of n[s])!!o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function zS(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],s=t[i];if(!!r!=!!s)return;if(r&&s){const o=r.getWithExplicit("orient"),a=s.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;e[i]=MS(r,s)}}}else return t.map(n=>n.clone());return e}function MS(e,t){for(const n of gh){const i=On(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,s)=>{switch(n){case"title":return $p(r,s);case"gridScale":return{explicit:r.explicit,value:se(r.value,s.value)}}return Fo(r,s,n,"axis")});e.setWithExplicit(n,i)}return e}function US(e,t,n,i,r){if(t==="disable")return n!==void 0;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(T(n.labelAngle)?n.labelAngle:Cr(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===Ig(i,r))return!0}return e===n[t]}const WS=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function GS(e,t){var n,i,r;let s=t.axis(e);const o=new zl,a=le(t.encoding[e]),{mark:u,config:l}=t,c=(s==null?void 0:s.orient)||((n=l[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((i=l.axis)===null||i===void 0?void 0:i.orient)||xA(e),f=t.getScaleComponent(e).get("type"),d=hA(e,f,c,t.config),p=s!==void 0?!s:Xa("disable",l.style,s==null?void 0:s.style,d).configValue;if(o.set("disable",p,s!==void 0),p)return o;s=s||{};const g=vA(a,s,e,l.style,d),m={fieldOrDatumDef:a,axis:s,channel:e,model:t,scaleType:f,orient:c,labelAngle:g,mark:u,config:l};for(const v of gh){const S=v in Ef?Ef[v](m):Sc(v)?s[v]:void 0,F=S!==void 0,E=US(S,v,s,t,e);if(F&&E)o.set(v,S,E);else{const{configValue:$=void 0,configFrom:A=void 0}=Sc(v)&&v!=="values"?Xa(v,l.style,s.style,d):{},N=$!==void 0;F&&!N?o.set(v,S,E):(A!=="vgAxisConfig"||WS.has(v)&&N||Br($)||T($))&&o.set(v,$,!1)}}const h=(r=s.encoding)!==null&&r!==void 0?r:{},x=Od.reduce((v,S)=>{var F;if(!o.hasAxisPart(S))return v;const E=Ug((F=h[S])!==null&&F!==void 0?F:{},t),$=S==="labels"?IS(t,e,E):E;return $!==void 0&&!G($)&&(v[S]={update:$}),v},{});return G(x)||o.set("encode",x,!!s.encoding||s.labelAngle!==void 0),o}function HS({encoding:e,size:t}){for(const n of Xe){const i=Rt(n);_t(t[i])&&xt(e[n])&&(delete t[i],O(Ld(i)))}return t}function qS(e,t,n){const i=it(e),r=M("orient",i,n);if(i.orient=JS(i.type,t,r),r!==void 0&&r!==i.orient&&O(Ty(i.orient,r)),i.type==="bar"&&i.orient){const a=M("cornerRadiusEnd",i,n);if(a!==void 0){const u=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:uO[i.orient];for(const l of u)i[l]=a;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}return M("opacity",i,n)===void 0&&(i.opacity=XS(i.type,t)),M("cursor",i,n)===void 0&&(i.cursor=VS(i,t,n)),i}function VS(e,t,n){return t.href||e.href||M("href",e,n)?"pointer":e.cursor}function XS(e,t){if(D([go,qu,Vu,Xu],e)&&!ul(t))return .7}function YS(e,t,{graticule:n}){if(n)return!1;const i=si("filled",e,t),r=e.type;return se(i,r!==go&&r!==po&&r!==js)}function JS(e,t,n){switch(e){case go:case Vu:case Xu:case Qd:case Zv:case Qv:return}const{x:i,y:r,x2:s,y2:o}=t;switch(e){case fo:if(C(i)&&(Se(i.bin)||C(r)&&r.aggregate&&!i.aggregate))return"vertical";if(C(r)&&(Se(r.bin)||C(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s&&(C(i)&&i.type===ii&&!J(i.bin)||La(i)))return"horizontal";if(!o&&(C(r)&&r.type===ii&&!J(r.bin)||La(r)))return"vertical"}case js:if(s&&!(C(i)&&Se(i.bin))&&o&&!(C(r)&&Se(r.bin)))return;case co:if(o)return C(r)&&Se(r.bin)?"horizontal":"vertical";if(s)return C(i)&&Se(i.bin)?"vertical":"horizontal";if(e===js){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case po:case qu:{const a=xt(i),u=xt(r);if(a&&!u)return e!=="tick"?"horizontal":"vertical";if(!a&&u)return e!=="tick"?"vertical":"horizontal";if(a&&u){const l=i,c=r,f=l.type===Ii,d=c.type===Ii;return f&&!d?e!=="tick"?"vertical":"horizontal":!f&&d?e!=="tick"?"horizontal":"vertical":!l.aggregate&&c.aggregate?e!=="tick"?"vertical":"horizontal":l.aggregate&&!c.aggregate?e!=="tick"?"horizontal":"vertical":n||"vertical"}else return n||void 0}}return"vertical"}const KS={vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ke(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),ve("x",e,{defaultPos:"mid"})),ve("y",e,{defaultPos:"mid"})),En(e,"radius","arc")),En(e,"theta","arc"))},QS={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},Ke(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),Ls("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),Ls("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),xl(e))},ZS={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},Ke(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),En(e,"x","bar")),En(e,"y","bar"))},eC={vgMark:"shape",encodeEntry:e=>Object.assign({},Ke(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&C(n)&&n.type===Yi?{field:w(n,{expr:"datum"})}:{})]}},tC={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},Ke(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),En(e,"x","image")),En(e,"y","image")),Ol(e,"url"))},nC={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ke(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),ve("x",e,{defaultPos:"mid"})),ve("y",e,{defaultPos:"mid"})),de("size",e,{vgChannel:"strokeWidth"})),xl(e))},iC={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ke(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),ve("x",e,{defaultPos:"mid"})),ve("y",e,{defaultPos:"mid"})),de("size",e)),xl(e))};function Ml(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ke(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),ve("x",e,{defaultPos:"mid"})),ve("y",e,{defaultPos:"mid"})),de("size",e)),de("angle",e)),rC(e,n,t))}function rC(e,t,n){return n?{shape:{value:n}}:de("shape",e)}const sC={vgMark:"symbol",encodeEntry:e=>Ml(e)},oC={vgMark:"symbol",encodeEntry:e=>Ml(e,"circle")},aC={vgMark:"symbol",encodeEntry:e=>Ml(e,"square")},uC={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},Ke(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),En(e,"x","rect")),En(e,"y","rect"))},lC={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},Ke(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Ls("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),Ls("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),de("size",e,{vgChannel:"strokeWidth"}))}},cC={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ke(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),ve("x",e,{defaultPos:"mid"})),ve("y",e,{defaultPos:"mid"})),Ol(e)),de("size",e,{vgChannel:"fontSize"})),de("angle",e)),lf("align",fC(e.markDef,n,t))),lf("baseline",dC(e.markDef,n,t))),ve("radius",e,{defaultPos:null,isMidPoint:!0})),ve("theta",e,{defaultPos:null,isMidPoint:!0}))}};function fC(e,t,n){if(M("align",e,n)===void 0)return"center"}function dC(e,t,n){if(M("baseline",e,n)===void 0)return"middle"}const pC={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",s=i==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ke(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),ve("x",e,{defaultPos:"mid",vgChannel:"xc"})),ve("y",e,{defaultPos:"mid",vgChannel:"yc"})),de("size",e,{defaultValue:gC(e),vgChannel:r})),{[s]:Q(M("thickness",n,t))})}};function gC(e){var t;const{config:n,markDef:i}=e,{orient:r}=i,s=r==="horizontal"?"width":"height",o=e.getScaleComponent(r==="horizontal"?"x":"y"),a=(t=M("size",i,n,{vgChannel:s}))!==null&&t!==void 0?t:n.tick.bandSize;if(a!==void 0)return a;{const u=o?o.get("range"):void 0;return u&&Dn(u)&&ae(u.step)?u.step*3/4:Is(n.view,s)*3/4}}const fs={arc:KS,area:QS,bar:ZS,circle:oC,geoshape:eC,image:tC,line:nC,point:sC,rect:uC,rule:lC,square:aC,text:cC,tick:pC,trail:iC};function hC(e){if(D([po,co,eO],e.mark)){const t=Dp(e.mark,e.encoding);if(t.length>0)return mC(e,t)}else if(D([fo],e.mark)){const t=ka.some(n=>M(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return bC(e)}return Ul(e)}const Rf="faceted_path_";function mC(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:Rf+e.requestDataName(q.Main),data:e.requestDataName(q.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:Ul(e,{fromPrefix:Rf})}]}const Lf="stack_group_";function bC(e){const[t]=Ul(e,{fromPrefix:Lf}),n=e.scaleName(e.stack.fieldChannel),i=(c={})=>e.vgField(e.stack.fieldChannel,c),r=(c,f)=>{const d=[i({prefix:"min",suffix:"start",expr:f}),i({prefix:"max",suffix:"start",expr:f}),i({prefix:"min",suffix:"end",expr:f}),i({prefix:"max",suffix:"end",expr:f})];return`${c}(${d.map(p=>`scale('${n}',${p})`).join(",")})`};let s,o;e.stack.fieldChannel==="x"?(s=Object.assign(Object.assign({},Ni(t.encode.update,["y","yc","y2","height",...ka])),{x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}}),o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},We(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(s=Object.assign(Object.assign({},Ni(t.encode.update,["x","xc","x2","width"])),{y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}}),o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},We(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const c of ka){const f=si(c,e.markDef,e.config);t.encode.update[c]?(s[c]=t.encode.update[c],delete t.encode.update[c]):f&&(s[c]=Q(f)),f&&(t.encode.update[c]={value:0})}const a=e.fieldDef(e.stack.groupbyChannel),u=w(a)?[w(a)]:[];return((a==null?void 0:a.bin)||(a==null?void 0:a.timeUnit))&&u.push(w(a,{binSuffix:"end"})),s=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((c,f)=>{if(t.encode.update[f])return Object.assign(Object.assign({},c),{[f]:t.encode.update[f]});{const d=si(f,e.markDef,e.config);return d!==void 0?Object.assign(Object.assign({},c),{[f]:Q(d)}):c}},s),s.stroke&&(s.strokeForeground={value:!0},s.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(q.Main),name:Lf+e.requestDataName(q.Main),groupby:u,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:s},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}function yC(e){const{encoding:t,stack:n,mark:i,markDef:r,config:s}=e,o=t.order;if(!(!j(o)&&ut(o)&&Da(o.value)||!o&&Da(M("order",r,s)))){if((j(o)||C(o))&&!n)return Cp(o,{expr:"datum"});if(Nn(i)){const a=r.orient==="horizontal"?"y":"x",u=t[a];if(C(u)){const l=u.sort;if(j(l))return{field:w(u,{prefix:a,suffix:"sort_index",expr:"datum"})};if(At(l))return{field:w({aggregate:ul(e.encoding)?l.op:void 0,field:l.field},{expr:"datum"})};if(fp(l)){const c=e.fieldDef(l.encoding);return{field:w(c,{expr:"datum"}),order:l.order}}else return l===null?void 0:{field:w(u,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}return}}}function Ul(e,t={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:s}=e,o=se(i.clip,vC(e),OC(e)),a=wp(i),u=r.key,l=yC(e),c=EC(e),f=M("aria",i,s),d=fs[n].postEncodingTransform?fs[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:fs[n].vgMark},o?{clip:!0}:{}),a?{style:a}:{}),u?{key:u.field}:{}),l?{sort:l}:{}),c||{}),f===!1?{aria:f}:{}),{from:{data:t.fromPrefix+e.requestDataName(q.Main)},encode:{update:fs[n].encodeEntry(e)}}),d?{transform:d}:{})]}function vC(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t&&t.get("selectionExtent")||n&&n.get("selectionExtent")?!0:void 0}function OC(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function EC(e){if(!e.component.selection)return null;const t=y(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=y(i.component.selection).length,i=i.parent;return n?{interactive:t>0||!!e.encoding.tooltip}:null}class hh extends ch{constructor(t,n,i,r={},s){super(t,"unit",n,i,s,void 0,qc(t)?t.view:void 0);this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const o=en(t.mark)?Object.assign({},t.mark):{type:t.mark},a=o.type;o.filled===void 0&&(o.filled=YS(o,s,{graticule:t.data&&vl(t.data)}));const u=this.encoding=IO(t.encoding||{},a,o.filled,s);this.markDef=qS(o,u,s),this.size=HS({encoding:u,size:qc(t)?Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):r}),this.stack=Jp(a,u),this.specifiedScales=this.initScales(a,u),this.specifiedAxes=this.initAxes(u),this.specifiedLegends=this.initLegends(u),this.specifiedProjection=t.projection,this.selection=t.selection}get hasProjection(){const{encoding:t}=this,n=this.mark===Zd,i=t&&qb.some(r=>k(t[r]));return n||i}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return ao.reduce((i,r)=>{var s;const o=le(n[r]);return o&&(i[r]=this.initScale((s=o.scale)!==null&&s!==void 0?s:{})),i},{})}initScale(t){const{domain:n,range:i}=t,r=it(t);return j(n)&&(r.domain=n.map(Ce)),j(i)&&(r.range=i.map(Ce)),r}initAxes(t){return Xe.reduce((n,i)=>{const r=t[i];if(k(r)||i===Z&&k(t.x2)||i===ce&&k(t.y2)){const s=k(r)?r.axis:void 0;n[i]=s&&this.initAxis(Object.assign({},s))}return n},{})}initAxis(t){const n=y(t),i={};for(const r of n){const s=t[r];i[r]=Br(s)?Ap(s):Ce(s)}return i}initLegends(t){return ty.reduce((n,i)=>{const r=le(t[i]);if(r&&iy(i)){const s=r.legend;n[i]=s&&it(s)}return n},{})}parseData(){this.component.data=Ho(this)}parseLayoutSize(){FS(this)}parseSelections(){this.component.selection=fA(this,this.selection)}parseMarkGroup(){this.component.mark=hC(this)}parseAxesAndHeaders(){this.component.axes=RS(this)}assembleSelectionTopLevelSignals(t){return WE(this,t)}assembleSignals(){return[...Tg(this),...ME(this,[])]}assembleSelectionData(t){return GE(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return jl(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return(!this.parent||!er(this.parent))&&(n=vg(this,n)),n.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return Kn(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return Ft(n)}typedFieldDef(t){const n=this.fieldDef(t);return Je(n)?n:null}}class Wl extends Ll{constructor(t,n,i,r,s){super(t,"layer",n,i,s,t.resolve,t.view);const o=Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((a,u)=>{if(Co(a))return new Wl(a,this,this.getName("layer_"+u),o,s);if(on(a))return new hh(a,this,this.getName("layer_"+u),o,s);throw new Error(ju(a))})}parseData(){this.component.data=Ho(this);for(const t of this.children)t.parseData()}parseLayoutSize(){SS(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of y(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){BS(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),Tg(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),jl(this))}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t}assembleLayout(){return null}assembleMarks(){return HE(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),Yg(this))}}function Gl(e,t,n,i,r){if(bo(e))return new xr(e,t,n,r);if(Co(e))return new Wl(e,t,n,i,r);if(on(e))return new hh(e,t,n,i,r);if(a1(e))return new TS(e,t,n,r);throw new Error(ju(e))}var xC=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function AC(e,t={}){t.logger&&rv(t.logger),t.fieldTitle&&vp(t.fieldTitle);try{const n=Yp(qs(t.config,e.config)),i=eg(e,n),r=Gl(i,null,"",void 0,n);return r.parse(),Pw(r.component.data,r),{spec:SC(r,wC(e,i.autosize,n,r),e.datasets,e.usermeta),normalized:i}}finally{t.logger&&sv(),t.fieldTitle&&FO()}}function wC(e,t,n,i){const r=i.component.layoutSize.get("width"),s=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):P(t)&&(t={type:t}),r&&s&&H1(t.type)){if(r==="step"&&s==="step")O($c()),t.type="pad";else if(r==="step"||s==="step"){const o=r==="step"?"width":"height";O($c(oo(o)));const a=o==="width"?"height":"width";t.type=q1(a)}}return Object.assign(Object.assign(Object.assign({},y(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),sf(n,!1)),sf(e,!0))}function SC(e,t,n={},i){const r=e.config?x1(e.config):void 0,s=[].concat(e.assembleSelectionData([]),ES(e.component.data,n)),o=e.assembleProjections(),a=e.assembleTitle(),u=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();c=c.filter(p=>(p.name==="width"||p.name==="height")&&p.value!==void 0?(t[p.name]=+p.value,!1):!0);const{params:f}=t,d=xC(t,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),d),a?{title:a}:{}),u?{style:u}:{}),l?{encode:{update:l}}:{}),{data:s}),o.length>0?{projections:o}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([]),...Vp(f)])),r?{config:r}:{}),i?{usermeta:i}:{})}var CC=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",normalize:eg,version:Cb,compile:AC,deepEqual:Xi,duplicate:I,pick:Ni,omit:We,stringify:V,hash:R,isNullOrFalse:Da,contains:D,some:Ti,every:Ou,mergeDeep:pd,unique:Et,isEqual:jb,setEqual:gd,hasIntersection:Eu,prefixGenerator:Na,fieldIntersection:xu,isEmpty:G,keys:y,vals:qt,entries:Rr,isBoolean:Sr,varName:Y,logicalExpr:_i,deleteNestedProperty:Fs,titleCase:Lr,accessPathWithDatum:Au,flatAccessWithDatum:hd,replacePathInField:Qt,replaceAll:ti,removePathFromField:wu,accessPathDepth:ki,getFirstDefined:se,uniqueId:bd,resetIdCounter:Nb,internalField:yd,isInternalField:vd,normalizeAngle:Cr,isNumeric:eo});function mh(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}var FC="vega-themes",_C="2.10.0",$C="Themes for stylized Vega and Vega-Lite visualizations.",jC=["vega","vega-lite","themes","style"],DC="BSD-3-Clause",NC={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},TC=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],kC="build/vega-themes.js",PC="build/vega-themes.module.js",IC="build/vega-themes.min.js",RC="build/vega-themes.min.js",LC="build/vega-themes.module.d.ts",BC={type:"git",url:"https://github.com/vega/vega-themes.git"},zC=["src","build"],MC={prebuild:"yarn clean",build:"rollup -c",clean:"rimraf build && rimraf examples/build","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",prepare:"beemo create-config",eslintbase:"beemo eslint .",format:"yarn eslintbase --fix",lint:"yarn eslintbase"},UC={"@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^11.2.0","@wessberg/rollup-plugin-ts":"^1.3.8","browser-sync":"^2.26.14",concurrently:"^6.0.0","gh-pages":"^3.1.0",rollup:"^2.39.1","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-terser":"^7.0.2",typescript:"^4.2.2",vega:"^5.19.1","vega-lite":"^5.0.0","vega-lite-dev-config":"^0.16.1"},WC={vega:"*","vega-lite":"*"},GC={name:FC,version:_C,description:$C,keywords:jC,license:DC,author:NC,contributors:TC,main:kC,module:PC,unpkg:IC,jsdelivr:RC,types:LC,repository:BC,files:zC,scripts:MC,devDependencies:UC,peerDependencies:WC};const wi="#fff",HC="#888",qC={background:"#333",title:{color:wi,subtitleColor:wi},style:{"guide-label":{fill:wi},"guide-title":{fill:wi}},axis:{domainColor:wi,gridColor:HC,tickColor:wi}},Ln="#4572a7",VC={background:"#fff",arc:{fill:Ln},area:{fill:Ln},line:{stroke:Ln,strokeWidth:2},path:{stroke:Ln},rect:{fill:Ln},shape:{stroke:Ln},symbol:{fill:Ln,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},Bn="#30a2da",ya="#cbcbcb",XC="#999",YC="#333",Bf="#f0f0f0",zf="#333",JC={arc:{fill:Bn},area:{fill:Bn},axis:{domainColor:ya,grid:!0,gridColor:ya,gridWidth:1,labelColor:XC,labelFontSize:10,titleColor:YC,tickColor:ya,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:Bf,group:{fill:Bf},legend:{labelColor:zf,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:zf,titleFontSize:14,titlePadding:10},line:{stroke:Bn,strokeWidth:2},path:{stroke:Bn,strokeWidth:.5},rect:{fill:Bn},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:Bn},bar:{binSpacing:2,fill:Bn,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},zn="#000",KC={group:{fill:"#e5e5e5"},arc:{fill:zn},area:{fill:zn},line:{stroke:zn},path:{stroke:zn},rect:{fill:zn},shape:{stroke:zn},symbol:{fill:zn,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},QC=22,ZC="normal",Mf="Benton Gothic, sans-serif",Uf=11.5,eF="normal",Mn="#82c6df",va="Benton Gothic Bold, sans-serif",Wf="normal",Gf=13,fr={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},tF={background:"#ffffff",title:{anchor:"start",color:"#000000",font:va,fontSize:QC,fontWeight:ZC},arc:{fill:Mn},area:{fill:Mn},line:{stroke:Mn,strokeWidth:2},path:{stroke:Mn},rect:{fill:Mn},shape:{stroke:Mn},symbol:{fill:Mn,size:30},axis:{labelFont:Mf,labelFontSize:Uf,labelFontWeight:eF,titleFont:va,titleFontSize:Gf,titleFontWeight:Wf},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:Mf,labelFontSize:Uf,symbolType:"square",titleFont:va,titleFontSize:Gf,titleFontWeight:Wf},range:{category:fr["category-6"],diverging:fr["fireandice-6"],heatmap:fr["fire-7"],ordinal:fr["fire-7"],ramp:fr["fire-7"]}},Un="#ab5787",ds="#979797",nF={background:"#f9f9f9",arc:{fill:Un},area:{fill:Un},line:{stroke:Un},path:{stroke:Un},rect:{fill:Un},shape:{stroke:Un},symbol:{fill:Un,size:30},axis:{domainColor:ds,domainWidth:.5,gridWidth:.2,labelColor:ds,tickColor:ds,tickWidth:.2,titleColor:ds},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},Wn="#3e5c69",iF={background:"#fff",arc:{fill:Wn},area:{fill:Wn},line:{stroke:Wn},path:{stroke:Wn},rect:{fill:Wn},shape:{stroke:Wn},symbol:{fill:Wn},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},He="#1696d2",Hf="#000000",rF="#FFFFFF",ps="Lato",Oa="Lato",sF="Lato",oF="#DEDDDD",aF=18,dr={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},uF={background:rF,title:{anchor:"start",fontSize:aF,font:ps},axisX:{domain:!0,domainColor:Hf,domainWidth:1,grid:!1,labelFontSize:12,labelFont:Oa,labelAngle:0,tickColor:Hf,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:ps},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:oF,gridWidth:1,labelFontSize:12,labelFont:Oa,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:ps,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:Oa,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:ps,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:dr["six-groups-cat-1"],diverging:dr["diverging-colors"],heatmap:dr["diverging-colors"],ordinal:dr["six-groups-seq"],ramp:dr["shades-blue"]},area:{fill:He},rect:{fill:He},line:{color:He,stroke:He,strokeWidth:5},trail:{color:He,stroke:He,strokeWidth:0,size:1},path:{stroke:He,strokeWidth:.5},point:{filled:!0},text:{font:sF,color:He,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:He,stroke:null}},arc:{fill:He},shape:{stroke:He},symbol:{fill:He,size:30}},Gn="#3366CC",qf="#ccc",gs="Arial, sans-serif",lF={arc:{fill:Gn},area:{fill:Gn},path:{stroke:Gn},rect:{fill:Gn},shape:{stroke:Gn},symbol:{stroke:Gn},circle:{fill:Gn},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:gs,fontSize:12},"guide-title":{font:gs,fontSize:12},"group-title":{font:gs,fontSize:12}},title:{font:gs,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:qf,tickColor:qf,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},cF=GC.version;var fF=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",dark:qC,excel:VC,fivethirtyeight:JC,ggplot2:KC,googlecharts:lF,latimes:tF,quartz:nF,urbaninstitute:uF,version:cF,vox:iF}),dF=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element img {
    max-width: 200px;
    max-height: 200px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;const bh="vg-tooltip-element",pF={offsetX:10,offsetY:10,id:bh,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:gF,maxDepth:2};function gF(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function hF(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return dF.toString().replace(bh,e)}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function mF(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function bF(e,t,n){if(j(e))return`[${e.map(i=>t(P(i)?i:Vf(i,n))).join(", ")}]`;if(ue(e)){let i="";const r=e,{title:s,image:o}=r,a=mF(r,["title","image"]);s&&(i+=`<h2>${t(s)}</h2>`),o&&(i+=`<img src="${t(o)}">`);const u=Object.keys(a);if(u.length>0){i+="<table>";for(const l of u){let c=a[l];c!==void 0&&(ue(c)&&(c=Vf(c,n)),i+=`<tr><td class="key">${t(l)}:</td><td class="value">${t(c)}</td></tr>`)}i+="</table>"}return i||"{}"}return t(e)}function yF(e){const t=[];return function(n,i){if(typeof i!="object"||i===null)return i;const r=t.indexOf(this)+1;return t.length=r,t.length>e?"[Object]":t.indexOf(i)>=0?"[Circular]":(t.push(i),i)}}function Vf(e,t){return JSON.stringify(e,yF(t))}function vF(e,t,n,i){let r=e.clientX+n;r+t.width>window.innerWidth&&(r=+e.clientX-n-t.width);let s=e.clientY+i;return s+t.height>window.innerHeight&&(s=+e.clientY-i-t.height),{x:r,y:s}}class OF{constructor(t){this.options=Object.assign(Object.assign({},pF),t);const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const i=document.createElement("style");i.setAttribute("id",this.options.styleId),i.innerHTML=hF(n);const r=document.head;r.childNodes.length>0?r.insertBefore(i,r.childNodes[0]):r.appendChild(i)}}tooltipHandler(t,n,i,r){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(document.fullscreenElement!=null?document.fullscreenElement:document.body).appendChild(this.el),r==null||r===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=bF(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:o,y:a}=vF(n,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${o}px`)}}function EF(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xf(e,t,n,i,r,s,o){try{var a=e[s](o),u=a.value}catch(l){n(l);return}a.done?t(u):Promise.resolve(u).then(i,r)}function Ws(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){var s=e.apply(t,n);function o(u){Xf(s,i,r,o,a,"next",u)}function a(u){Xf(s,i,r,o,a,"throw",u)}o(void 0)})}}var yh=Object.prototype,Xn=yh.hasOwnProperty,Ot,Hl=typeof Symbol=="function"?Symbol:{},qo=Hl.iterator||"@@iterator",xF=Hl.asyncIterator||"@@asyncIterator",Gs=Hl.toStringTag||"@@toStringTag";function vh(e,t,n,i){var r=t&&t.prototype instanceof iu?t:iu,s=Object.create(r.prototype),o=new ru(i||[]);return s._invoke=FF(e,n,o),s}function ql(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(i){return{type:"throw",arg:i}}}var Yf="suspendedStart",AF="suspendedYield",Jf="executing",hs="completed",rt={};function iu(){}function Vo(){}function Wi(){}var Vl={};Vl[qo]=function(){return this};var Ea=Object.getPrototypeOf,ms=Ea&&Ea(Ea(Xl([])));ms&&ms!==yh&&Xn.call(ms,qo)&&(Vl=ms);var tr=Wi.prototype=iu.prototype=Object.create(Vl);Vo.prototype=tr.constructor=Wi;Wi.constructor=Vo;Wi[Gs]=Vo.displayName="GeneratorFunction";function Oh(e){["next","throw","return"].forEach(function(t){e[t]=function(n){return this._invoke(t,n)}})}function Eh(e){var t=typeof e=="function"&&e.constructor;return t?t===Vo||(t.displayName||t.name)==="GeneratorFunction":!1}function wF(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,Wi):(e.__proto__=Wi,Gs in e||(e[Gs]="GeneratorFunction")),e.prototype=Object.create(tr),e}function SF(e){return{__await:e}}function Xo(e,t){function n(s,o,a,u){var l=ql(e[s],e,o);if(l.type==="throw")u(l.arg);else{var c=l.arg,f=c.value;return f&&typeof f=="object"&&Xn.call(f,"__await")?t.resolve(f.__await).then(function(d){n("next",d,a,u)},function(d){n("throw",d,a,u)}):t.resolve(f).then(function(d){c.value=d,a(c)},function(d){return n("throw",d,a,u)})}}var i;function r(s,o){function a(){return new t(function(u,l){n(s,o,u,l)})}return i=i?i.then(a,a):a()}this._invoke=r}Oh(Xo.prototype);Xo.prototype[xF]=function(){return this};function CF(e,t,n,i,r){r===void 0&&(r=Promise);var s=new Xo(vh(e,t,n,i),r);return Eh(t)?s:s.next().then(function(o){return o.done?o.value:s.next()})}function FF(e,t,n){var i=Yf;return function(s,o){if(i===Jf)throw new Error("Generator is already running");if(i===hs){if(s==="throw")throw o;return Ah()}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=xh(a,n);if(u){if(u===rt)continue;return u}}if(n.method==="next")n.sent=n._sent=n.arg;else if(n.method==="throw"){if(i===Yf)throw i=hs,n.arg;n.dispatchException(n.arg)}else n.method==="return"&&n.abrupt("return",n.arg);i=Jf;var l=ql(e,t,n);if(l.type==="normal"){if(i=n.done?hs:AF,l.arg===rt)continue;return{value:l.arg,done:n.done}}else l.type==="throw"&&(i=hs,n.method="throw",n.arg=l.arg)}}}function xh(e,t){var n=e.iterator[t.method];if(n===Ot){if(t.delegate=null,t.method==="throw"){if(e.iterator.return&&(t.method="return",t.arg=Ot,xh(e,t),t.method==="throw"))return rt;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return rt}var i=ql(n,e.iterator,t.arg);if(i.type==="throw")return t.method="throw",t.arg=i.arg,t.delegate=null,rt;var r=i.arg;if(!r)return t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,rt;if(r.done)t[e.resultName]=r.value,t.next=e.nextLoc,t.method!=="return"&&(t.method="next",t.arg=Ot);else return r;return t.delegate=null,rt}Oh(tr);tr[Gs]="Generator";tr[qo]=function(){return this};tr.toString=function(){return"[object Generator]"};function _F(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function xa(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function ru(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_F,this),this.reset(!0)}function $F(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function i(){for(;t.length;){var r=t.pop();if(r in e)return i.value=r,i.done=!1,i}return i.done=!0,i}}function Xl(e){if(e){var t=e[qo];if(t)return t.call(e);if(typeof e.next=="function")return e;if(!isNaN(e.length)){var n=-1,i=function r(){for(;++n<e.length;)if(Xn.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=Ot,r.done=!0,r};return i.next=i}}return{next:Ah}}function Ah(){return{value:Ot,done:!0}}ru.prototype={constructor:ru,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=Ot,this.done=!1,this.delegate=null,this.method="next",this.arg=Ot,this.tryEntries.forEach(xa),!t)for(var n in this)n.charAt(0)==="t"&&Xn.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=Ot)},stop:function(){this.done=!0;var t=this.tryEntries[0],n=t.completion;if(n.type==="throw")throw n.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(l,c){return o.type="throw",o.arg=t,n.next=l,c&&(n.method="next",n.arg=Ot),!!c}for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r],o=s.completion;if(s.tryLoc==="root")return i("end");if(s.tryLoc<=this.prev){var a=Xn.call(s,"catchLoc"),u=Xn.call(s,"finallyLoc");if(a&&u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(a){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else if(u){if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,n){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&Xn.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&(t==="break"||t==="continue")&&s.tryLoc<=n&&n<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=n,s?(this.method="next",this.next=s.finallyLoc,rt):this.complete(o)},complete:function(t,n){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&n&&(this.next=n),rt},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),xa(i),rt}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc===t){var r=i.completion;if(r.type==="throw"){var s=r.arg;xa(i)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:Xl(t),resultName:n,nextLoc:i},this.method==="next"&&(this.arg=Ot),rt}};var mn={wrap:vh,isGeneratorFunction:Eh,AsyncIterator:Xo,mark:wF,awrap:SF,async:CF,keys:$F,values:Xl};function jF(e,t,n){var i=e.open(t),r=1e4,s=250,o=new URL(t),a=o.origin,u=~~(r/s);function l(f){f.source===i&&(u=0,e.removeEventListener("message",l,!1))}e.addEventListener("message",l,!1);function c(){u<=0||(i.postMessage(n,a),setTimeout(c,s),u-=1)}setTimeout(c,s)}var DF=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box; }
  .vega-embed.has-actions {
    padding-right: 38px; }
  .vega-embed details:not([open]) > :not(summary) {
    display: none !important; }
  .vega-embed summary {
    list-style: none;
    position: absolute;
    top: 0;
    right: 0;
    padding: 6px;
    z-index: 1000;
    background: white;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    color: #1b1e23;
    border: 1px solid #aaa;
    border-radius: 999px;
    opacity: 0.2;
    transition: opacity 0.4s ease-in;
    outline: none;
    cursor: pointer;
    line-height: 0px; }
    .vega-embed summary::-webkit-details-marker {
      display: none; }
    .vega-embed summary:active {
      box-shadow: #aaa 0px 0px 0px 1px inset; }
    .vega-embed summary svg {
      width: 14px;
      height: 14px; }
  .vega-embed details[open] summary {
    opacity: 0.7; }
  .vega-embed:hover summary,
  .vega-embed:focus summary {
    opacity: 1 !important;
    transition: opacity 0.2s ease; }
  .vega-embed .vega-actions {
    position: absolute;
    z-index: 1001;
    top: 35px;
    right: -9px;
    display: flex;
    flex-direction: column;
    padding-bottom: 8px;
    padding-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
    border: 1px solid #d9d9d9;
    background: white;
    animation-duration: 0.15s;
    animation-name: scale-in;
    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
    text-align: left; }
    .vega-embed .vega-actions a {
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      color: #434a56;
      text-decoration: none; }
      .vega-embed .vega-actions a:hover {
        background-color: #f7f7f9;
        color: black; }
    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
      content: "";
      display: inline-block;
      position: absolute; }
    .vega-embed .vega-actions::before {
      left: auto;
      right: 14px;
      top: -16px;
      border: 8px solid #0000;
      border-bottom-color: #d9d9d9; }
    .vega-embed .vega-actions::after {
      left: auto;
      right: 15px;
      top: -14px;
      border: 7px solid #0000;
      border-bottom-color: #fff; }
  .vega-embed .chart-wrapper.fit-x {
    width: 100%; }
  .vega-embed .chart-wrapper.fit-y {
    height: 100%; }

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px; }

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6); }
  to {
    opacity: 1;
    transform: scale(1); } }
`;String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});function wh(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,s=n;r<s.length;r++){var o=s[r];NF(e,o)}return e}function NF(e,t){for(var n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];nd(e,r,t[r],!0)}}var Aa;function Kf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function bn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Kf(Object(n),!0).forEach(function(i){EF(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kf(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var hn=Dh,Ir=CC,bs=typeof window!="undefined"?window:void 0;Ir===void 0&&bs!==null&&bs!==void 0&&(Aa=bs.vl)!==null&&Aa!==void 0&&Aa.compile&&(Ir=bs.vl);var TF={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},kF={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},mr={vega:"Vega","vega-lite":"Vega-Lite"},Hs={vega:hn.version,"vega-lite":Ir?Ir.version:"not available"},PF={vega:e=>e,"vega-lite":(e,t)=>Ir.compile(e,{config:t}).spec},IF=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,RF="chart-wrapper";function LF(e){return typeof e=="function"}function Qf(e,t,n,i){var r="<html><head>".concat(t,'</head><body><pre><code class="json">'),s="</code></pre>".concat(n,"</body></html>"),o=window.open("");o.document.write(r+e+s),o.document.title="".concat(mr[i]," JSON Source")}function BF(e,t){if(e.$schema){var n=mh(e.$schema);if(t&&t!==n.library){var i;console.warn("The given visualization spec is written in ".concat(mr[n.library],", but mode argument sets ").concat((i=mr[t])!==null&&i!==void 0?i:t,"."))}var r=n.library;return fd.satisfies(Hs[r],"^".concat(n.version.slice(1)))||console.warn("The input spec uses ".concat(mr[r]," ").concat(n.version,", but the current version of ").concat(mr[r]," is v").concat(Hs[r],".")),r}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t!=null?t:"vega"}function zF(e){return!!(e&&"load"in e)}function Zf(e){return zF(e)?e:hn.loader(e)}function ed(e){var t;return(t=e.usermeta&&e.usermeta.embedOptions)!==null&&t!==void 0?t:{}}function qF(e,t){return su.apply(this,arguments)}function su(){return su=Ws(mn.mark(function e(t,n){var i,r,s,o,a,u,l,c,f,d,p=arguments;return mn.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(s=p.length>2&&p[2]!==void 0?p[2]:{},!P(n)){m.next=10;break}return a=Zf(s.loader),m.t0=JSON,m.next=6,a.load(n);case 6:m.t1=m.sent,o=m.t0.parse.call(m.t0,m.t1),m.next=11;break;case 10:o=n;case 11:return u=ed(o).loader,(!a||u)&&(a=Zf((l=s.loader)!==null&&l!==void 0?l:u)),m.next=15,td(ed(o),a);case 15:return c=m.sent,m.next=18,td(s,a);case 18:return f=m.sent,d=bn(bn({},wh(f,c)),{},{config:qs((i=f.config)!==null&&i!==void 0?i:{},(r=c.config)!==null&&r!==void 0?r:{})}),m.next=22,UF(t,o,d,a);case 22:return m.abrupt("return",m.sent);case 23:case"end":return m.stop()}},e)})),su.apply(this,arguments)}function td(e,t){return ou.apply(this,arguments)}function ou(){return ou=Ws(mn.mark(function e(t,n){var i,r,s;return mn.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!P(t.config)){a.next=8;break}return a.t1=JSON,a.next=4,n.load(t.config);case 4:a.t2=a.sent,a.t0=a.t1.parse.call(a.t1,a.t2),a.next=9;break;case 8:a.t0=(i=t.config)!==null&&i!==void 0?i:{};case 9:if(r=a.t0,!P(t.patch)){a.next=18;break}return a.t4=JSON,a.next=14,n.load(t.patch);case 14:a.t5=a.sent,a.t3=a.t4.parse.call(a.t4,a.t5),a.next=19;break;case 18:a.t3=t.patch;case 19:return s=a.t3,a.abrupt("return",bn(bn(bn({},t),s?{patch:s}:{}),r?{config:r}:{}));case 21:case"end":return a.stop()}},e)})),ou.apply(this,arguments)}function MF(e){var t=e.getRootNode?e.getRootNode():document;if(t instanceof ShadowRoot)return{root:t,rootContainer:t};var n;return{root:document,rootContainer:(n=document.head)!==null&&n!==void 0?n:document.body}}function UF(e,t){return au.apply(this,arguments)}function au(){return au=Ws(mn.mark(function e(t,n){var i,r,s,o,a,u,l,c,f,d,p,g,m,h,x,v,S,F,E,$,A,N,U,K,Ae,Re,Qe,ee,Le,ge,he,Be,Ze,Bt,yi,ht,vi,mt,Pn,Oi,Ei,In,un,nr,ir,ln,rr,bt=arguments;return mn.wrap(function(cn){for(;;)switch(cn.prev=cn.next){case 0:if(rr=function(){Bt&&document.removeEventListener("click",Bt),ee.finalize()},u=bt.length>2&&bt[2]!==void 0?bt[2]:{},l=bt.length>3?bt[3]:void 0,c=u.theme?qs(fF[u.theme],(i=u.config)!==null&&i!==void 0?i:{}):u.config,f=Hi(u.actions)?u.actions:wh({},TF,(r=u.actions)!==null&&r!==void 0?r:{}),d=bn(bn({},kF),u.i18n),p=(s=u.renderer)!==null&&s!==void 0?s:"canvas",g=(o=u.logLevel)!==null&&o!==void 0?o:hn.Warn,m=(a=u.downloadFileName)!==null&&a!==void 0?a:"visualization",h=typeof t=="string"?document.querySelector(t):t,h){cn.next=12;break}throw new Error("".concat(t," does not exist"));case 12:return u.defaultStyle!==!1&&(x="vega-embed-style",v=MF(h),S=v.root,F=v.rootContainer,S.getElementById(x)||(E=document.createElement("style"),E.id=x,E.innerText=u.defaultStyle===void 0||u.defaultStyle===!0?DF.toString():u.defaultStyle,F.appendChild(E))),$=BF(n,u.mode),A=PF[$](n,c),$==="vega-lite"&&A.$schema&&(N=mh(A.$schema),fd.satisfies(Hs.vega,"^".concat(N.version.slice(1)))||console.warn("The compiled spec uses Vega ".concat(N.version,", but current version is v").concat(Hs.vega,"."))),h.classList.add("vega-embed"),f&&h.classList.add("has-actions"),h.innerHTML="",U=h,f&&(K=document.createElement("div"),K.classList.add(RF),h.appendChild(K),U=K),Ae=u.patch,Ae&&(Ae instanceof Function?A=Ae(A):A=Vs(A,Ae,!0,!1).newDocument),u.formatLocale&&hn.formatLocale(u.formatLocale),u.timeFormatLocale&&hn.timeFormatLocale(u.timeFormatLocale),Re=u.ast,Qe=hn.parse(A,$==="vega-lite"?{}:c,{ast:Re}),ee=new(u.viewClass||hn.View)(Qe,bn({loader:l,logLevel:g,renderer:p},Re?{expr:hn.expressionInterpreter}:{})),ee.addSignalListener("autosize",(yt,De)=>{var ze=De.type;ze=="fit-x"?(U.classList.add("fit-x"),U.classList.remove("fit-y")):ze=="fit-y"?(U.classList.remove("fit-x"),U.classList.add("fit-y")):ze=="fit"?U.classList.add("fit-x","fit-y"):U.classList.remove("fit-x","fit-y")}),u.tooltip!==!1&&(LF(u.tooltip)?Le=u.tooltip:Le=new OF(u.tooltip===!0?{}:u.tooltip).call,ee.tooltip(Le)),ge=u.hover,ge===void 0&&(ge=$==="vega"),ge&&(he=typeof ge=="boolean"?{}:ge,Be=he.hoverSet,Ze=he.updateSet,ee.hover(Be,Ze)),u&&(u.width!=null&&ee.width(u.width),u.height!=null&&ee.height(u.height),u.padding!=null&&ee.padding(u.padding)),cn.next=36,ee.initialize(U,u.bind).runAsync();case 36:if(f!==!1){if(yi=h,u.defaultStyle!==!1&&(ht=document.createElement("details"),ht.title=d.CLICK_TO_VIEW_ACTIONS,h.append(ht),yi=ht,vi=document.createElement("summary"),vi.innerHTML=IF,ht.append(vi),Bt=yt=>{ht.contains(yt.target)||ht.removeAttribute("open")},document.addEventListener("click",Bt)),mt=document.createElement("div"),yi.append(mt),mt.classList.add("vega-actions"),f===!0||f.export!==!1)for(Pn=function(){var De=Ei[Oi];if(f===!0||f.export===!0||f.export[De]){var ze=d["".concat(De.toUpperCase(),"_ACTION")],xi=document.createElement("a");xi.text=ze,xi.href="#",xi.target="_blank",xi.download="".concat(m,".").concat(De),xi.addEventListener("mousedown",function(){var Sh=Ws(mn.mark(function Yl(Ch){var Jl;return mn.wrap(function(sr){for(;;)switch(sr.prev=sr.next){case 0:return Ch.preventDefault(),sr.next=3,ee.toImageURL(De,u.scaleFactor);case 3:Jl=sr.sent,this.href=Jl;case 5:case"end":return sr.stop()}},Yl,this)}));return function(Yl){return Sh.apply(this,arguments)}}()),mt.append(xi)}},Oi=0,Ei=["svg","png"];Oi<Ei.length;Oi++)Pn();(f===!0||f.source!==!1)&&(In=document.createElement("a"),In.text=d.SOURCE_ACTION,In.href="#",In.addEventListener("click",function(yt){var De,ze;Qf(Jo(n),(De=u.sourceHeader)!==null&&De!==void 0?De:"",(ze=u.sourceFooter)!==null&&ze!==void 0?ze:"",$),yt.preventDefault()}),mt.append(In)),$==="vega-lite"&&(f===!0||f.compiled!==!1)&&(un=document.createElement("a"),un.text=d.COMPILED_ACTION,un.href="#",un.addEventListener("click",function(yt){var De,ze;Qf(Jo(A),(De=u.sourceHeader)!==null&&De!==void 0?De:"",(ze=u.sourceFooter)!==null&&ze!==void 0?ze:"","vega"),yt.preventDefault()}),mt.append(un)),(f===!0||f.editor!==!1)&&(ir=(nr=u.editorUrl)!==null&&nr!==void 0?nr:"https://vega.github.io/editor/",ln=document.createElement("a"),ln.text=d.EDITOR_ACTION,ln.href="#",ln.addEventListener("click",function(yt){jF(window,ir,{config:c,mode:$,renderer:p,spec:Jo(n)}),yt.preventDefault()}),mt.append(ln))}return cn.abrupt("return",{view:ee,spec:n,vgSpec:A,finalize:rr});case 38:case"end":return cn.stop()}},e)})),au.apply(this,arguments)}export{TF as DEFAULT_ACTIONS,qF as default,BF as guessMode,hn as vega,Ir as vegaLite};
