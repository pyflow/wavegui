import{h as Ei,i as be,a as W,w as qf,s as zi,$ as Y,t as ui,b as ye,c as Mi,l as mh,W as bh,d as I,e as yh,f as ge,m as Bs,g as Ui,j as vh,v as Oh}from"./vega.module-8472b5ff.js";import"./index-fe0329c3.js";/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var Eh=globalThis&&globalThis.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var s in r)r.hasOwnProperty(s)&&(i[s]=r[s])},e(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}}(),xh=Object.prototype.hasOwnProperty;function ya(e,t){return xh.call(e,t)}function va(e){if(Array.isArray(e)){for(var n=new Array(e.length),t=0;t<n.length;t++)n[t]=""+t;return n}if(Object.keys)return Object.keys(e);var n=[];for(var i in e)ya(e,i)&&n.push(i);return n}function We(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Oa(e){for(var t=0,n=e.length,i;t<n;){if(i=e.charCodeAt(t),i>=48&&i<=57){t++;continue}return!1}return!0}function Wn(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Vf(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Ea(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Ea(e[t]))return!0}else if(typeof e=="object"){for(var i=va(e),r=i.length,t=0;t<r;t++)if(Ea(e[i[t]]))return!0}}return!1}function Hc(e,t){var n=[e];for(var i in t){var r=typeof t[i]=="object"?JSON.stringify(t[i],null,2):t[i];typeof r<"u"&&n.push(i+": "+r)}return n.join(`
`)}var Xf=function(e){Eh(t,e);function t(n,i,r,s,o){var a=this.constructor,u=e.call(this,Hc(n,{name:i,index:r,operation:s,tree:o}))||this;return u.name=i,u.index=r,u.operation=s,u.tree=o,Object.setPrototypeOf(u,a.prototype),u.message=Hc(n,{name:i,index:r,operation:s,tree:o}),u}return t}(Error),de=Xf,Ah=We,xi={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var i=e[t];return delete e[t],{newDocument:n,removed:i}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:function(e,t,n){var i=bs(n,this.path);i&&(i=We(i));var r=Vn(n,{op:"remove",path:this.from}).removed;return Vn(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(e,t,n){var i=bs(n,this.from);return Vn(n,{op:"add",path:this.path,value:We(i)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:br(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},wh={add:function(e,t,n){return Oa(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var i=e.splice(t,1);return{newDocument:n,removed:i[0]}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:xi.move,copy:xi.copy,test:xi.test,_get:xi._get};function bs(e,t){if(t=="")return e;var n={op:"_get",path:t};return Vn(e,n),n.value}function Vn(e,t,n,i,r,s){if(n===void 0&&(n=!1),i===void 0&&(i=!0),r===void 0&&(r=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):ys(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=bs(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=br(e,t.value),o.test===!1)throw new de("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new de("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{i||(e=We(e));var a=t.path||"",u=a.split("/"),c=e,l=1,f=u.length,d=void 0,g=void 0,p=void 0;for(typeof n=="function"?p=n:p=ys;;){if(g=u[l],r&&g=="__proto__")throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(c[g]===void 0?d=u.slice(0,l).join("/"):l==f-1&&(d=t.path),d!==void 0&&p(t,0,e,d)),l++,Array.isArray(c)){if(g==="-")g=c.length;else{if(n&&!Oa(g))throw new de("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);Oa(g)&&(g=~~g)}if(l>=f){if(n&&t.op==="add"&&g>c.length)throw new de("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=wh[t.op].call(t,c,g,e);if(o.test===!1)throw new de("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(g&&g.indexOf("~")!=-1&&(g=Vf(g)),l>=f){var o=xi[t.op].call(t,c,g,e);if(o.test===!1)throw new de("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}c=c[g]}}}function zs(e,t,n,i,r){if(i===void 0&&(i=!0),r===void 0&&(r=!0),n&&!Array.isArray(t))throw new de("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=We(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=Vn(e,t[o],n,!0,r,o),e=s[o].newDocument;return s.newDocument=e,s}function Sh(e,t,n){var i=Vn(e,t);if(i.test===!1)throw new de("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument}function ys(e,t,n,i){if(typeof e!="object"||e===null||Array.isArray(e))throw new de("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(xi[e.op]){if(typeof e.path!="string")throw new de("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new de('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new de("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new de("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Ea(e.value))throw new de("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var r=e.path.split("/").length,s=i.split("/").length;if(r!==s+1&&r!==s)throw new de("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==i)throw new de("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=Yf([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new de("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new de("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function Yf(e,t,n){try{if(!Array.isArray(e))throw new de("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)zs(We(t),We(e),n||!0);else{n=n||ys;for(var i=0;i<e.length;i++)n(e[i],i,t,void 0)}}catch(r){if(r instanceof de)return r;throw r}}function br(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),i=Array.isArray(t),r,s,o;if(n&&i){if(s=e.length,s!=t.length)return!1;for(r=s;r--!==0;)if(!br(e[r],t[r]))return!1;return!0}if(n!=i)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(r=s;r--!==0;)if(!t.hasOwnProperty(a[r]))return!1;for(r=s;r--!==0;)if(o=a[r],!br(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}const Ch=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:de,_areEquals:br,applyOperation:Vn,applyPatch:zs,applyReducer:Sh,deepClone:Ah,getValueByPointer:bs,validate:Yf,validator:ys},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var nu=new WeakMap,_h=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),Fh=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function jh(e){return nu.get(e)}function $h(e,t){return e.observers.get(t)}function Dh(e,t){e.observers.delete(t.callback)}function Th(e,t){t.unobserve()}function Nh(e,t){var n=[],i,r=jh(e);if(!r)r=new _h(e),nu.set(e,r);else{var s=$h(r,t);i=s&&s.observer}if(i)return i;if(i={},r.value=We(e),t){i.callback=t,i.next=null;var o=function(){xa(i)},a=function(){clearTimeout(i.next),i.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return i.patches=n,i.object=e,i.unobserve=function(){xa(i),clearTimeout(i.next),Dh(r,i),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},r.observers.set(t,new Fh(t,i)),i}function xa(e,t){t===void 0&&(t=!1);var n=nu.get(e.object);iu(n.value,e.object,e.patches,"",t),e.patches.length&&zs(n.value,e.patches);var i=e.patches;return i.length>0&&(e.patches=[],e.callback&&e.callback(i)),i}function iu(e,t,n,i,r){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=va(t),o=va(e),a=!1,u=o.length-1;u>=0;u--){var c=o[u],l=e[c];if(ya(t,c)&&!(t[c]===void 0&&l!==void 0&&Array.isArray(t)===!1)){var f=t[c];typeof l=="object"&&l!=null&&typeof f=="object"&&f!=null?iu(l,f,n,i+"/"+Wn(c),r):l!==f&&(r&&n.push({op:"test",path:i+"/"+Wn(c),value:We(l)}),n.push({op:"replace",path:i+"/"+Wn(c),value:We(f)}))}else Array.isArray(e)===Array.isArray(t)?(r&&n.push({op:"test",path:i+"/"+Wn(c),value:We(l)}),n.push({op:"remove",path:i+"/"+Wn(c)}),a=!0):(r&&n.push({op:"test",path:i,value:e}),n.push({op:"replace",path:i,value:t}))}if(!(!a&&s.length==o.length))for(var u=0;u<s.length;u++){var c=s[u];!ya(e,c)&&t[c]!==void 0&&n.push({op:"add",path:i+"/"+Wn(c),value:We(t[c])})}}}function kh(e,t,n){n===void 0&&(n=!1);var i=[];return iu(e,t,i,"",n),i}const Ph=Object.freeze(Object.defineProperty({__proto__:null,compare:kh,generate:xa,observe:Nh,unobserve:Th},Symbol.toStringTag,{value:"Module"}));Object.assign({},Ch,Ph,{JsonPatchError:Xf,deepClone:We,escapePathComponent:Wn,unescapePathComponent:Vf});var Ih=/("(?:[^\\"]|\\.)*")|[:,]/g,Wo=function(t,n){var i,r,s;return n=n||{},i=JSON.stringify([1],void 0,n.indent===void 0?2:n.indent).slice(2,-3),r=i===""?1/0:n.maxLength===void 0?80:n.maxLength,s=n.replacer,function o(a,u,c){var l,f,d,g,p,m,h,E,v,S,D,x;if(a&&typeof a.toJSON=="function"&&(a=a.toJSON()),D=JSON.stringify(a,s),D===void 0)return D;if(h=r-u.length-c,D.length<=h&&(v=D.replace(Ih,function(N,w){return w||N+" "}),v.length<=h))return v;if(s!=null&&(a=JSON.parse(D),s=void 0),typeof a=="object"&&a!==null){if(E=u+i,d=[],f=0,Array.isArray(a))for(S="[",l="]",h=a.length;f<h;f++)d.push(o(a[f],E,f===h-1?0:1)||"null");else for(S="{",l="}",m=Object.keys(a),h=m.length;f<h;f++)g=m[f],p=JSON.stringify(g)+": ",x=o(a[g],E,p.length+(f===h-1?0:1)),x!==void 0&&d.push(p+x);if(d.length>0)return[S,i+d.join(`,
`+E),l].join(`
`+u)}return D}(t,"",0)},Jt={},Rh={get exports(){return Jt},set exports(e){Jt=e}};const Lh="2.0.0",Bh=256,zh=Number.MAX_SAFE_INTEGER||9007199254740991,Mh=16;var Ms={SEMVER_SPEC_VERSION:Lh,MAX_LENGTH:Bh,MAX_SAFE_INTEGER:zh,MAX_SAFE_COMPONENT_LENGTH:Mh};const Uh=typeof process=="object"&&process.env&&{}.NODE_DEBUG&&/\bsemver\b/i.test({}.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};var Us=Uh;(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n}=Ms,i=Us;t=e.exports={};const r=t.re=[],s=t.src=[],o=t.t={};let a=0;const u=(c,l,f)=>{const d=a++;i(d,l),o[c]=d,s[d]=l,r[d]=new RegExp(l,f?"g":void 0)};u("NUMERICIDENTIFIER","0|[1-9]\\d*"),u("NUMERICIDENTIFIERLOOSE","[0-9]+"),u("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),u("MAINVERSION",`(${s[o.NUMERICIDENTIFIER]})\\.(${s[o.NUMERICIDENTIFIER]})\\.(${s[o.NUMERICIDENTIFIER]})`),u("MAINVERSIONLOOSE",`(${s[o.NUMERICIDENTIFIERLOOSE]})\\.(${s[o.NUMERICIDENTIFIERLOOSE]})\\.(${s[o.NUMERICIDENTIFIERLOOSE]})`),u("PRERELEASEIDENTIFIER",`(?:${s[o.NUMERICIDENTIFIER]}|${s[o.NONNUMERICIDENTIFIER]})`),u("PRERELEASEIDENTIFIERLOOSE",`(?:${s[o.NUMERICIDENTIFIERLOOSE]}|${s[o.NONNUMERICIDENTIFIER]})`),u("PRERELEASE",`(?:-(${s[o.PRERELEASEIDENTIFIER]}(?:\\.${s[o.PRERELEASEIDENTIFIER]})*))`),u("PRERELEASELOOSE",`(?:-?(${s[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${s[o.PRERELEASEIDENTIFIERLOOSE]})*))`),u("BUILDIDENTIFIER","[0-9A-Za-z-]+"),u("BUILD",`(?:\\+(${s[o.BUILDIDENTIFIER]}(?:\\.${s[o.BUILDIDENTIFIER]})*))`),u("FULLPLAIN",`v?${s[o.MAINVERSION]}${s[o.PRERELEASE]}?${s[o.BUILD]}?`),u("FULL",`^${s[o.FULLPLAIN]}$`),u("LOOSEPLAIN",`[v=\\s]*${s[o.MAINVERSIONLOOSE]}${s[o.PRERELEASELOOSE]}?${s[o.BUILD]}?`),u("LOOSE",`^${s[o.LOOSEPLAIN]}$`),u("GTLT","((?:<|>)?=?)"),u("XRANGEIDENTIFIERLOOSE",`${s[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),u("XRANGEIDENTIFIER",`${s[o.NUMERICIDENTIFIER]}|x|X|\\*`),u("XRANGEPLAIN",`[v=\\s]*(${s[o.XRANGEIDENTIFIER]})(?:\\.(${s[o.XRANGEIDENTIFIER]})(?:\\.(${s[o.XRANGEIDENTIFIER]})(?:${s[o.PRERELEASE]})?${s[o.BUILD]}?)?)?`),u("XRANGEPLAINLOOSE",`[v=\\s]*(${s[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${s[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${s[o.XRANGEIDENTIFIERLOOSE]})(?:${s[o.PRERELEASELOOSE]})?${s[o.BUILD]}?)?)?`),u("XRANGE",`^${s[o.GTLT]}\\s*${s[o.XRANGEPLAIN]}$`),u("XRANGELOOSE",`^${s[o.GTLT]}\\s*${s[o.XRANGEPLAINLOOSE]}$`),u("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),u("COERCERTL",s[o.COERCE],!0),u("LONETILDE","(?:~>?)"),u("TILDETRIM",`(\\s*)${s[o.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",u("TILDE",`^${s[o.LONETILDE]}${s[o.XRANGEPLAIN]}$`),u("TILDELOOSE",`^${s[o.LONETILDE]}${s[o.XRANGEPLAINLOOSE]}$`),u("LONECARET","(?:\\^)"),u("CARETTRIM",`(\\s*)${s[o.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",u("CARET",`^${s[o.LONECARET]}${s[o.XRANGEPLAIN]}$`),u("CARETLOOSE",`^${s[o.LONECARET]}${s[o.XRANGEPLAINLOOSE]}$`),u("COMPARATORLOOSE",`^${s[o.GTLT]}\\s*(${s[o.LOOSEPLAIN]})$|^$`),u("COMPARATOR",`^${s[o.GTLT]}\\s*(${s[o.FULLPLAIN]})$|^$`),u("COMPARATORTRIM",`(\\s*)${s[o.GTLT]}\\s*(${s[o.LOOSEPLAIN]}|${s[o.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",u("HYPHENRANGE",`^\\s*(${s[o.XRANGEPLAIN]})\\s+-\\s+(${s[o.XRANGEPLAIN]})\\s*$`),u("HYPHENRANGELOOSE",`^\\s*(${s[o.XRANGEPLAINLOOSE]})\\s+-\\s+(${s[o.XRANGEPLAINLOOSE]})\\s*$`),u("STAR","(<|>)?=?\\s*\\*"),u("GTE0","^\\s*>=\\s*0.0.0\\s*$"),u("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")})(Rh,Jt);const Wh=["includePrerelease","loose","rtl"],Gh=e=>e?typeof e!="object"?{loose:!0}:Wh.filter(t=>e[t]).reduce((t,n)=>(t[n]=!0,t),{}):{};var Ws=Gh;const qc=/^[0-9]+$/,Jf=(e,t)=>{const n=qc.test(e),i=qc.test(t);return n&&i&&(e=+e,t=+t),e===t?0:n&&!i?-1:i&&!n?1:e<t?-1:1},Hh=(e,t)=>Jf(t,e);var Aa={compareIdentifiers:Jf,rcompareIdentifiers:Hh};const Jr=Us,{MAX_LENGTH:Vc,MAX_SAFE_INTEGER:Kr}=Ms,{re:Xc,t:Yc}=Jt,qh=Ws,{compareIdentifiers:nr}=Aa;let bt=class{constructor(t,n){if(n=qh(n),t instanceof bt){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid Version: ${t}`);if(t.length>Vc)throw new TypeError(`version is longer than ${Vc} characters`);Jr("SemVer",t,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;const i=t.trim().match(n.loose?Xc[Yc.LOOSE]:Xc[Yc.FULL]);if(!i)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>Kr||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Kr||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Kr||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(r=>{if(/^[0-9]+$/.test(r)){const s=+r;if(s>=0&&s<Kr)return s}return r}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(Jr("SemVer.compare",this.version,this.options,t),!(t instanceof bt)){if(typeof t=="string"&&t===this.version)return 0;t=new bt(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof bt||(t=new bt(t,this.options)),nr(this.major,t.major)||nr(this.minor,t.minor)||nr(this.patch,t.patch)}comparePre(t){if(t instanceof bt||(t=new bt(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let n=0;do{const i=this.prerelease[n],r=t.prerelease[n];if(Jr("prerelease compare",n,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return nr(i,r)}while(++n)}compareBuild(t){t instanceof bt||(t=new bt(t,this.options));let n=0;do{const i=this.build[n],r=t.build[n];if(Jr("prerelease compare",n,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return nr(i,r)}while(++n)}inc(t,n){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n),this.inc("pre",n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n),this.inc("pre",n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);i===-1&&this.prerelease.push(0)}n&&(this.prerelease[0]===n?isNaN(this.prerelease[1])&&(this.prerelease=[n,0]):this.prerelease=[n,0]);break;default:throw new Error(`invalid increment argument: ${t}`)}return this.format(),this.raw=this.version,this}};var Ne=bt;const{MAX_LENGTH:Vh}=Ms,{re:Jc,t:Kc}=Jt,Qc=Ne,Xh=Ws,Yh=(e,t)=>{if(t=Xh(t),e instanceof Qc)return e;if(typeof e!="string"||e.length>Vh||!(t.loose?Jc[Kc.LOOSE]:Jc[Kc.FULL]).test(e))return null;try{return new Qc(e,t)}catch(i){return null}};var Wi=Yh;const Jh=Wi,Kh=(e,t)=>{const n=Jh(e,t);return n?n.version:null};var Qh=Kh;const Zh=Wi,em=(e,t)=>{const n=Zh(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};var tm=em;const nm=Ne,im=(e,t,n,i)=>{typeof n=="string"&&(i=n,n=void 0);try{return new nm(e,n).inc(t,i).version}catch(r){return null}};var rm=im;const Zc=Ne,sm=(e,t,n)=>new Zc(e,n).compare(new Zc(t,n));var ct=sm;const om=ct,am=(e,t,n)=>om(e,t,n)===0;var ru=am;const el=Wi,um=ru,cm=(e,t)=>{if(um(e,t))return null;{const n=el(e),i=el(t),r=n.prerelease.length||i.prerelease.length,s=r?"pre":"",o=r?"prerelease":"";for(const a in n)if((a==="major"||a==="minor"||a==="patch")&&n[a]!==i[a])return s+a;return o}};var lm=cm;const fm=Ne,dm=(e,t)=>new fm(e,t).major;var gm=dm;const pm=Ne,hm=(e,t)=>new pm(e,t).minor;var mm=hm;const bm=Ne,ym=(e,t)=>new bm(e,t).patch;var vm=ym;const Om=Wi,Em=(e,t)=>{const n=Om(e,t);return n&&n.prerelease.length?n.prerelease:null};var xm=Em;const Am=ct,wm=(e,t,n)=>Am(t,e,n);var Sm=wm;const Cm=ct,_m=(e,t)=>Cm(e,t,!0);var Fm=_m;const tl=Ne,jm=(e,t,n)=>{const i=new tl(e,n),r=new tl(t,n);return i.compare(r)||i.compareBuild(r)};var su=jm;const $m=su,Dm=(e,t)=>e.sort((n,i)=>$m(n,i,t));var Tm=Dm;const Nm=su,km=(e,t)=>e.sort((n,i)=>Nm(i,n,t));var Pm=km;const Im=ct,Rm=(e,t,n)=>Im(e,t,n)>0;var Gs=Rm;const Lm=ct,Bm=(e,t,n)=>Lm(e,t,n)<0;var ou=Bm;const zm=ct,Mm=(e,t,n)=>zm(e,t,n)!==0;var Kf=Mm;const Um=ct,Wm=(e,t,n)=>Um(e,t,n)>=0;var au=Wm;const Gm=ct,Hm=(e,t,n)=>Gm(e,t,n)<=0;var uu=Hm;const qm=ru,Vm=Kf,Xm=Gs,Ym=au,Jm=ou,Km=uu,Qm=(e,t,n,i)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e===n;case"!==":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e!==n;case"":case"=":case"==":return qm(e,n,i);case"!=":return Vm(e,n,i);case">":return Xm(e,n,i);case">=":return Ym(e,n,i);case"<":return Jm(e,n,i);case"<=":return Km(e,n,i);default:throw new TypeError(`Invalid operator: ${t}`)}};var Qf=Qm;const Zm=Ne,e0=Wi,{re:Qr,t:Zr}=Jt,t0=(e,t)=>{if(e instanceof Zm)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;t=t||{};let n=null;if(!t.rtl)n=e.match(Qr[Zr.COERCE]);else{let i;for(;(i=Qr[Zr.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)(!n||i.index+i[0].length!==n.index+n[0].length)&&(n=i),Qr[Zr.COERCERTL].lastIndex=i.index+i[1].length+i[2].length;Qr[Zr.COERCERTL].lastIndex=-1}return n===null?null:e0(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)};var n0=t0,Go,nl;function i0(){return nl||(nl=1,Go=function(e){e.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}),Go}var r0=J;J.Node=Qn;J.create=J;function J(e){var t=this;if(t instanceof J||(t=new J),t.tail=null,t.head=null,t.length=0,e&&typeof e.forEach=="function")e.forEach(function(r){t.push(r)});else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)t.push(arguments[n]);return t}J.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t};J.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}};J.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}};J.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)o0(this,arguments[e]);return this.length};J.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)a0(this,arguments[e]);return this.length};J.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}};J.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}};J.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,i=0;n!==null;i++)e.call(t,n.value,i,this),n=n.next};J.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,i=this.length-1;n!==null;i--)e.call(t,n.value,i,this),n=n.prev};J.prototype.get=function(e){for(var t=0,n=this.head;n!==null&&t<e;t++)n=n.next;if(t===e&&n!==null)return n.value};J.prototype.getReverse=function(e){for(var t=0,n=this.tail;n!==null&&t<e;t++)n=n.prev;if(t===e&&n!==null)return n.value};J.prototype.map=function(e,t){t=t||this;for(var n=new J,i=this.head;i!==null;)n.push(e.call(t,i.value,this)),i=i.next;return n};J.prototype.mapReverse=function(e,t){t=t||this;for(var n=new J,i=this.tail;i!==null;)n.push(e.call(t,i.value,this)),i=i.prev;return n};J.prototype.reduce=function(e,t){var n,i=this.head;if(arguments.length>1)n=t;else if(this.head)i=this.head.next,n=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=0;i!==null;r++)n=e(n,i.value,r),i=i.next;return n};J.prototype.reduceReverse=function(e,t){var n,i=this.tail;if(arguments.length>1)n=t;else if(this.tail)i=this.tail.prev,n=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=this.length-1;i!==null;r--)n=e(n,i.value,r),i=i.prev;return n};J.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;n!==null;t++)e[t]=n.value,n=n.next;return e};J.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;n!==null;t++)e[t]=n.value,n=n.prev;return e};J.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new J;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,r=this.head;r!==null&&i<e;i++)r=r.next;for(;r!==null&&i<t;i++,r=r.next)n.push(r.value);return n};J.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new J;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,r=this.tail;r!==null&&i>t;i--)r=r.prev;for(;r!==null&&i>e;i--,r=r.prev)n.push(r.value);return n};J.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var i=0,r=this.head;r!==null&&i<e;i++)r=r.next;for(var s=[],i=0;r&&i<t;i++)s.push(r.value),r=this.removeNode(r);r===null&&(r=this.tail),r!==this.head&&r!==this.tail&&(r=r.prev);for(var i=0;i<n.length;i++)r=s0(this,r,n[i]);return s};J.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;n!==null;n=n.prev){var i=n.prev;n.prev=n.next,n.next=i}return this.head=t,this.tail=e,this};function s0(e,t,n){var i=t===e.head?new Qn(n,null,t,e):new Qn(n,t,t.next,e);return i.next===null&&(e.tail=i),i.prev===null&&(e.head=i),e.length++,i}function o0(e,t){e.tail=new Qn(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function a0(e,t){e.head=new Qn(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function Qn(e,t,n,i){if(!(this instanceof Qn))return new Qn(e,t,n,i);this.list=i,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}try{i0()(J)}catch(e){}const u0=r0,Gn=Symbol("max"),zt=Symbol("length"),vi=Symbol("lengthCalculator"),dr=Symbol("allowStale"),Hn=Symbol("maxAge"),Bt=Symbol("dispose"),il=Symbol("noDisposeOnSet"),Ee=Symbol("lruList"),nt=Symbol("cache"),Zf=Symbol("updateAgeOnGet"),Ho=()=>1;class c0{constructor(t){if(typeof t=="number"&&(t={max:t}),t||(t={}),t.max&&(typeof t.max!="number"||t.max<0))throw new TypeError("max must be a non-negative number");this[Gn]=t.max||1/0;const n=t.length||Ho;if(this[vi]=typeof n!="function"?Ho:n,this[dr]=t.stale||!1,t.maxAge&&typeof t.maxAge!="number")throw new TypeError("maxAge must be a number");this[Hn]=t.maxAge||0,this[Bt]=t.dispose,this[il]=t.noDisposeOnSet||!1,this[Zf]=t.updateAgeOnGet||!1,this.reset()}set max(t){if(typeof t!="number"||t<0)throw new TypeError("max must be a non-negative number");this[Gn]=t||1/0,ir(this)}get max(){return this[Gn]}set allowStale(t){this[dr]=!!t}get allowStale(){return this[dr]}set maxAge(t){if(typeof t!="number")throw new TypeError("maxAge must be a non-negative number");this[Hn]=t,ir(this)}get maxAge(){return this[Hn]}set lengthCalculator(t){typeof t!="function"&&(t=Ho),t!==this[vi]&&(this[vi]=t,this[zt]=0,this[Ee].forEach(n=>{n.length=this[vi](n.value,n.key),this[zt]+=n.length})),ir(this)}get lengthCalculator(){return this[vi]}get length(){return this[zt]}get itemCount(){return this[Ee].length}rforEach(t,n){n=n||this;for(let i=this[Ee].tail;i!==null;){const r=i.prev;rl(this,t,i,n),i=r}}forEach(t,n){n=n||this;for(let i=this[Ee].head;i!==null;){const r=i.next;rl(this,t,i,n),i=r}}keys(){return this[Ee].toArray().map(t=>t.key)}values(){return this[Ee].toArray().map(t=>t.value)}reset(){this[Bt]&&this[Ee]&&this[Ee].length&&this[Ee].forEach(t=>this[Bt](t.key,t.value)),this[nt]=new Map,this[Ee]=new u0,this[zt]=0}dump(){return this[Ee].map(t=>vs(this,t)?!1:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[Ee]}set(t,n,i){if(i=i||this[Hn],i&&typeof i!="number")throw new TypeError("maxAge must be a number");const r=i?Date.now():0,s=this[vi](n,t);if(this[nt].has(t)){if(s>this[Gn])return Ai(this,this[nt].get(t)),!1;const u=this[nt].get(t).value;return this[Bt]&&(this[il]||this[Bt](t,u.value)),u.now=r,u.maxAge=i,u.value=n,this[zt]+=s-u.length,u.length=s,this.get(t),ir(this),!0}const o=new l0(t,n,s,r,i);return o.length>this[Gn]?(this[Bt]&&this[Bt](t,n),!1):(this[zt]+=o.length,this[Ee].unshift(o),this[nt].set(t,this[Ee].head),ir(this),!0)}has(t){if(!this[nt].has(t))return!1;const n=this[nt].get(t).value;return!vs(this,n)}get(t){return qo(this,t,!0)}peek(t){return qo(this,t,!1)}pop(){const t=this[Ee].tail;return t?(Ai(this,t),t.value):null}del(t){Ai(this,this[nt].get(t))}load(t){this.reset();const n=Date.now();for(let i=t.length-1;i>=0;i--){const r=t[i],s=r.e||0;if(s===0)this.set(r.k,r.v);else{const o=s-n;o>0&&this.set(r.k,r.v,o)}}}prune(){this[nt].forEach((t,n)=>qo(this,n,!1))}}const qo=(e,t,n)=>{const i=e[nt].get(t);if(i){const r=i.value;if(vs(e,r)){if(Ai(e,i),!e[dr])return}else n&&(e[Zf]&&(i.value.now=Date.now()),e[Ee].unshiftNode(i));return r.value}},vs=(e,t)=>{if(!t||!t.maxAge&&!e[Hn])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[Hn]&&n>e[Hn]},ir=e=>{if(e[zt]>e[Gn])for(let t=e[Ee].tail;e[zt]>e[Gn]&&t!==null;){const n=t.prev;Ai(e,t),t=n}},Ai=(e,t)=>{if(t){const n=t.value;e[Bt]&&e[Bt](n.key,n.value),e[zt]-=n.length,e[nt].delete(n.key),e[Ee].removeNode(t)}};class l0{constructor(t,n,i,r,s){this.key=t,this.value=n,this.length=i,this.now=r,this.maxAge=s||0}}const rl=(e,t,n,i)=>{let r=n.value;vs(e,r)&&(Ai(e,n),e[dr]||(r=void 0)),r&&t.call(i,r.value,r.key,e)};var f0=c0,Vo,sl;function lt(){if(sl)return Vo;sl=1;class e{constructor(A,R){if(R=i(R),A instanceof e)return A.loose===!!R.loose&&A.includePrerelease===!!R.includePrerelease?A:new e(A.raw,R);if(A instanceof r)return this.raw=A.value,this.set=[[A]],this.format(),this;if(this.options=R,this.loose=!!R.loose,this.includePrerelease=!!R.includePrerelease,this.raw=A,this.set=A.split(/\s*\|\|\s*/).map(j=>this.parseRange(j.trim())).filter(j=>j.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${A}`);if(this.set.length>1){const j=this.set[0];if(this.set=this.set.filter(k=>!d(k[0])),this.set.length===0)this.set=[j];else if(this.set.length>1){for(const k of this.set)if(k.length===1&&g(k[0])){this.set=[k];break}}}this.format()}format(){return this.range=this.set.map(A=>A.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(A){A=A.trim();const j=`parseRange:${Object.keys(this.options).join(",")}:${A}`,k=n.get(j);if(k)return k;const $=this.options.loose,P=$?a[u.HYPHENRANGELOOSE]:a[u.HYPHENRANGE];A=A.replace(P,K(this.options.includePrerelease)),s("hyphen replace",A),A=A.replace(a[u.COMPARATORTRIM],c),s("comparator trim",A,a[u.COMPARATORTRIM]),A=A.replace(a[u.TILDETRIM],l),A=A.replace(a[u.CARETTRIM],f),A=A.split(/\s+/).join(" ");const H=$?a[u.COMPARATORLOOSE]:a[u.COMPARATOR],U=A.split(" ").map(Q=>m(Q,this.options)).join(" ").split(/\s+/).map(Q=>B(Q,this.options)).filter(this.options.loose?Q=>!!Q.match(H):()=>!0).map(Q=>new r(Q,this.options));U.length;const q=new Map;for(const Q of U){if(d(Q))return[Q];q.set(Q.value,Q)}q.size>1&&q.has("")&&q.delete("");const he=[...q.values()];return n.set(j,he),he}intersects(A,R){if(!(A instanceof e))throw new TypeError("a Range is required");return this.set.some(j=>p(j,R)&&A.set.some(k=>p(k,R)&&j.every($=>k.every(P=>$.intersects(P,R)))))}test(A){if(!A)return!1;if(typeof A=="string")try{A=new o(A,this.options)}catch(R){return!1}for(let R=0;R<this.set.length;R++)if(ie(this.set[R],A,this.options))return!0;return!1}}Vo=e;const t=f0,n=new t({max:1e3}),i=Ws,r=Hs(),s=Us,o=Ne,{re:a,t:u,comparatorTrimReplace:c,tildeTrimReplace:l,caretTrimReplace:f}=Jt,d=_=>_.value==="<0.0.0-0",g=_=>_.value==="",p=(_,A)=>{let R=!0;const j=_.slice();let k=j.pop();for(;R&&j.length;)R=j.every($=>k.intersects($,A)),k=j.pop();return R},m=(_,A)=>(s("comp",_,A),_=S(_,A),s("caret",_),_=E(_,A),s("tildes",_),_=x(_,A),s("xrange",_),_=w(_,A),s("stars",_),_),h=_=>!_||_.toLowerCase()==="x"||_==="*",E=(_,A)=>_.trim().split(/\s+/).map(R=>v(R,A)).join(" "),v=(_,A)=>{const R=A.loose?a[u.TILDELOOSE]:a[u.TILDE];return _.replace(R,(j,k,$,P,H)=>{s("tilde",_,j,k,$,P,H);let U;return h(k)?U="":h($)?U=`>=${k}.0.0 <${+k+1}.0.0-0`:h(P)?U=`>=${k}.${$}.0 <${k}.${+$+1}.0-0`:H?(s("replaceTilde pr",H),U=`>=${k}.${$}.${P}-${H} <${k}.${+$+1}.0-0`):U=`>=${k}.${$}.${P} <${k}.${+$+1}.0-0`,s("tilde return",U),U})},S=(_,A)=>_.trim().split(/\s+/).map(R=>D(R,A)).join(" "),D=(_,A)=>{s("caret",_,A);const R=A.loose?a[u.CARETLOOSE]:a[u.CARET],j=A.includePrerelease?"-0":"";return _.replace(R,(k,$,P,H,U)=>{s("caret",_,k,$,P,H,U);let q;return h($)?q="":h(P)?q=`>=${$}.0.0${j} <${+$+1}.0.0-0`:h(H)?$==="0"?q=`>=${$}.${P}.0${j} <${$}.${+P+1}.0-0`:q=`>=${$}.${P}.0${j} <${+$+1}.0.0-0`:U?(s("replaceCaret pr",U),$==="0"?P==="0"?q=`>=${$}.${P}.${H}-${U} <${$}.${P}.${+H+1}-0`:q=`>=${$}.${P}.${H}-${U} <${$}.${+P+1}.0-0`:q=`>=${$}.${P}.${H}-${U} <${+$+1}.0.0-0`):(s("no pr"),$==="0"?P==="0"?q=`>=${$}.${P}.${H}${j} <${$}.${P}.${+H+1}-0`:q=`>=${$}.${P}.${H}${j} <${$}.${+P+1}.0-0`:q=`>=${$}.${P}.${H} <${+$+1}.0.0-0`),s("caret return",q),q})},x=(_,A)=>(s("replaceXRanges",_,A),_.split(/\s+/).map(R=>N(R,A)).join(" ")),N=(_,A)=>{_=_.trim();const R=A.loose?a[u.XRANGELOOSE]:a[u.XRANGE];return _.replace(R,(j,k,$,P,H,U)=>{s("xRange",_,j,k,$,P,H,U);const q=h($),he=q||h(P),Q=he||h(H),qe=Q;return k==="="&&qe&&(k=""),U=A.includePrerelease?"-0":"",q?k===">"||k==="<"?j="<0.0.0-0":j="*":k&&qe?(he&&(P=0),H=0,k===">"?(k=">=",he?($=+$+1,P=0,H=0):(P=+P+1,H=0)):k==="<="&&(k="<",he?$=+$+1:P=+P+1),k==="<"&&(U="-0"),j=`${k+$}.${P}.${H}${U}`):he?j=`>=${$}.0.0${U} <${+$+1}.0.0-0`:Q&&(j=`>=${$}.${P}.0${U} <${$}.${+P+1}.0-0`),s("xRange return",j),j})},w=(_,A)=>(s("replaceStars",_,A),_.trim().replace(a[u.STAR],"")),B=(_,A)=>(s("replaceGTE0",_,A),_.trim().replace(a[A.includePrerelease?u.GTE0PRE:u.GTE0],"")),K=_=>(A,R,j,k,$,P,H,U,q,he,Q,qe,et)=>(h(j)?R="":h(k)?R=`>=${j}.0.0${_?"-0":""}`:h($)?R=`>=${j}.${k}.0${_?"-0":""}`:P?R=`>=${R}`:R=`>=${R}${_?"-0":""}`,h(q)?U="":h(he)?U=`<${+q+1}.0.0-0`:h(Q)?U=`<${q}.${+he+1}.0-0`:qe?U=`<=${q}.${he}.${Q}-${qe}`:_?U=`<${q}.${he}.${+Q+1}-0`:U=`<=${U}`,`${R} ${U}`.trim()),ie=(_,A,R)=>{for(let j=0;j<_.length;j++)if(!_[j].test(A))return!1;if(A.prerelease.length&&!R.includePrerelease){for(let j=0;j<_.length;j++)if(s(_[j].semver),_[j].semver!==r.ANY&&_[j].semver.prerelease.length>0){const k=_[j].semver;if(k.major===A.major&&k.minor===A.minor&&k.patch===A.patch)return!0}return!1}return!0};return Vo}var Xo,ol;function Hs(){if(ol)return Xo;ol=1;const e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(l,f){if(f=n(f),l instanceof t){if(l.loose===!!f.loose)return l;l=l.value}o("comparator",l,f),this.options=f,this.loose=!!f.loose,this.parse(l),this.semver===e?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(l){const f=this.options.loose?i[r.COMPARATORLOOSE]:i[r.COMPARATOR],d=l.match(f);if(!d)throw new TypeError(`Invalid comparator: ${l}`);this.operator=d[1]!==void 0?d[1]:"",this.operator==="="&&(this.operator=""),d[2]?this.semver=new a(d[2],this.options.loose):this.semver=e}toString(){return this.value}test(l){if(o("Comparator.test",l,this.options.loose),this.semver===e||l===e)return!0;if(typeof l=="string")try{l=new a(l,this.options)}catch(f){return!1}return s(l,this.operator,this.semver,this.options)}intersects(l,f){if(!(l instanceof t))throw new TypeError("a Comparator is required");if((!f||typeof f!="object")&&(f={loose:!!f,includePrerelease:!1}),this.operator==="")return this.value===""?!0:new u(l.value,f).test(this.value);if(l.operator==="")return l.value===""?!0:new u(this.value,f).test(l.semver);const d=(this.operator===">="||this.operator===">")&&(l.operator===">="||l.operator===">"),g=(this.operator==="<="||this.operator==="<")&&(l.operator==="<="||l.operator==="<"),p=this.semver.version===l.semver.version,m=(this.operator===">="||this.operator==="<=")&&(l.operator===">="||l.operator==="<="),h=s(this.semver,"<",l.semver,f)&&(this.operator===">="||this.operator===">")&&(l.operator==="<="||l.operator==="<"),E=s(this.semver,">",l.semver,f)&&(this.operator==="<="||this.operator==="<")&&(l.operator===">="||l.operator===">");return d||g||p&&m||h||E}}Xo=t;const n=Ws,{re:i,t:r}=Jt,s=Qf,o=Us,a=Ne,u=lt();return Xo}const d0=lt(),g0=(e,t,n)=>{try{t=new d0(t,n)}catch(i){return!1}return t.test(e)};var qs=g0;const p0=lt(),h0=(e,t)=>new p0(e,t).set.map(n=>n.map(i=>i.value).join(" ").trim().split(" "));var m0=h0;const b0=Ne,y0=lt(),v0=(e,t,n)=>{let i=null,r=null,s=null;try{s=new y0(t,n)}catch(o){return null}return e.forEach(o=>{s.test(o)&&(!i||r.compare(o)===-1)&&(i=o,r=new b0(i,n))}),i};var O0=v0;const E0=Ne,x0=lt(),A0=(e,t,n)=>{let i=null,r=null,s=null;try{s=new x0(t,n)}catch(o){return null}return e.forEach(o=>{s.test(o)&&(!i||r.compare(o)===1)&&(i=o,r=new E0(i,n))}),i};var w0=A0;const Yo=Ne,S0=lt(),al=Gs,C0=(e,t)=>{e=new S0(e,t);let n=new Yo("0.0.0");if(e.test(n)||(n=new Yo("0.0.0-0"),e.test(n)))return n;n=null;for(let i=0;i<e.set.length;++i){const r=e.set[i];let s=null;r.forEach(o=>{const a=new Yo(o.semver.version);switch(o.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!s||al(a,s))&&(s=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),s&&(!n||al(n,s))&&(n=s)}return n&&e.test(n)?n:null};var _0=C0;const F0=lt(),j0=(e,t)=>{try{return new F0(e,t).range||"*"}catch(n){return null}};var $0=j0;const D0=Ne,ed=Hs(),{ANY:T0}=ed,N0=lt(),k0=qs,ul=Gs,cl=ou,P0=uu,I0=au,R0=(e,t,n,i)=>{e=new D0(e,i),t=new N0(t,i);let r,s,o,a,u;switch(n){case">":r=ul,s=P0,o=cl,a=">",u=">=";break;case"<":r=cl,s=I0,o=ul,a="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(k0(e,t,i))return!1;for(let c=0;c<t.set.length;++c){const l=t.set[c];let f=null,d=null;if(l.forEach(g=>{g.semver===T0&&(g=new ed(">=0.0.0")),f=f||g,d=d||g,r(g.semver,f.semver,i)?f=g:o(g.semver,d.semver,i)&&(d=g)}),f.operator===a||f.operator===u||(!d.operator||d.operator===a)&&s(e,d.semver))return!1;if(d.operator===u&&o(e,d.semver))return!1}return!0};var cu=R0;const L0=cu,B0=(e,t,n)=>L0(e,t,">",n);var z0=B0;const M0=cu,U0=(e,t,n)=>M0(e,t,"<",n);var W0=U0;const ll=lt(),G0=(e,t,n)=>(e=new ll(e,n),t=new ll(t,n),e.intersects(t));var H0=G0;const q0=qs,V0=ct;var X0=(e,t,n)=>{const i=[];let r=null,s=null;const o=e.sort((l,f)=>V0(l,f,n));for(const l of o)q0(l,t,n)?(s=l,r||(r=l)):(s&&i.push([r,s]),s=null,r=null);r&&i.push([r,null]);const a=[];for(const[l,f]of i)l===f?a.push(l):!f&&l===o[0]?a.push("*"):f?l===o[0]?a.push(`<=${f}`):a.push(`${l} - ${f}`):a.push(`>=${l}`);const u=a.join(" || "),c=typeof t.raw=="string"?t.raw:String(t);return u.length<c.length?u:t};const fl=lt(),ds=Hs(),{ANY:Jo}=ds,rr=qs,lu=ct,Y0=(e,t,n={})=>{if(e===t)return!0;e=new fl(e,n),t=new fl(t,n);let i=!1;e:for(const r of e.set){for(const s of t.set){const o=J0(r,s,n);if(i=i||o!==null,o)continue e}if(i)return!1}return!0},J0=(e,t,n)=>{if(e===t)return!0;if(e.length===1&&e[0].semver===Jo){if(t.length===1&&t[0].semver===Jo)return!0;n.includePrerelease?e=[new ds(">=0.0.0-0")]:e=[new ds(">=0.0.0")]}if(t.length===1&&t[0].semver===Jo){if(n.includePrerelease)return!0;t=[new ds(">=0.0.0")]}const i=new Set;let r,s;for(const g of e)g.operator===">"||g.operator===">="?r=dl(r,g,n):g.operator==="<"||g.operator==="<="?s=gl(s,g,n):i.add(g.semver);if(i.size>1)return null;let o;if(r&&s){if(o=lu(r.semver,s.semver,n),o>0)return null;if(o===0&&(r.operator!==">="||s.operator!=="<="))return null}for(const g of i){if(r&&!rr(g,String(r),n)||s&&!rr(g,String(s),n))return null;for(const p of t)if(!rr(g,String(p),n))return!1;return!0}let a,u,c,l,f=s&&!n.includePrerelease&&s.semver.prerelease.length?s.semver:!1,d=r&&!n.includePrerelease&&r.semver.prerelease.length?r.semver:!1;f&&f.prerelease.length===1&&s.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(const g of t){if(l=l||g.operator===">"||g.operator===">=",c=c||g.operator==="<"||g.operator==="<=",r){if(d&&g.semver.prerelease&&g.semver.prerelease.length&&g.semver.major===d.major&&g.semver.minor===d.minor&&g.semver.patch===d.patch&&(d=!1),g.operator===">"||g.operator===">="){if(a=dl(r,g,n),a===g&&a!==r)return!1}else if(r.operator===">="&&!rr(r.semver,String(g),n))return!1}if(s){if(f&&g.semver.prerelease&&g.semver.prerelease.length&&g.semver.major===f.major&&g.semver.minor===f.minor&&g.semver.patch===f.patch&&(f=!1),g.operator==="<"||g.operator==="<="){if(u=gl(s,g,n),u===g&&u!==s)return!1}else if(s.operator==="<="&&!rr(s.semver,String(g),n))return!1}if(!g.operator&&(s||r)&&o!==0)return!1}return!(r&&c&&!s&&o!==0||s&&l&&!r&&o!==0||d||f)},dl=(e,t,n)=>{if(!e)return t;const i=lu(e.semver,t.semver,n);return i>0?e:i<0||t.operator===">"&&e.operator===">="?t:e},gl=(e,t,n)=>{if(!e)return t;const i=lu(e.semver,t.semver,n);return i<0?e:i>0||t.operator==="<"&&e.operator==="<="?t:e};var K0=Y0;const Ko=Jt;var td={re:Ko.re,src:Ko.src,tokens:Ko.t,SEMVER_SPEC_VERSION:Ms.SEMVER_SPEC_VERSION,SemVer:Ne,compareIdentifiers:Aa.compareIdentifiers,rcompareIdentifiers:Aa.rcompareIdentifiers,parse:Wi,valid:Qh,clean:tm,inc:rm,diff:lm,major:gm,minor:mm,patch:vm,prerelease:xm,compare:ct,rcompare:Sm,compareLoose:Fm,compareBuild:su,sort:Tm,rsort:Pm,gt:Gs,lt:ou,eq:ru,neq:Kf,gte:au,lte:uu,cmp:Qf,coerce:n0,Comparator:Hs(),Range:lt(),satisfies:qs,toComparators:m0,maxSatisfying:O0,minSatisfying:w0,minVersion:_0,validRange:$0,outside:cu,gtr:z0,ltr:W0,intersects:H0,simplifyRange:X0,subset:K0};const Q0="4.17.0";Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,i){return Array.isArray(i)?n.push.apply(n,e.call(i,t-1)):n.push(i),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var wa={},Z0={get exports(){return wa},set exports(e){wa=e}};(function(e){var t=function(){function n(d,g){return g!=null&&d instanceof g}var i;try{i=Map}catch(d){i=function(){}}var r;try{r=Set}catch(d){r=function(){}}var s;try{s=Promise}catch(d){s=function(){}}function o(d,g,p,m,h){typeof g=="object"&&(p=g.depth,m=g.prototype,h=g.includeNonEnumerable,g=g.circular);var E=[],v=[],S=typeof Buffer<"u";typeof g>"u"&&(g=!0),typeof p>"u"&&(p=1/0);function D(x,N){if(x===null)return null;if(N===0)return x;var w,B;if(typeof x!="object")return x;if(n(x,i))w=new i;else if(n(x,r))w=new r;else if(n(x,s))w=new s(function(P,H){x.then(function(U){P(D(U,N-1))},function(U){H(D(U,N-1))})});else if(o.__isArray(x))w=[];else if(o.__isRegExp(x))w=new RegExp(x.source,f(x)),x.lastIndex&&(w.lastIndex=x.lastIndex);else if(o.__isDate(x))w=new Date(x.getTime());else{if(S&&Buffer.isBuffer(x))return Buffer.allocUnsafe?w=Buffer.allocUnsafe(x.length):w=new Buffer(x.length),x.copy(w),w;n(x,Error)?w=Object.create(x):typeof m>"u"?(B=Object.getPrototypeOf(x),w=Object.create(B)):(w=Object.create(m),B=m)}if(g){var K=E.indexOf(x);if(K!=-1)return v[K];E.push(x),v.push(w)}n(x,i)&&x.forEach(function(P,H){var U=D(H,N-1),q=D(P,N-1);w.set(U,q)}),n(x,r)&&x.forEach(function(P){var H=D(P,N-1);w.add(H)});for(var ie in x){var _;B&&(_=Object.getOwnPropertyDescriptor(B,ie)),!(_&&_.set==null)&&(w[ie]=D(x[ie],N-1))}if(Object.getOwnPropertySymbols)for(var A=Object.getOwnPropertySymbols(x),ie=0;ie<A.length;ie++){var R=A[ie],j=Object.getOwnPropertyDescriptor(x,R);j&&!j.enumerable&&!h||(w[R]=D(x[R],N-1),j.enumerable||Object.defineProperty(w,R,{enumerable:!1}))}if(h)for(var k=Object.getOwnPropertyNames(x),ie=0;ie<k.length;ie++){var $=k[ie],j=Object.getOwnPropertyDescriptor(x,$);j&&j.enumerable||(w[$]=D(x[$],N-1),Object.defineProperty(w,$,{enumerable:!1}))}return w}return D(d,p)}o.clonePrototype=function(g){if(g===null)return null;var p=function(){};return p.prototype=g,new p};function a(d){return Object.prototype.toString.call(d)}o.__objToStr=a;function u(d){return typeof d=="object"&&a(d)==="[object Date]"}o.__isDate=u;function c(d){return typeof d=="object"&&a(d)==="[object Array]"}o.__isArray=c;function l(d){return typeof d=="object"&&a(d)==="[object RegExp]"}o.__isRegExp=l;function f(d){var g="";return d.global&&(g+="g"),d.ignoreCase&&(g+="i"),d.multiline&&(g+="m"),g}return o.__getRegExpFlags=f,o}();e.exports&&(e.exports=t)})(Z0);const eb=wa;var tb=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var i,r,s;if(Array.isArray(t)){if(i=t.length,i!=n.length)return!1;for(r=i;r--!==0;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(s=Object.keys(t),i=s.length,i!==Object.keys(n).length)return!1;for(r=i;r--!==0;)if(!Object.prototype.hasOwnProperty.call(n,s[r]))return!1;for(r=i;r--!==0;){var o=s[r];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n},yr=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var n=typeof t.cycles=="boolean"?t.cycles:!1,i=t.cmp&&function(s){return function(o){return function(a,u){var c={key:a,value:o[a]},l={key:u,value:o[u]};return s(c,l)}}}(t.cmp),r=[];return function s(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,u;if(Array.isArray(o)){for(u="[",a=0;a<o.length;a++)a&&(u+=","),u+=s(o[a])||"null";return u+"]"}if(o===null)return"null";if(r.indexOf(o)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var c=r.push(o)-1,l=Object.keys(o).sort(i&&i(o));for(u="",a=0;a<l.length;a++){var f=l[a],d=s(o[f]);d&&(u&&(u+=","),u+=JSON.stringify(f)+":"+d)}return r.splice(c,1),"{"+u+"}"}}(e)};function fu(e){return!!e.or}function du(e){return!!e.and}function gu(e){return!!e.not}function gs(e,t){if(gu(e))gs(e.not,t);else if(du(e))for(const n of e.and)gs(n,t);else if(fu(e))for(const n of e.or)gs(n,t);else t(e)}function ps(e,t){return gu(e)?{not:ps(e.not,t)}:du(e)?{and:e.and.map(n=>ps(n,t))}:fu(e)?{or:e.or.map(n=>ps(n,t))}:t(e)}const Gi=tb,G=eb;function Fi(e,t){const n={};for(const i of t)Ei(e,i)&&(n[i]=e[i]);return n}function Ge(e,t){const n=Object.assign({},e);for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>yr(e)).join(",")})`};const se=yr;function V(e){if(be(e))return e;const t=W(e)?e:yr(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function Sa(e){return e===!1||e===null}function L(e,t){return e.indexOf(t)>-1}function ji(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function pu(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function nd(e,...t){for(const n of t)nb(e,n!=null?n:{});return e}function nb(e,t){for(const n of y(t))qf(e,n,t[n],!0)}function Ot(e,t){const n=[],i={};let r;for(const s of e)r=t(s),!(r in i)&&(i[r]=1,n.push(s));return n}function ib(e,t){const n=y(e),i=y(t);if(n.length!==i.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0}function id(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function hu(e,t){for(const n of e)if(t.has(n))return!0;return!1}function Ca(e){const t=new Set;for(const n of e){const r=zi(n).map((o,a)=>a===0?o:`[${o}]`),s=r.map((o,a)=>r.slice(0,a+1).join(""));for(const o of s)t.add(o)}return t}function mu(e,t){return e===void 0||t===void 0?!0:hu(Ca(e),Ca(t))}function te(e){return y(e).length===0}const y=Object.keys,Gt=Object.values,Dr=Object.entries;function vr(e){return e===!0||e===!1}function ae(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function wi(e,t){return gu(e)?"!("+wi(e.not,t)+")":du(e)?"("+e.and.map(n=>wi(n,t)).join(") && (")+")":fu(e)?"("+e.or.map(n=>wi(n,t)).join(") || (")+")":t(e)}function Os(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&Os(e[n],t)&&delete e[n],te(e)}function Tr(e){return e.charAt(0).toUpperCase()+e.substr(1)}function bu(e,t="datum"){const n=zi(e),i=[];for(let r=1;r<=n.length;r++){const s=`[${n.slice(0,r).map(Y).join("][")}]`;i.push(`${t}${s}`)}return i.join(" && ")}function rd(e,t="datum"){return`${t}[${Y(zi(e).join("."))}]`}function rb(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function Kt(e){return`${zi(e).map(rb).join("\\.")}`}function Zn(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function yu(e){return`${zi(e).join(".")}`}function $i(e){return e?zi(e).length:0}function pe(...e){for(const t of e)if(t!==void 0)return t}let sd=42;function od(e){const t=++sd;return e?String(e)+t:t}function sb(){sd=42}function ad(e){return ud(e)?e:`__${e}`}function ud(e){return e.indexOf("__")===0}function Or(e){if(e!==void 0)return(e%360+360)%360}function Vs(e){return be(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}const pl={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function Nr(e){return e&&e.condition}const cd=["domain","grid","labels","ticks","title"],ob={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},ld={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},ab=Object.assign(Object.assign({},ld),{style:1,labelExpr:1,encoding:1});function hl(e){return!!ab[e]}const ub={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},fd=y(ub),cb={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},lb={count:1,min:1,max:1};function Qt(e){return!!e&&!!e.argmin}function xn(e){return!!e&&!!e.argmax}function vu(e){return W(e)&&!!cb[e]}const fb=["count","valid","missing","distinct"];function dd(e){return W(e)&&L(fb,e)}function db(e){return W(e)&&L(["min","max"],e)}const gb=["count","sum","distinct","valid","missing"],pb=["mean","average","median","q1","q3","min","max"],hb=ui(pb);var kr=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Ht="row",qt="column",Xs="facet",le="x",Oe="y",ft="x2",jt="y2",$t="radius",en="radius2",dt="theta",tn="theta2",Dt="latitude",Tt="longitude",gt="latitude2",Ye="longitude2",Le="color",Nt="fill",kt="stroke",Be="shape",nn="size",ci="angle",rn="opacity",An="fillOpacity",wn="strokeOpacity",Sn="strokeWidth",Cn="strokeDash",Pr="text",Ir="order",Rr="detail",Ys="key",ei="tooltip",Js="href",Ks="url",Qs="description",mb={x:1,y:1,x2:1,y2:1},gd={theta:1,theta2:1,radius:1,radius2:1};function pd(e){return e in gd}const Ou={longitude:1,longitude2:1,latitude:1,latitude2:1};function bb(e){switch(e){case Dt:return"y";case gt:return"y2";case Tt:return"x";case Ye:return"x2"}}function yb(e){return e in Ou}const vb=y(Ou),hd=Object.assign(Object.assign(Object.assign(Object.assign({},mb),gd),Ou),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function Si(e){return e===Le||e===Nt||e===kt}const md={row:1,column:1,facet:1},Xe=y(md),Eu=Object.assign(Object.assign({},hd),md),Ob=y(Eu),Eb=kr(Eu,["order","detail","tooltip"]),xb=kr(Eb,["row","column","facet"]);function Ab(e){return!!xb[e]}function bd(e){return!!Eu[e]}const wb=[ft,jt,gt,Ye,tn,en];function yd(e){return li(e)!==e}function li(e){switch(e){case ft:return le;case jt:return Oe;case gt:return Dt;case Ye:return Tt;case tn:return dt;case en:return $t}return e}function bn(e){if(pd(e))switch(e){case dt:return"startAngle";case tn:return"endAngle";case $t:return"outerRadius";case en:return"innerRadius"}return e}function Pt(e){switch(e){case le:return ft;case Oe:return jt;case Dt:return gt;case Tt:return Ye;case dt:return tn;case $t:return en}}function It(e){switch(e){case le:case ft:return"width";case Oe:case jt:return"height"}}function Sb(e){switch(e){case le:return"xOffset";case Oe:return"yOffset";case ft:return"x2Offset";case jt:return"y2Offset";case dt:return"thetaOffset";case $t:return"radiusOffset";case tn:return"theta2Offset";case en:return"radius2Offset"}}const xu=kr(hd,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),Cb=y(xu),_n={x:1,y:1},Je=y(_n);function St(e){return e in _n}const Au={theta:1,radius:1},_b=y(Au);function Zs(e){return e==="width"?le:Oe}const vd=kr(xu,["text","tooltip","href","url","description","detail","key","order"]),Fb=y(vd);function jb(e){return!!xu[e]}function $b(e){switch(e){case Le:case Nt:case kt:case nn:case Be:case rn:case Sn:case Cn:return!0;case An:case wn:case ci:return!1}}const Od=Object.assign(Object.assign(Object.assign({},_n),Au),vd),eo=y(Od);function Fn(e){return!!Od[e]}function Db(e,t){return Nb(e)[t]}const Ed={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},Tb=kr(Ed,["geoshape"]);function Nb(e){switch(e){case Le:case Nt:case kt:case Qs:case Rr:case Ys:case ei:case Js:case Ir:case rn:case An:case wn:case Sn:case Xs:case Ht:case qt:return Ed;case le:case Oe:case Dt:case Tt:return Tb;case ft:case jt:case gt:case Ye:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case nn:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case Cn:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Be:return{point:"always",geoshape:"always"};case Pr:return{text:"always"};case ci:return{point:"always",square:"always",text:"always"};case Ks:return{image:"always"};case dt:return{text:"always",arc:"always"};case $t:return{text:"always",arc:"always"};case tn:case en:return{arc:"always"}}}function Qo(e){switch(e){case le:case Oe:case dt:case $t:case nn:case ci:case Sn:case rn:case An:case wn:case ft:case jt:case tn:case en:return;case Xs:case Ht:case qt:case Be:case Cn:case Pr:case ei:case Js:case Ks:case Qs:return"discrete";case Le:case Nt:case kt:return"flexible";case Dt:case Tt:case gt:case Ye:case Rr:case Ys:case Ir:return}}function xd(e){return Mi(e)&&(e=po(e,void 0)),"bin"+y(e).map(t=>to(e[t])?ae(`_${t}_${Dr(e[t])}`):ae(`_${t}_${e[t]}`)).join("")}function ue(e){return e===!0||Lr(e)&&!e.binned}function je(e){return e==="binned"||Lr(e)&&e.binned===!0}function Lr(e){return ye(e)}function to(e){return e==null?void 0:e.selection}function ml(e){switch(e){case Ht:case qt:case nn:case Le:case Nt:case kt:case Sn:case rn:case An:case wn:case Be:return 6;case Cn:return 4;default:return 10}}function wu(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const kb='Autosize "fit" only works for single views and layered views.';function bl(e){return`${e=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function yl(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function vl(e){return e?`Dropping "fit-${e}" because spec has discrete ${It(e)}.`:'Dropping "fit" because spec has discrete size.'}function Su(e){return`Unknown field for ${e}. Cannot calculate view size.`}function Ol(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function Pb(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function Ib(e){return`The "nearest" transform is not supported for ${e} marks.`}function Ad(e){return`Selection not supported for ${e} yet.`}function Rb(e){return`Cannot find a selection named "${e}".`}const Lb="Scale bindings are currently only supported for scales with unbinned, continuous domains.",Bb="Legend bindings are only supported for selections over an individual field or encoding channel.";function zb(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}const Mb="The same selection must be used to override scale domains in a layered view.",Ub='Interval selections should be initialized using "x" and/or "y" keys.';function Wb(e){return`Unknown repeated value "${e}".`}function El(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const Gb="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function Hb(e){return`Unrecognized parse "${e}".`}function xl(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}const qb="Attempt to add the same child twice.";function Vb(e){return`Ignoring an invalid transform: ${se(e)}.`}const Xb='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function Al(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function Yb(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${se(t)} is overridden by a child projection ${se(n)}.`}const Jb="Arc marks uses theta channel rather than angle, replacing angle with theta.";function Kb(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${se(n)}}.`}function wd(e){return`Invalid field type "${e}".`}function Qb(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function Zb(e){return`Invalid aggregation operator "${e}".`}function Sd(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function _a(e,t){return`Dropping ${se(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const ey="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function no(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function ty(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function ny(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function iy(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function Zo(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function ry(e){return`The ${e} for range marks cannot be an expression`}function sy(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function oy(e,t){return`Specified orient "${e}" overridden with "${t}".`}const ay=`Scale's "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.`;function uy(e){return`Cannot use the scale property "${e}" with non-color channel.`}function cy(e){return`Using unaggregated domain with raw field has no effect (${se(e)}).`}function ly(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function fy(e){return`Unaggregated domain is currently unsupported for log scale (${se(e)}).`}function dy(e){return`Cannot apply size to non-oriented mark "${e}".`}function gy(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function py(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function Cd(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function _d(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function hy(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${se(n)} and ${se(i)}). Using ${se(n)}.`}function my(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${se(n)} and ${se(i)}). Using the union of the two domains.`}function by(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function yy(e){return`Dropping sort property ${se(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const wl="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",vy="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",Oy="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",Ey="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function xy(e){return`Cannot stack "${e}" if there is already "${e}2".`}function Ay(e){return`Cannot stack non-linear scale (${e}).`}function wy(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function Es(e,t){return`Invalid ${e}: ${se(t)}.`}function Sy(e){return`Dropping day from datetime ${se(e)} as day cannot be combined with other units.`}function Cy(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function _y(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function Fy(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function Sl(e){return`1D error band does not support ${e}.`}function Fd(e){return`Channel ${e} is required for "binned" bin.`}function jy(e){return`Channel ${e} should not be used with "binned" bin.`}function $y(e){return`Domain for ${e} is required for threshold scale.`}globalThis&&globalThis.__classPrivateFieldSet;globalThis&&globalThis.__classPrivateFieldGet;const jd=mh(bh);let Di=jd;function Dy(e){return Di=e,Di}function Ty(){return Di=jd,Di}function O(...e){Di.warn(...e)}function Ny(...e){Di.debug(...e)}function fi(e){if(e&&ye(e)){for(const t of _u)if(t in e)return!0}return!1}const $d=["january","february","march","april","may","june","july","august","september","october","november","december"],ky=$d.map(e=>e.substr(0,3)),Dd=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Py=Dd.map(e=>e.substr(0,3));function Iy(e){if(Vs(e)&&(e=+e),be(e))return e>4&&O(Es("quarter",e)),e-1;throw new Error(Es("quarter",e))}function Ry(e){if(Vs(e)&&(e=+e),be(e))return e-1;{const t=e.toLowerCase(),n=$d.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=ky.indexOf(i);if(r!==-1)return r;throw new Error(Es("month",e))}}function Ly(e){if(Vs(e)&&(e=+e),be(e))return e%7;{const t=e.toLowerCase(),n=Dd.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Py.indexOf(i);if(r!==-1)return r;throw new Error(Es("day",e))}}function Cu(e,t){const n=[];if(t&&e.day!==void 0&&y(e).length>1&&(O(Sy(e)),e=G(e),delete e.day),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?Ry(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?Iy(e.quarter):e.quarter;n.push(be(i)?i*3:i+"*3")}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?Ly(e.day):e.day;n.push(be(i)?i+1:i+"+1")}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r>"u"?0:r)}return n}function Er(e){const n=Cu(e,!0).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function By(e){const n=Cu(e,!1).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function zy(e){const t=Cu(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}var My=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Td={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},_u=y(Td);function Uy(e){return!!Td[e]}function Fu(e){return e.startsWith("utc")}function Wy(e){return e.substr(3)}const Gy={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function ju(e){const t=[];for(const n of _u)Nd(e,n)&&t.push(n);return t}function Nd(e,t){const n=e.indexOf(t);return!(n<0||n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o"||n>0&&t==="year"&&e.charAt(n-1)==="f")}function Hy(e,t,{end:n}={end:!1}){const i=bu(t),r=Fu(e)?"utc":"";function s(u){return u==="quarter"?`(${r}quarter(${i})-1)`:`${r}${u}(${i})`}let o;const a={};for(const u of _u)Nd(e,u)&&(a[u]=s(u),o=u);return n&&(a[o]+="+1"),By(a)}function kd(e){if(!e)return;const t=ju(e);return`timeUnitSpecifier(${yr(t)}, ${yr(Gy)})`}function qy(e,t,n){if(!e)return;const i=kd(e);return`${n||Fu(e)?"utc":"time"}Format(${t}, ${i})`}function Te(e){if(!e)return;let t;return W(e)?t={unit:e}:ye(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),Fu(t.unit)&&(t.utc=!0,t.unit=Wy(t.unit)),t}function Vy(e){const t=Te(e),{utc:n}=t,i=My(t,["utc"]);return i.unit?(n?"utc":"")+y(i).map(r=>ae(`${r==="unit"?"":`_${r}_`}${i[r]}`)).join(""):(n?"utc":"")+"timeunit"+y(i).map(r=>ae(`_${r}_${i[r]}`)).join("")}function z(e){return e&&!!e.signal}function jn(e){return!!e.step}function Xy(e){return I(e)?!1:"fields"in e&&!("data"in e)}function Yy(e){return I(e)?!1:"fields"in e&&"data"in e}function Wt(e){return I(e)?!1:"field"in e&&"data"in e}const Jy={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},Ky=y(Jy),Qy={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Fa=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function Zy(e){return e==null?void 0:e.selection}function $u(e){return e&&!!e.field&&e.equal!==void 0}function Du(e){return e&&!!e.field&&e.lt!==void 0}function Tu(e){return e&&!!e.field&&e.lte!==void 0}function Nu(e){return e&&!!e.field&&e.gt!==void 0}function ku(e){return e&&!!e.field&&e.gte!==void 0}function Pu(e){if(e&&e.field){if(I(e.range)&&e.range.length===2)return!0;if(z(e.range))return!0}return!1}function Iu(e){return e&&!!e.field&&(I(e.oneOf)||I(e.in))}function ev(e){return e&&!!e.field&&e.valid!==void 0}function Pd(e){return Iu(e)||$u(e)||Pu(e)||Du(e)||Nu(e)||Tu(e)||ku(e)}function yt(e,t){return ho(e,{timeUnit:t,wrapTime:!0})}function tv(e,t){return e.map(n=>yt(n,t))}function Id(e,t=!0){var n;const{field:i}=e,r=(n=Te(e.timeUnit))===null||n===void 0?void 0:n.unit,s=r?"time("+Hy(r,i)+")":C(e,{expr:"datum"});if($u(e))return s+"==="+yt(e.equal,r);if(Du(e)){const o=e.lt;return`${s}<${yt(o,r)}`}else if(Nu(e)){const o=e.gt;return`${s}>${yt(o,r)}`}else if(Tu(e)){const o=e.lte;return`${s}<=${yt(o,r)}`}else if(ku(e)){const o=e.gte;return`${s}>=${yt(o,r)}`}else{if(Iu(e))return`indexof([${tv(e.oneOf,r).join(",")}], ${s}) !== -1`;if(ev(e))return Ru(s,e.valid);if(Pu(e)){const{range:o}=e,a=z(o)?{signal:`${o.signal}[0]`}:o[0],u=z(o)?{signal:`${o.signal}[1]`}:o[1];if(a!==null&&u!==null&&t)return"inrange("+s+", ["+yt(a,r)+", "+yt(u,r)+"])";const c=[];return a!==null&&c.push(`${s} >= ${yt(a,r)}`),u!==null&&c.push(`${s} <= ${yt(u,r)}`),c.length>0?c.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function Ru(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function nv(e){var t;return Pd(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=Te(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const Br={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},ti=Br.quantitative,Lu=Br.ordinal,Ti=Br.temporal,Bu=Br.nominal,Hi=Br.geojson;function iv(e){if(e)switch(e=e.toLowerCase(),e){case"q":case ti:return"quantitative";case"t":case Ti:return"temporal";case"o":case Lu:return"ordinal";case"n":case Bu:return"nominal";case Hi:return"geojson"}}var rv=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const me={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},ja={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function sv(e,t){const n=ja[e],i=ja[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const ov={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function Cl(e){return ov[e]}const Rd=["linear","log","pow","sqrt","symlog","time","utc"],av=ui(Rd),uv=["linear","log","pow","sqrt","symlog"],cv=ui(uv);function lv(e){return e in cv}const fv=["quantile","quantize","threshold"],dv=ui(fv),gv=Rd.concat(["quantile","quantize","threshold","sequential","identity"]),pv=ui(gv),hv=["ordinal","bin-ordinal","point","band"],mv=ui(hv);function ze(e){return e in mv}function Ke(e){return e in pv}function st(e){return e in av}function xs(e){return e in dv}const bv={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function yv(e){return!W(e)&&!!e.name}function Ld(e){return e==null?void 0:e.selection}function vv(e){return e&&e.unionWith}const Ov={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},Ev=rv(Ov,["type","domain","range","rangeMax","rangeMin","scheme"]),xv=y(Ev);function $a(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!L(["point","band","identity"],e);case"bins":return!L(["point","band","identity","ordinal"],e);case"round":return st(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return st(e)||L(["point","band"],e);case"paddingOuter":case"align":return L(["point","band"],e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"clamp":return st(e);case"nice":return st(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return Ke(e)&&!L(["log","time","utc","threshold","quantile"],e)}}function Bd(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Si(e)?void 0:uy(e);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function Av(e,t){return L([Lu,Bu],t)?e===void 0||ze(e):t===Ti?L([me.TIME,me.UTC,void 0],e):t===ti?L([me.LOG,me.POW,me.SQRT,me.SYMLOG,me.QUANTILE,me.QUANTIZE,me.THRESHOLD,me.LINEAR,void 0],e):!0}function wv(e,t){if(!Fn(e))return!1;switch(e){case le:case Oe:case dt:case $t:return st(t)||L(["band","point"],t);case nn:case Sn:case rn:case An:case wn:case ci:return st(t)||xs(t)||L(["band","point","ordinal"],t);case Le:case Nt:case kt:return t!=="band";case Cn:return t==="ordinal"||xs(t);case Be:return t==="ordinal"}}function zr(e){return e&&!!e.expr}function it(e){const t=y(e||{}),n={};for(const i of t)n[i]=$e(e[i]);return n}const ke={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},zd=ke.arc,io=ke.area,ro=ke.bar,Sv=ke.image,so=ke.line,oo=ke.point,Cv=ke.rect,As=ke.rule,Md=ke.text,zu=ke.tick,_v=ke.trail,Mu=ke.circle,Uu=ke.square,Ud=ke.geoshape;function $n(e){return L(["line","area","trail"],e)}function _l(e){return L(["rect","bar","image","arc"],e)}const Wd=y(ke);function Zt(e){return e.type}ui(Wd);const Fv=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],jv=["fill","fillOpacity"],$v=[...Fv,...jv],Dv={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1},Fl=y(Dv),Tv={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},Nv={color:"#4c78a8",invalid:"filter",timeUnitBand:1},kv={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},Gd=y(kv),Pv={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},Hd=5,Iv={binSpacing:1,continuousBandSize:Hd,timeUnitBandPosition:.5},Rv={binSpacing:0,continuousBandSize:Hd,timeUnitBandPosition:.5},Lv={thickness:1};function Bv(e){return Zt(e)?e.type:e}function Wu(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:s}=e,o=Vd(e);return F(n)&&!dd(n.aggregate)&&r&&st(r.get("type"))&&r.get("zero")===!1?qd({fieldDef:n,channel:t,markDef:i,ref:o,config:s}):o}function qd({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){return $n(n.type)||Z("invalid",n,r)===null?i:[zv(e,t),i]}function zv(e,t){const n=Gu(e,!0),r=li(t)==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function Gu(e,t=!0){return Ru(W(e)?e:C(e,{expr:"datum"}),!t)}function Mv(e){const{datum:t}=e;return fi(t)?Er(t):`${JSON.stringify(t)}`}function Xn(e,t,n,i){const r={};if(t&&(r.scale=t),Dn(e)){const{datum:s}=e;fi(s)?r.signal=Er(s):z(s)?r.signal=s.signal:zr(s)?r.signal=s.expr:r.value=s}else r.field=C(e,n);if(i){const{offset:s,band:o}=i;s&&(r.offset=s),o&&(r.band=o)}return r}function ws({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,band:s=.5}){const o=0<s&&s<1?"datum":void 0,a=C(t,{expr:o,suffix:r}),u=n!==void 0?C(n,{expr:o}):C(t,{suffix:"end",expr:o}),c={};if(s===0||s===1){c.scale=e;const l=s===0?a:u;c.field=l}else{const l=`${s} * ${a} + ${1-s} * ${u}`;c.signal=`scale("${e}", ${l})`}return i&&(c.offset=i),c}function Vd({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:u,defaultRef:c,band:l}){var f;if(t){if(M(t)){if(Qe(t)){l=l!=null?l:Ur({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:a,config:r,isMidPoint:!0});const{bin:g,timeUnit:p,type:m}=t;if(ue(g)||l&&p&&m===Ti)return a&&a.impute?Xn(t,s,{binSuffix:"mid"},{offset:u}):l?ws({scaleName:s,fieldOrDatumDef:t,band:l,offset:u}):Xn(t,s,Wr(t,e)?{binSuffix:"range"}:{},{offset:u});if(je(g)){if(F(n))return ws({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:l,offset:u});O(Fd(e===le?ft:jt))}}const d=o==null?void 0:o.get("type");return Xn(t,s,ze(d)?{binSuffix:"range"}:{},{offset:u,band:d==="band"?(f=l!=null?l:t.band)!==null&&f!==void 0?f:.5:void 0})}else if(ut(t)){const d=t.value,g=u?{offset:u}:{};return Object.assign(Object.assign({},gr(e,d)),g)}}return yh(c)&&(c=c()),c&&Object.assign(Object.assign({},c),u?{offset:u}:{})}function gr(e,t){return L(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:L(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:ce(t)}function ni(e){return e&&e!=="number"&&e!=="time"}function Xd(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}const Uv=" – ";function Hu({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s}){var o,a;if(ni(n))return qu({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:s});const u=Yd(e,i,r);if(Ni(e)){const c=Gv(u,F(e)?(o=Te(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0,t,s.timeFormat,go(e)&&((a=e.scale)===null||a===void 0?void 0:a.type)===me.UTC);return c?{signal:c}:void 0}if(t=Qd(dn(e),t,s),F(e)&&ue(e.bin)){const c=C(e,{expr:i,binSuffix:"end"});return{signal:ao(u,c,t,n,s)}}else return t||dn(e)==="quantitative"?{signal:`${Zd(u,t)}`}:{signal:`isValid(${u}) ? ${u} : ""+${u}`}}function Yd(e,t,n){return F(e)?n?`${C(e,{expr:t,suffix:"end"})}-${C(e,{expr:t,suffix:"start"})}`:C(e,{expr:t}):Mv(e)}function qu({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s,field:o}){if(o=o!=null?o:Yd(e,i,r),F(e)&&ue(e.bin)){const a=C(e,{expr:i,binSuffix:"end"});return{signal:ao(o,a,t,n,s)}}return{signal:Xd(n,o,t)}}function Jd(e,t,n,i,r,s){var o;if(!ni(i)){if(Ni(e)){const a=F(e)?(o=Te(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0;return Wv(n,a,r,s)}return Qd(t,n,r)}}function Kd(e,t,n){if(e&&(z(e)||e==="number"||e==="time"))return e;if(Ni(t)&&n!=="time"&&n!=="utc")return"time"}function Qd(e,t,n){if(W(t))return t;if(e===ti)return n.numberFormat}function Wv(e,t,n,i){return e||(t?{signal:kd(t)}:i?void 0:n.timeFormat)}function Zd(e,t){return`format(${e}, "${t||""}")`}function jl(e,t,n,i){var r;return ni(n)?Xd(n,e,t):Zd(e,(r=W(t)?t:void 0)!==null&&r!==void 0?r:i.numberFormat)}function ao(e,t,n,i,r){const s=jl(e,n,i,r),o=jl(t,n,i,r);return`${Ru(e,!1)} ? "null" : ${s} + "${Uv}" + ${o}`}function Gv(e,t,n,i,r){return!t||n?(n=W(n)?n:i,`${r?"utc":"time"}Format(${e}, '${n}')`):qy(t,e,r)}const uo="min",Hv={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function $l(e){return e in Hv}function eg(e){return!!e&&!!e.encoding}function xt(e){return!!e&&(e.op==="count"||!!e.field)}function tg(e){return!!e&&I(e)}function Mr(e){return"row"in e||"column"in e}function Vu(e){return!!e&&"header"in e}function co(e){return"facet"in e}var Da=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function qv(e){return e.selection}function Vv(e){return e&&!W(e)&&"repeat"in e}function Dl(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function Xu(e){return"sort"in e}function Ur({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:r,config:s,isMidPoint:o}){if(M(t)&&t.band!==void 0)return t.band;if(F(t)){const{timeUnit:a,bin:u}=t;if(a&&!n)return o?ii("timeUnitBandPosition",i,s):_l(i.type)?ii("timeUnitBand",i,s):0;if(ue(u))return _l(i.type)&&!o?1:.5}if((r==null?void 0:r.fieldChannel)===e&&o)return .5}function Yu(e,t,n,i,r,s){return ue(t.bin)||t.timeUnit&&Qe(t)&&t.type==="temporal"?!!Ur({channel:e,fieldDef:t,fieldDef2:n,stack:i,markDef:r,config:s}):!1}function Ju(e){return!!e&&"condition"in e}function lo(e){const t=e&&e.condition;return!!t&&!I(t)&&F(t)}function fo(e){const t=e&&e.condition;return!!t&&!I(t)&&M(t)}function Xv(e){const t=e&&e.condition;return!!t&&(I(t)||ut(t))}function F(e){return!!e&&(!!e.field||e.aggregate==="count")}function dn(e){return e&&e.type}function Dn(e){return!!e&&"datum"in e}function Et(e){return Qe(e)&&sg(e)||Ta(e)}function Ta(e){return Dn(e)&&be(e.datum)}function M(e){return F(e)||Dn(e)}function Qe(e){return!!e&&("field"in e||e.aggregate==="count")&&"type"in e}function ut(e){return e&&"value"in e&&"value"in e}function go(e){return!!e&&("scale"in e||"sort"in e)}function Ku(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function ng(e){return!!e&&"legend"in e}function ig(e){return!!e&&("format"in e||"formatType"in e)}function Yv(e){return Ge(e,["legend","axis","header","scale"])}function Jv(e){return"op"in e}function C(e,t={}){var n,i,r;let s=e.field;const o=t.prefix;let a=t.suffix,u="";if(Kv(e))s=ad("count");else{let c;if(!t.nofn)if(Jv(e))c=e.op;else{const{bin:l,aggregate:f,timeUnit:d}=e;ue(l)?(c=xd(l),a=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((i=t.suffix)!==null&&i!==void 0?i:"")):f?xn(f)?(u=`["${s}"]`,s=`argmax_${f.argmax}`):Qt(f)?(u=`["${s}"]`,s=`argmin_${f.argmin}`):c=String(f):d&&(c=Vy(d),a=(!L(["range","mid"],t.binSuffix)&&t.binSuffix||"")+((r=t.suffix)!==null&&r!==void 0?r:""))}c&&(s=s?`${c}_${s}`:c)}return a&&(s=`${s}_${a}`),o&&(s=`${o}_${s}`),t.forAs?yu(s):t.expr?rd(s,t.expr)+u:Kt(s)+u}function rg(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return F(e)&&!!e.bin;case"temporal":return!1}throw new Error(wd(e.type))}function sg(e){return!rg(e)}function Kv(e){return e.aggregate==="count"}function Qv(e,t){var n;const{field:i,bin:r,timeUnit:s,aggregate:o}=e;if(o==="count")return t.countTitle;if(ue(r))return`${i} (binned)`;if(s){const a=(n=Te(s))===null||n===void 0?void 0:n.unit;if(a)return`${i} (${ju(a).join("-")})`}else if(o)return xn(o)?`${i} for max ${o.argmax}`:Qt(o)?`${i} for min ${o.argmin}`:`${Tr(o)} of ${i}`;return i}function Zv(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(xn(t))return`${r} for argmax(${t.argmax})`;if(Qt(t))return`${r} for argmin(${t.argmin})`;const s=Te(i),o=t||(s==null?void 0:s.unit)||(s==null?void 0:s.maxbins)&&"timeunit"||ue(n)&&"bin";return o?o.toUpperCase()+"("+r+")":r}const og=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return Zv(e);default:return Qv(e,t)}};let ag=og;function ug(e){ag=e}function eO(){ug(og)}function Ci(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,s;const o=(r=Qu(e))===null||r===void 0?void 0:r.title;if(!F(e))return o;const a=e,u=i?Zu(a,t):void 0;return n?pe(o,a.title,u):(s=o!=null?o:a.title)!==null&&s!==void 0?s:u}function Qu(e){if(Ku(e)&&e.axis)return e.axis;if(ng(e)&&e.legend)return e.legend;if(Vu(e)&&e.header)return e.header}function Zu(e,t){return ag(e,t)}function Ss(e){var t;if(ig(e)){const{format:n,formatType:i}=e;return{format:n,formatType:i}}else{const n=(t=Qu(e))!==null&&t!==void 0?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function tO(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(Xu(e)&&I(e.sort))return"ordinal";const{aggregate:i,bin:r,timeUnit:s}=e;if(s)return"temporal";if(r||i&&!xn(i)&&!Qt(i))return"quantitative";if(go(e)&&(!((n=e.scale)===null||n===void 0)&&n.type))switch(ja[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function Ct(e){if(F(e))return e;if(lo(e))return e.condition}function ve(e){if(M(e))return e;if(fo(e))return e.condition}function cg(e,t,n,i={}){if(W(e)||be(e)||Mi(e)){const r=W(e)?"string":be(e)?"number":"boolean";return O(Kb(t,r,e)),{value:e}}return M(e)?Cs(e,t,n,i):fo(e)?Object.assign(Object.assign({},e),{condition:Cs(e.condition,t,n,i)}):e}function Cs(e,t,n,i){if(ig(e)){const{format:r,formatType:s}=e,o=Da(e,["format","formatType"]);if(ni(s)&&!n.customFormatTypes)return O(Al(t)),Cs(o,t,n,i)}else{const r=Ku(e)?"axis":ng(e)?"legend":Vu(e)?"header":null;if(r&&e[r]){const s=e[r],{format:o,formatType:a}=s,u=Da(s,["format","formatType"]);if(ni(a)&&!n.customFormatTypes)return O(Al(t)),Cs(Object.assign(Object.assign({},e),{[r]:u}),t,n,i)}}return F(e)?ec(e,t,i):nO(e)}function nO(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=be(n)?"quantitative":W(n)?"nominal":fi(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}function ec(e,t,{compositeMark:n=!1}={}){const{aggregate:i,timeUnit:r,bin:s,field:o}=e,a=Object.assign({},e);if(!n&&i&&!vu(i)&&!xn(i)&&!Qt(i)&&(O(Zb(i)),delete a.aggregate),r&&(a.timeUnit=Te(r)),o&&(a.field=`${o}`),ue(s)&&(a.bin=po(s,t)),je(s)&&!St(t)&&O(jy(t)),Qe(a)){const{type:u}=a,c=iv(u);u!==c&&(a.type=c),u!=="quantitative"&&dd(i)&&(O(Qb(u,i)),a.type="quantitative")}else if(!yd(t)){const u=tO(a,t);a.type=u}if(Qe(a)){const{compatible:u,warning:c}=iO(a,t)||{};u===!1&&O(c)}if(Xu(a)&&W(a.sort)){const{sort:u}=a;if($l(u))return Object.assign(Object.assign({},a),{sort:{encoding:u}});const c=u.substr(1);if(u.charAt(0)==="-"&&$l(c))return Object.assign(Object.assign({},a),{sort:{encoding:c,order:"descending"}})}if(Vu(a)){const{header:u}=a,{orient:c}=u,l=Da(u,["orient"]);if(c)return Object.assign(Object.assign({},a),{header:Object.assign(Object.assign({},l),{labelOrient:u.labelOrient||c,titleOrient:u.titleOrient||c})})}return a}function po(e,t){return Mi(e)?{maxbins:ml(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?Object.assign(Object.assign({},e),{maxbins:ml(t)}):e}const Pn={compatible:!0};function iO(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case Ht:case qt:case Xs:return sg(e)?{compatible:!1,warning:ny(t)}:Pn;case le:case Oe:case Le:case Nt:case kt:case Pr:case Rr:case Ys:case ei:case Js:case Ks:case ci:case dt:case $t:case Qs:return Pn;case Tt:case Ye:case Dt:case gt:return n!==ti?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:Pn;case rn:case An:case wn:case Sn:case nn:case tn:case en:case ft:case jt:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:Pn;case Cn:return L(["ordinal","nominal"],e.type)?Pn:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case Be:return L(["ordinal","nominal","geojson"],e.type)?Pn:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case Ir:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:Pn}}function Ni(e){const{formatType:t}=Ss(e);return t==="time"||!t&&rO(e)}function rO(e){return e&&(e.type==="temporal"||F(e)&&!!e.timeUnit)}function ho(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var s;const o=t&&((s=Te(t))===null||s===void 0?void 0:s.unit);let a=o||n==="temporal",u;return zr(e)?u=e.expr:z(e)?u=e.signal:fi(e)?(a=!0,u=Er(e)):(W(e)||be(e))&&a&&(u=`datetime(${JSON.stringify(e)})`,Uy(o)&&(be(e)&&e<1e4||W(e)&&isNaN(Date.parse(e)))&&(u=Er({[o]:e}))),u?i&&a?`time(${u})`:u:r?void 0:JSON.stringify(e)}function lg(e,t){const{type:n}=e;return t.map(i=>{const r=ho(i,{timeUnit:F(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return r!==void 0?{signal:r}:i})}function Wr(e,t){return ue(e.bin)?Fn(t)&&L(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}var sO=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function fg(e){const{anchor:t,frame:n,offset:i,orient:r,color:s,subtitleColor:o,subtitleFont:a,subtitleFontSize:u,subtitleFontStyle:c,subtitleFontWeight:l,subtitleLineHeight:f,subtitlePadding:d}=e,g=sO(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},g),s?{fill:s}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),h=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),a?{subtitleFont:a}:{}),u?{subtitleFontSize:u}:{}),c?{subtitleFontStyle:c}:{}),l?{subtitleFontWeight:l}:{}),f?{subtitleLineHeight:f}:{}),d?{subtitlePadding:d}:{}),E=Fi(p,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:p,subtitleMarkConfig:E,nonMark:m,subtitle:h}}function gn(e){return W(e)||I(e)&&W(e[0])}var tc=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function dg(e){const t=I(e.condition)?e.condition.map(Tl):Tl(e.condition);return Object.assign(Object.assign({},$e(e)),{condition:t})}function $e(e){if(zr(e)){const{expr:t}=e,n=tc(e,["expr"]);return Object.assign({signal:t},n)}return e}function Tl(e){if(zr(e)){const{expr:t}=e,n=tc(e,["expr"]);return Object.assign({signal:t},n)}return e}function ce(e){if(zr(e)){const{expr:t}=e,n=tc(e,["expr"]);return Object.assign({signal:t},n)}return z(e)?e:e!==void 0?{value:e}:void 0}function Nl(e){return z(e)?e.signal:Y(e.value)}function Vt(e){return z(e)?e.signal:e==null?null:Y(e)}function oO(e,t,n){for(const i of n){const r=ii(i,t.markDef,t.config);r!==void 0&&(e[i]=ce(r))}return e}function gg(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function Z(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:s}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:s&&(!r||r===e)?void 0:ii(e,t,n,i)}function ii(e,t,n,{vgChannel:i}={}){return pe(i?_s(e,t,n.style):void 0,_s(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function _s(e,t,n){return pg(e,gg(t),n)}function pg(e,t,n){t=ge(t);let i;for(const r of t){const s=n[r];s&&s[e]!==void 0&&(i=s[e])}return i}function hg(e,t){return ge(e).reduce((n,i)=>{var r;return n.field.push(C(i,t)),n.order.push((r=i.sort)!==null&&r!==void 0?r:"ascending"),n},{field:[],order:[]})}function mg(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(Gi(r,i))return;n.push(i)}),n}function bg(e,t){return Gi(e,t)||!t?e:e?[...ge(e),...ge(t)].join(", "):t}function yg(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((gn(n)||z(n))&&(gn(i)||z(i)))return{explicit:e.explicit,value:bg(n,i)};if(gn(n)||z(n))return{explicit:e.explicit,value:n};if(gn(i)||z(i))return{explicit:e.explicit,value:i};if(!gn(n)&&!z(n)&&!gn(i)&&!z(i))return{explicit:e.explicit,value:mg(n,i)};throw new Error("It should never reach here")}function sn(e){return"mark"in e}class mo{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return sn(t)?Bv(t.mark)===this.name:!1}}var aO=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Yn(e,t){const n=e&&e[t];return n?I(n)?ji(n,i=>!!i.field):F(n)||lo(n):!1}function nc(e){return ji(Ob,t=>{if(Yn(e,t)){const n=e[t];if(I(n))return ji(n,i=>!!i.aggregate);{const i=Ct(n);return i&&!!i.aggregate}}return!1})}function vg(e,t){const n=[],i=[],r=[],s=[],o={};return ic(e,(a,u)=>{if(F(a)){const{field:c,aggregate:l,bin:f,timeUnit:d}=a,g=aO(a,["field","aggregate","bin","timeUnit"]);if(l||d||f){const p=Qu(a),m=p&&p.title;let h=C(a,{forAs:!0});const E=Object.assign(Object.assign(Object.assign({},m?[]:{title:Ci(a,t,{allowDisabling:!0})}),g),{field:h});if(l){let v;if(xn(l)?(v="argmax",h=C({op:"argmax",field:l.argmax},{forAs:!0}),E.field=`${h}.${c}`):Qt(l)?(v="argmin",h=C({op:"argmin",field:l.argmin},{forAs:!0}),E.field=`${h}.${c}`):l!=="boxplot"&&l!=="errorbar"&&l!=="errorband"&&(v=l),v){const S={op:v,as:h};c&&(S.field=c),s.push(S)}}else if(n.push(h),Qe(a)&&ue(f)){if(i.push({bin:f,field:c,as:h}),n.push(C(a,{binSuffix:"end"})),Wr(a,u)&&n.push(C(a,{binSuffix:"range"})),St(u)){const v={field:h+"_end"};o[u+"2"]=v}E.bin="binned",yd(u)||(E.type=ti)}else if(d){r.push({timeUnit:d,field:c,as:h});const v=Qe(a)&&a.type!==Ti&&"time";v&&(u===Pr||u===ei?E.formatType=v:jb(u)?E.legend=Object.assign({formatType:v},E.legend):St(u)&&(E.axis=Object.assign({formatType:v},E.axis)))}o[u]=E}else n.push(c),o[u]=e[u]}else o[u]=e[u]}),{bins:i,timeUnits:r,aggregate:s,groupby:n,encoding:o}}function uO(e,t,n){const i=Db(t,n);if(i){if(i==="binned"){const r=e[t===ft?le:Oe];return!!(F(r)&&F(e[t])&&je(r.bin))}}else return!1;return!0}function cO(e,t,n,i){return y(e).reduce((r,s)=>{if(!bd(s))return O(ty(s)),r;const o=e[s];if(s==="angle"&&t==="arc"&&!e.theta&&(O(Jb),s=dt),!uO(e,s,t))return O(no(s,t)),r;if(s===nn&&t==="line"){const a=Ct(e[s]);if(a!=null&&a.aggregate)return O(ey),r}if(s===Le&&(n?"fill"in e:"stroke"in e))return O(Sd("encoding",{fill:"fill"in e,stroke:"stroke"in e})),r;if(s===Rr||s===Ir&&!I(o)&&!ut(o)||s===ei&&I(o))o&&(r[s]=ge(o).reduce((a,u)=>(F(u)?a.push(ec(u,s)):O(_a(u,s)),a),[]));else{if(s===ei&&o===null)r[s]=null;else if(!F(o)&&!Dn(o)&&!ut(o)&&!Ju(o)&&!z(o))return O(_a(o,s)),r;r[s]=cg(o,s,i)}return r},{})}function bo(e,t){const n={};for(const i of y(e)){const r=cg(e[i],i,t,{compositeMark:!0});n[i]=r}return n}function lO(e){const t=[];for(const n of y(e))if(Yn(e,n)){const i=e[n],r=ge(i);for(const s of r)F(s)?t.push(s):lo(s)&&t.push(s.condition)}return t}function ic(e,t,n){if(e)for(const i of y(e)){const r=e[i];if(I(r))for(const s of r)t.call(n,s,i);else t.call(n,r,i)}}function fO(e,t,n,i){return e?y(e).reduce((r,s)=>{const o=e[s];return I(o)?o.reduce((a,u)=>t.call(i,a,u,s),r):t.call(i,r,o,s)},n):n}function Og(e,t){return y(t).reduce((n,i)=>{switch(i){case le:case Oe:case Js:case Qs:case Ks:case ft:case jt:case dt:case tn:case $t:case en:case Dt:case Tt:case gt:case Ye:case Pr:case Be:case ci:case ei:return n;case Ir:if(e==="line"||e==="trail")return n;case Rr:case Ys:{const r=t[i];if(I(r)||F(r))for(const s of ge(r))s.aggregate||n.push(C(s,{}));return n}case nn:if(e==="trail")return n;case Le:case Nt:case kt:case rn:case An:case wn:case Cn:case Sn:{const r=Ct(t[i]);return r&&!r.aggregate&&n.push(C(r,{})),n}}},[])}var Eg=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function dO(e){const{tooltip:t}=e,n=Eg(e,["tooltip"]);if(!t)return{filteredEncoding:n};let i,r;if(I(t)){for(const s of t)s.aggregate?(i||(i=[]),i.push(s)):(r||(r=[]),r.push(s));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return I(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function Na(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:o,titlePrefix:a})=>{const u=i?` of ${rc(t)}`:"";return{field:o+t.field,type:t.type,title:z(a)?{signal:a+`"${escape(u)}"`}:a+u}}),s=lO(n).map(Yv);return{tooltip:[...r,...Ot(s,V)]}}function rc(e){const{title:t,field:n}=e;return pe(t,n)}function sc(e,t,n,i,r){const{scale:s,axis:o}=n;return({partName:a,mark:u,positionPrefix:c,endPositionPrefix:l=void 0,extraEncoding:f={}})=>{const d=rc(n);return xg(e,a,r,{mark:u,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:c+"_"+n.field,type:n.type},d!==void 0?{title:d}:{}),s!==void 0?{scale:s}:{}),o!==void 0?{axis:o}:{})},W(l)?{[t+"2"]:{field:l+"_"+n.field}}:{}),i),f)})}}function xg(e,t,n,i){const{clip:r,color:s,opacity:o}=e,a=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),r?{clip:r}:{}),s?{color:s}:{}),o?{opacity:o}:{}),Zt(i.mark)?i.mark:{type:i.mark}),{style:`${a}-${t}`}),Mi(e[t])?{}:e[t])})]:[]}function Ag(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",s=i[r],o=i[r+"2"],a=i[r+"Error"],u=i[r+"Error2"];return{continuousAxisChannelDef:es(s,n),continuousAxisChannelDef2:es(o,n),continuousAxisChannelDefError:es(a,n),continuousAxisChannelDefError2:es(u,n),continuousAxis:r}}function es(e,t){if(e&&e.aggregate){const{aggregate:n}=e,i=Eg(e,["aggregate"]);return n!==t&&O(Fy(n,t)),i}else return e}function wg(e,t){const{mark:n,encoding:i}=e,{x:r,y:s}=i;if(Zt(n)&&n.orient)return n.orient;if(Et(r)){if(Et(s)){const o=F(r)&&r.aggregate,a=F(s)&&s.aggregate;if(!o&&a===t)return"vertical";if(!a&&o===t)return"horizontal";if(o===t&&a===t)throw new Error("Both x and y cannot have aggregate");return Ni(s)&&!Ni(r)?"horizontal":"vertical"}return"horizontal"}else{if(Et(s))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}}var hs=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Fs="boxplot",gO=["box","median","outliers","rule","ticks"],pO=new mo(Fs,Cg);function Sg(e){return be(e)?"tukey":e}function Cg(e,{config:t}){var n,i;e=Object.assign(Object.assign({},e),{encoding:bo(e.encoding,t)});const{mark:r,encoding:s,selection:o,projection:a}=e,u=hs(e,["mark","encoding","selection","projection"]),c=Zt(r)?r:{type:r};o&&O(Ad("boxplot"));const l=(n=c.extent)!==null&&n!==void 0?n:t.boxplot.extent,f=Z("size",c,t),d=Sg(l),{bins:g,timeUnits:p,transform:m,continuousAxisChannelDef:h,continuousAxis:E,groupby:v,aggregate:S,encodingWithoutContinuousAxis:D,ticksOrient:x,boxOrient:N,customTooltipWithoutAggregatedField:w}=hO(e,l,t),{color:B,size:K}=D,ie=hs(D,["color","size"]),_=cn=>sc(c,E,h,cn,t.boxplot),A=_(ie),R=_(D),j=_(Object.assign(Object.assign({},ie),K?{size:K}:{})),k=Na([{fieldPrefix:d==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:d==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],h,D),$={type:"tick",color:"black",opacity:1,orient:x,invalid:null,aria:!1},P=d==="min-max"?k:Na([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],h,D),H=[...A({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:P}),...A({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:P}),...A({partName:"ticks",mark:$,positionPrefix:"lower_whisker",extraEncoding:P}),...A({partName:"ticks",mark:$,positionPrefix:"upper_whisker",extraEncoding:P})],U=[...d!=="tukey"?H:[],...R({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:N,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:k}),...j({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},ye(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:x,aria:!1}),positionPrefix:"mid_box",extraEncoding:k})];if(d==="min-max")return Object.assign(Object.assign({},u),{transform:((i=u.transform)!==null&&i!==void 0?i:[]).concat(m),layer:U});const q=`datum["lower_box_${h.field}"]`,he=`datum["upper_box_${h.field}"]`,Q=`(${he} - ${q})`,qe=`${q} - ${l} * ${Q}`,et=`${he} + ${l} * ${Q}`,Nn=`datum["${h.field}"]`,mi={joinaggregate:_g(h.field),groupby:v},bi={transform:[{filter:`(${qe} <= ${Nn}) && (${Nn} <= ${et})`},{aggregate:[{op:"min",field:h.field,as:"lower_whisker_"+h.field},{op:"max",field:h.field,as:"upper_whisker_"+h.field},{op:"min",field:"lower_box_"+h.field,as:"lower_box_"+h.field},{op:"max",field:"upper_box_"+h.field,as:"upper_box_"+h.field},...S],groupby:v}],layer:H},kn=hs(ie,["tooltip"]),{scale:an,axis:Qi}=h,Zi=rc(h),un=Ge(Qi,["title"]),er=xg(c,"outliers",t.boxplot,{transform:[{filter:`(${Nn} < ${qe}) || (${Nn} > ${et})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[E]:Object.assign(Object.assign(Object.assign({field:h.field,type:h.type},Zi!==void 0?{title:Zi}:{}),an!==void 0?{scale:an}:{}),te(un)?{}:{axis:un})},kn),B?{color:B}:{}),w?{tooltip:w}:{})})[0];let ht;const Uo=[...g,...p,mi];return er?ht={transform:Uo,layer:[er,bi]}:(ht=bi,ht.transform.unshift(...Uo)),Object.assign(Object.assign({},u),{layer:[ht,{transform:m,layer:U}]})}function _g(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}function hO(e,t,n){const i=wg(e,Fs),{continuousAxisChannelDef:r,continuousAxis:s}=Ag(e,i,Fs),o=r.field,a=Sg(t),u=[..._g(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:(a==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(a==="min-max"?"upper_whisker_":"max_")+o}],c=a==="min-max"||a==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],l=e.encoding,f=s;l[f];const d=hs(l,[typeof f=="symbol"?f:f+""]),{customTooltipWithoutAggregatedField:g,filteredEncoding:p}=dO(d),{bins:m,timeUnits:h,aggregate:E,groupby:v,encoding:S}=vg(p,n),D=i==="vertical"?"horizontal":"vertical",x=i,N=[...m,...h,{aggregate:[...E,...u],groupby:v},...c];return{bins:m,timeUnits:h,transform:N,groupby:v,aggregate:E,continuousAxisChannelDef:r,continuousAxis:s,encodingWithoutContinuousAxis:S,ticksOrient:D,boxOrient:x,customTooltipWithoutAggregatedField:g}}var kl=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const oc="errorbar",mO=["ticks","rule"],bO=new mo(oc,Fg);function Fg(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:bo(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:u,tooltipEncoding:c}=jg(e,oc,t);delete s.size;const l=sc(a,r,i,s,t.errorbar),f=a.thickness,d=a.size,g=Object.assign(Object.assign({type:"tick",orient:o,aria:!1},f!==void 0?{thickness:f}:{}),d!==void 0?{size:d}:{}),p=[...l({partName:"ticks",mark:g,positionPrefix:"lower",extraEncoding:c}),...l({partName:"ticks",mark:g,positionPrefix:"upper",extraEncoding:c}),...l({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},f!==void 0?{size:f}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:c})];return Object.assign(Object.assign(Object.assign({},u),{transform:n}),p.length>1?{layer:p}:Object.assign({},p[0]))}function yO(e,t){const{encoding:n}=e;if(vO(n))return{orient:wg(e,t),inputType:"raw"};const i=OO(n),r=EO(n),s=n.x,o=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const a=n.x2,u=n.y2;if(M(a)&&M(u))throw new Error(`${t} cannot have both x2 and y2`);if(M(a)){if(Et(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(M(u)){if(Et(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const a=n.xError,u=n.xError2,c=n.yError,l=n.yError2;if(M(u)&&!M(a))throw new Error(`${t} cannot have xError2 without xError`);if(M(l)&&!M(c))throw new Error(`${t} cannot have yError2 without yError`);if(M(a)&&M(c))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(M(a)){if(Et(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(M(c)){if(Et(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function vO(e){return(M(e.x)||M(e.y))&&!M(e.x2)&&!M(e.y2)&&!M(e.xError)&&!M(e.xError2)&&!M(e.yError)&&!M(e.yError2)}function OO(e){return M(e.x2)||M(e.y2)}function EO(e){return M(e.xError)||M(e.xError2)||M(e.yError)||M(e.yError2)}function jg(e,t,n){var i;const{mark:r,encoding:s,selection:o,projection:a}=e,u=kl(e,["mark","encoding","selection","projection"]),c=Zt(r)?r:{type:r};o&&O(Ad(t));const{orient:l,inputType:f}=yO(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:g,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:m,continuousAxis:h}=Ag(e,l,t),{errorBarSpecificAggregate:E,postAggregateCalculates:v,tooltipSummary:S,tooltipTitleWithFieldName:D}=xO(c,d,g,p,m,f,t,n),x=s,N=h;x[N];const w=h==="x"?"x2":"y2";x[w];const B=h==="x"?"xError":"yError";x[B];const K=h==="x"?"xError2":"yError2";x[K];const ie=kl(x,[typeof N=="symbol"?N:N+"",typeof w=="symbol"?w:w+"",typeof B=="symbol"?B:B+"",typeof K=="symbol"?K:K+""]),{bins:_,timeUnits:A,aggregate:R,groupby:j,encoding:k}=vg(ie,n),$=[...R,...E],P=f!=="raw"?[]:j,H=Na(S,d,k,D);return{transform:[...(i=u.transform)!==null&&i!==void 0?i:[],..._,...A,...$.length===0?[]:[{aggregate:$,groupby:P}],...v],groupby:P,continuousAxisChannelDef:d,continuousAxis:h,encodingWithoutContinuousAxis:k,ticksOrient:l==="vertical"?"horizontal":"vertical",markDef:c,outerSpec:u,tooltipEncoding:H}}function xO(e,t,n,i,r,s,o,a){let u=[],c=[];const l=t.field;let f,d=!1;if(s==="raw"){const g=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":a.errorbar.center,p=e.extent?e.extent:g==="mean"?"stderr":"iqr";if(g==="median"!=(p==="iqr")&&O(_y(g,p,o)),p==="stderr"||p==="stdev")u=[{op:p,field:l,as:"extent_"+l},{op:g,field:l,as:"center_"+l}],c=[{calculate:`datum["center_${l}"] + datum["extent_${l}"]`,as:"upper_"+l},{calculate:`datum["center_${l}"] - datum["extent_${l}"]`,as:"lower_"+l}],f=[{fieldPrefix:"center_",titlePrefix:Tr(g)},{fieldPrefix:"upper_",titlePrefix:Pl(g,p,"+")},{fieldPrefix:"lower_",titlePrefix:Pl(g,p,"-")}],d=!0;else{let m,h,E;p==="ci"?(m="mean",h="ci0",E="ci1"):(m="median",h="q1",E="q3"),u=[{op:h,field:l,as:"lower_"+l},{op:E,field:l,as:"upper_"+l},{op:m,field:l,as:"center_"+l}],f=[{fieldPrefix:"upper_",titlePrefix:Ci({field:l,aggregate:E,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:Ci({field:l,aggregate:h,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:Ci({field:l,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&O(Cy(e.center,e.extent)),s==="aggregated-upper-lower"?(f=[],c=[{calculate:`datum["${n.field}"]`,as:"upper_"+l},{calculate:`datum["${l}"]`,as:"lower_"+l}]):s==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:l}],c=[{calculate:`datum["${l}"] + datum["${i.field}"]`,as:"upper_"+l}],r?c.push({calculate:`datum["${l}"] + datum["${r.field}"]`,as:"lower_"+l}):c.push({calculate:`datum["${l}"] - datum["${i.field}"]`,as:"lower_"+l}));for(const g of c)f.push({fieldPrefix:g.as.substring(0,6),titlePrefix:Zn(Zn(g.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:c,errorBarSpecificAggregate:u,tooltipSummary:f,tooltipTitleWithFieldName:d}}function Pl(e,t,n){return Tr(e)+" "+n+" "+t}const ac="errorband",AO=["band","borders"],wO=new mo(ac,$g);function $g(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:bo(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:u}=jg(e,ac,t),c=o,l=sc(c,r,i,s,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},g={type:f?"line":"rule"};const p=Object.assign(Object.assign({},c.interpolate?{interpolate:c.interpolate}:{}),c.tension&&c.interpolate?{tension:c.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),g=Object.assign(Object.assign(Object.assign({},g),p),{aria:!1})):c.interpolate?O(Sl("interpolate")):c.tension&&O(Sl("tension")),Object.assign(Object.assign({},a),{transform:n,layer:[...l({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...l({partName:"borders",mark:g,positionPrefix:"lower",extraEncoding:u}),...l({partName:"borders",mark:g,positionPrefix:"upper",extraEncoding:u})]})}const Dg={};function uc(e,t,n){const i=new mo(e,t);Dg[e]={normalizer:i,parts:n}}function SO(){return y(Dg)}uc(Fs,Cg,gO);uc(oc,Fg,mO);uc(ac,$g,AO);const CO=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],Tg={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},Ng={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},_O=y(Tg),FO=y(Ng),jO={header:1,headerRow:1,headerColumn:1,headerFacet:1},kg=y(jO),Pg=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],$O={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},DO={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1};var TO=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Ig(e){const t=[];for(const n of e||[]){const{expr:i,bind:r}=n,s=TO(n,["expr","bind"]);if(r&&i){const o=Object.assign(Object.assign({},s),{bind:r,init:i});t.push(o)}else{const o=Object.assign(Object.assign(Object.assign({},s),i?{update:i}:{}),r?{bind:r}:{});t.push(o)}}return t}const ki="_vgsid_",NO={single:{on:"click",fields:[ki],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[ki],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function cc(e){return!!e&&(e==="legend"||!!e.legend)}function ea(e){return cc(e)&&ye(e)}function kO(e){return yo(e)||fc(e)||lc(e)}function lc(e){return"concat"in e}function yo(e){return"vconcat"in e}function fc(e){return"hconcat"in e}function _t(e){return ye(e)&&e.step!==void 0}function Il(e){return e.view||e.width||e.height}const Rl=20,PO={align:1,bounds:1,center:1,columns:1,spacing:1},IO=y(PO);function RO(e,t,n){var i,r;const s=n[t],o={},{spacing:a,columns:u}=s;a!==void 0&&(o.spacing=a),u!==void 0&&(co(e)&&!Mr(e.facet)||lc(e))&&(o.columns=u),yo(e)&&(o.columns=1);for(const c of IO)if(e[c]!==void 0)if(c==="spacing"){const l=e[c];o[c]=be(l)?l:{row:(i=l.row)!==null&&i!==void 0?i:a,column:(r=l.column)!==null&&r!==void 0?r:a}}else o[c]=e[c];return o}var LO=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ka(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function js(e,t){const n=xr(e,t);return _t(n)?n.step:dc}function xr(e,t){var n;const i=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return pe(i,{step:e.step})}const dc=20,BO={continuousWidth:200,continuousHeight:200,step:dc},zO={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:BO,mark:Nv,arc:{},area:{},bar:Iv,circle:{},geoshape:{},image:{},line:{},point:{},rect:Rv,rule:{color:"black"},square:{},text:{color:"black"},tick:Lv,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:bv,projection:{},legend:$O,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:NO,style:{},title:{},facet:{spacing:Rl},concat:{spacing:Rl}},Lt=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],Ll={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},Bl={blue:Lt[0],orange:Lt[1],red:Lt[2],teal:Lt[3],green:Lt[4],yellow:Lt[5],purple:Lt[6],pink:Lt[7],brown:Lt[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function MO(e={}){return{signals:[{name:"color",value:ye(e)?Object.assign(Object.assign({},Bl),e):Bl}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function UO(e){return{signals:[{name:"fontSize",value:ye(e)?Object.assign(Object.assign({},Ll),e):Ll}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function WO(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function Rg(e){const t=y(e||{}),n={};for(const i of t){const r=e[i];n[i]=Nr(r)?dg(r):$e(r)}return n}function GO(e){const t=y(e),n={};for(const i of t)n[i]=Rg(e[i]);return n}const HO=[...Gd,...fd,...kg,"background","padding","legend","lineBreak","scale","style","title","view"];function Lg(e={}){const{color:t,font:n,fontSize:i}=e,r=LO(e,["color","font","fontSize"]),s=Bs({},zO,n?WO(n):{},t?MO(t):{},i?UO(i):{},r||{}),o=Ge(s,HO);for(const a of["background","lineBreak","padding"])s[a]&&(o[a]=$e(s[a]));for(const a of Gd)s[a]&&(o[a]=it(s[a]));for(const a of fd)s[a]&&(o[a]=Rg(s[a]));for(const a of kg)s[a]&&(o[a]=it(s[a]));return s.legend&&(o.legend=it(s.legend)),s.scale&&(o.scale=it(s.scale)),s.style&&(o.style=GO(s.style)),s.title&&(o.title=it(s.title)),s.view&&(o.view=it(s.view)),o}const qO=["view",...Wd],VO=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],XO=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},Tv);function YO(e){e=G(e);for(const t of VO)delete e[t];if(e.axis)for(const t in e.axis)Nr(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of CO)delete e.legend[t];if(e.mark){for(const t of Fl)delete e.mark[t];e.mark.tooltip&&ye(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(Ig(e.params)),delete e.params);for(const t of qO){for(const i of Fl)delete e[t][i];const n=XO[t];if(n)for(const i of n)delete e[t][i];KO(e,t)}for(const t of SO())delete e[t];JO(e);for(const t in e)ye(e[t])&&te(e[t])&&delete e[t];return te(e)?void 0:e}function JO(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=fg(e.title);te(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),te(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),te(i)?delete e.title:e.title=i}function KO(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const s=Object.assign(Object.assign({},r),e.style[n!=null?n:t]);te(s)||(e.style[n!=null?n:t]=s),i||delete e[t]}function vo(e){return"layer"in e}function QO(e){return"repeat"in e}function ZO(e){return!I(e.repeat)&&e.repeat.layer}var e1=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class t1{map(t,n){return co(t)?this.mapFacet(t,n):QO(t)?this.mapRepeat(t,n):fc(t)?this.mapHConcat(t,n):yo(t)?this.mapVConcat(t,n):lc(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(vo(t))return this.mapLayer(t,n);if(sn(t))return this.mapUnit(t,n);throw new Error(wu(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(i=>this.mapLayerOrUnit(i,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(i=>this.map(i,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(i=>this.map(i,n))})}mapConcat(t,n){const{concat:i}=t,r=e1(t,["concat"]);return Object.assign(Object.assign({},r),{concat:i.map(s=>this.map(s,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const n1={zero:1,center:1,normalize:1};function i1(e){return e in n1}const r1=new Set([zd,ro,io,As,oo,Mu,Uu,so,Md,zu]),s1=new Set([ro,io,zd]);function zl(e,t){var n,i;const r=t==="x"?"y":"radius",s=e[t],o=e[r];if(F(s)&&F(o))if(dn(s)==="quantitative"&&dn(o)==="quantitative"){if(s.stack)return t;if(o.stack)return r;const a=F(s)&&!!s.aggregate,u=F(o)&&!!o.aggregate;if(a!==u)return a?t:r;{const c=(n=s.scale)===null||n===void 0?void 0:n.type,l=(i=o.scale)===null||i===void 0?void 0:i.type;if(c&&c!=="linear")return r;if(l&&l!=="linear")return t}}else{if(dn(s)==="quantitative")return t;if(dn(o)==="quantitative")return r}else{if(dn(s)==="quantitative")return t;if(dn(o)==="quantitative")return r}}function o1(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function Bg(e,t,n={}){const i=Zt(e)?e.type:e;if(!r1.has(i))return null;const r=zl(t,"x")||zl(t,"theta");if(!r)return null;const s=t[r],o=F(s)?C(s,{}):void 0;let a=o1(r),u=t[a],c=F(u)?C(u,{}):void 0;c===o&&(c=void 0,u=void 0,a=void 0);const l=Cb.reduce((d,g)=>{if(g!=="tooltip"&&Yn(t,g)){const p=t[g];for(const m of ge(p)){const h=Ct(m);if(h.aggregate)continue;const E=C(h,{});(!E||E!==c)&&d.push({channel:g,fieldDef:h})}}return d},[]);let f;if(s.stack!==void 0?Mi(s.stack)?f=s.stack?"zero":null:f=s.stack:l.length>0&&s1.has(i)&&(f="zero"),!f||!i1(f)||nc(t)&&l.length===0)return null;if(s.scale&&s.scale.type&&s.scale.type!==me.LINEAR){if(n.disallowNonLinearStack)return null;O(Ay(s.scale.type))}return M(t[Pt(r)])?(s.stack!==void 0&&O(xy(r)),null):(F(s)&&s.aggregate&&!L(gb,s.aggregate)&&O(wy(s.aggregate)),{groupbyChannel:u?a:void 0,groupbyField:c,fieldChannel:r,impute:s.impute===null?!1:$n(i),stackBy:l,offset:f})}var zg=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function a1(e){const t=zg(e,["point","line"]);return y(t).length>1?t:t.type}function u1(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:Ge(e[t],["point","line"])}));return e}function ta(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?ye(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?ye(t.point)?t.point:{}:void 0}function Ml(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class c1{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(sn(t)){const{mark:i,encoding:r}=t,s=Zt(i)?i:{type:i};switch(s.type){case"line":case"rule":case"trail":return!!ta(s,n[s.type],r);case"area":return!!ta(s,n[s.type],r)||!!Ml(s,n[s.type])}}return!1}run(t,n,i){const{config:r}=n,{selection:s,projection:o,mark:a,encoding:u}=t,c=zg(t,["selection","projection","mark","encoding"]),l=bo(u,r),f=Zt(a)?a:{type:a},d=ta(f,r[f.type],l),g=f.type==="area"&&Ml(f,r[f.type]),p=[Object.assign(Object.assign({},s?{selection:s}:{}),{mark:a1(Object.assign(Object.assign({},f.type==="area"&&f.opacity===void 0&&f.fillOpacity===void 0?{opacity:.7}:{}),f)),encoding:Ge(l,["shape"])})],m=Bg(f,l);let h=l;if(m){const{fieldChannel:E,offset:v}=m;h=Object.assign(Object.assign({},l),{[E]:Object.assign(Object.assign({},l[E]),v?{stack:v}:{})})}return g&&p.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"line"},Fi(f,["clip","interpolate","tension","tooltip"])),g),encoding:h})),d&&p.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},Fi(f,["clip","tooltip"])),d),encoding:h})),i(Object.assign(Object.assign({},c),{layer:p}),Object.assign(Object.assign({},n),{config:u1(r)}))}}var Ul=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class l1{constructor(){this.name="RangeStep"}hasMatchingType(t){var n;if(sn(t)&&t.encoding)for(const i of Je){const r=t.encoding[i];if(r&&M(r)&&!((n=r==null?void 0:r.scale)===null||n===void 0)&&n.rangeStep)return!0}return!1}run(t){var n;const i={};let r=Object.assign({},t.encoding);for(const s of Je){const o=It(s),a=r[s];if(a&&M(a)&&!((n=a==null?void 0:a.scale)===null||n===void 0)&&n.rangeStep){const{scale:u}=a,c=Ul(a,["scale"]),l=u,f=Ul(l,["rangeStep"]);i[o]={step:u.rangeStep},O(ay),r=Object.assign(Object.assign({},r),{[s]:Object.assign(Object.assign({},c),te(f)?{}:{scale:f})})}}return Object.assign(Object.assign(Object.assign({},i),t),{encoding:r})}}var f1=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function d1(e,t){return t?Mr(e)?Ug(e,t):Mg(e,t):e}function na(e,t){return t?Ug(e,t):e}function Pa(e,t,n){const i=t[e];if(Vv(i)){if(i.repeat in n)return Object.assign(Object.assign({},t),{[e]:n[i.repeat]});O(Wb(i.repeat));return}return t}function Mg(e,t){if(e=Pa("field",e,t),e!==void 0){if(e===null)return null;if(Xu(e)&&xt(e.sort)){const n=Pa("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function Wl(e,t){if(F(e))return Mg(e,t);{const n=Pa("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function Gl(e,t){if(M(e)){const n=Wl(e,t);if(n)return n;if(Ju(e))return{condition:e.condition}}else{if(fo(e)){const n=Wl(e.condition,t);return n?Object.assign(Object.assign({},e),{condition:n}):f1(e,["condition"])}return e}}function Ug(e,t){const n={};for(const i in e)if(Ei(e,i)){const r=e[i];if(I(r))n[i]=r.map(s=>Gl(s,t)).filter(s=>s);else{const s=Gl(r,t);s!==void 0&&(n[i]=s)}}return n}class g1{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(sn(t)){const{encoding:n,mark:i}=t;if(i==="line")for(const r of wb){const s=li(r),o=n[s];if(n[r]&&(F(o)&&!je(o.bin)||Dn(o)))return!0}}return!1}run(t,n,i){const{encoding:r}=t;return O(sy(!!r.x2,!!r.y2)),i(Object.assign(Object.assign({},t),{mark:"rule"}),n)}}var ln=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class p1 extends t1{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[pO,bO,wO,new c1,new g1,new l1]}map(t,n){if(sn(t)){const i=Yn(t.encoding,Ht),r=Yn(t.encoding,qt),s=Yn(t.encoding,Xs);if(i||r||s)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:i,parentProjection:r}=n,s=na(t.encoding,n.repeater),o=Object.assign(Object.assign({},t),s?{encoding:s}:{});if(i||r)return this.mapUnitWithParentEncodingOrProjection(o,n);const a=this.mapLayerOrUnit.bind(this);for(const u of this.nonFacetUnitNormalizers)if(u.hasMatchingType(o,n.config))return u.run(o,n,a);return o}mapRepeat(t,n){return ZO(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:i,spec:r}=t,s=ln(t,["repeat","spec"]),{row:o,column:a,layer:u}=i,{repeater:c={},repeaterPrefix:l=""}=n;return o||a?this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},o?{row:o}:{}),a?{column:a}:{}),spec:{repeat:{layer:u},spec:r}}),n):Object.assign(Object.assign({},s),{layer:u.map(f=>{const d=Object.assign(Object.assign({},c),{layer:f}),g=(r.name||"")+l+`child__layer_${ae(f)}`,p=this.mapLayerOrUnit(r,Object.assign(Object.assign({},n),{repeater:d,repeaterPrefix:g}));return p.name=g,p})})}mapNonLayerRepeat(t,n){var i;const{repeat:r,spec:s,data:o}=t,a=ln(t,["repeat","spec","data"]);!I(r)&&t.columns&&(t=Ge(t,["columns"]),O(El("repeat")));const u=[],{repeater:c={},repeaterPrefix:l=""}=n,f=!I(r)&&r.row||[c?c.row:null],d=!I(r)&&r.column||[c?c.column:null],g=I(r)&&r||[c?c.repeat:null];for(const m of g)for(const h of f)for(const E of d){const v={repeat:m,row:h,column:E,layer:c.layer},S=(s.name||"")+l+"child__"+(I(r)?`${ae(m)}`:(r.row?`row_${ae(h)}`:"")+(r.column?`column_${ae(E)}`:"")),D=this.map(s,Object.assign(Object.assign({},n),{repeater:v,repeaterPrefix:S}));D.name=S,u.push(Ge(D,["data"]))}const p=I(r)?t.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:(i=s.data)!==null&&i!==void 0?i:o,align:"all"},a),{columns:p,concat:u})}mapFacet(t,n){const{facet:i}=t;return Mr(i)&&t.columns&&(t=Ge(t,["columns"]),O(El("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:i,projection:r}=t,{parentEncoding:s,parentProjection:o,config:a}=n,u=ql({parentProjection:o,projection:r}),c=Hl({parentEncoding:s,encoding:na(i,n.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),u?{projection:u}:{}),c?{encoding:c}:{}),{config:a})}mapFacetedUnit(t,n){const i=t.encoding,{row:r,column:s,facet:o}=i,a=ln(i,["row","column","facet"]),{mark:u,width:c,projection:l,height:f,view:d,selection:g,encoding:p}=t,m=ln(t,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:h,layout:E}=this.getFacetMappingAndLayout({row:r,column:s,facet:o},n),v=na(a,n.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},m),E),{facet:h,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},c?{width:c}:{}),f?{height:f}:{}),d?{view:d}:{}),l?{projection:l}:{}),{mark:u,encoding:v}),g?{selection:g}:{})}),n)}getFacetMappingAndLayout(t,n){var i;const{row:r,column:s,facet:o}=t;if(r||s){o&&O(iy([...r?[Ht]:[],...s?[qt]:[]]));const a={},u={};for(const c of[Ht,qt]){const l=t[c];if(l){const f=ln(l,["align","center","spacing","columns"]);a[c]=f;for(const d of["align","center","spacing"])l[d]!==void 0&&(u[d]=(i=u[d])!==null&&i!==void 0?i:{},u[d][c]=l[d])}}return{facetMapping:a,layout:u}}else{const{align:a,center:u,spacing:c,columns:l}=o,f=ln(o,["align","center","spacing","columns"]);return{facetMapping:d1(f,n.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},a?{align:a}:{}),u?{center:u}:{}),c?{spacing:c}:{}),l?{columns:l}:{})}}}mapLayer(t,n){var{parentEncoding:i,parentProjection:r}=n,s=ln(n,["parentEncoding","parentProjection"]);const{encoding:o,projection:a}=t,u=ln(t,["encoding","projection"]),c=Object.assign(Object.assign({},s),{parentEncoding:Hl({parentEncoding:i,encoding:o,layer:!0}),parentProjection:ql({parentProjection:r,projection:a})});return super.mapLayer(u,c)}}function Hl({parentEncoding:e,encoding:t={},layer:n}){let i={};if(e){const r=new Set([...y(e),...y(t)]);for(const s of r){const o=t[s],a=e[s];if(M(o)){const u=Object.assign(Object.assign({},a),o);i[s]=u}else fo(o)?i[s]=Object.assign(Object.assign({},o),{condition:Object.assign(Object.assign({},a),o.condition)}):o||o===null?i[s]=o:(n||ut(a)||z(a)||M(a)||I(a))&&(i[s]=a)}}else i=t;return!i||te(i)?void 0:i}function ql(e){const{parentProjection:t,projection:n}=e;return t&&n&&O(Yb({parentProjection:t,projection:n})),n!=null?n:t}function Wg(e,t){t===void 0&&(t=Lg(e.config));const n=m1(e,t),{width:i,height:r}=e,s=b1(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const h1=new p1;function m1(e,t={}){return h1.map(e,{config:t})}function Vl(e){return W(e)?{type:e}:e!=null?e:{}}function b1(e,t,n){let{width:i,height:r}=t;const s=sn(e)||vo(e),o={};s?i=="container"&&r=="container"?(o.type="fit",o.contains="padding"):i=="container"?(o.type="fit-x",o.contains="padding"):r=="container"&&(o.type="fit-y",o.contains="padding"):(i=="container"&&(O(bl("width")),i=void 0),r=="container"&&(O(bl("height")),r=void 0));const a=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?Vl(n.autosize):{}),Vl(e.autosize));if(a.type==="fit"&&!s&&(O(kb),a.type="pad"),i=="container"&&!(a.type=="fit"||a.type=="fit-x")&&O(yl("width")),r=="container"&&!(a.type=="fit"||a.type=="fit-y")&&O(yl("height")),!Gi(a,{type:"pad"}))return a}function y1(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function v1(e){return e?`fit-${Zs(e)}`:"fit"}const O1=["background","padding"];function Xl(e,t){const n={};for(const i of O1)e&&e[i]!==void 0&&(n[i]=$e(e[i]));return t&&(n.params=e.params),n}class on{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new on(G(this.explicit),G(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return pe(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,n){n.value!==void 0&&this.set(t,n.value,n.explicit)}set(t,n,i){return delete this[i?"implicit":"explicit"][t],this[i?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,n){n.explicit[t]!==void 0?this.set(t,n.explicit[t],!0):n.implicit[t]!==void 0&&this.set(t,n.implicit[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of y(t.combine())){const i=t.getWithExplicit(n);this.setWithExplicit(n,i)}}}function Mt(e){return{explicit:!0,value:e}}function Ue(e){return{explicit:!1,value:e}}function Gg(e){return(t,n,i,r)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:Oo(t,n,i,r)}}function Oo(e,t,n,i){return e.explicit&&t.explicit&&O(hy(n,i,e.value,t.value)),e}function yn(e,t,n,i,r=Oo){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Gi(e.value,t.value)?e:r(e,t,n,i)}class E1 extends on{constructor(t={},n={},i=!1){super(t,n),this.explicit=t,this.implicit=n,this.parseNothing=i}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function Ar(e){return"url"in e}function $s(e){return"values"in e}function Hg(e){return"name"in e&&!Ar(e)&&!$s(e)&&!Jn(e)}function Jn(e){return e&&(qg(e)||Vg(e)||gc(e))}function qg(e){return"sequence"in e}function Vg(e){return"sphere"in e}function gc(e){return"graticule"in e}var re;(function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"})(re||(re={}));function Xg(e){return"filter"in e}function x1(e){return(e==null?void 0:e.stop)!==void 0}function A1(e){return"lookup"in e}function w1(e){return"data"in e}function S1(e){return"selection"in e}function C1(e){return"pivot"in e}function _1(e){return"density"in e}function F1(e){return"quantile"in e}function j1(e){return"regression"in e}function $1(e){return"loess"in e}function D1(e){return"sample"in e}function T1(e){return"window"in e}function N1(e){return"joinaggregate"in e}function k1(e){return"flatten"in e}function P1(e){return"calculate"in e}function I1(e){return"bin"in e}function R1(e){return"impute"in e}function L1(e){return"timeUnit"in e}function B1(e){return"aggregate"in e}function z1(e){return"stack"in e}function M1(e){return"fold"in e}function U1(e){return e.map(t=>Xg(t)?{filter:ps(t.filter,nv)}:t)}function qi(e,t,n,i){const r=Ju(t)&&t.condition,s=i(t);if(r){const a=ge(r).map(u=>{const c=i(u),l=qv(u)?Op(e,u.selection):ks(e,u.test);return Object.assign({test:l},c)});return{[n]:[...a,...s!==void 0?[s]:[]]}}else return s!==void 0?{[n]:s}:{}}function pc(e,t="text"){const n=e.encoding[t];return qi(e,n,t,i=>Eo(i,e.config))}function Eo(e,t,n="datum"){if(e){if(ut(e))return ce(e.value);if(M(e)){const{format:i,formatType:r}=Ss(e);return Hu({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}}function Yg(e,t={}){const{encoding:n,markDef:i,config:r,stack:s}=e,o=n.tooltip;if(I(o))return{tooltip:Yl({tooltip:o},s,r,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return qi(e,o,"tooltip",u=>{const c=Eo(u,r,a);if(c)return c;if(u===null)return;let l=Z("tooltip",i,r);if(l===!0&&(l={content:"encoding"}),W(l))return{value:l};if(ye(l))return z(l)?l:l.content==="encoding"?Yl(n,s,r,t):{signal:a}})}}function Jg(e,t,n,{reactiveGeom:i}={}){const r={},s=i?"datum.datum":"datum",o=[];function a(c,l){const f=li(l),d=Qe(c)?c:Object.assign(Object.assign({},c),{type:e[f].type}),g=d.title||Zu(d,n),p=ge(g).join(", ");let m;if(St(l)){const h=l==="x"?"x2":"y2",E=Ct(e[h]);if(je(d.bin)&&E){const v=C(d,{expr:s}),S=C(E,{expr:s}),{format:D,formatType:x}=Ss(d);m=ao(v,S,D,x,n),r[h]=!0}else if(t&&t.fieldChannel===l&&t.offset==="normalize"){const{format:v,formatType:S}=Ss(d);m=Hu({fieldOrDatumDef:d,format:v,formatType:S,expr:s,config:n,normalizeStack:!0}).signal}}m=m!=null?m:Eo(d,n,s).signal,o.push({channel:l,key:p,value:m})}ic(e,(c,l)=>{F(c)?a(c,l):lo(c)&&a(c.condition,l)});const u={};for(const{channel:c,key:l,value:f}of o)!r[c]&&!u[l]&&(u[l]=f);return u}function Yl(e,t,n,{reactiveGeom:i}={}){const r=Jg(e,t,n,{reactiveGeom:i}),s=Dr(r).map(([o,a])=>`"${o}": ${a}`);return s.length>0?{signal:`{${s.join(", ")}}`}:void 0}function W1(e){const{markDef:t,config:n}=e,i=Z("aria",t,n);return i===!1?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),G1(e)),H1(e))}function G1(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=Z("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in Qy?{}:{ariaRoleDescription:{value:t}}}function H1(e){const{encoding:t,markDef:n,config:i,stack:r}=e,s=t.description;if(s)return qi(e,s,"description",u=>Eo(u,e.config));const o=Z("description",n,i);if(o!=null)return{description:ce(o)};if(i.aria===!1)return{};const a=Jg(t,r,i);if(!te(a))return{description:{signal:Dr(a).map(([u,c],l)=>`"${l>0?"; ":""}${u}: " + (${c})`).join(" + ")}}}function xe(e,t,n={}){const{markDef:i,encoding:r,config:s}=t,{vgChannel:o}=n;let{defaultRef:a,defaultValue:u}=n;a===void 0&&(u=u!=null?u:Z(e,i,s,{vgChannel:o,ignoreVgConfig:!0}),u!==void 0&&(a=ce(u)));const c=r[e];return qi(t,c,o!=null?o:e,l=>Vd({channel:e,channelDef:l,markDef:i,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function Kg(e,t={filled:void 0}){var n,i,r,s;const{markDef:o,encoding:a,config:u}=e,{type:c}=o,l=(n=t.filled)!==null&&n!==void 0?n:Z("filled",o,u),f=L(["bar","point","circle","square","geoshape"],c)?"transparent":void 0,d=(r=(i=Z(l===!0?"color":void 0,o,u,{vgChannel:"fill"}))!==null&&i!==void 0?i:u.mark[l===!0&&"color"])!==null&&r!==void 0?r:f,g=(s=Z(l===!1?"color":void 0,o,u,{vgChannel:"stroke"}))!==null&&s!==void 0?s:u.mark[l===!1&&"color"],p=l?"fill":"stroke",m=Object.assign(Object.assign({},d?{fill:ce(d)}:{}),g?{stroke:ce(g)}:{});return o.color&&(l?o.fill:o.stroke)&&O(Sd("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},m),xe("color",e,{vgChannel:p,defaultValue:l?d:g})),xe("fill",e,{defaultValue:a.fill?d:void 0})),xe("stroke",e,{defaultValue:a.stroke?g:void 0}))}function q1(e){const{encoding:t,mark:n}=e,i=t.order;return!$n(n)&&ut(i)?qi(e,i,"zindex",r=>ce(r.value)):{}}function wr(e,t){const n=Sb(e),i=t[n];if(i)return i}function Se(e,t,{defaultPos:n,vgChannel:i,isMidPoint:r}){const{encoding:s,markDef:o,config:a,stack:u}=t,c=s[e],l=s[Pt(e)],f=t.scaleName(e),d=t.getScaleComponent(e),g=wr(e,o),p=hc({model:t,defaultPos:n,channel:e,scaleName:f,scale:d}),m=!c&&St(e)&&(s.latitude||s.longitude)?{field:t.getName(e)}:V1({channel:e,channelDef:c,channel2Def:l,markDef:o,config:a,isMidPoint:r,scaleName:f,scale:d,stack:u,offset:g,defaultRef:p});return m?{[i||e]:m}:void 0}function V1(e){const{channel:t,channelDef:n,isMidPoint:i,scaleName:r,stack:s,offset:o,markDef:a,config:u}=e;if(M(n)&&s&&t===s.fieldChannel){if(F(n)){const c=Ur({channel:t,fieldDef:n,isMidPoint:i,markDef:a,stack:s,config:u});if(c!==void 0)return ws({scaleName:r,fieldOrDatumDef:n,startSuffix:"start",band:c,offset:o})}return Xn(n,r,{suffix:"end"},{offset:o})}return Wu(e)}function hc({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:s,config:o}=e;return()=>{const a=li(n),u=bn(n),c=Z(n,s,o,{vgChannel:u});if(c!==void 0)return gr(n,c);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const l=r.get("type");if(!L([me.LOG,me.TIME,me.UTC],l)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const l=e[It(n)];return Object.assign(Object.assign({},l),{mult:.5})}}}}const X1={left:"x",center:"xc",right:"x2"},Y1={top:"y",middle:"yc",bottom:"y2"};function Qg(e,t,n,i="middle"){if(e==="radius"||e==="theta")return bn(e);const r=e==="x"?"align":"baseline",s=Z(r,t,n);let o;return z(s)?(O(ry(r)),o=void 0):o=s,e==="x"?X1[o||(i==="top"?"left":"center")]:Y1[o||i]}function Ds(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?Zg(e,t,{defaultPos:n,defaultPos2:i}):Se(e,t,{defaultPos:n})}function Zg(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:s}=t,o=Pt(e),a=It(e),u=J1(t,i,o),c=u[a]?Qg(e,r,s):bn(e);return Object.assign(Object.assign({},Se(e,t,{defaultPos:n,vgChannel:c})),u)}function J1(e,t,n){const{encoding:i,mark:r,markDef:s,stack:o,config:a}=e,u=li(n),c=It(n),l=bn(n),f=i[u],d=e.scaleName(u),g=e.getScaleComponent(u),p=n in i||n in s?wr(n,e.markDef):wr(u,e.markDef);if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude))return{[l]:{field:e.getName(n)}};const m=K1({channel:n,channelDef:f,channel2Def:i[n],markDef:s,config:a,scaleName:d,scale:g,stack:o,offset:p,defaultRef:void 0});return m!==void 0?{[l]:m}:ts(n,s)||ts(n,{[n]:_s(n,s,a.style),[c]:_s(c,s,a.style)})||ts(n,a[r])||ts(n,a.mark)||{[l]:hc({model:e,defaultPos:t,channel:n,scaleName:d,scale:g})()}}function K1({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:u,defaultRef:c}){return M(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?Xn(t,s,{suffix:"start"},{offset:u}):Wu({channel:e,channelDef:n,scaleName:s,scale:o,stack:a,markDef:i,config:r,offset:u,defaultRef:c})}function ts(e,t){const n=It(e),i=bn(e);if(t[i]!==void 0)return{[i]:gr(e,t[i])};if(t[e]!==void 0)return{[i]:gr(e,t[e])};if(t[n])return{[n]:gr(e,t[n])}}function vn(e,t,n){var i,r,s,o;const{config:a,encoding:u,markDef:c,stack:l}=e,f=Pt(t),d=It(t),g=u[t],p=u[f],m=e.getScaleComponent(t),h=m?m.get("type"):void 0,E=e.scaleName(t),v=c.orient,S=(r=(i=u[d])!==null&&i!==void 0?i:u.size)!==null&&r!==void 0?r:Z("size",c,a,{vgChannel:d}),D=n==="bar"&&(t==="x"?v==="vertical":v==="horizontal");if(F(g)&&(ue(g.bin)||je(g.bin)||g.timeUnit&&!p)&&!S&&!ze(h)){const x=Ur({channel:t,fieldDef:g,stack:l,markDef:c,config:a}),N=(s=e.component.axes[t])===null||s===void 0?void 0:s[0],w=(o=N==null?void 0:N.get("translate"))!==null&&o!==void 0?o:.5;return eE({fieldDef:g,fieldDef2:p,channel:t,markDef:c,scaleName:E,band:x,axisTranslate:w,spacing:St(t)?Z("binSpacing",c,a):void 0,reverse:m.get("reverse"),config:a})}else return(M(g)&&ze(h)||D)&&!p?Z1(n,g,t,e):Zg(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function Q1(e,t,n,i,r,s){if(i){const u=i.get("type");if(u==="point"||u==="band"){if(r[e].discreteBandSize!==void 0)return{value:r[e].discreteBandSize};if(u===me.POINT){const c=i.get("range");return jn(c)&&be(c.step)?{value:c.step-2}:{value:dc-2}}else return{scale:n,band:s}}else return{value:r[e].continuousBandSize}}const o=js(r.view,t),a=pe(r[e].discreteBandSize,o-2);return a!==void 0?{value:a}:void 0}function Z1(e,t,n,i){var r;const{markDef:s,encoding:o,config:a,stack:u}=i,c=s.orient,l=i.scaleName(n),f=i.getScaleComponent(n),d=It(n),g=Pt(n),p=c==="horizontal"&&n==="y"||c==="vertical"&&n==="x",m=Z(p?"size":d,s,a,{vgChannel:d});let h;(o.size||m!==void 0)&&(p?h=xe("size",i,{vgChannel:d,defaultValue:m}):O(dy(s.type)));const E=(r=M(t)?Ur({channel:n,fieldDef:t,markDef:s,stack:u,config:a}):void 0)!==null&&r!==void 0?r:1;h=h||{[d]:Q1(e,d,l,f,a,E)};const v=(f==null?void 0:f.get("type"))!=="band"||!("band"in h[d]),S=Qg(n,s,a,v?"middle":"top"),D=wr(n,s),x=Wu({channel:n,channelDef:t,markDef:s,config:a,scaleName:l,scale:f,stack:u,offset:D,defaultRef:hc({model:i,defaultPos:"mid",channel:n,scaleName:l,scale:f}),band:v?.5:(1-E)/2});if(d)return Object.assign({[S]:x},h);{const N=bn(g),w=h[d],B=D?Object.assign(Object.assign({},w),{offset:D}):w;return{[S]:x,[N]:I(x)?[x[0],Object.assign(Object.assign({},x[1]),{offset:B})]:Object.assign(Object.assign({},x),{offset:B})}}}function sr(e,t,n,i,r){if(pd(e))return 0;const s=e==="x"||e==="y2"?-t/2:t/2;if(z(n)||z(r)||z(i)){const o=Vt(n),a=Vt(r),u=Vt(i),c=u?`${u} + `:"",l=o?`(${o} ? -1 : 1) * `:"",f=a?`(${a} + ${s})`:s;return{signal:c+l+f}}else return r=r||0,i+(n?-r-s:+r+s)}function eE({fieldDef:e,fieldDef2:t,channel:n,band:i,scaleName:r,markDef:s,spacing:o=0,axisTranslate:a,reverse:u,config:c}){const l=Pt(n),f=bn(n),d=bn(l),g=wr(n,s);if(ue(e.bin)||e.timeUnit)return{[d]:Jl({channel:n,fieldDef:e,scaleName:r,markDef:s,band:(1-i)/2,offset:sr(l,o,u,a,g),config:c}),[f]:Jl({channel:n,fieldDef:e,scaleName:r,markDef:s,band:1-(1-i)/2,offset:sr(n,o,u,a,g),config:c})};if(je(e.bin)){const p=Xn(e,r,{},{offset:sr(l,o,u,a,g)});if(F(t))return{[d]:p,[f]:Xn(t,r,{},{offset:sr(n,o,u,a,g)})};if(Lr(e.bin)&&e.bin.step)return{[d]:p,[f]:{signal:`scale("${r}", ${C(e,{expr:"datum"})} + ${e.bin.step})`,offset:sr(n,o,u,a,g)}}}O(Fd(l))}function Jl({channel:e,fieldDef:t,scaleName:n,markDef:i,band:r,offset:s,config:o}){const a=ws({scaleName:n,fieldOrDatumDef:t,band:r,offset:s});return qd({fieldDef:t,channel:e,markDef:i,ref:a,config:o})}const tE=new Set(["aria"]);function Ze(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?Kg(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},nE(e.markDef,t)),Kl(e,"fill",n)),Kl(e,"stroke",i)),xe("opacity",e)),xe("fillOpacity",e)),xe("strokeOpacity",e)),xe("strokeWidth",e)),xe("strokeDash",e)),q1(e)),Yg(e)),pc(e,"href")),W1(e))}function Kl(e,t,n){const{config:i,mark:r,markDef:s}=e;if(Z("invalid",s,i)==="hide"&&n&&!$n(r)){const a=iE(e,{invalid:!0,channels:eo});if(a)return{[t]:[{test:a,value:null},...ge(n)]}}return n?{[t]:n}:{}}function nE(e,t){return Ky.reduce((n,i)=>(!tE.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=ce(e[i])),n),{})}function iE(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const u=a.get("type"),c=e.vgField(o,{expr:"datum"});c&&Ke(u)&&(s[c]=!0)}return s},{}),r=y(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>Gu(o,t)).join(` ${s} `)}}function mc(e){const{config:t,markDef:n}=e;if(Z("invalid",n,t)){const r=rE(e,{channels:Je});if(r)return{defined:{signal:r}}}return{}}function rE(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const u=a.get("type"),c=e.vgField(o,{expr:"datum"});c&&Ke(u)&&(s[c]=!0)}return s},{}),r=y(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>Gu(o,t)).join(` ${s} `)}}function Ql(e,t){if(t!==void 0)return{[e]:ce(t)}}const ia="voronoi",ep={has:e=>e.type!=="interval"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(ia)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,s=e.mark;if($n(s))return O(Ib(s)),n;const o={name:e.getName(ia),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},Yg(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,u=!1;return n.forEach((c,l)=>{var f;const d=(f=c.name)!==null&&f!==void 0?f:"";d===e.component.mark[0].name?a=l:d.indexOf(ia)>=0&&(u=!0)}),u||n.splice(a+1,0,o),n}};class ne{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.indexOf(t)>-1){O(qb);return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const i of this._children)i.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=n,t.parent=this}}class De extends ne{constructor(t,n,i,r){super(t,n),this.type=i,this.refCounts=r,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName="clone_"+this.debugName,t._source=this._source,t._name="clone_"+this._name,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${od()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}var Zl=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class At extends ne{constructor(t,n){super(t),this.formula=n}clone(){return new At(null,G(this.formula))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s,o)=>{const{field:a,timeUnit:u}=s,c=fe(n)?n.encoding[Pt(o)]:void 0,l=fe(n)&&Yu(o,s,c,n.stack,n.markDef,n.config);if(u){const f=C(s,{forAs:!0});r[V({as:f,field:a,timeUnit:u})]=Object.assign({as:f,field:a,timeUnit:u},l?{band:!0}:{})}return r},{});return te(i)?null:new At(t,i)}static makeFromTransform(t,n){const i=Object.assign({},n),{timeUnit:r}=i,s=Zl(i,["timeUnit"]),o=Te(r),a=Object.assign(Object.assign({},s),{timeUnit:o});return new At(t,{[V(a)]:a})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)(!this.formula[n]||t.formula[n].band)&&(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}removeFormulas(t){const n={};for(const[i,r]of Dr(this.formula))t.has(r.as)||(n[i]=r);this.formula=n}producedFields(){return new Set(Gt(this.formula).map(t=>t.as))}dependentFields(){return new Set(Gt(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${V(this.formula)}`}assemble(){const t=[];for(const n of Gt(this.formula)){const{field:i,as:r,timeUnit:s}=n,o=Te(s),{unit:a,utc:u}=o,c=Zl(o,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:Kt(i),type:"timeunit"},a?{units:ju(a)}:{}),u?{timezone:"utc"}:{}),c),{as:[r,`${r}_end`]}))}return t}}var sE=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Gr="_tuple_fields";class oE{constructor(...t){this.items=t,this.hasChannel={},this.hasField={}}}const aE={has:()=>!0,parse:(e,t,n)=>{var i,r,s;const o=t.name,a=(i=t.project)!==null&&i!==void 0?i:t.project=new oE,u={},c={},l=new Set,f=(d,g)=>{const p=g==="visual"?d.channel:d.field;let m=ae(`${o}_${p}`);for(let h=1;l.has(m);h++)m=ae(`${o}_${p}_${h}`);return l.add(m),{[g]:m}};if(!n.fields&&!n.encodings){const d=e.config.selection[n.type];if(n.init)for(const g of ge(n.init))for(const p of y(g))Ab(p)?(n.encodings||(n.encodings=[])).push(p):n.type==="interval"?(O(Ub),n.encodings=d.encodings):(n.fields||(n.fields=[])).push(p);else n.encodings=d.encodings,n.fields=d.fields}for(const d of(r=n.fields)!==null&&r!==void 0?r:[]){const g={type:"E",field:d};g.signals=Object.assign({},f(g,"data")),a.items.push(g),a.hasField[d]=g}for(const d of(s=n.encodings)!==null&&s!==void 0?s:[]){const g=e.fieldDef(d);if(g){let p=g.field;if(g.aggregate){O(Pb(d,g.aggregate));continue}else if(!p){O(Ol(d));continue}if(g.timeUnit){p=e.vgField(d);const m={timeUnit:g.timeUnit,as:p,field:g.field};c[V(m)]=m}if(!u[p]){let m="E";if(t.type==="interval"){const E=e.getScaleComponent(d).get("type");Ke(E)&&(m="R")}else g.bin&&(m="R-RE");const h={field:p,channel:d,type:m};h.signals=Object.assign(Object.assign({},f(h,"data")),f(h,"visual")),a.items.push(u[p]=h),a.hasField[p]=a.hasChannel[d]=u[p]}}else O(Ol(d))}if(n.init){const d=g=>a.items.map(p=>g[p.channel]!==void 0?g[p.channel]:g[p.field]);if(n.type==="interval")t.init=d(n.init);else{const g=ge(n.init);t.init=g.map(d)}}te(c)||(a.timeUnit=new At(null,c))},signals:(e,t,n)=>{const i=t.name+Gr;return n.filter(s=>s.name===i).length>0?n:n.concat({name:i,value:t.project.items.map(s=>{const o=sE(s,["signals","hasLegend"]);return o.field=Kt(o.field),o})})}},tp={has:e=>e.type==="single"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!cc(e.bind),parse:(e,t,n,i)=>{i.on||delete t.events,i.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,s=t.bind,o=t.init&&t.init[0],a=ep.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((u,c)=>{var l,f;const d=ae(`${i}_${u.field}`);n.filter(p=>p.name===d).length||n.unshift(Object.assign(Object.assign({name:d},o?{init:Pi(o[c])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${Y(u.field)}] : null`}]:[],bind:(f=(l=s[u.field])!==null&&l!==void 0?l:s[u.channel])!==null&&f!==void 0?f:s}))}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.filter(c=>c.name===i+Ft)[0],o=i+Gr,a=r.items.map(c=>ae(`${i}_${c.field}`)),u=a.map(c=>`${c} !== null`).join(" && ");return a.length&&(s.update=`${u} ? {fields: ${o}, values: [${a.join(", ")}]} : null`),delete s.value,delete s.on,n}},Ts="_toggle",np={has:e=>e.type==="multi"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+Ts,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Ft,i=t.name+Ts;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${Xt(e)}}, `)+`${i} ? ${n} : null`}},uE={has:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t,n)=>{n.clear&&(t.clear=W(n.clear)?Ui(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(tp.has(t))for(const i of t.project.items){const r=n.findIndex(s=>s.name===ae(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,s){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const r of t.project.items){const s=n.findIndex(o=>o.name===r.signals.visual);if(i(s,"[0, 0]"),s===-1){const o=n.findIndex(a=>a.name===r.signals.data);i(o,"null")}}else{let r=n.findIndex(s=>s.name===t.name+Ft);i(r,"null"),np.has(t)&&(r=n.findIndex(s=>s.name===t.name+Ts),i(r,"false"))}return n}},On={has:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!Fn(r))continue;const s=e.getScaleComponent(r),o=s?s.get("type"):void 0;if(!s||!Ke(o)){O(Lb);continue}const a={selection:t.name,field:i.field};s.set("selectionExtent",a,!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(o=>n.filter(a=>a.name===o.signals.data).length===0);if(!e.parent||Ra(e)||i.length===0)return n;const r=n.filter(o=>o.name===t.name)[0];let s=r.update;if(s.indexOf(fp)>=0)r.update=`{${i.map(o=>`${Y(o.field)}: ${o.signals.data}`).join(", ")}}`;else{for(const o of i){const a=`${Y(o.field)}: ${o.signals.data}`;s.indexOf(a)<0&&(s=`${s.substring(0,s.length-1)}, ${a}}`)}r.update=s}return n.concat(i.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!Ra(e))for(const i of t.scales){const r=n.filter(s=>s.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function Ia(e,t){return`domain(${Y(e.scaleName(t))})`}function Ra(e){var t;return e.parent&&Ji(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:Ra(e.parent.parent))}const ip={has:e=>{const t=e.resolve==="global"&&e.bind&&cc(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==ki;return t&&!n&&O(Bb),t&&n},parse:(e,t,n,i)=>{var r;if(i.on||delete t.events,i.clear||delete t.clear,i.on||i.clear){const a='event.item && indexof(event.item.mark.role, "legend") < 0';for(const u of t.events)u.filter=ge((r=u.filter)!==null&&r!==void 0?r:[]),u.filter.indexOf(a)<0&&u.filter.push(a)}const s=ea(t.bind)?t.bind.legend:"click",o=W(s)?Ui(s,"view"):ge(s);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=ea(t.bind)&&t.bind.legend,s=o=>a=>{const u=G(a);return u.markname=o,u};for(const o of t.project.items){if(!o.hasLegend)continue;const a=`${ae(o.field)}_legend`,u=`${i}_${a}`;if(n.filter(l=>l.name===u).length===0){const l=r.merge.map(s(`${a}_symbols`)).concat(r.merge.map(s(`${a}_labels`))).concat(r.merge.map(s(`${a}_entries`)));n.unshift(Object.assign(Object.assign({name:u},t.init?{}:{value:null}),{on:[{events:l,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${u}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.find(d=>d.name===i+Ft),o=i+Gr,a=r.items.filter(d=>d.hasLegend).map(d=>ae(`${i}_${ae(d.field)}_legend`)),c=`${a.map(d=>`${d} !== null`).join(" && ")} ? {fields: ${o}, values: [${a.join(", ")}]} : null`;t.events&&a.length>0?s.on.push({events:a.map(d=>({signal:d})),update:c}):a.length>0&&(s.update=c,delete s.value,delete s.on);const l=n.find(d=>d.name===i+Ts),f=ea(t.bind)&&t.bind.legend;return l&&(t.events?l.on.push(Object.assign(Object.assign({},l.on[0]),{events:f})):l.on[0].events=f),n}};function cE(e,t,n){var i;const r=(i=e.fieldDef(t))===null||i===void 0?void 0:i.field;di(e,s=>{var o,a;const u=(o=s.project.hasField[r])!==null&&o!==void 0?o:s.project.hasChannel[t];if(u&&ip.has(s)){const c=(a=n.get("selections"))!==null&&a!==void 0?a:[];c.push(s.name),n.set("selections",c,!1),u.hasLegend=!0}})}const rp="_translate_anchor",sp="_translate_delta",lE={has:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=On.has(t),s=i+rp,{x:o,y:a}=t.project.hasChannel;let u=Ui(t.translate,"scope");return r||(u=u.map(c=>(c.between[0].markname=i+pr,c))),n.push({name:s,value:{},on:[{events:u.map(c=>c.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?", extent_x: "+(r?Ia(e,le):`slice(${o.signals.visual})`):"")+(a!==void 0?", extent_y: "+(r?Ia(e,Oe):`slice(${a.signals.visual})`):"")+"}"}]},{name:i+sp,value:{},on:[{events:u,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),o!==void 0&&ef(e,t,o,"width",n),a!==void 0&&ef(e,t,a,"height",n),n}};function ef(e,t,n,i,r){var s;const o=t.name,a=o+rp,u=o+sp,c=n.channel,l=On.has(t),f=r.filter(D=>D.name===n.signals[l?"data":"visual"])[0],d=e.getSizeSignalRef(i).signal,g=e.getScaleComponent(c),p=g.get("type"),m=l&&c===le?"-":"",h=`${a}.extent_${c}`,E=`${m}${u}.${c} / `+(l?`${d}`:`span(${h})`),S=`${l?p==="log"?"panLog":p==="pow"?"panPow":"panLinear":"panLinear"}(${h}, ${E}`+(l&&p==="pow"?`, ${(s=g.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";f.on.push({events:{signal:u},update:l?S:`clampRange(${S}, 0, ${d})`})}const op="_zoom_anchor",ap="_zoom_delta",fE={has:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=On.has(t),s=i+ap,{x:o,y:a}=t.project.hasChannel,u=Y(e.scaleName(le)),c=Y(e.scaleName(Oe));let l=Ui(t.zoom,"scope");return r||(l=l.map(f=>(f.markname=i+pr,f))),n.push({name:i+op,on:[{events:l,update:r?"{"+[u?`x: invert(${u}, x(unit))`:"",c?`y: invert(${c}, y(unit))`:""].filter(f=>!!f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:l,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&tf(e,t,o,"width",n),a!==void 0&&tf(e,t,a,"height",n),n}};function tf(e,t,n,i,r){var s;const o=t.name,a=n.channel,u=On.has(t),c=r.filter(v=>v.name===n.signals[u?"data":"visual"])[0],l=e.getSizeSignalRef(i).signal,f=e.getScaleComponent(a),d=f.get("type"),g=u?Ia(e,a):c.name,p=o+ap,m=`${o}${op}.${a}`,E=`${u?d==="log"?"zoomLog":d==="pow"?"zoomPow":"zoomLinear":"zoomLinear"}(${g}, ${m}, ${p}`+(u&&d==="pow"?`, ${(s=f.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";c.on.push({events:{signal:p},update:u?E:`clampRange(${E}, 0, ${l})`})}const dE=[aE,np,On,ip,lE,fE,tp,ep,uE];function xo(e,t){for(const n of dE)n.has(e)&&t(n)}var gE=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Pi(e,t=!0,n=vh){if(I(e)){const i=e.map(r=>Pi(r,t,n));return t?`[${i.join(", ")}]`:i}else if(fi(e))return n(t?Er(e):zy(e));return t?n(JSON.stringify(e)):e}function pE(e,t){return di(e,(n,i)=>{const r=n.name;let s=i.modifyExpr(e,n);t.push(...i.signals(e,n)),xo(n,o=>{o.signals&&(t=o.signals(e,n,t)),o.modifyExpr&&(s=o.modifyExpr(e,n,s))}),t.push({name:r+SE,on:[{events:{signal:n.name+Ft},update:`modify(${Y(n.name+ri)}, ${s})`}]})}),bc(t)}function hE(e,t){if(e.component.selection&&y(e.component.selection).length){const n=Y(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:Ui("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return bc(t)}function mE(e,t){let n=!1;return di(e,(i,r)=>{const s=i.name,o=Y(s+ri);if(t.filter(u=>u.name===s).length===0){const u=i.resolve==="global"?"union":i.resolve,c=i.type==="multi"?", true)":")";t.push({name:i.name,update:`${fp}(${o}, ${Y(u)}${c}`})}n=!0,r.topLevelSignals&&(t=r.topLevelSignals(e,i,t)),xo(i,u=>{u.topLevelSignals&&(t=u.topLevelSignals(e,i,t))})}),n&&t.filter(r=>r.name==="unit").length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),bc(t)}function bE(e,t){const n=[...t];return di(e,i=>{const r={name:i.name+ri};if(i.init){const o=i.project.items.map(u=>gE(u,["signals"])),a=i.init.map(u=>Pi(u,!1));r.values=i.type==="interval"?[{unit:Xt(e,{escape:!1}),fields:o,values:a}]:a.map(u=>({unit:Xt(e,{escape:!1}),fields:o,values:u}))}n.filter(o=>o.name===i.name+ri).length||n.push(r)}),n}function up(e,t){return di(e,(n,i)=>{t=i.marks?i.marks(e,n,t):t,xo(n,r=>{r.marks&&(t=r.marks(e,n,t))})}),t}function yE(e,t){for(const n of e.children)fe(n)&&(t=up(n,t));return t}function vE(e,t){const n=t.selection,i=e.getSelectionComponent(n,ae(n));return{signal:Ep(i,t)}}function bc(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}var OE=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const pr="_brush",La="_scale_trigger",EE={signals:(e,t)=>{const n=t.name,i=n+Gr,r=On.has(t),s=[],o=[],a=[];if(t.translate&&!r){const l=`!event.item || event.item.mark.name !== ${Y(n+pr)}`;cp(t,(f,d)=>{var g;const p=ge((g=d.between[0].filter)!==null&&g!==void 0?g:d.between[0].filter=[]);return p.indexOf(l)<0&&p.push(l),f})}t.project.items.forEach((l,f)=>{const d=l.channel;if(d!==le&&d!==Oe){O("Interval selections only support x and y encoding channels.");return}const g=t.init?t.init[f]:null,p=xE(e,t,l,g),m=l.signals.data,h=l.signals.visual,E=Y(e.scaleName(d)),v=e.getScaleComponent(d).get("type"),S=Ke(v)?"+":"";s.push(...p),o.push(m),a.push({scaleName:e.scaleName(d),expr:`(!isArray(${m}) || (${S}invert(${E}, ${h})[0] === ${S}${m}[0] && ${S}invert(${E}, ${h})[1] === ${S}${m}[1]))`})}),r||s.push({name:n+La,value:{},on:[{events:a.map(l=>({scale:l.scaleName})),update:a.map(l=>l.expr).join(" && ")+` ? ${n+La} : {}`}]});const u=t.init,c=`unit: ${Xt(e)}, fields: ${i}, values`;return s.concat(Object.assign(Object.assign({name:n+Ft},u?{init:`{${c}: ${Pi(u)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${c}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>t.name+Ft+", "+(t.resolve==="global"?"true":`{unit: ${Xt(e)}}`),marks:(e,t,n)=>{const i=t.name,{x:r,y:s}=t.project.hasChannel,o=r&&r.signals.visual,a=s&&s.signals.visual,u=`data(${Y(t.name+ri)})`;if(On.has(t))return n;const c={x:r!==void 0?{signal:`${o}[0]`}:{value:0},y:s!==void 0?{signal:`${a}[0]`}:{value:0},x2:r!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const h of y(c))c[h]=[Object.assign({test:`${u}.length && ${u}[0].unit === ${Xt(e)}`},c[h]),{value:0}];const l=t.mark,{fill:f,fillOpacity:d,cursor:g}=l,p=OE(l,["fill","fillOpacity","cursor"]),m=y(p).reduce((h,E)=>(h[E]=[{test:[r!==void 0&&`${o}[0] !== ${o}[1]`,s!==void 0&&`${a}[0] !== ${a}[1]`].filter(v=>v).join(" && "),value:p[E]},{value:null}],h),{});return[{name:i+pr+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:c}},...n,{name:i+pr,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},g?{cursor:{value:g}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},c),m)}}]}};function xE(e,t,n,i){const r=n.channel,s=n.signals.visual,o=n.signals.data,a=On.has(t),u=Y(e.scaleName(r)),c=e.getScaleComponent(r),l=c?c.get("type"):void 0,f=m=>`scale(${u}, ${m})`,d=e.getSizeSignalRef(r===le?"width":"height").signal,g=`${r}(unit)`,p=cp(t,(m,h)=>[...m,{events:h.between[0],update:`[${g}, ${g}]`},{events:h,update:`[${s}[0], clamp(${g}, 0, ${d})]`}]);return p.push({events:{signal:t.name+La},update:Ke(l)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),a?[{name:o,on:[]}]:[Object.assign(Object.assign({name:s},i?{init:Pi(i,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},i?{init:Pi(i)}:{}),{on:[{events:{signal:s},update:`${s}[0] === ${s}[1] ? null : invert(${u}, ${s})`}]})]}function cp(e,t){return e.events.reduce((n,i)=>i.between?t(n,i):(O(`${i} is not an ordered event stream for interval selections.`),n),[])}function lp(e,t){const n=t.name,i=n+Gr,r=t.project,s="(item().isVoronoi ? datum.datum : datum)",o=r.items.map(c=>{const l=e.fieldDef(c.channel);return l&&l.bin?`[${s}[${Y(e.vgField(c.channel,{}))}], ${s}[${Y(e.vgField(c.channel,{binSuffix:"end"}))}]]`:`${s}[${Y(c.field)}]`}).join(", "),a=`unit: ${Xt(e)}, fields: ${i}, values`,u=t.events;return[{name:n+Ft,on:u?[{events:u,update:`datum && item().mark.marktype !== 'group' ? {${a}: [${o}]} : null`,force:!0}]:[]}]}const AE={signals:lp,modifyExpr:(e,t)=>t.name+Ft+", "+(t.resolve==="global"?"null":`{unit: ${Xt(e)}}`)},wE={signals:lp,modifyExpr:(e,t)=>t.name+Ft+", "+(t.resolve==="global"?"true":`{unit: ${Xt(e)}}`)},ri="_store",Ft="_tuple",SE="_modify",fp="vlSelectionResolve",CE={single:wE,multi:AE,interval:EE};function di(e,t){const n=e.component.selection;if(n){for(const i of Gt(n))if(t(i,CE[i.type])===!0)break}}function _E(e){let t=e.parent;for(;t&&!at(t);)t=t.parent;return t}function Xt(e,{escape:t}={escape:!0}){let n=t?Y(e.name):e.name;const i=_E(e);if(i){const{facet:r}=i;for(const s of Xe)r[s]&&(n+=` + '__facet_${s}_' + (facet[${Y(i.vgField(s))}])`)}return n}function yc(e){let t=!1;return di(e,n=>{t=t||n.project.items.some(i=>i.field===ki)}),t}const FE="RawCode",jE="Literal",$E="Property",DE="Identifier",TE="ArrayExpression",NE="BinaryExpression",kE="CallExpression",PE="ConditionalExpression",IE="LogicalExpression",RE="MemberExpression",LE="ObjectExpression",BE="UnaryExpression";function pt(e){this.type=e}pt.prototype.visit=function(e){let t,n,i;if(e(this))return 1;for(t=zE(this),n=0,i=t.length;n<i;++n)if(t[n].visit(e))return 1};function zE(e){switch(e.type){case TE:return e.elements;case NE:case IE:return[e.left,e.right];case kE:return[e.callee].concat(e.arguments);case PE:return[e.test,e.consequent,e.alternate];case RE:return[e.object,e.property];case LE:return e.properties;case $E:return[e.key,e.value];case BE:return[e.argument];case DE:case jE:case FE:default:return[]}}var Rt,T,b,_e,ee,Ao=1,Hr=2,si=3,Tn=4,wo=5,gi=6,Ie=7,qr=8,ME=9;Rt={};Rt[Ao]="Boolean";Rt[Hr]="<end>";Rt[si]="Identifier";Rt[Tn]="Keyword";Rt[wo]="Null";Rt[gi]="Numeric";Rt[Ie]="Punctuator";Rt[qr]="String";Rt[ME]="RegularExpression";var UE="ArrayExpression",WE="BinaryExpression",GE="CallExpression",HE="ConditionalExpression",dp="Identifier",qE="Literal",VE="LogicalExpression",XE="MemberExpression",YE="ObjectExpression",JE="Property",KE="UnaryExpression",Ae="Unexpected token %0",QE="Unexpected number",ZE="Unexpected string",ex="Unexpected identifier",tx="Unexpected reserved word",nx="Unexpected end of input",Ba="Invalid regular expression",ra="Invalid regular expression: missing /",gp="Octal literals are not allowed in strict mode.",ix="Duplicate data property in object literal not allowed in strict mode",we="ILLEGAL",Sr="Disabled.",rx=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),sx=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function So(e,t){if(!e)throw new Error("ASSERT: "+t)}function Ut(e){return e>=48&&e<=57}function vc(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function hr(e){return"01234567".indexOf(e)>=0}function ox(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Cr(e){return e===10||e===13||e===8232||e===8233}function Vr(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&rx.test(String.fromCharCode(e))}function Ns(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&sx.test(String.fromCharCode(e))}const ax={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function pp(){for(;b<_e;){const e=T.charCodeAt(b);if(ox(e)||Cr(e))++b;else break}}function za(e){var t,n,i,r=0;for(n=e==="u"?4:2,t=0;t<n;++t)b<_e&&vc(T[b])?(i=T[b++],r=r*16+"0123456789abcdef".indexOf(i.toLowerCase())):X({},Ae,we);return String.fromCharCode(r)}function ux(){var e,t,n,i;for(e=T[b],t=0,e==="}"&&X({},Ae,we);b<_e&&(e=T[b++],!!vc(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&X({},Ae,we),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,i=(t-65536&1023)+56320,String.fromCharCode(n,i))}function hp(){var e,t;for(e=T.charCodeAt(b++),t=String.fromCharCode(e),e===92&&(T.charCodeAt(b)!==117&&X({},Ae,we),++b,e=za("u"),(!e||e==="\\"||!Vr(e.charCodeAt(0)))&&X({},Ae,we),t=e);b<_e&&(e=T.charCodeAt(b),!!Ns(e));)++b,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),T.charCodeAt(b)!==117&&X({},Ae,we),++b,e=za("u"),(!e||e==="\\"||!Ns(e.charCodeAt(0)))&&X({},Ae,we),t+=e);return t}function cx(){var e,t;for(e=b++;b<_e;){if(t=T.charCodeAt(b),t===92)return b=e,hp();if(Ns(t))++b;else break}return T.slice(e,b)}function lx(){var e,t,n;return e=b,t=T.charCodeAt(b)===92?hp():cx(),t.length===1?n=si:ax.hasOwnProperty(t)?n=Tn:t==="null"?n=wo:t==="true"||t==="false"?n=Ao:n=si,{type:n,value:t,start:e,end:b}}function sa(){var e=b,t=T.charCodeAt(b),n,i=T[b],r,s,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++b,{type:Ie,value:String.fromCharCode(t),start:e,end:b};default:if(n=T.charCodeAt(b+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return b+=2,{type:Ie,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:b};case 33:case 61:return b+=2,T.charCodeAt(b)===61&&++b,{type:Ie,value:T.slice(e,b),start:e,end:b}}}if(o=T.substr(b,4),o===">>>=")return b+=4,{type:Ie,value:o,start:e,end:b};if(s=o.substr(0,3),s===">>>"||s==="<<="||s===">>=")return b+=3,{type:Ie,value:s,start:e,end:b};if(r=s.substr(0,2),i===r[1]&&"+-<>&|".indexOf(i)>=0||r==="=>")return b+=2,{type:Ie,value:r,start:e,end:b};if(r==="//"&&X({},Ae,we),"<>=!+-*%&|^/".indexOf(i)>=0)return++b,{type:Ie,value:i,start:e,end:b};X({},Ae,we)}function fx(e){let t="";for(;b<_e&&vc(T[b]);)t+=T[b++];return t.length===0&&X({},Ae,we),Vr(T.charCodeAt(b))&&X({},Ae,we),{type:gi,value:parseInt("0x"+t,16),start:e,end:b}}function dx(e){let t="0"+T[b++];for(;b<_e&&hr(T[b]);)t+=T[b++];return(Vr(T.charCodeAt(b))||Ut(T.charCodeAt(b)))&&X({},Ae,we),{type:gi,value:parseInt(t,8),octal:!0,start:e,end:b}}function nf(){var e,t,n;if(n=T[b],So(Ut(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=b,e="",n!=="."){if(e=T[b++],n=T[b],e==="0"){if(n==="x"||n==="X")return++b,fx(t);if(hr(n))return dx(t);n&&Ut(n.charCodeAt(0))&&X({},Ae,we)}for(;Ut(T.charCodeAt(b));)e+=T[b++];n=T[b]}if(n==="."){for(e+=T[b++];Ut(T.charCodeAt(b));)e+=T[b++];n=T[b]}if(n==="e"||n==="E")if(e+=T[b++],n=T[b],(n==="+"||n==="-")&&(e+=T[b++]),Ut(T.charCodeAt(b)))for(;Ut(T.charCodeAt(b));)e+=T[b++];else X({},Ae,we);return Vr(T.charCodeAt(b))&&X({},Ae,we),{type:gi,value:parseFloat(e),start:t,end:b}}function gx(){var e="",t,n,i,r,s=!1;for(t=T[b],So(t==="'"||t==='"',"String literal must starts with a quote"),n=b,++b;b<_e;)if(i=T[b++],i===t){t="";break}else if(i==="\\")if(i=T[b++],!i||!Cr(i.charCodeAt(0)))switch(i){case"u":case"x":T[b]==="{"?(++b,e+=ux()):e+=za(i);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:hr(i)?(r="01234567".indexOf(i),r!==0&&(s=!0),b<_e&&hr(T[b])&&(s=!0,r=r*8+"01234567".indexOf(T[b++]),"0123".indexOf(i)>=0&&b<_e&&hr(T[b])&&(r=r*8+"01234567".indexOf(T[b++]))),e+=String.fromCharCode(r)):e+=i;break}else i==="\r"&&T[b]===`
`&&++b;else{if(Cr(i.charCodeAt(0)))break;e+=i}return t!==""&&X({},Ae,we),{type:qr,value:e,octal:s,start:n,end:b}}function px(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(i,r)=>{if(parseInt(r,16)<=1114111)return"x";X({},Ba)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(i){X({},Ba)}try{return new RegExp(e,t)}catch(i){return null}}function hx(){var e,t,n,i,r;for(e=T[b],So(e==="/","Regular expression literal must start with a slash"),t=T[b++],n=!1,i=!1;b<_e;)if(e=T[b++],t+=e,e==="\\")e=T[b++],Cr(e.charCodeAt(0))&&X({},ra),t+=e;else if(Cr(e.charCodeAt(0)))X({},ra);else if(n)e==="]"&&(n=!1);else if(e==="/"){i=!0;break}else e==="["&&(n=!0);return i||X({},ra),r=t.substr(1,t.length-2),{value:r,literal:t}}function mx(){var e,t,n;for(t="",n="";b<_e&&(e=T[b],!!Ns(e.charCodeAt(0)));)++b,e==="\\"&&b<_e?X({},Ae,we):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&X({},Ba,n),{value:n,literal:t}}function bx(){var e,t,n,i;return ee=null,pp(),e=b,t=hx(),n=mx(),i=px(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:b}}function yx(e){return e.type===si||e.type===Tn||e.type===Ao||e.type===wo}function mp(){if(pp(),b>=_e)return{type:Hr,start:b,end:b};const e=T.charCodeAt(b);return Vr(e)?lx():e===40||e===41||e===59?sa():e===39||e===34?gx():e===46?Ut(T.charCodeAt(b+1))?nf():sa():Ut(e)?nf():sa()}function Re(){const e=ee;return b=e.end,ee=mp(),b=e.end,e}function bp(){const e=b;ee=mp(),b=e}function vx(e){const t=new pt(UE);return t.elements=e,t}function rf(e,t,n){const i=new pt(e==="||"||e==="&&"?VE:WE);return i.operator=e,i.left=t,i.right=n,i}function Ox(e,t){const n=new pt(GE);return n.callee=e,n.arguments=t,n}function Ex(e,t,n){const i=new pt(HE);return i.test=e,i.consequent=t,i.alternate=n,i}function Oc(e){const t=new pt(dp);return t.name=e,t}function ur(e){const t=new pt(qE);return t.value=e.value,t.raw=T.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function sf(e,t,n){const i=new pt(XE);return i.computed=e==="[",i.object=t,i.property=n,i.computed||(n.member=!0),i}function xx(e){const t=new pt(YE);return t.properties=e,t}function of(e,t,n){const i=new pt(JE);return i.key=t,i.value=n,i.kind=e,i}function Ax(e,t){const n=new pt(KE);return n.operator=e,n.argument=t,n.prefix=!0,n}function X(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,(s,o)=>(So(o<i.length,"Message reference must be in range"),i[o]));throw n=new Error(r),n.index=b,n.description=r,n}function Co(e){e.type===Hr&&X(e,nx),e.type===gi&&X(e,QE),e.type===qr&&X(e,ZE),e.type===si&&X(e,ex),e.type===Tn&&X(e,tx),X(e,Ae,e.value)}function Fe(e){const t=Re();(t.type!==Ie||t.value!==e)&&Co(t)}function oe(e){return ee.type===Ie&&ee.value===e}function oa(e){return ee.type===Tn&&ee.value===e}function wx(){const e=[];for(b=ee.start,Fe("[");!oe("]");)oe(",")?(Re(),e.push(null)):(e.push(oi()),oe("]")||Fe(","));return Re(),vx(e)}function af(){b=ee.start;const e=Re();return e.type===qr||e.type===gi?(e.octal&&X(e,gp),ur(e)):Oc(e.value)}function Sx(){var e,t,n,i;if(b=ee.start,e=ee,e.type===si)return n=af(),Fe(":"),i=oi(),of("init",n,i);if(e.type===Hr||e.type===Ie)Co(e);else return t=af(),Fe(":"),i=oi(),of("init",t,i)}function Cx(){var e=[],t,n,i,r={},s=String;for(b=ee.start,Fe("{");!oe("}");)t=Sx(),t.key.type===dp?n=t.key.name:n=s(t.key.value),i="$"+n,Object.prototype.hasOwnProperty.call(r,i)?X({},ix):r[i]=!0,e.push(t),oe("}")||Fe(",");return Fe("}"),xx(e)}function _x(){Fe("(");const e=Ec();return Fe(")"),e}const Fx={if:1};function jx(){var e,t,n;if(oe("("))return _x();if(oe("["))return wx();if(oe("{"))return Cx();if(e=ee.type,b=ee.start,e===si||Fx[ee.value])n=Oc(Re().value);else if(e===qr||e===gi)ee.octal&&X(ee,gp),n=ur(Re());else{if(e===Tn)throw new Error(Sr);e===Ao?(t=Re(),t.value=t.value==="true",n=ur(t)):e===wo?(t=Re(),t.value=null,n=ur(t)):oe("/")||oe("/=")?(n=ur(bx()),bp()):Co(Re())}return n}function $x(){const e=[];if(Fe("("),!oe(")"))for(;b<_e&&(e.push(oi()),!oe(")"));)Fe(",");return Fe(")"),e}function Dx(){b=ee.start;const e=Re();return yx(e)||Co(e),Oc(e.value)}function Tx(){return Fe("."),Dx()}function Nx(){Fe("[");const e=Ec();return Fe("]"),e}function kx(){var e,t,n;for(e=jx();;)if(oe("."))n=Tx(),e=sf(".",e,n);else if(oe("("))t=$x(),e=Ox(e,t);else if(oe("["))n=Nx(),e=sf("[",e,n);else break;return e}function uf(){const e=kx();if(ee.type===Ie&&(oe("++")||oe("--")))throw new Error(Sr);return e}function ms(){var e,t;if(ee.type!==Ie&&ee.type!==Tn)t=uf();else{if(oe("++")||oe("--"))throw new Error(Sr);if(oe("+")||oe("-")||oe("~")||oe("!"))e=Re(),t=ms(),t=Ax(e.value,t);else{if(oa("delete")||oa("void")||oa("typeof"))throw new Error(Sr);t=uf()}}return t}function cf(e){let t=0;if(e.type!==Ie&&e.type!==Tn)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function Px(){var e,t,n,i,r,s,o,a,u,c;if(e=ee,u=ms(),i=ee,r=cf(i),r===0)return u;for(i.prec=r,Re(),t=[e,ee],o=ms(),s=[u,i,o];(r=cf(ee))>0;){for(;s.length>2&&r<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),t.pop(),n=rf(a,u,o),s.push(n);i=Re(),i.prec=r,s.push(i),t.push(ee),n=ms(),s.push(n)}for(c=s.length-1,n=s[c],t.pop();c>1;)t.pop(),n=rf(s[c-1].value,s[c-2],n),c-=2;return n}function oi(){var e,t,n;return e=Px(),oe("?")&&(Re(),t=oi(),Fe(":"),n=oi(),e=Ex(e,t,n)),e}function Ec(){const e=oi();if(oe(","))throw new Error(Sr);return e}function Ix(e){T=e,b=0,_e=T.length,ee=null,bp();const t=Ec();if(ee.type!==Hr)throw new Error("Unexpect token after expression.");return t}function Ma(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...Ma(e.object)),t.push(...Ma(e.property))),t)}function yp(e){return e.object.type==="MemberExpression"?yp(e.object):e.object.name==="datum"}function vp(e){const t=Ix(e),n=new Set;return t.visit(i=>{i.type==="MemberExpression"&&yp(i)&&n.add(Ma(i).slice(1).join("."))}),n}class Vi extends ne{constructor(t,n,i){super(t),this.model=n,this.filter=i,this.expr=ks(this.model,this.filter,this),this._dependentFields=vp(this.expr)}clone(){return new Vi(null,this.model,G(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}var Rx=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Lx(e,t){var n;const i={},r=e.config.selection;for(const s of y(t!=null?t:{})){const o=G(t[s]),a=r[o.type],u=Rx(a,["fields","encodings"]);for(const f in u)f==="encodings"&&o.fields||f==="fields"&&o.encodings||(f==="mark"&&(o[f]=Object.assign(Object.assign({},u[f]),o[f])),(o[f]===void 0||o[f]===!0)&&(o[f]=(n=u[f])!==null&&n!==void 0?n:o[f]));const c=ae(s),l=i[c]=Object.assign(Object.assign({},o),{name:c,events:W(o.on)?Ui(o.on,"scope"):G(o.on)});xo(l,f=>{f.has(l)&&f.parse&&f.parse(e,l,o,t[s])})}return i}function Op(e,t,n,i="datum"){const r=[];function s(a){const u=ae(a),c=e.getSelectionComponent(u,a),l=Y(u+ri);if(c.project.timeUnit){const f=n!=null?n:e.component.data.raw,d=c.project.timeUnit.clone();f.parent?d.insertAsParentOf(f):f.parent=d}return c.empty!=="none"&&r.push(l),`vlSelectionTest(${l}, ${i}`+(c.resolve==="global"?")":`, ${Y(c.resolve)})`)}const o=wi(t,s);return(r.length?"!("+r.map(a=>`length(data(${a}))`).join(" || ")+") || ":"")+`(${o})`}function Ep(e,t){const n=t.encoding;let i=t.field;if(!n&&!i)i=e.project.items[0].field,e.project.items.length>1&&O(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${Y(i)}.`);else if(n&&!i){const r=e.project.items.filter(s=>s.channel===n);!r.length||r.length>1?(i=e.project.items[0].field,O((r.length?"Multiple ":"No ")+`matching ${Y(n)} encoding found for selection ${Y(t.selection)}. Using "field": ${Y(i)}.`)):i=r[0].field}return`${e.name}[${Y(i)}]`}function Bx(e,t){di(e,n=>{const i=n.name,r=e.getName(`lookup_${i}`);e.component.data.outputNodes[r]=n.materialized=new De(new Vi(t,e,{selection:i}),r,re.Lookup,e.component.data.outputNodeRefCounts)})}function ks(e,t,n){return wi(t,i=>W(i)?i:Zy(i)?Op(e,i.selection,n):Id(i))}var ns=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function zx(e,t){if(e)return I(e)&&!gn(e)?e.map(n=>Zu(n,t)).join(", "):e}function aa(e,t,n,i){var r,s,o;e.encode=(r=e.encode)!==null&&r!==void 0?r:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=i}function cr(e,t,n,i={header:!1}){var r,s;const o=e.combine(),{disable:a,orient:u,scale:c,labelExpr:l,title:f,zindex:d}=o,g=ns(o,["disable","orient","scale","labelExpr","title","zindex"]);if(!a){for(const p in g){const m=ob[p],h=g[p];if(m&&m!==t&&m!=="both")delete g[p];else if(Nr(h)){const{condition:E}=h,v=ns(h,["condition"]),S=ge(E),D=pl[p];if(D){const{vgProp:x,part:N}=D,w=[...S.map(B=>{const{test:K}=B,ie=ns(B,["test"]);return Object.assign({test:ks(null,K)},ie)}),v];aa(g,N,x,w),delete g[p]}else if(D===null){const x={signal:S.map(N=>{const{test:w}=N,B=ns(N,["test"]);return`${ks(null,w)} ? ${Nl(B)} : `}).join("")+Nl(v)};g[p]=x}}else if(z(h)){const E=pl[p];if(E){const{vgProp:v,part:S}=E;aa(g,S,v,h),delete g[p]}}}if(t==="grid"){if(!g.grid)return;if(g.encode){const{grid:p}=g.encode;g.encode=Object.assign({},p?{grid:p}:{}),te(g.encode)&&delete g.encode}return Object.assign(Object.assign({scale:c,orient:u},g),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:pe(d,0)})}else{if(!i.header&&e.mainExtracted)return;if(l!==void 0){let m=l;!((s=(r=g.encode)===null||r===void 0?void 0:r.labels)===null||s===void 0)&&s.update&&z(g.encode.labels.update.text)&&(m=Zn(l,"datum.label",g.encode.labels.update.text.signal)),aa(g,"labels","text",{signal:m})}if(g.labelAlign===null&&delete g.labelAlign,g.encode){for(const m of cd)e.hasAxisPart(m)||delete g.encode[m];te(g.encode)&&delete g.encode}const p=zx(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:c,orient:u,grid:!1},p?{title:p}:{}),g),n.aria===!1?{aria:!1}:{}),{zindex:pe(d,0)})}}}function xp(e){const{axes:t}=e.component,n=[];for(const i of Je)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const s=i==="x"?"height":"width",o=e.getSizeSignalRef(s).signal;s!==o&&n.push({name:s,update:o})}}return n}function Mx(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>cr(r,"grid",t)),...i.map(r=>cr(r,"grid",t)),...n.map(r=>cr(r,"main",t)),...i.map(r=>cr(r,"main",t))].filter(r=>r)}function lf(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const s=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},a=t[n==="x"?"axisTop":"axisRight"]||{},u=new Set([...y(o),...y(a)]),c={};for(const l of u.values())c[l]={signal:`${i.signal} === "${s}" ? ${Vt(o[l])} : ${Vt(a[l])}`};return c}return t[r]})])}function Ux(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:lv(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",o=z(n)?"axisOrient":"axis"+Tr(n),a=[...r,...r.map(c=>s+c.substr(4))],u=["axis",o,s];return{vlOnlyAxisConfig:lf(a,i,e,n),vgAxisConfig:lf(u,i,e,n),axisConfigStyle:Wx([...u,...a],i)}}function Wx(e,t){var n;const i=[{}];for(const r of e){let s=(n=t[r])===null||n===void 0?void 0:n.style;if(s){s=ge(s);for(const o of s)i.push(t.style[o])}}return Object.assign.apply(null,i)}function Ua(e,t,n,i={}){var r;const s=pg(e,n,t);if(s!==void 0)return{configFrom:"style",configValue:s};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((r=i[o])===null||r===void 0?void 0:r[e])!==void 0)return{configFrom:o,configValue:i[o][e]};return{}}const ff={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:r}=n;return Jd(e,e.type,i,r,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return Kd(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return F(e)&&je(e.bin)?!1:(i=t.grid)!==null&&i!==void 0?i:Gx(n,e)},gridScale:({model:e,channel:t})=>Hx(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||wp(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||Ap(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return(i=e.labelFlush)!==null&&i!==void 0?i:Vx(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return(i=e.labelOverlap)!==null&&i!==void 0?i:Xx(t.type,n,F(t)&&!!t.timeUnit,F(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var s;const o=e==="x"?"width":e==="y"?"height":void 0,a=o?t.getSizeSignalRef(o):void 0;return(s=n.tickCount)!==null&&s!==void 0?s:Jx({fieldOrDatumDef:i,scaleType:r,size:a,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=Sp(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),s=n==="x"?"x2":"y2",o=t.fieldDef(s);return mg(r?[Dl(r)]:[],F(o)?[Dl(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>Kx(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return(i=e.zindex)!==null&&i!==void 0?i:Qx(n,t)}};function Gx(e,t){return!ze(e)&&F(t)&&!ue(t==null?void 0:t.bin)}function Hx(e,t){const n=t==="x"?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}function qx(e,t,n,i,r){const s=t==null?void 0:t.labelAngle;if(s!==void 0)return z(s)?s:Or(s);{const{configValue:o}=Ua("labelAngle",i,t==null?void 0:t.style,r);return o!==void 0?Or(o):n===le&&L([Bu,Lu],e.type)&&!(F(e)&&e.timeUnit)?270:void 0}}function Wa(e){return`(((${e.signal} % 360) + 360) % 360)`}function Ap(e,t,n,i){if(e!==void 0)if(n==="x"){if(z(e)){const r=Wa(e),s=z(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${s} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(z(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==(t==="top")?"bottom":"top"}else{if(z(e)){const r=Wa(e),s=z(t)?`(${t.signal} === "left")`:t==="left";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${i?'"middle"':"null"} : (45 <= ${r} && ${r} <= 135) === ${s} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(z(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==(t==="left")?"top":"bottom"}}function wp(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,s=i?"bottom":"left";if(z(e)){const o=Wa(e),a=z(t)?`(${t.signal} === "${s}")`:t===s;return{signal:`(${r?"("+o+" + 90)":o} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${o} && ${o} < ${180+r}) === ${a} ? "left" : "right"`}}if((e+r)%180===0)return i?null:"center";if(z(t)){const o=r<e&&e<180+r?"===":"!==";return{signal:`${`${t.signal} ${o} "${s}"`} ? "left" : "right"`}}return(r<e&&e<180+r)==(t===s)?"left":"right"}function Vx(e,t){if(t==="x"&&L(["quantitative","temporal"],e))return!0}function Xx(e,t,n,i){if(n&&!ye(i)||e!=="nominal"&&e!=="ordinal")return t==="log"||t==="symlog"?"greedy":!0}function Yx(e){return e==="x"?"bottom":"left"}function Jx({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!ze(t)&&t!=="log"){if(F(e)){if(ue(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&L(["month","hours","day","quarter"],(r=Te(e.timeUnit))===null||r===void 0?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}}function Sp(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),s=i?i.title:void 0,o=r?r.title:void 0;if(s&&o)return bg(s,o);if(s)return s;if(o)return o;if(s!==void 0)return s;if(o!==void 0)return o}function Kx(e,t){const n=e.values;if(I(n))return lg(t,n);if(z(n))return n}function Qx(e,t){return e==="rect"&&rg(t)?1:0}class Ii extends ne{constructor(t,n){super(t),this.transform=n,this._dependentFields=vp(this.transform.calculate)}clone(){return new Ii(null,G(this.transform))}static parseAllForSortIndex(t,n){return n.forEachFieldDef((i,r)=>{if(go(i)&&tg(i.sort)){const{field:s,timeUnit:o}=i,a=i.sort,u=a.map((c,l)=>`${Id({field:s,timeUnit:o,equal:c})} ? ${l} : `).join("")+a.length;t=new Ii(t,{calculate:u,as:Ri(i,r,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${V(this.transform)}`}}function Ri(e,t,n){return C(e,Object.assign({prefix:t,suffix:"sort_index"},n!=null?n:{}))}function _o(e,t){return L(["top","bottom"],t)?"column":L(["left","right"],t)||e==="row"?"row":"column"}function Li(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return pe((t||{})[e],r[e],n.header[e])}function Fo(e,t,n,i){const r={};for(const s of e){const o=Li(s,t||{},n,i);o!==void 0&&(r[s]=o)}return r}const xc=["row","column"],Ac=["header","footer"];function Zx(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=Fo(["titleAnchor","titleAngle","titleOrient"],r.header,i,t),u=_o(t,a),c=Or(o);return{name:`${t}-title`,type:"group",role:`${u}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),_p(c,u)),Cp(u,c,s)),Fp(i,r,t,_O,Tg))}}function Cp(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=wp(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function _p(e,t){const n=Ap(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function eA(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of Ac)if(n[r])for(const s of n[r]){const o=nA(e,t,r,n,s);o!=null&&i.push(o)}return i}function tA(e,t){var n;const{sort:i}=e;return xt(i)?{field:C(i,{expr:"datum"}),order:(n=i.order)!==null&&n!==void 0?n:"ascending"}:I(i)?{field:Ri(e,t,{expr:"datum"}),order:"ascending"}:{field:C(e,{expr:"datum"}),order:i!=null?i:"ascending"}}function Ga(e,t,n){const{format:i,formatType:r,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:u}=Fo(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),c=Hu({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,l=_o(t,a);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:u?Zn(Zn(u,"datum.label",c),"datum.value",C(e,{expr:"parent"})):c}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),_p(s,l)),Cp(l,s,o)),Fp(n,e,t,FO,Ng))}function nA(e,t,n,i,r){if(r){let s=null;const{facetFieldDef:o}=i,a=e.config?e.config:void 0;if(o&&r.labels){const{labelOrient:f}=Fo(["labelOrient"],o.header,a,t);(t==="row"&&!L(["top","bottom"],f)||t==="column"&&!L(["left","right"],f))&&(s=Ga(o,t,a))}const u=at(e)&&!Mr(e.facet),c=r.axes,l=(c==null?void 0:c.length)>0;if(s||l){const f=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:tA(o,t)}:{}),l&&u?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),s?{title:s}:{}),r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{}),l?{axes:c}:{})}}return null}const iA={column:{start:0,end:1},row:{start:1,end:0}};function rA(e,t){return iA[t][e]}function sA(e,t){const n={};for(const i of Xe){const r=e[i];if(r!=null&&r.facetFieldDef){const{titleAnchor:s,titleOrient:o}=Fo(["titleAnchor","titleOrient"],r.facetFieldDef.header,t,i),a=_o(i,o),u=rA(s,a);u!==void 0&&(n[a]=u)}}return te(n)?void 0:n}function Fp(e,t,n,i,r){const s={};for(const o of i){if(!r[o])continue;const a=Li(o,t==null?void 0:t.header,e,n);a!==void 0&&(s[r[o]]=a)}return s}function wc(e){return[...is(e,"width"),...is(e,"height"),...is(e,"childWidth"),...is(e,"childHeight")]}function is(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const s=e.getScaleComponent(n);if(s){const o=s.get("type"),a=s.get("range");if(ze(o)&&jn(a)){const u=e.scaleName(n);return at(e.parent)&&e.parent.component.resolve.scale[n]==="independent"?[df(u,a)]:[df(u,a),{name:r,update:jp(u,s,`domain('${u}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const s=r.endsWith("width"),o=s?"containerSize()[0]":"containerSize()[1]",a=ka(e.config.view,s?"width":"height"),u=`isFinite(${o}) ? ${o} : ${a}`;return[{name:r,init:u,on:[{update:u,events:"window:resize"}]}]}else return[{name:r,value:i}]}function df(e,t){return{name:e+"_step",value:t.step}}function jp(e,t,n){const i=t.get("type"),r=t.get("padding"),s=pe(t.get("paddingOuter"),r);let o=t.get("paddingInner");return o=i==="band"?o!==void 0?o:r:1,`bandspace(${n}, ${Vt(o)}, ${Vt(s)}) * ${e}_step`}function $p(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function Dp(e,t){return y(e).reduce((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),qi(t,r,i,s=>ce(s.value)))},{})}function oA(e,t){if(Ji(t)||at(t))return"shared";if(Dc(t))return St(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function Sc(e,t){const n=e.scale[t],i=St(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&O(by(t)),"independent"):e[i][t]||"shared"}const aA=Object.assign(Object.assign({},DO),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),Tp=y(aA);class uA extends on{}const gf={symbols:cA,gradient:lA,labels:fA,entries:dA};function cA(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:s}){var o,a,u,c,l,f,d,g;if(s!=="symbol")return;const{markDef:p,encoding:m,config:h,mark:E}=n,v=p.filled&&E!=="trail";let S=Object.assign(Object.assign({},oO({},n,$v)),Kg(n,{filled:v}));const D=(o=r.get("symbolOpacity"))!==null&&o!==void 0?o:h.legend.symbolOpacity,x=(a=r.get("symbolFillColor"))!==null&&a!==void 0?a:h.legend.symbolFillColor,N=(u=r.get("symbolStrokeColor"))!==null&&u!==void 0?u:h.legend.symbolStrokeColor,w=D===void 0?(c=Np(m.opacity))!==null&&c!==void 0?c:p.opacity:void 0;if(S.fill){if(i==="fill"||v&&i===Le)delete S.fill;else if(S.fill.field)x?delete S.fill:(S.fill=ce((l=h.legend.symbolBaseFillColor)!==null&&l!==void 0?l:"black"),S.fillOpacity=ce(w!=null?w:1));else if(I(S.fill)){const B=(g=(d=Ha((f=m.fill)!==null&&f!==void 0?f:m.color))!==null&&d!==void 0?d:p.fill)!==null&&g!==void 0?g:v&&p.color;B&&(S.fill=ce(B))}}if(S.stroke){if(i==="stroke"||!v&&i===Le)delete S.stroke;else if(S.stroke.field||N)delete S.stroke;else if(I(S.stroke)){const B=pe(Ha(m.stroke||m.color),p.stroke,v?p.color:void 0);B&&(S.stroke={value:B})}}if(i!==rn){const B=F(t)&&Pp(n,r,t);B?S.opacity=[Object.assign({test:B},ce(w!=null?w:1)),ce(h.legend.unselectedOpacity)]:w&&(S.opacity=ce(w))}return S=Object.assign(Object.assign({},S),e),te(S)?void 0:S}function lA(e,{model:t,legendType:n,legendCmpt:i}){var r;if(n!=="gradient")return;const{config:s,markDef:o,encoding:a}=t;let u={};const l=((r=i.get("gradientOpacity"))!==null&&r!==void 0?r:s.legend.gradientOpacity)===void 0?Np(a.opacity)||o.opacity:void 0;return l&&(u.opacity=ce(l)),u=Object.assign(Object.assign({},u),e),te(u)?void 0:u}function fA(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const s=n.legend(i)||{},o=n.config,a=F(t)?Pp(n,r,t):void 0,u=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:c,formatType:l}=s,f=ni(l)?qu({fieldOrDatumDef:t,field:"datum.value",format:c,formatType:l,config:o}):void 0,d=Object.assign(Object.assign(Object.assign({},u?{opacity:u}:{}),f?{text:f}:{}),e);return te(d)?void 0:d}function dA(e,{legendCmpt:t}){const n=t.get("selections");return n!=null&&n.length?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}function Np(e){return kp(e,(t,n)=>Math.max(t,n.value))}function Ha(e){return kp(e,(t,n)=>pe(t,n.value))}function kp(e,t){if(Xv(e))return ge(e.condition).reduce(t,e.value);if(ut(e))return e.value}function Pp(e,t,n){const i=t.get("selections");if(!(i!=null&&i.length))return;const r=Y(n.field);return i.map(s=>`(!length(data(${Y(ae(s)+ri)})) || (${s}[${r}] && indexof(${s}[${r}], datum.value) >= 0))`).join(" || ")}const pf={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return Jd(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return Kd(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:r}=e;return(n=(t=i.gradientLength)!==null&&t!==void 0?t:r.gradientLength)!==null&&n!==void 0?n:vA(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return(r=(i=e.labelOverlap)!==null&&i!==void 0?i:t.labelOverlap)!==null&&r!==void 0?r:OA(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return(r=e.symbolType)!==null&&r!==void 0?r:pA(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>Ci(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Si(n)&&st(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>gA(t,e)};function gA(e,t){const n=e.values;if(I(n))return lg(t,n);if(z(n))return n}function pA(e,t,n,i){var r;if(t!=="shape"){const s=(r=Ha(n))!==null&&r!==void 0?r:i;if(s)return s}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function hA(e){const{legend:t}=e;return pe(t.type,mA(e))}function mA({channel:e,timeUnit:t,scaleType:n}){if(Si(e)){if(L(["quarter","month","day"],t))return"symbol";if(st(n))return"gradient"}return"symbol"}function bA({legendConfig:e,legendType:t,orient:n,legend:i}){var r,s;return(s=(r=i.direction)!==null&&r!==void 0?r:e[t?"gradientDirection":"symbolDirection"])!==null&&s!==void 0?s:yA(n,t)}function yA(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function vA({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:u}=e;if(st(r))return n==="horizontal"?i==="top"||i==="bottom"?hf(t,"width",o,s):o:hf(t,"height",u,a)}function hf(e,t,n,i){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${i})`}}function OA(e){if(L(["quantile","threshold","log","symlog"],e))return"greedy"}function Ip(e){const t=fe(e)?EA(e):SA(e);return e.component.legends=t,t}function EA(e){const{encoding:t}=e,n={};for(const i of[Le,...Pg]){const r=ve(t[i]);!r||!e.getScaleComponent(i)||i===Be&&F(r)&&r.type===Hi||(n[i]=wA(e,i))}return n}function xA(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function AA(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n!=null&&n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function wA(e,t){var n,i,r;let s=e.legend(t);const{markDef:o,encoding:a,config:u}=e,c=u.legend,l=new uA({},xA(e,t));cE(e,t,l);const f=s!==void 0?!s:c.disable;if(l.set("disable",f,s!==void 0),f)return l;s=s||{};const d=e.getScaleComponent(t).get("type"),g=ve(a[t]),p=F(g)?(n=Te(g.timeUnit))===null||n===void 0?void 0:n.unit:void 0,m=s.orient||u.legend.orient||"right",h=hA({legend:s,channel:t,timeUnit:p,scaleType:d}),E=bA({legend:s,legendType:h,orient:m,legendConfig:c}),v={legend:s,channel:t,model:e,markDef:o,encoding:a,fieldOrDatumDef:g,legendConfig:c,config:u,scaleType:d,orient:m,legendType:h,direction:E};for(const w of Tp){if(h==="gradient"&&w.startsWith("symbol")||h==="symbol"&&w.startsWith("gradient"))continue;const B=w in pf?pf[w](v):s[w];if(B!==void 0){const K=AA(B,w,s,e.fieldDef(t));(K||u.legend[w]===void 0)&&l.set(w,B,K)}}const S=(i=s==null?void 0:s.encoding)!==null&&i!==void 0?i:{},D=l.get("selections"),x={},N={fieldOrDatumDef:g,model:e,channel:t,legendCmpt:l,legendType:h};for(const w of["labels","legend","title","symbols","gradient","entries"]){const B=Dp((r=S[w])!==null&&r!==void 0?r:{},e),K=w in gf?gf[w](B,N):B;K!==void 0&&!te(K)&&(x[w]=Object.assign(Object.assign(Object.assign({},D!=null&&D.length&&F(g)?{name:`${ae(g.field)}_legend_${w}`}:{}),D!=null&&D.length?{interactive:!!D}:{}),{update:K}))}return te(x)||l.set("encode",x,!!(s!=null&&s.encoding)),l}function SA(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){Ip(i);for(const r of y(i.component.legends))n.legend[r]=Sc(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=Rp(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of y(t))for(const r of e.children)r.component.legends[i]&&n.legend[i]==="shared"&&delete r.component.legends[i];return t}function Rp(e,t){var n,i,r,s;if(!e)return t.clone();const o=e.getWithExplicit("orient"),a=t.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;let u=!1;for(const c of Tp){const l=yn(e.getWithExplicit(c),t.getWithExplicit(c),c,"legend",(f,d)=>{switch(c){case"symbolType":return CA(f,d);case"title":return yg(f,d);case"type":return u=!0,Ue("symbol")}return Oo(f,d,c,"legend")});e.setWithExplicit(c,l)}return u&&(!((i=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||i===void 0)&&i.gradient&&Os(e.implicit,["encode","gradient"]),!((s=(r=e.explicit)===null||r===void 0?void 0:r.encode)===null||s===void 0)&&s.gradient&&Os(e.explicit,["encode","gradient"])),e}function CA(e,t){return t.value==="circle"?t:e}var _A=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function FA(e,t,n,i){var r,s,o;e.encode=(r=e.encode)!==null&&r!==void 0?r:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=i}function Lp(e){const t=e.component.legends,n={};for(const r of y(t)){const s=e.getScaleComponent(r),o=se(s.get("domains"));if(n[o])for(const a of n[o])Rp(a,t[r])||n[o].push(t[r]);else n[o]=[t[r].clone()]}return Gt(n).flat().map(r=>jA(r,e.config)).filter(r=>r!==void 0)}function jA(e,t){var n,i,r;const s=e.combine(),{disable:o,labelExpr:a,selections:u}=s,c=_A(s,["disable","labelExpr","selections"]);if(!o){if(t.aria===!1&&c.aria==null&&(c.aria=!1),!((n=c.encode)===null||n===void 0)&&n.symbols){const l=c.encode.symbols.update;l.fill&&l.fill.value!=="transparent"&&!l.stroke&&!c.stroke&&(l.stroke={value:"transparent"});for(const f of Pg)c[f]&&delete l[f]}if(c.title||delete c.title,a!==void 0){let l=a;!((r=(i=c.encode)===null||i===void 0?void 0:i.labels)===null||r===void 0)&&r.update&&z(c.encode.labels.update.text)&&(l=Zn(a,"datum.label",c.encode.labels.update.text.signal)),FA(c,"labels","text",{signal:l})}return c}}function $A(e){return Ji(e)||Dc(e)?DA(e):Bp(e)}function DA(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),Bp(e))}function Bp(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},s=t.data.reduce((o,a)=>{const u=z(a)?a.signal:`data('${e.lookupDataSource(a)}')`;return L(o,u)||o.push(u),o},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}else return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const TA=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class zp extends on{constructor(t,n,i,r){super(Object.assign({},n),{name:t}),this.specifiedProjection=n,this.size=i,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function Mp(e){e.component.projection=fe(e)?NA(e):IA(e)}function NA(e){var t;if(e.hasProjection){const n=e.specifiedProjection,i=!(n&&(n.scale!=null||n.translate!=null)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,s=i?kA(e):void 0;return new zp(e.projectionName(!0),Object.assign(Object.assign({},(t=e.config.projection)!==null&&t!==void 0?t:{}),n!=null?n:{}),r,s)}}function kA(e){const t=[],{encoding:n}=e;for(const i of[[Tt,Dt],[Ye,gt]])(ve(n[i[0]])||ve(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(Be)&&e.typedFieldDef(Be).type===Hi&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(re.Main)),t}function PA(e,t){const n=pu(TA,r=>!!(!Ei(e.explicit,r)&&!Ei(t.explicit,r)||Ei(e.explicit,r)&&Ei(t.explicit,r)&&se(e.get(r))===se(t.get(r))));if(se(e.size)===se(t.size)){if(n)return e;if(se(e.explicit)===se({}))return t;if(se(t.explicit)===se({}))return e}return null}function IA(e){if(e.children.length===0)return;let t;for(const i of e.children)Mp(i);const n=pu(e.children,i=>{const r=i.component.projection;if(r)if(t){const s=PA(t,r);return s&&(t=s),!!s}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new zp(i,t.specifiedProjection,t.size,G(t.data));for(const s of e.children){const o=s.component.projection;o&&(o.isFit&&r.data.push(...s.component.projection.data),s.renameProjection(o.get("name"),i),o.merged=!0)}return r}}var RA=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function LA(e,t,n,i){var r,s;if(Wr(t,n)){const o=fe(e)?(s=(r=e.axis(n))!==null&&r!==void 0?r:e.legend(n))!==null&&s!==void 0?s:{}:{},a=C(t,{expr:"datum"}),u=C(t,{expr:"datum",binSuffix:"end"});return{formulaAs:C(t,{binSuffix:"range",forAs:!0}),formula:ao(a,u,o.format,o.formatType,i)}}return{}}function Up(e,t){return`${xd(e)}_${t}`}function BA(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function Cc(e,t,n){var i;const r=(i=po(n,void 0))!==null&&i!==void 0?i:{},s=Up(r,t);return e.getName(`${s}_bins`)}function zA(e){return"as"in e}function mf(e,t,n){let i,r;zA(e)?i=W(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[C(e,{forAs:!0}),C(e,{binSuffix:"end",forAs:!0})];const s=Object.assign({},po(t,void 0)),o=Up(s,e.field),{signal:a,extentSignal:u}=BA(n,o);if(to(s.extent)){const l=s.extent,f=l.selection;r=Ep(n.getSelectionComponent(ae(f),f),l),delete s.extent}const c=Object.assign(Object.assign(Object.assign({bin:s,field:e.field,as:[i]},a?{signal:a}:{}),u?{extentSignal:u}:{}),r?{span:r}:{});return{key:o,binComponent:c}}class wt extends ne{constructor(t,n){super(t),this.bins=n}clone(){return new wt(null,G(this.bins))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s,o)=>{if(Qe(s)&&ue(s.bin)){const{key:a,binComponent:u}=mf(s,s.bin,n);r[a]=Object.assign(Object.assign(Object.assign({},u),r[a]),LA(n,s,o,n.config))}return r},{});return te(i)?null:new wt(t,i)}static makeFromTransform(t,n,i){const{key:r,binComponent:s}=mf(n,n.bin,i);return new wt(t,{[r]:s})}merge(t,n){for(const i of y(t.bins))i in this.bins?(n(t.bins[i].signal,this.bins[i].signal),this.bins[i].as=Ot([...this.bins[i].as,...t.bins[i].as],V)):this.bins[i]=t.bins[i];for(const i of t.children)t.removeChild(i),i.parent=this;t.remove()}producedFields(){return new Set(Gt(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(Gt(this.bins).map(t=>t.field))}hash(){return`Bin ${V(this.bins)}`}assemble(){return Gt(this.bins).flatMap(t=>{const n=[],[i,...r]=t.as,s=t.bin,{extent:o}=s,a=RA(s,["extent"]),u=Object.assign(Object.assign(Object.assign({type:"bin",field:Kt(t.field),as:i,signal:t.signal},to(o)?{extent:null}:{extent:o}),t.span?{span:{signal:`span(${t.span})`}}:{}),a);!o&&t.extentSignal&&(n.push({type:"extent",field:Kt(t.field),signal:t.extentSignal}),u.extent={signal:t.extentSignal}),n.push(u);for(const c of r)for(let l=0;l<2;l++)n.push({type:"formula",expr:C({field:i[l]},{expr:"datum"}),as:c[l]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}function MA(e,t,n,i){const r=fe(i)?i.encoding[Pt(t)]:void 0;if(Qe(n)&&fe(i)&&Yu(t,n,r,i.stack,i.markDef,i.config))e.add(C(n,{})),e.add(C(n,{suffix:"end"})),n.bin&&Wr(n,t)&&e.add(C(n,{binSuffix:"range"}));else if(yb(t)){const s=bb(t);e.add(i.getName(s))}else e.add(C(n));return e}function UA(e,t){var n;for(const i of y(t)){const r=t[i];for(const s of y(r))i in e?e[i][s]=new Set([...(n=e[i][s])!==null&&n!==void 0?n:[],...r[s]]):e[i]={[s]:r[s]}}}class ot extends ne{constructor(t,n,i){super(t),this.dimensions=n,this.measures=i}clone(){return new ot(null,new Set(this.dimensions),G(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let i=!1;n.forEachFieldDef(o=>{o.aggregate&&(i=!0)});const r={},s=new Set;return!i||(n.forEachFieldDef((o,a)=>{var u,c,l,f;const{aggregate:d,field:g}=o;if(d)if(d==="count")r["*"]=(u=r["*"])!==null&&u!==void 0?u:{},r["*"].count=new Set([C(o,{forAs:!0})]);else{if(Qt(d)||xn(d)){const p=Qt(d)?"argmin":"argmax",m=d[p];r[m]=(c=r[m])!==null&&c!==void 0?c:{},r[m][p]=new Set([C({op:p,field:m},{forAs:!0})])}else r[g]=(l=r[g])!==null&&l!==void 0?l:{},r[g][d]=new Set([C(o,{forAs:!0})]);Fn(a)&&n.scaleDomain(a)==="unaggregated"&&(r[g]=(f=r[g])!==null&&f!==void 0?f:{},r[g].min=new Set([C({field:g,aggregate:"min"},{forAs:!0})]),r[g].max=new Set([C({field:g,aggregate:"max"},{forAs:!0})]))}else MA(s,a,o,n)}),s.size+y(r).length===0)?null:new ot(t,s,r)}static makeFromTransform(t,n){var i,r,s;const o=new Set,a={};for(const u of n.aggregate){const{op:c,field:l,as:f}=u;c&&(c==="count"?(a["*"]=(i=a["*"])!==null&&i!==void 0?i:{},a["*"].count=new Set([f||C(u,{forAs:!0})])):(a[l]=(r=a[l])!==null&&r!==void 0?r:{},a[l][c]=new Set([f||C(u,{forAs:!0})])))}for(const u of(s=n.groupby)!==null&&s!==void 0?s:[])o.add(u);return o.size+y(a).length===0?null:new ot(t,o,a)}merge(t){return id(this.dimensions,t.dimensions)?(UA(this.measures,t.measures),!0):(Ny("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...y(this.measures)])}producedFields(){const t=new Set;for(const n of y(this.measures))for(const i of y(this.measures[n])){const r=this.measures[n][i];r.size===0?t.add(`${i}_${n}`):r.forEach(t.add,t)}return t}hash(){return`Aggregate ${V({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],i=[];for(const s of y(this.measures))for(const o of y(this.measures[s]))for(const a of this.measures[s][o])i.push(a),t.push(o),n.push(s==="*"?null:Kt(s));return{type:"aggregate",groupby:[...this.dimensions].map(Kt),ops:t,fields:n,as:i}}}class Xi extends ne{constructor(t,n,i,r){super(t),this.model=n,this.name=i,this.data=r;for(const s of Xe){const o=n.facet[s];if(o){const{bin:a,sort:u}=o;this[s]=Object.assign({name:n.getName(`${s}_domain`),fields:[C(o),...ue(a)?[C(o,{binSuffix:"end"})]:[]]},xt(u)?{sortField:u}:I(u)?{sortIndexField:Ri(o,s)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of Xe)this[n]&&(t+=` ${n.charAt(0)}:${V(this[n])}`);return t}get fields(){var t;const n=[];for(const i of Xe)!((t=this[i])===null||t===void 0)&&t.fields&&n.push(...this[i].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of Xe)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of Je){const i=this.childModel.component.scales[n];if(i&&!i.merged){const r=i.get("type"),s=i.get("range");if(ze(r)&&jn(s)){const o=jo(this.childModel,n),a=$c(o);a?t[n]=a:O(Su(n))}}}return t}assembleRowColumnHeaderData(t,n,i){const r={row:"y",column:"x"}[t],s=[],o=[],a=[];i&&i[r]&&(n?(s.push(`distinct_${i[r]}`),o.push("max")):(s.push(i[r]),o.push("distinct")),a.push(`distinct_${i[r]}`));const{sortField:u,sortIndexField:c}=this[t];if(u){const{op:l=uo,field:f}=u;s.push(f),o.push(l),a.push(C(u,{forAs:!0}))}else c&&(s.push(c),o.push("max"),a.push(c));return{name:this[t].name,source:n!=null?n:this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},s.length?{fields:s,ops:o,as:a}:{})]}}assembleFacetHeaderData(t){var n,i;const{columns:r}=this.model.layout,{layoutHeaders:s}=this.model.component,o=[],a={};for(const l of xc){for(const f of Ac){const d=(n=s[l]&&s[l][f])!==null&&n!==void 0?n:[];for(const g of d)if(((i=g.axes)===null||i===void 0?void 0:i.length)>0){a[l]=!0;break}}if(a[l]){const f=`length(data("${this.facet.name}"))`,d=l==="row"?r?{signal:`ceil(${f} / ${r})`}:1:r?{signal:`min(${f}, ${r})`}:{signal:f};o.push({name:`${this.facet.name}_${l}`,transform:[{type:"sequence",start:0,stop:d}]})}}const{row:u,column:c}=a;return(u||c)&&o.unshift(this.assembleRowColumnHeaderData("facet",null,t)),o}assemble(){var t,n;const i=[];let r=null;const s=this.getChildIndependentFieldsWithStep(),{column:o,row:a,facet:u}=this;if(o&&a&&(s.x||s.y)){r=`cross_${this.column.name}_${this.row.name}`;const c=[].concat((t=s.x)!==null&&t!==void 0?t:[],(n=s.y)!==null&&n!==void 0?n:[]),l=c.map(()=>"distinct");i.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:c,ops:l}]})}for(const c of[qt,Ht])this[c]&&i.push(this.assembleRowColumnHeaderData(c,r,s));if(u){const c=this.assembleFacetHeaderData(s);c&&i.push(...c)}return i}}function bf(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function WA(e,t){const n=bu(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.indexOf("date:")===0){const i=bf(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.indexOf("utc:")===0){const i=bf(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return O(Hb(t)),null}function GA(e){const t={};return gs(e.filter,n=>{var i;if(Pd(n)){let r=null;$u(n)?r=$e(n.equal):Tu(n)?r=$e(n.lte):Du(n)?r=$e(n.lt):Nu(n)?r=$e(n.gt):ku(n)?r=$e(n.gte):Pu(n)?r=n.range[0]:Iu(n)&&(r=((i=n.oneOf)!==null&&i!==void 0?i:n.in)[0]),r&&(fi(r)?t[n.field]="date":be(r)?t[n.field]="number":W(r)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function HA(e){const t={};function n(i){Ni(i)?t[i.field]="date":i.type==="quantitative"&&db(i.aggregate)?t[i.field]="number":$i(i.field)>1?i.field in t||(t[i.field]="flatten"):go(i)&&xt(i.sort)&&$i(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((fe(e)||at(e))&&e.forEachFieldDef((i,r)=>{if(Qe(i))n(i);else{const s=li(r),o=e.fieldDef(s);n(Object.assign(Object.assign({},i),{type:o.type}))}}),fe(e)){const{mark:i,markDef:r,encoding:s}=e;if($n(i)&&!e.encoding.order){const o=r.orient==="horizontal"?"y":"x",a=s[o];F(a)&&a.type==="quantitative"&&!(a.field in t)&&(t[a.field]="number")}}return t}function qA(e){const t={};if(fe(e)&&e.component.selection)for(const n of y(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&$i(r.field)>1&&(t[r.field]="flatten")}return t}class Ce extends ne{constructor(t,n){super(t),this._parse=n}clone(){return new Ce(null,G(this._parse))}hash(){return`Parse ${V(this._parse)}`}static makeExplicit(t,n,i){let r={};const s=n.data;return!Jn(s)&&s&&s.format&&s.format.parse&&(r=s.format.parse),this.makeWithAncestors(t,r,{},i)}static makeWithAncestors(t,n,i,r){for(const a of y(i)){const u=r.getWithExplicit(a);u.value!==void 0&&(u.explicit||u.value===i[a]||u.value==="derived"||i[a]==="flatten"?delete i[a]:O(xl(a,i[a],u.value)))}for(const a of y(n)){const u=r.get(a);u!==void 0&&(u===n[a]?delete n[a]:O(xl(a,n[a],u)))}const s=new on(n,i);r.copyAll(s);const o={};for(const a of y(s.combine())){const u=s.get(a);u!==null&&(o[a]=u)}return y(o).length===0||r.parseNothing?null:new Ce(t,o)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of y(this._parse)){const i=this._parse[n];$i(n)===1&&(t[n]=i)}return t}producedFields(){return new Set(y(this._parse))}dependentFields(){return new Set(y(this._parse))}assembleTransforms(t=!1){return y(this._parse).filter(n=>t?$i(n)>1:!0).map(n=>{const i=WA(n,this._parse[n]);return i?{type:"formula",expr:i,as:yu(n)}:null}).filter(n=>n!==null)}}class En extends ne{clone(){return new En(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([ki])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:ki}}}class Xr extends ne{constructor(t,n){super(t),this.params=n}clone(){return new Xr(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${V(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class Yr extends ne{constructor(t,n){super(t),this.params=n}clone(){return new Yr(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${V(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}class ai extends ne{constructor(t){super(null),t=t!=null?t:{name:"source"};let n;if(Jn(t)||(n=t.format?Object.assign({},Ge(t.format,["parse"])):{}),$s(t))this._data={values:t.values};else if(Ar(t)){if(this._data={url:t.url},!n.type){let i=/(?:\.([^.]+))?$/.exec(t.url)[1];L(["json","csv","tsv","dsv","topojson"],i)||(i="json"),n.type=i}}else Vg(t)?this._data={values:[{type:"Sphere"}]}:(Hg(t)||Jn(t))&&(this._data={});this._generator=Jn(t),t.name&&(this._name=t.name),n&&!te(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var yf=globalThis&&globalThis.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},VA=globalThis&&globalThis.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},lr;function _c(e){return e instanceof ai||e instanceof Xr||e instanceof Yr}class Fc{constructor(){lr.set(this,void 0),yf(this,lr,!1)}setModified(){yf(this,lr,!0)}get modifiedFlag(){return VA(this,lr)}}lr=new WeakMap;class pi extends Fc{getNodeDepths(t,n,i){i.set(t,n);for(const r of t.children)this.getNodeDepths(r,n+1,i);return i}optimize(t){const i=[...this.getNodeDepths(t,0,new Map).entries()].sort((r,s)=>s[1]-r[1]);for(const r of i)this.run(r[0]);return this.modifiedFlag}}class jc extends Fc{optimize(t){this.run(t);for(const n of t.children)this.optimize(n);return this.modifiedFlag}}class XA extends jc{mergeNodes(t,n){const i=n.shift();for(const r of n)t.removeChild(r),r.parent=i,r.remove()}run(t){const n=t.children.map(r=>r.hash()),i={};for(let r=0;r<n.length;r++)i[n[r]]===void 0?i[n[r]]=[t.children[r]]:i[n[r]].push(t.children[r]);for(const r of y(i))i[r].length>1&&(this.setModified(),this.mergeNodes(t,i[r]))}}class YA extends jc{constructor(t){super(),this.requiresSelectionId=t&&yc(t)}run(t){t instanceof En&&(this.requiresSelectionId&&(_c(t.parent)||t.parent instanceof ot||t.parent instanceof Ce)||(this.setModified(),t.remove()))}}class JA extends Fc{optimize(t){return this.run(t,new Set),this.modifiedFlag}run(t,n){let i=new Set;t instanceof At&&(i=t.producedFields(),hu(i,n)&&(this.setModified(),t.removeFormulas(n),t.producedFields.length===0&&t.remove()));for(const r of t.children)this.run(r,new Set([...n,...i]))}}class KA extends jc{constructor(){super()}run(t){t instanceof De&&!t.isRequired()&&(this.setModified(),t.remove())}}class QA extends pi{run(t){if(!_c(t)&&!(t.numChildren()>1)){for(const n of t.children)if(n instanceof Ce)if(t instanceof Ce)this.setModified(),t.merge(n);else{if(mu(t.producedFields(),n.dependentFields()))continue;this.setModified(),n.swapWithParent()}}}}class ZA extends pi{run(t){const n=[...t.children],i=t.children.filter(r=>r instanceof Ce);if(t.numChildren()>1&&i.length>=1){const r={},s=new Set;for(const o of i){const a=o.parse;for(const u of y(a))u in r?r[u]!==a[u]&&s.add(u):r[u]=a[u]}for(const o of s)delete r[o];if(!te(r)){this.setModified();const o=new Ce(t,r);for(const a of n){if(a instanceof Ce)for(const u of y(r))delete a.parse[u];t.removeChild(a),a.parent=o,a instanceof Ce&&y(a.parse).length===0&&a.remove()}}}}}class ew extends pi{run(t){t instanceof De||t.numChildren()>0||t instanceof Xi||t instanceof ai||(this.setModified(),t.remove())}}class tw extends pi{run(t){const n=t.children.filter(r=>r instanceof At),i=n.pop();for(const r of n)this.setModified(),i.merge(r)}}class nw extends pi{run(t){const n=t.children.filter(r=>r instanceof ot),i={};for(const r of n){const s=V(r.groupBy);s in i||(i[s]=[]),i[s].push(r)}for(const r of y(i)){const s=i[r];if(s.length>1){const o=s.pop();for(const a of s)o.merge(a)&&(t.removeChild(a),a.parent=o,a.remove(),this.setModified())}}}}class iw extends pi{constructor(t){super(),this.model=t}run(t){const n=!(_c(t)||t instanceof Vi||t instanceof Ce||t instanceof En),i=[],r=[];for(const s of t.children)s instanceof wt&&(n&&!mu(t.producedFields(),s.dependentFields())?i.push(s):r.push(s));if(i.length>0){const s=i.pop();for(const o of i)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified(),t instanceof wt?t.merge(s,this.model.renameSignal.bind(this.model)):s.swapWithParent()}if(r.length>1){const s=r.pop();for(const o of r)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified()}}}class rw extends pi{run(t){const n=[...t.children];if(!ji(n,o=>o instanceof De)||t.numChildren()<=1)return;const r=[];let s;for(const o of n)if(o instanceof De){let a=o;for(;a.numChildren()===1;){const[u]=a.children;if(u instanceof De)a=u;else break}r.push(...a.children),s?(t.removeChild(o),o.parent=s.parent,s.parent.removeChild(s),s.parent=a,this.setModified()):s=a}else r.push(o);if(r.length){this.setModified();for(const o of r)o.parent.removeChild(o),o.parent=s}}}class hi extends ne{constructor(t,n){super(t),this.transform=n}clone(){return new hi(null,G(this.transform))}addDimensions(t){this.transform.groupby=Ot(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:C(t)}hash(){return`JoinAggregateTransform ${V(this.transform)}`}assemble(){const t=[],n=[],i=[];for(const s of this.transform.joinaggregate)n.push(s.op),i.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},r!==void 0?{groupby:r}:{})}}function sw(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=C(i);return r&&t.push(r),t},[])}function ow(e){return I(e)&&e.every(t=>W(t))&&e.length>1}class Yt extends ne{constructor(t,n){super(t),this._stack=n}clone(){return new Yt(null,G(this._stack))}static makeFromTransform(t,n){const{stack:i,groupby:r,as:s,offset:o="zero"}=n,a=[],u=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),u.push(pe(f.order,"ascending"));const c={field:a,order:u};let l;return ow(s)?l=s:W(s)?l=[s,s+"_end"]:l=[n.stack+"_start",n.stack+"_end"],new Yt(t,{stackField:i,groupby:r,offset:o,sort:c,facetby:[],as:l})}static makeFromEncoding(t,n){const i=n.stack,{encoding:r}=n;if(!i)return null;const{groupbyChannel:s,fieldChannel:o,offset:a,impute:u}=i;let c;if(s){const g=r[s];c=Ct(g)}const l=sw(n),f=n.encoding.order;let d;return I(f)||F(f)?d=hg(f):d=l.reduce((g,p)=>(g.field.push(p),g.order.push(o==="y"?"descending":"ascending"),g),{field:[],order:[]}),new Yt(t,{dimensionFieldDef:c,stackField:n.vgField(o),facetby:[],stackby:l,sort:d,offset:a,impute:u,as:[n.vgField(o,{suffix:"start",forAs:!0}),n.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${V(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:t,impute:n,groupby:i}=this._stack;return t?t.bin?n?[C(t,{binSuffix:"mid"})]:[C(t,{}),C(t,{binSuffix:"end"})]:[C(t)]:i!=null?i:[]}assemble(){const t=[],{facetby:n,dimensionFieldDef:i,stackField:r,stackby:s,sort:o,offset:a,impute:u,as:c}=this._stack;if(u&&i){const{band:l=.5,bin:f}=i;f&&t.push({type:"formula",expr:`${l}*`+C(i,{expr:"datum"})+`+${1-l}*`+C(i,{expr:"datum",binSuffix:"end"}),as:C(i,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:r,groupby:[...s,...n],key:C(i,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:r,sort:o,as:c,offset:a}),t}}class Yi extends ne{constructor(t,n){super(t),this.transform=n}clone(){return new Yi(null,G(this.transform))}addDimensions(t){this.transform.groupby=Ot(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const i=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(i.add,i),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(r=>i.add(r.field)),this.transform.window.map(r=>r.field).filter(r=>r!==void 0).forEach(i.add,i),i}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:C(t)}hash(){return`WindowTransform ${V(this.transform)}`}assemble(){var t;const n=[],i=[],r=[],s=[];for(const d of this.transform.window)i.push(d.op),r.push(this.getDefaultName(d)),s.push(d.param===void 0?null:d.param),n.push(d.field===void 0?null:d.field);const o=this.transform.frame,a=this.transform.groupby;if(o&&o[0]===null&&o[1]===null&&i.every(d=>vu(d)))return Object.assign({type:"joinaggregate",as:r,ops:i,fields:n},a!==void 0?{groupby:a}:{});const u=[],c=[];if(this.transform.sort!==void 0)for(const d of this.transform.sort)u.push(d.field),c.push((t=d.order)!==null&&t!==void 0?t:"ascending");const l={field:u,order:c},f=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:s,as:r,ops:i,fields:n,sort:l},f!==void 0?{ignorePeers:f}:{}),a!==void 0?{groupby:a}:{}),o!==void 0?{frame:o}:{})}}function aw(e){function t(n){if(!(n instanceof Xi)){const i=n.clone();if(i instanceof De){const r=Va+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof ot||i instanceof Yt||i instanceof Yi||i instanceof hi)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function qa(e){if(e instanceof Xi)if(e.numChildren()===1&&!(e.children[0]instanceof De)){const t=e.children[0];(t instanceof ot||t instanceof Yt||t instanceof Yi||t instanceof hi)&&t.addDimensions(e.fields),t.swapWithParent(),qa(e)}else{const t=e.model.component.data.main;Wp(t);const n=aw(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(qa)}function Wp(e){if(e instanceof De&&e.type===re.Main&&e.numChildren()===1){const t=e.children[0];t instanceof Xi||(t.swapWithParent(),Wp(e))}}const Va="scale_",rs=5;function Xa(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return!1;if(!Xa(t.children))return!1}return!0}function tt(e,t){let n=!1;for(const i of t)n=e.optimize(i)||n;return n}function vf(e,t,n){let i=e.sources,r=!1;return r=tt(new KA,i)||r,r=tt(new YA(t),i)||r,i=i.filter(s=>s.numChildren()>0),r=tt(new ew,i)||r,i=i.filter(s=>s.numChildren()>0),n||(r=tt(new QA,i)||r,r=tt(new iw(t),i)||r,r=tt(new JA,i)||r,r=tt(new ZA,i)||r,r=tt(new nw,i)||r,r=tt(new tw,i)||r,r=tt(new XA,i)||r,r=tt(new rw,i)||r),e.sources=i,r}function uw(e,t){Xa(e.sources);let n=0,i=0;for(let r=0;r<rs&&vf(e,t,!0);r++)n++;e.sources.map(qa);for(let r=0;r<rs&&vf(e,t,!1);r++)i++;Xa(e.sources),Math.max(n,i)===rs&&O(`Maximum optimization runs(${rs}) reached.`)}class He{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new He(()=>t(n))}}var cw=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Gp(e){fe(e)?lw(e):fw(e)}function lw(e){const t=e.component.scales;for(const n of y(t)){const i=gw(e,n);if(t[n].setWithExplicit("domains",i),hw(e,n),e.component.data.isFaceted){let s=e;for(;!at(s)&&s.parent;)s=s.parent;if(s.component.resolve.scale[n]==="shared")for(const a of i.value)Wt(a)&&(a.data=Va+a.data.replace(Va,""))}}}function fw(e){for(const n of e.children)Gp(n);const t=e.component.scales;for(const n of y(t)){let i,r=null;for(const s of e.children){const o=s.component.scales[n];if(o){i===void 0?i=o.getWithExplicit("domains"):i=yn(i,o.getWithExplicit("domains"),"domains","scale",Ya);const a=o.get("selectionExtent");r&&a&&r.selection!==a.selection&&O(Mb),r=a}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function dw(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:s}=Of(t,n);if(!r){O(s);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=Of(t,n);if(r)return"unaggregated"}return e}function gw(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=dw(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:r})),t==="x"&&ve(i.x2)?ve(i.x)?yn(fn(n,r,e,"x"),fn(n,r,e,"x2"),"domain","scale",Ya):fn(n,r,e,"x2"):t==="y"&&ve(i.y2)?ve(i.y)?yn(fn(n,r,e,"y"),fn(n,r,e,"y2"),"domain","scale",Ya):fn(n,r,e,"y2"):fn(n,r,e,t)}function pw(e,t,n){return e.map(i=>({signal:`{data: ${ho(i,{timeUnit:n,type:t})}}`}))}function ua(e,t,n){var i;const r=(i=Te(n))===null||i===void 0?void 0:i.unit;return t==="temporal"||r?pw(e,t,r):[e]}function fn(e,t,n,i){const{encoding:r}=n,s=ve(r[i]),{type:o}=s,a=s.timeUnit;if(vv(t)){const f=fn(e,void 0,n,i),d=ua(t.unionWith,o,a);return Mt([...f.value,...d])}else{if(z(t))return Mt([t]);if(t&&t!=="unaggregated"&&!Ld(t))return Mt(ua(t,o,a))}const u=n.stack;if(u&&i===u.fieldChannel){if(u.offset==="normalize")return Ue([[0,1]]);const f=n.requestDataName(re.Main);return Ue([{data:f,field:n.vgField(i,{suffix:"start"})},{data:f,field:n.vgField(i,{suffix:"end"})}])}const c=Fn(i)&&F(s)?mw(n,i,e):void 0;if(Dn(s)){const f=ua([s.datum],o,a);return Ue(f)}const l=s;if(t==="unaggregated"){const f=n.requestDataName(re.Main),{field:d}=s;return Ue([{data:f,field:C({field:d,aggregate:"min"})},{data:f,field:C({field:d,aggregate:"max"})}])}else if(ue(l.bin)){if(ze(e))return Ue(e==="bin-ordinal"?[]:[{data:vr(c)?n.requestDataName(re.Main):n.requestDataName(re.Raw),field:n.vgField(i,Wr(l,i)?{binSuffix:"range"}:{}),sort:c===!0||!ye(c)?{field:n.vgField(i,{}),op:"min"}:c}]);{const{bin:f}=l;if(ue(f)){const d=Cc(n,l.field,f);return Ue([new He(()=>{const g=n.getSignalName(d);return`[${g}.start, ${g}.stop]`})])}else return Ue([{data:n.requestDataName(re.Main),field:n.vgField(i,{})}])}}else if(l.timeUnit&&L(["time","utc"],e)&&Yu(i,l,fe(n)?n.encoding[Pt(i)]:void 0,n.stack,n.markDef,n.config)){const f=n.requestDataName(re.Main);return Ue([{data:f,field:n.vgField(i)},{data:f,field:n.vgField(i,{suffix:"end"})}])}else return Ue(c?[{data:vr(c)?n.requestDataName(re.Main):n.requestDataName(re.Raw),field:n.vgField(i),sort:c}]:[{data:n.requestDataName(re.Main),field:n.vgField(i)}])}function ca(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:n!=null?n:t?"sum":uo},i?{field:Kt(i)}:{}),r?{order:r}:{})}function hw(e,t){var n;const i=e.component.scales[t],r=e.specifiedScales[t].domain,s=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,o=Ld(r)&&r,a=Lr(s)&&to(s.extent)&&s.extent;(o||a)&&i.set("selectionExtent",o!=null?o:a,!0)}function mw(e,t,n){if(!ze(n))return;const i=e.fieldDef(t),r=i.sort;if(tg(r))return{op:"min",field:Ri(i,t),order:"ascending"};const{stack:s}=e,o=s?[...s.groupbyField?[s.groupbyField]:[],...s.stackBy.map(a=>a.fieldDef.field)]:void 0;if(xt(r)){const a=s&&!L(o,r.field);return ca(r,a)}else if(eg(r)){const{encoding:a,order:u}=r,c=e.fieldDef(a),{aggregate:l,field:f}=c,d=s&&!L(o,f);if(Qt(l)||xn(l))return ca({field:C(c),order:u},d);if(vu(l)||!l)return ca({op:l,field:f,order:u},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(L(["ascending",void 0],r))return!0}}function Of(e,t){const{aggregate:n,type:i}=e;return n?W(n)&&!hb[n]?{valid:!1,reason:ly(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:fy(e)}:{valid:!0}:{valid:!1,reason:cy(e)}}function Ya(e,t,n,i){return e.explicit&&t.explicit&&O(my(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function bw(e){const t=Ot(e.map(o=>Wt(o)?cw(o,["sort"]):o),V),n=Ot(e.map(o=>{if(Wt(o)){const a=o.sort;return a!==void 0&&!vr(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}}).filter(o=>o!==void 0),V);if(t.length===0)return;if(t.length===1){const o=e[0];if(Wt(o)&&n.length>0){let a=n[0];if(n.length>1)O(wl),a=!0;else if(ye(a)&&"field"in a){const u=a.field;o.field===u&&(a=a.order?{order:a.order}:!0)}return Object.assign(Object.assign({},o),{sort:a})}return o}const i=Ot(n.map(o=>vr(o)||!("op"in o)||W(o.op)&&o.op in lb?o:(O(yy(o)),!0)),V);let r;i.length===1?r=i[0]:i.length>1&&(O(wl),r=!0);const s=Ot(e.map(o=>Wt(o)?o.data:null),o=>o);return s.length===1&&s[0]!==null?Object.assign({data:s[0],fields:t.map(a=>a.field)},r?{sort:r}:{}):Object.assign({fields:t},r?{sort:r}:{})}function $c(e){if(Wt(e)&&W(e.field))return e.field;if(Xy(e)){let t;for(const n of e.fields)if(Wt(n)&&W(n.field)){if(!t)t=n.field;else if(t!==n.field)return O(vy),t}return O(Oy),t}else if(Yy(e)){O(Ey);const t=e.fields[0];return W(t)?t:void 0}}function jo(e,t){const i=e.component.scales[t].get("domains").map(r=>(Wt(r)&&(r.data=e.lookupDataSource(r.data)),r));return bw(i)}var yw=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Hp(e){return Ji(e)||Dc(e)?e.children.reduce((t,n)=>t.concat(Hp(n)),Ef(e)):Ef(e)}function Ef(e){return y(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:s,type:o,selectionExtent:a,domains:u,range:c,reverse:l}=r,f=yw(r,["name","type","selectionExtent","domains","range","reverse"]),d=vw(r.range,s,n,e);let g;a&&(g=vE(e,a));const p=jo(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:o},p?{domain:p}:{}),g?{domainRaw:g}:{}),{range:d}),l!==void 0?{reverse:l}:{}),f)),t},[])}function vw(e,t,n,i){if(St(n)){if(jn(e))return{step:{signal:t+"_step"}}}else if(ye(e)&&Wt(e))return Object.assign(Object.assign({},e),{data:i.lookupDataSource(e.data)});return e}class qp extends on{constructor(t,n){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:ji(this.get("domains"),t=>I(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const Ow=["range","scheme"];function Vp(e){return e==="x"?"width":e==="y"?"height":void 0}function Ew(e){const t=e.component.scales;for(const n of eo){const i=t[n];if(!i)continue;const r=xw(n,e);i.setWithExplicit("range",r)}}function xf(e,t){const n=e.fieldDef(t);if(n&&n.bin&&ue(n.bin)){const i=Cc(e,n.field,n.bin),r=Vp(t),s=e.getName(r);return new He(()=>{const o=e.getSignalName(i),a=`(${o}.stop - ${o}.start) / ${o}.step`;return`${e.getSignalName(s)} / (${a})`})}}function xw(e,t){const n=t.specifiedScales[e],{size:i}=t,s=t.getScaleComponent(e).get("type");for(const c of Ow)if(n[c]!==void 0){const l=$a(s,c),f=Bd(e,c);if(!l)O(Cd(s,c,e));else if(f)O(f);else switch(c){case"range":{const d=n.range;if(I(d)){if(St(e))return Mt(d.map(g=>{if(g==="width"||g==="height"){const p=t.getName(g),m=t.getSignalName.bind(t);return He.fromName(m,p)}return g}))}else if(ye(d))return Mt({data:t.requestDataName(re.Main),field:d.field,sort:{op:"min",field:t.vgField(e)}});return Mt(d)}case"scheme":return Mt(Aw(n[c]))}}if(e===le||e===Oe){const c=e===le?"width":"height",l=i[c];if(_t(l)){if(ze(s))return Mt({step:l.step});O(_d(c))}}const{rangeMin:o,rangeMax:a}=n,u=ww(e,t);return(o!==void 0||a!==void 0)&&$a(s,"rangeMin")&&I(u)&&u.length===2?Mt([o!=null?o:u[0],a!=null?a:u[1]]):Ue(u)}function Aw(e){return yv(e)?Object.assign({scheme:e.name},Ge(e,["name"])):{scheme:e}}function ww(e,t){const{size:n,config:i,mark:r,encoding:s}=t,o=t.getSignalName.bind(t),{type:a}=ve(s[e]),c=t.getScaleComponent(e).get("type"),{domain:l,domainMid:f}=t.specifiedScales[e];switch(e){case le:case Oe:{if(L(["point","band"],c)){if(e===le&&!n.width){const p=xr(i.view,"width");if(_t(p))return p}else if(e===Oe&&!n.height){const p=xr(i.view,"height");if(_t(p))return p}}const d=Vp(e),g=t.getName(d);return e===Oe&&Ke(c)?[He.fromName(o,g),0]:[0,He.fromName(o,g)]}case nn:{const d=t.component.scales[e].get("zero"),g=Xp(r,d,i),p=_w(r,n,t,i);return xs(c)?Cw(g,p,Sw(c,i,l,e)):[g,p]}case dt:return[0,Math.PI*2];case ci:return[0,360];case $t:return[0,new He(()=>{const d=t.getSignalName("width"),g=t.getSignalName("height");return`min(${d},${g})/2`})];case Sn:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case Cn:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Be:return"symbol";case Le:case Nt:case kt:return c==="ordinal"?a==="nominal"?"category":"ordinal":f!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case rn:case An:case wn:return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}function Sw(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&I(n)?n.length+1:(O($y(i)),3)}}function Cw(e,t,n){const i=()=>{const r=Vt(t),s=Vt(e),o=`(${r} - ${s}) / (${n} - 1)`;return`sequence(${s}, ${r} + ${o}, ${o})`};return z(t)?new He(i):{signal:i()}}function Xp(e,t,n){if(t)return z(t)?{signal:`${t.signal} ? 0 : ${Xp(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(no("size",e))}const Af=.95;function _w(e,t,n,i){const r={x:xf(n,"x"),y:xf(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const s=wf(t,r,i.view);return be(s)?s-1:new He(()=>`${s.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const s=wf(t,r,i.view);return be(s)?Math.pow(Af*s,2):new He(()=>`pow(${Af} * ${s.signal}, 2)`)}}throw new Error(no("size",e))}function wf(e,t,n){const i=_t(e.width)?e.width.step:js(n,"width"),r=_t(e.height)?e.height.step:js(n,"height");return t.x||t.y?new He(()=>`min(${[t.x?t.x.signal:i,t.y?t.y.signal:r].join(", ")})`):Math.min(i,r)}function Yp(e,t){fe(e)?Fw(e,t):Kp(e,t)}function Fw(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:s,specifiedScales:o}=e;for(const a of y(n)){const u=o[a],c=n[a],l=e.getScaleComponent(a),f=ve(r[a]),d=u[t],g=l.get("type"),p=l.get("padding"),m=l.get("paddingInner"),h=$a(g,t),E=Bd(a,t);if(d!==void 0&&(h?E&&O(E):O(Cd(g,t,a))),h&&E===void 0)if(d!==void 0){const v=f.timeUnit,S=f.type;switch(t){case"domainMax":case"domainMin":fi(u[t])||S==="temporal"||v?c.set(t,{signal:ho(u[t],{type:S,timeUnit:v})},!0):c.set(t,u[t],!0);break;default:c.copyKeyFromObject(t,u)}}else{const v=t in Sf?Sf[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:g,scalePadding:p,scalePaddingInner:m,domain:u.domain,markDef:s,config:i}):i.scale[t];v!==void 0&&c.set(t,v,!1)}}}const Sf={bins:({model:e,fieldOrDatumDef:t})=>F(t)?jw(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>$w(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>Dw(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>Tw(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:i})=>Nw(e,t,n.type,i.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:i,scalePaddingInner:r,config:s})=>kw(e,t,n,i.type,r,s.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=F(e)?e.sort:void 0;return Pw(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r})=>Iw(e,t,n,i,r)};function Jp(e){fe(e)?Ew(e):Kp(e,"range")}function Kp(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?Jp(i):Yp(i,t);for(const i of y(n)){let r;for(const s of e.children){const o=s.component.scales[i];if(o){const a=o.getWithExplicit(t);r=yn(r,a,t,"scale",Gg((u,c)=>{switch(t){case"range":return u.step&&c.step?u.step-c.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function jw(e,t){const n=t.bin;if(ue(n)){const i=Cc(e,t.field,n);return new He(()=>e.getSignalName(i))}else if(je(n)&&Lr(n)&&n.step!==void 0)return{step:n.step}}function $w(e,t){if(L([Le,Nt,kt],e)&&t!=="nominal")return"hcl"}function Dw(e,t,n){var i;if(!(!((i=Ct(n))===null||i===void 0)&&i.bin||L([me.TIME,me.UTC],e)))return t in _n?!0:void 0}function Tw(e,t,n,i,r,s){if(e in _n){if(st(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:a}=r;if(o==="bar"&&!(F(i)&&(i.bin||i.timeUnit))&&(a==="vertical"&&e==="x"||a==="horizontal"&&e==="y"))return s.continuousBandSize}if(t===me.POINT)return n.pointPadding}}function Nw(e,t,n,i){if(e===void 0&&t in _n){const{bandPaddingInner:r,barBandPaddingInner:s,rectBandPaddingInner:o}=i;return pe(r,n==="bar"?s:o)}}function kw(e,t,n,i,r,s){if(e===void 0&&t in _n&&n===me.BAND){const{bandPaddingOuter:o}=s;return pe(o,z(r)?{signal:`${r.signal}/2`}:r/2)}}function Pw(e,t,n,i){if(n==="x"&&i.xReverse!==void 0)return Ke(e)&&t==="descending"?z(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse;if(Ke(e)&&t==="descending")return!0}function Iw(e,t,n,i,r){if(!!n&&n!=="unaggregated"&&Ke(r)){if(I(n)){const o=n[0],a=n[n.length-1];if(o<=0&&a>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!xs(r))return!0;if(!(F(t)&&t.bin)&&L([...Je,..._b],e)){const{orient:o,type:a}=i;return!(L(["bar","area","line","trail"],a)&&(o==="horizontal"&&e==="y"||o==="vertical"&&e==="x"))}return!1}function Rw(e,t,n,i){const r=Lw(t,n,i),{type:s}=e;return Fn(t)?s!==void 0?wv(t,s)?F(n)&&!Av(s,n.type)?(O(py(s,r)),r):s:(O(gy(t,s,r)),r):r:null}function Lw(e,t,n){var i;switch(t.type){case"nominal":case"ordinal":if(Si(e)||Qo(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&O(Zo(e,"ordinal")),"ordinal";if(e in _n){if(L(["rect","bar","image","rule"],n))return"band"}else if(n==="arc"&&e in Au)return"band";return t.band!==void 0||Ku(t)&&(!((i=t.axis)===null||i===void 0)&&i.tickBand)?"band":"point";case"temporal":return Si(e)?"time":Qo(e)==="discrete"?(O(Zo(e,"temporal")),"ordinal"):F(t)&&t.timeUnit&&Te(t.timeUnit).utc?"utc":"time";case"quantitative":return Si(e)?F(t)&&ue(t.bin)?"bin-ordinal":"linear":Qo(e)==="discrete"?(O(Zo(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(wd(t.type))}function Bw(e,{ignoreRange:t}={}){Qp(e),Gp(e);for(const n of xv)Yp(e,n);t||Jp(e)}function Qp(e){fe(e)?e.component.scales=zw(e):e.component.scales=Uw(e)}function zw(e){const{encoding:t,mark:n}=e;return eo.reduce((i,r)=>{const s=ve(t[r]);if(s&&n===Ud&&r===Be&&s.type===Hi)return i;let o=s&&s.scale;if(s&&o!==null&&o!==!1){o=o!=null?o:{};const a=Rw(o,r,s,n);i[r]=new qp(e.scaleName(r+"",!0),{value:a,explicit:o.type===a})}return i},{})}const Mw=Gg((e,t)=>Cl(e)-Cl(t));function Uw(e){var t;const n=e.component.scales={},i={},r=e.component.resolve;for(const s of e.children){Qp(s);for(const o of y(s.component.scales))if(r.scale[o]=(t=r.scale[o])!==null&&t!==void 0?t:oA(o,e),r.scale[o]==="shared"){const a=i[o],u=s.component.scales[o].getWithExplicit("type");a?sv(a.value,u.value)?i[o]=yn(a,u,"type","scale",Mw):(r.scale[o]="independent",delete i[o]):i[o]=u}}for(const s of y(i)){const o=e.scaleName(s,!0),a=i[s];n[s]=new qp(o,a);for(const u of e.children){const c=u.component.scales[s];c&&(u.renameScale(c.get("name"),o),c.merged=!0)}}return n}var la=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class fa{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function fe(e){return(e==null?void 0:e.type)==="unit"}function at(e){return(e==null?void 0:e.type)==="facet"}function Dc(e){return(e==null?void 0:e.type)==="concat"}function Ji(e){return(e==null?void 0:e.type)==="layer"}class Tc{constructor(t,n,i,r,s,o,a){var u,c;this.type=n,this.parent=i,this.config=s,this.children=[],this.correctDataNames=l=>(l.from&&l.from.data&&(l.from.data=this.lookupDataSource(l.from.data)),l.from&&l.from.facet&&l.from.facet.data&&(l.from.facet.data=this.lookupDataSource(l.from.facet.data)),l),this.parent=i,this.config=s,this.view=it(a),this.name=(u=t.name)!==null&&u!==void 0?u:r,this.title=gn(t.title)?{text:t.title}:t.title?this.initTitle(t.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new fa,this.projectionNameMap=i?i.projectionNameMap:new fa,this.signalNameMap=i?i.signalNameMap:new fa,this.data=t.data,this.description=t.description,this.transforms=U1((c=t.transform)!==null&&c!==void 0?c:[]),this.layout=n==="layer"||n==="unit"?{}:RO(t,n,s),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:co(t)||i&&i.component.data.isFaceted&&t.data===void 0},layoutSize:new on,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?G(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}initTitle(t){const n=y(t),i={text:$e(t.text)};for(const r of n)i[r]=$e(t[r]);return i}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){Bw(this)}parseProjection(){Mp(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){Ip(this)}assembleGroupStyle(){var t,n;if(this.type==="unit"||this.type==="layer")return(n=(t=this.view)===null||t===void 0?void 0:t.style)!==null&&n!==void 0?n:"cell"}assembleEncodeFromView(t){const n=la(t,["style"]),i={};for(const r of y(n)){const s=n[r];s!==void 0&&(i[r]=ce(s))}return i}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=ce(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n!=null?n:{}):te(n)?void 0:n}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,i=la(t,["spacing"]),{component:r,config:s}=this,o=sA(r.layoutHeaders,s);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),i),o?{titleBand:o}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const i of Xe)t[i].title&&n.push(Zx(this,i));for(const i of xc)n=n.concat(eA(this,i));return n}assembleAxes(){return Mx(this.component.axes,this.config)}assembleLegends(){return Lp(this)}assembleProjections(){return $A(this)}assembleTitle(){var t,n,i;const r=(t=this.title)!==null&&t!==void 0?t:{},{encoding:s}=r,o=la(r,["encoding"]),a=Object.assign(Object.assign(Object.assign({},fg(this.config.title).nonMark),o),s?{encode:{update:s}}:{});if(a.text)return L(["unit","layer"],this.type)?L(["middle",void 0],a.anchor)&&(a.frame=(n=a.frame)!==null&&n!==void 0?n:"group"):a.anchor=(i=a.anchor)!==null&&i!==void 0?i:"start",te(a)?void 0:a}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const i=this.assembleLayout();i&&(n.layout=i),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||at(this.parent)?Hp(this):[];r.length>0&&(n.scales=r);const s=this.assembleAxes();s.length>0&&(n.axes=s);const o=this.assembleLegends();return o.length>0&&(n.legends=o),n}getName(t){return ae((this.name?this.name+"_":"")+t)}getDataName(t){return this.getName(re[t].toLowerCase())}requestDataName(t){const n=this.getDataName(t),i=this.component.data.outputNodeRefCounts;return i[n]=(i[n]||0)+1,n}getSizeSignalRef(t){if(at(this.parent)){const n=$p(t),i=Zs(n),r=this.component.scales[i];if(r&&!r.merged){const s=r.get("type"),o=r.get("range");if(ze(s)&&jn(o)){const a=r.get("name"),u=jo(this,i),c=$c(u);if(c){const l=C({aggregate:"distinct",field:c},{expr:"datum"});return{signal:jp(a,r,l)}}else return O(Su(i)),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){if(n)return this.getName(t);if(bd(t)&&Fn(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t)))return this.scaleNameMap.get(this.getName(t))}projectionName(t){if(t)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let i=this.component.selection[t];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(t,n)),!i)throw new Error(Rb(n));return i}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(i=>i.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(i=>i.hasOrientSignalRef()))}}class Zp extends Tc{vgField(t,n={}){const i=this.fieldDef(t);if(i)return C(i,n)}reduceFieldDef(t,n){return fO(this.getMapping(),(i,r,s)=>{const o=Ct(r);return o?t(i,o,s):i},n)}forEachFieldDef(t,n){ic(this.getMapping(),(i,r)=>{const s=Ct(i);s&&t(s,r)},n)}}var Ww=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class $o extends ne{constructor(t,n){var i,r,s;super(t),this.transform=n,this.transform=G(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"value",(s=o[1])!==null&&s!==void 0?s:"density"]}clone(){return new $o(null,G(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${V(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,i=Ww(t,["density"]);return Object.assign({type:"kde",field:n},i)}}class _r extends ne{constructor(t,n){super(t),this.filter=n}clone(){return new _r(null,Object.assign({},this.filter))}static make(t,n){const{config:i,mark:r,markDef:s}=n;if(Z("invalid",s,i)!=="filter")return null;const a=n.reduceFieldDef((u,c,l)=>{const f=Fn(l)&&n.getScaleComponent(l);if(f){const d=f.get("type");Ke(d)&&c.aggregate!=="count"&&!$n(r)&&(u[c.field]=c)}return u},{});return y(a).length?new _r(t,a):null}dependentFields(){return new Set(y(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${V(this.filter)}`}assemble(){const t=y(this.filter).reduce((n,i)=>{const r=this.filter[i],s=C(r,{expr:"datum"});return r!==null&&(r.type==="temporal"?n.push(`(isDate(${s}) || (isValid(${s}) && isFinite(+${s})))`):r.type==="quantitative"&&(n.push(`isValid(${s})`),n.push(`isFinite(+${s})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class Do extends ne{constructor(t,n){super(t),this.transform=n,this.transform=G(n);const{flatten:i,as:r=[]}=this.transform;this.transform.as=i.map((s,o)=>{var a;return(a=r[o])!==null&&a!==void 0?a:s})}clone(){return new Do(this.parent,G(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${V(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform;return{type:"flatten",fields:t,as:n}}}class To extends ne{constructor(t,n){var i,r,s;super(t),this.transform=n,this.transform=G(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"key",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new To(null,G(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${V(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform;return{type:"fold",fields:t,as:n}}}class _i extends ne{constructor(t,n,i,r){super(t),this.fields=n,this.geojson=i,this.signal=r}clone(){return new _i(null,G(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let i=0;for(const r of[[Tt,Dt],[Ye,gt]]){const s=r.map(o=>{const a=ve(n.encoding[o]);return F(a)?a.field:Dn(a)?{expr:`${a.datum}`}:ut(a)?{expr:`${a.value}`}:void 0});(s[0]||s[1])&&(t=new _i(t,s,null,n.getName(`geojson_${i++}`)))}if(n.channelHasField(Be)){const r=n.typedFieldDef(Be);r.type===Hi&&(t=new _i(t,null,r.field,n.getName(`geojson_${i++}`)))}return t}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter(W);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${V(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class Fr extends ne{constructor(t,n,i,r){super(t),this.projection=n,this.fields=i,this.as=r}clone(){return new Fr(null,this.projection,G(this.fields),G(this.as))}static parseAll(t,n){if(!n.projectionName())return t;for(const i of[[Tt,Dt],[Ye,gt]]){const r=i.map(o=>{const a=ve(n.encoding[o]);return F(a)?a.field:Dn(a)?{expr:`${a.datum}`}:ut(a)?{expr:`${a.value}`}:void 0}),s=i[0]===Ye?"2":"";(r[0]||r[1])&&(t=new Fr(t,n.projectionName(),r,[n.getName("x"+s),n.getName("y"+s)]))}return t}dependentFields(){return new Set(this.fields.filter(W))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${V(this.fields)} ${V(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Kn extends ne{constructor(t,n){super(t),this.transform=n}clone(){return new Kn(null,G(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:i,step:r}=t;return{signal:`sequence(${[n,i,...r?[r]:[]].join(",")})`}}static makeFromTransform(t,n){return new Kn(t,n)}static makeFromEncoding(t,n){const i=n.encoding,r=i.x,s=i.y;if(F(r)&&F(s)){const o=r.impute?r:s.impute?s:void 0;if(o===void 0)return;const a=r.impute?s:s.impute?r:void 0,{method:u,value:c,frame:l,keyvals:f}=o.impute,d=Og(n.mark,i);return new Kn(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:o.field,key:a.field},u?{method:u}:{}),c!==void 0?{value:c}:{}),l?{frame:l}:{}),f!==void 0?{keyvals:f}:{}),d.length?{groupby:d}:{}))}return null}hash(){return`Impute ${V(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:i,method:r,groupby:s,value:o,frame:a=[null,null]}=this.transform,u=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},i?{keyvals:x1(i)?this.processSequence(i):i}:{}),{method:"value"}),s?{groupby:s}:{}),{value:!r||r==="value"?o:null});if(r&&r!=="value"){const c=Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[r],fields:[t],frame:a,ignorePeers:!1},s?{groupby:s}:{}),l={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[u,c,l]}else return[u]}}var Gw=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class No extends ne{constructor(t,n){var i,r,s;super(t),this.transform=n,this.transform=G(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.loess]}clone(){return new No(null,G(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${V(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:i}=t,r=Gw(t,["loess","on"]);return Object.assign({type:"loess",x:i,y:n},r)}}class jr extends ne{constructor(t,n,i){super(t),this.transform=n,this.secondary=i}clone(){return new jr(null,G(this.transform),this.secondary)}static make(t,n,i,r){const s=n.component.data.sources,{from:o}=i;let a=null;if(w1(o)){let u=nh(o.data,s);u||(u=new ai(o.data),s.push(u));const c=n.getName(`lookup_${r}`);a=new De(u,c,re.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[c]=a}else if(S1(o)){const u=o.selection;if(i=Object.assign({as:u},i),a=n.getSelectionComponent(ae(u),u).materialized,!a)throw new Error(zb(u))}return new jr(t,i,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?ge(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${V({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:ge(this.transform.as)}:{});else{let n=this.transform.as;W(n)||(O(Xb),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}var Hw=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class ko extends ne{constructor(t,n){var i,r,s;super(t),this.transform=n,this.transform=G(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"prob",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new ko(null,G(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${V(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,i=Hw(t,["quantile"]);return Object.assign({type:"quantile",field:n},i)}}var qw=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Po extends ne{constructor(t,n){var i,r,s;super(t),this.transform=n,this.transform=G(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.regression]}clone(){return new Po(null,G(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${V(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:i}=t,r=qw(t,["regression","on"]);return Object.assign({type:"regression",x:i,y:n},r)}}class Io extends ne{constructor(t,n){super(t),this.transform=n}clone(){return new Io(null,G(this.transform))}addDimensions(t){var n;this.transform.groupby=Ot(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),i=>i)}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${V(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:i,limit:r,op:s}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},r!==void 0?{limit:r}:{}),s!==void 0?{op:s}:{}),i!==void 0?{groupby:i}:{})}}class Ro extends ne{constructor(t,n){super(t),this.transform=n}clone(){return new Ro(null,G(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${V(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function eh(e){let t=0;function n(i,r){var s;if(i instanceof ai&&!i.isGenerator&&!Ar(i.data)&&(e.push(r),r={name:null,source:r.name,transform:[]}),i instanceof Ce&&(i.parent instanceof ai&&!r.source?(r.format=Object.assign(Object.assign({},(s=r.format)!==null&&s!==void 0?s:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof Xi){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source;for(const o of i.assemble())e.push(o);return}switch((i instanceof Xr||i instanceof Yr||i instanceof _r||i instanceof Vi||i instanceof Ii||i instanceof Fr||i instanceof _i||i instanceof ot||i instanceof jr||i instanceof Yi||i instanceof hi||i instanceof To||i instanceof Do||i instanceof $o||i instanceof No||i instanceof ko||i instanceof Po||i instanceof En||i instanceof Ro||i instanceof Io)&&r.transform.push(i.assemble()),(i instanceof wt||i instanceof At||i instanceof Kn||i instanceof Yt)&&r.transform.push(...i.assemble()),i instanceof De&&(r.source&&r.transform.length===0?i.setSource(r.source):i.parent instanceof De?i.setSource(r.name):(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1&&(e.push(r),r={name:null,source:r.name,transform:[]}))),i.numChildren()){case 0:i instanceof De&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const a of i.children)n(a,{name:null,source:o,transform:[]});break}}}return n}function Vw(e){const t=[],n=eh(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function Xw(e,t){var n,i;const r=[],s=eh(r);let o=0;for(const u of e.sources){u.hasName()||(u.dataName=`source_${o++}`);const c=u.assemble();s(u,c)}for(const u of r)u.transform.length===0&&delete u.transform;let a=0;for(const[u,c]of r.entries())((n=c.transform)!==null&&n!==void 0?n:[]).length===0&&!c.source&&r.splice(a++,0,r.splice(u,1)[0]);for(const u of r)for(const c of(i=u.transform)!==null&&i!==void 0?i:[])c.type==="lookup"&&(c.from=e.outputNodes[c.from].getSource());for(const u of r)u.name in t&&(u.values=t[u.name]);return r}function Yw(e){return e==="top"||e==="left"||z(e)?"header":"footer"}function Jw(e){for(const t of Xe)Kw(e,t);Cf(e,"x"),Cf(e,"y")}function Kw(e,t){var n;const{facet:i,config:r,child:s,component:o}=e;if(e.channelHasField(t)){const a=i[t],u=Li("title",null,r,t);let c=Ci(a,r,{allowDisabling:!0,includeDefault:u===void 0||!!u});s.component.layoutHeaders[t].title&&(c=I(c)?c.join(", "):c,c+=" / "+s.component.layoutHeaders[t].title,s.component.layoutHeaders[t].title=null);const l=Li("labelOrient",a,r,t),f=(n=a.header)!==null&&n!==void 0?n:{},d=pe(f.labels,r.header.labels,!0),g=L(["bottom","right"],l)?"footer":"header";o.layoutHeaders[t]={title:c,facetFieldDef:a,[g]:t==="facet"?[]:[th(e,t,d)]}}}function th(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function Cf(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:s}=e.component;if(s.axis[t]=Sc(s,t),s.axis[t]==="shared"){const o=t==="x"?"column":"row",a=r[o];for(const u of i.component.axes[t]){const c=Yw(u.get("orient"));a[c]=(n=a[c])!==null&&n!==void 0?n:[th(e,o,!1)];const l=cr(u,"main",e.config,{header:!0});l&&a[c][0].axes.push(l),u.mainExtracted=!0}}}}function Qw(e){Nc(e),Ps(e,"width"),Ps(e,"height")}function Zw(e){Nc(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";Ps(e,t),Ps(e,n)}function Nc(e){for(const t of e.children)t.parseLayoutSize()}function Ps(e,t){const n=$p(t),i=Zs(n),r=e.component.resolve,s=e.component.layoutSize;let o;for(const a of e.children){const u=a.component.layoutSize.getWithExplicit(n),c=r.scale[i];if(c==="independent"&&u.value==="step"){o=void 0;break}if(o){if(c==="independent"&&o.value!==u.value){o=void 0;break}o=yn(o,u,n,"")}else o=u}if(o){for(const a of e.children)e.renameSignal(a.getName(n),e.getName(t)),a.component.layoutSize.set(n,"merged",!1);s.setWithExplicit(t,o)}else s.setWithExplicit(t,{explicit:!1,value:void 0})}function eS(e){const{size:t,component:n}=e;for(const i of Je){const r=It(i);if(t[r]){const s=t[r];n.layoutSize.set(r,_t(s)?"step":s,!0)}else{const s=tS(e,r);n.layoutSize.set(r,s,!1)}}}function tS(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const s=r.get("type"),o=r.get("range");if(ze(s)){const a=xr(i.view,t);return jn(o)||_t(a)?"step":a}else return ka(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return ka(i.view,t);{const s=xr(i.view,t);return _t(s)?s.step:s}}}var nS=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Ja(e,t,n){return C(t,Object.assign({suffix:`by_${C(e)}`},n!=null?n:{}))}class mr extends Zp{constructor(t,n,i,r){super(t,"facet",n,i,r,t.resolve),this.child=Lc(t.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(t.facet)}initFacet(t){if(!Mr(t))return{facet:this.initFacetFieldDef(t,"facet")};const n=y(t),i={};for(const r of n){if(!L([Ht,qt],r)){O(no(r,"facet"));break}const s=t[r];if(s.field===void 0){O(_a(s,r));break}i[r]=this.initFacetFieldDef(s,r)}return i}initFacetFieldDef(t,n){const{header:i}=t,r=nS(t,["header"]),s=ec(r,n);return i&&(s.header=it(i)),s}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=Lo(this),this.child.parseData()}parseLayoutSize(){Nc(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),Jw(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,i;const r={};for(const s of Xe)for(const o of Ac){const a=this.component.layoutHeaders[s],u=a[o],{facetFieldDef:c}=a;if(c){const l=Li("titleOrient",c.header,this.config,s);if(L(["right","bottom"],l)){const f=_o(s,l);r.titleAnchor=(t=r.titleAnchor)!==null&&t!==void 0?t:{},r.titleAnchor[f]="end"}}if(u!=null&&u[0]){const l=s==="row"?"height":"width",f=o==="header"?"headerBand":"footerBand";s!=="facet"&&!this.child.component.layoutSize.get(l)&&(r[f]=(n=r[f])!==null&&n!==void 0?n:{},r[f][s]=.5),a.title&&(r.offset=(i=r.offset)!==null&&i!==void 0?i:{},r.offset[s==="row"?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:t,row:n}=this.facet,i=t?this.columnDistinctSignal():n?1:void 0;let r="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),i?{columns:i}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof mr))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(t){return this.parent&&this.parent instanceof mr?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:C(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],i=[];if(this.child instanceof mr){if(this.child.channelHasField("column")){const r=C(this.child.facet.column);t.push(r),n.push("distinct"),i.push(`distinct_${r}`)}}else for(const r of Je){const s=this.child.component.scales[r];if(s&&!s.merged){const o=s.get("type"),a=s.get("range");if(ze(o)&&jn(a)){const u=jo(this.child,r),c=$c(u);c?(t.push(c),n.push("distinct"),i.push(`distinct_${c}`)):O(Su(r))}}}return{fields:t,ops:n,as:i}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:i,column:r}=this.facet,{fields:s,ops:o,as:a}=this.getCardinalityAggregateForChild(),u=[];for(const l of Xe){const f=this.facet[l];if(f){u.push(C(f));const{bin:d,sort:g}=f;if(ue(d)&&u.push(C(f,{binSuffix:"end"})),xt(g)){const{field:p,op:m=uo}=g,h=Ja(f,g);i&&r?(s.push(h),o.push("max"),a.push(h)):(s.push(p),o.push(m),a.push(h))}else if(I(g)){const p=Ri(f,l);s.push(p),o.push("max"),a.push(p)}}}const c=!!i&&!!r;return Object.assign({name:t,data:n,groupby:u},c||s.length>0?{aggregate:Object.assign(Object.assign({},c?{cross:c}:{}),s.length?{fields:s,ops:o,as:a}:{})}:{})}facetSortFields(t){const{facet:n}=this,i=n[t];return i?xt(i.sort)?[Ja(i,i.sort,{expr:"datum"})]:I(i.sort)?[Ri(i,t,{expr:"datum"})]:[C(i,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,i=n[t];if(i){const{sort:r}=i;return[(xt(r)?r.order:!I(r)&&r)||"ascending"]}return[]}assembleLabelTitle(){var t;const{facet:n,config:i}=this;if(n.facet)return Ga(n.facet,"facet",i);const r={row:["top","bottom"],column:["left","right"]};for(const s of xc)if(n[s]){const o=Li("labelOrient",(t=n[s])===null||t===void 0?void 0:t.header,i,s);if(L(r[s],o))return Ga(n[s],s,i)}}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,i=Vw(n),r=t.assembleGroupEncodeEntry(!1),s=this.assembleLabelTitle()||t.assembleTitle(),o=t.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},s?{title:s}:{}),o?{style:o}:{}),{from:{facet:this.assembleFacet()},sort:{field:Xe.map(u=>this.facetSortFields(u)).flat(),order:Xe.map(u=>this.facetSortOrder(u)).flat()}}),i.length>0?{data:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup(hE(this,[])))]}getMapping(){return this.facet}}function iS(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const s of[n,i])if(xt(s.sort)){const{field:o,op:a=uo}=s.sort;e=r=new hi(e,{joinaggregate:[{op:a,field:o,as:Ja(s,s.sort,{forAs:!0})}],groupby:[C(s)]})}return r}return null}function nh(e,t){var n,i,r,s;for(const o of t){const a=o.data;if(e.name&&o.hasName()&&e.name!==o.dataName)continue;const u=(n=e.format)===null||n===void 0?void 0:n.mesh,c=(i=a.format)===null||i===void 0?void 0:i.feature;if(u&&c)continue;const l=(r=e.format)===null||r===void 0?void 0:r.feature;if((l||c)&&l!==c)continue;const f=(s=a.format)===null||s===void 0?void 0:s.mesh;if(!((u||f)&&u!==f)){if($s(e)&&$s(a)){if(Gi(e.values,a.values))return o}else if(Ar(e)&&Ar(a)){if(e.url===a.url)return o}else if(Hg(e)&&e.name===o.dataName)return o}}return null}function rS(e,t){if(e.data||!e.parent){if(e.data===null){const i=new ai({values:[]});return t.push(i),i}const n=nh(e.data,t);if(n)return Jn(e.data)||(n.data.format=nd({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new ai(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function sS(e,t,n){var i,r;let s=0;for(const o of t.transforms){let a,u;if(P1(o))u=e=new Ii(e,o),a="derived";else if(Xg(o)){const c=GA(o);u=e=(i=Ce.makeWithAncestors(e,{},c,n))!==null&&i!==void 0?i:e,e=new Vi(e,t,o.filter)}else if(I1(o))u=e=wt.makeFromTransform(e,o,t),a="number";else if(L1(o))a="date",n.getWithExplicit(o.field).value===void 0&&(e=new Ce(e,{[o.field]:a}),n.set(o.field,a,!1)),u=e=At.makeFromTransform(e,o);else if(B1(o))u=e=ot.makeFromTransform(e,o),a="number",yc(t)&&(e=new En(e));else if(A1(o))u=e=jr.make(e,t,o,s++),a="derived";else if(T1(o))u=e=new Yi(e,o),a="number";else if(N1(o))u=e=new hi(e,o),a="number";else if(z1(o))u=e=Yt.makeFromTransform(e,o),a="derived";else if(M1(o))u=e=new To(e,o),a="derived";else if(k1(o))u=e=new Do(e,o),a="derived";else if(C1(o))u=e=new Io(e,o),a="derived";else if(D1(o))e=new Ro(e,o);else if(R1(o))u=e=Kn.makeFromTransform(e,o),a="derived";else if(_1(o))u=e=new $o(e,o),a="derived";else if(F1(o))u=e=new ko(e,o),a="derived";else if(j1(o))u=e=new Po(e,o),a="derived";else if($1(o))u=e=new No(e,o),a="derived";else{O(Vb(o));continue}if(u&&a!==void 0)for(const c of(r=u.producedFields())!==null&&r!==void 0?r:[])n.set(c,a,!1)}return e}function Lo(e){var t,n,i,r,s,o,a,u,c,l;let f=rS(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:g}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new E1,m=e.data;Jn(m)?(qg(m)?f=new Yr(f,m.sequence):gc(m)&&(f=new Xr(f,m.graticule)),p.parseNothing=!0):((t=m==null?void 0:m.format)===null||t===void 0?void 0:t.parse)===null&&(p.parseNothing=!0),f=(n=Ce.makeExplicit(f,e,p))!==null&&n!==void 0?n:f,f=new En(f);const h=e.parent&&Ji(e.parent);(fe(e)||at(e))&&h&&(f=(i=wt.makeFromEncoding(f,e))!==null&&i!==void 0?i:f),e.transforms.length>0&&(f=sS(f,e,p));const E=qA(e),v=HA(e);f=(r=Ce.makeWithAncestors(f,{},Object.assign(Object.assign({},E),v),p))!==null&&r!==void 0?r:f,fe(e)&&(f=_i.parseAll(f,e),f=Fr.parseAll(f,e)),(fe(e)||at(e))&&(h||(f=(s=wt.makeFromEncoding(f,e))!==null&&s!==void 0?s:f),f=(o=At.makeFromEncoding(f,e))!==null&&o!==void 0?o:f,f=Ii.parseAllForSortIndex(f,e));const S=e.getDataName(re.Raw),D=new De(f,S,re.Raw,g);if(d[S]=D,f=D,fe(e)){const B=ot.makeFromEncoding(f,e);B&&(f=B,yc(e)&&(f=new En(f))),f=(a=Kn.makeFromEncoding(f,e))!==null&&a!==void 0?a:f,f=(u=Yt.makeFromEncoding(f,e))!==null&&u!==void 0?u:f}fe(e)&&(f=(c=_r.make(f,e))!==null&&c!==void 0?c:f);const x=e.getDataName(re.Main),N=new De(f,x,re.Main,g);d[x]=N,f=N,fe(e)&&Bx(e,N);let w=null;if(at(e)){const B=e.getName("facet");f=(l=iS(f,e.facet))!==null&&l!==void 0?l:f,w=new Xi(f,e,B,N.getSource()),d[B]=w}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:g,raw:D,main:N,facetRoot:w,ancestorParse:p})}class oS extends Tc{constructor(t,n,i,r){var s,o,a,u;super(t,"concat",n,i,r,t.resolve),(((o=(s=t.resolve)===null||s===void 0?void 0:s.axis)===null||o===void 0?void 0:o.x)==="shared"||((u=(a=t.resolve)===null||a===void 0?void 0:a.axis)===null||u===void 0?void 0:u.y)==="shared")&&O(Gb),this.children=this.getChildren(t).map((c,l)=>Lc(c,this,this.getName("concat_"+l),void 0,r))}parseData(){this.component.data=Lo(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of y(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return yo(t)?t.vconcat:fc(t)?t.hconcat:t.concat}parseLayoutSize(){Zw(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=wc(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),i=t.assembleGroupStyle(),r=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),i?{style:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup())})}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}function aS(e){return e===!1||e===null}const uS=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},ld),{labelExpr:1,encode:1}),ih=y(uS);class kc extends on{constructor(t={},n={},i=!1){super(),this.explicit=t,this.implicit=n,this.mainExtracted=i}clone(){return new kc(G(this.explicit),G(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!aS(this.get(t))}hasOrientSignalRef(){return z(this.explicit.orient)}}function cS(e,t,n){var i;const{encoding:r,config:s}=e,o=(i=ve(r[t]))!==null&&i!==void 0?i:ve(r[Pt(t)]),a=e.axis(t)||{},{format:u,formatType:c}=a;return ni(c)?Object.assign({text:qu({fieldOrDatumDef:o,field:"datum.value",format:u,formatType:c,config:s})},n):n}function lS(e){return Je.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[bS(n,e)]),t),{})}const fS={bottom:"top",top:"bottom",left:"right",right:"left"};function dS(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const s of e.children){s.parseAxesAndHeaders();for(const o of y(s.component.axes))i.axis[o]=Sc(e.component.resolve,o),i.axis[o]==="shared"&&(n[o]=gS(n[o],s.component.axes[o]),n[o]||(i.axis[o]="independent",delete n[o]))}for(const s of Je){for(const o of e.children)if(o.component.axes[s]){if(i.axis[s]==="independent"){n[s]=((t=n[s])!==null&&t!==void 0?t:[]).concat(o.component.axes[s]);for(const a of o.component.axes[s]){const{value:u,explicit:c}=a.getWithExplicit("orient");if(!z(u)){if(r[u]>0&&!c){const l=fS[u];r[u]>r[l]&&a.set("orient",l,!1)}r[u]++}}}delete o.component.axes[s]}if(i.axis[s]==="independent"&&n[s]&&n[s].length>1)for(const o of n[s])o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function gS(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],s=t[i];if(!!r!=!!s)return;if(r&&s){const o=r.getWithExplicit("orient"),a=s.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;e[i]=pS(r,s)}}}else return t.map(n=>n.clone());return e}function pS(e,t){for(const n of ih){const i=yn(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,s)=>{switch(n){case"title":return yg(r,s);case"gridScale":return{explicit:r.explicit,value:pe(r.value,s.value)}}return Oo(r,s,n,"axis")});e.setWithExplicit(n,i)}return e}function hS(e,t,n,i,r){if(t==="disable")return n!==void 0;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(z(n.labelAngle)?n.labelAngle:Or(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===Sp(i,r))return!0}return e===n[t]}const mS=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function bS(e,t){var n,i,r;let s=t.axis(e);const o=new kc,a=ve(t.encoding[e]),{mark:u,config:c}=t,l=(s==null?void 0:s.orient)||((n=c[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((i=c.axis)===null||i===void 0?void 0:i.orient)||Yx(e),f=t.getScaleComponent(e).get("type"),d=Ux(e,f,l,t.config),g=s!==void 0?!s:Ua("disable",c.style,s==null?void 0:s.style,d).configValue;if(o.set("disable",g,s!==void 0),g)return o;s=s||{};const p=qx(a,s,e,c.style,d),m={fieldOrDatumDef:a,axis:s,channel:e,model:t,scaleType:f,orient:l,labelAngle:p,mark:u,config:c};for(const v of ih){const S=v in ff?ff[v](m):hl(v)?s[v]:void 0,D=S!==void 0,x=hS(S,v,s,t,e);if(D&&x)o.set(v,S,x);else{const{configValue:N=void 0,configFrom:w=void 0}=hl(v)&&v!=="values"?Ua(v,c.style,s.style,d):{},B=N!==void 0;D&&!B?o.set(v,S,x):(w!=="vgAxisConfig"||mS.has(v)&&B||Nr(N)||z(N))&&o.set(v,N,!1)}}const h=(r=s.encoding)!==null&&r!==void 0?r:{},E=cd.reduce((v,S)=>{var D;if(!o.hasAxisPart(S))return v;const x=Dp((D=h[S])!==null&&D!==void 0?D:{},t),N=S==="labels"?cS(t,e,x):x;return N!==void 0&&!te(N)&&(v[S]={update:N}),v},{});return te(E)||o.set("encode",E,!!s.encoding||s.labelAngle!==void 0),o}function yS({encoding:e,size:t}){for(const n of Je){const i=It(n);_t(t[i])&&Et(e[n])&&(delete t[i],O(_d(i)))}return t}function vS(e,t,n){const i=it(e),r=Z("orient",i,n);if(i.orient=AS(i.type,t,r),r!==void 0&&r!==i.orient&&O(oy(i.orient,r)),i.type==="bar"&&i.orient){const a=Z("cornerRadiusEnd",i,n);if(a!==void 0){const u=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:Pv[i.orient];for(const c of u)i[c]=a;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}return Z("opacity",i,n)===void 0&&(i.opacity=ES(i.type,t)),Z("cursor",i,n)===void 0&&(i.cursor=OS(i,t,n)),i}function OS(e,t,n){return t.href||e.href||Z("href",e,n)?"pointer":e.cursor}function ES(e,t){if(L([oo,zu,Mu,Uu],e)&&!nc(t))return .7}function xS(e,t,{graticule:n}){if(n)return!1;const i=ii("filled",e,t),r=e.type;return pe(i,r!==oo&&r!==so&&r!==As)}function AS(e,t,n){switch(e){case oo:case Mu:case Uu:case Md:case Cv:case Sv:return}const{x:i,y:r,x2:s,y2:o}=t;switch(e){case ro:if(F(i)&&(je(i.bin)||F(r)&&r.aggregate&&!i.aggregate))return"vertical";if(F(r)&&(je(r.bin)||F(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s&&(F(i)&&i.type===ti&&!ue(i.bin)||Ta(i)))return"horizontal";if(!o&&(F(r)&&r.type===ti&&!ue(r.bin)||Ta(r)))return"vertical"}case As:if(s&&!(F(i)&&je(i.bin))&&o&&!(F(r)&&je(r.bin)))return;case io:if(o)return F(r)&&je(r.bin)?"horizontal":"vertical";if(s)return F(i)&&je(i.bin)?"vertical":"horizontal";if(e===As){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case so:case zu:{const a=Et(i),u=Et(r);if(a&&!u)return e!=="tick"?"horizontal":"vertical";if(!a&&u)return e!=="tick"?"vertical":"horizontal";if(a&&u){const c=i,l=r,f=c.type===Ti,d=l.type===Ti;return f&&!d?e!=="tick"?"vertical":"horizontal":!f&&d?e!=="tick"?"horizontal":"vertical":!c.aggregate&&l.aggregate?e!=="tick"?"vertical":"horizontal":c.aggregate&&!l.aggregate?e!=="tick"?"horizontal":"vertical":n||"vertical"}else return n||void 0}}return"vertical"}const wS={vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ze(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Se("x",e,{defaultPos:"mid"})),Se("y",e,{defaultPos:"mid"})),vn(e,"radius","arc")),vn(e,"theta","arc"))},SS={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},Ze(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),Ds("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),Ds("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),mc(e))},CS={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},Ze(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),vn(e,"x","bar")),vn(e,"y","bar"))},_S={vgMark:"shape",encodeEntry:e=>Object.assign({},Ze(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&F(n)&&n.type===Hi?{field:C(n,{expr:"datum"})}:{})]}},FS={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},Ze(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),vn(e,"x","image")),vn(e,"y","image")),pc(e,"url"))},jS={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ze(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Se("x",e,{defaultPos:"mid"})),Se("y",e,{defaultPos:"mid"})),xe("size",e,{vgChannel:"strokeWidth"})),mc(e))},$S={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ze(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Se("x",e,{defaultPos:"mid"})),Se("y",e,{defaultPos:"mid"})),xe("size",e)),mc(e))};function Pc(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ze(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Se("x",e,{defaultPos:"mid"})),Se("y",e,{defaultPos:"mid"})),xe("size",e)),xe("angle",e)),DS(e,n,t))}function DS(e,t,n){return n?{shape:{value:n}}:xe("shape",e)}const TS={vgMark:"symbol",encodeEntry:e=>Pc(e)},NS={vgMark:"symbol",encodeEntry:e=>Pc(e,"circle")},kS={vgMark:"symbol",encodeEntry:e=>Pc(e,"square")},PS={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},Ze(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),vn(e,"x","rect")),vn(e,"y","rect"))},IS={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},Ze(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Ds("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),Ds("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),xe("size",e,{vgChannel:"strokeWidth"}))}},RS={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ze(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),Se("x",e,{defaultPos:"mid"})),Se("y",e,{defaultPos:"mid"})),pc(e)),xe("size",e,{vgChannel:"fontSize"})),xe("angle",e)),Ql("align",LS(e.markDef,n,t))),Ql("baseline",BS(e.markDef,n,t))),Se("radius",e,{defaultPos:null,isMidPoint:!0})),Se("theta",e,{defaultPos:null,isMidPoint:!0}))}};function LS(e,t,n){if(Z("align",e,n)===void 0)return"center"}function BS(e,t,n){if(Z("baseline",e,n)===void 0)return"middle"}const zS={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",s=i==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ze(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Se("x",e,{defaultPos:"mid",vgChannel:"xc"})),Se("y",e,{defaultPos:"mid",vgChannel:"yc"})),xe("size",e,{defaultValue:MS(e),vgChannel:r})),{[s]:ce(Z("thickness",n,t))})}};function MS(e){var t;const{config:n,markDef:i}=e,{orient:r}=i,s=r==="horizontal"?"width":"height",o=e.getScaleComponent(r==="horizontal"?"x":"y"),a=(t=Z("size",i,n,{vgChannel:s}))!==null&&t!==void 0?t:n.tick.bandSize;if(a!==void 0)return a;{const u=o?o.get("range"):void 0;return u&&jn(u)&&be(u.step)?u.step*3/4:js(n.view,s)*3/4}}const ss={arc:wS,area:SS,bar:CS,circle:NS,geoshape:_S,image:FS,line:jS,point:TS,rect:PS,rule:IS,square:kS,text:RS,tick:zS,trail:$S};function US(e){if(L([so,io,_v],e.mark)){const t=Og(e.mark,e.encoding);if(t.length>0)return WS(e,t)}else if(L([ro],e.mark)){const t=Fa.some(n=>Z(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return GS(e)}return Ic(e)}const _f="faceted_path_";function WS(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:_f+e.requestDataName(re.Main),data:e.requestDataName(re.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:Ic(e,{fromPrefix:_f})}]}const Ff="stack_group_";function GS(e){const[t]=Ic(e,{fromPrefix:Ff}),n=e.scaleName(e.stack.fieldChannel),i=(l={})=>e.vgField(e.stack.fieldChannel,l),r=(l,f)=>{const d=[i({prefix:"min",suffix:"start",expr:f}),i({prefix:"max",suffix:"start",expr:f}),i({prefix:"min",suffix:"end",expr:f}),i({prefix:"max",suffix:"end",expr:f})];return`${l}(${d.map(g=>`scale('${n}',${g})`).join(",")})`};let s,o;e.stack.fieldChannel==="x"?(s=Object.assign(Object.assign({},Fi(t.encode.update,["y","yc","y2","height",...Fa])),{x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}}),o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},Ge(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(s=Object.assign(Object.assign({},Fi(t.encode.update,["x","xc","x2","width"])),{y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}}),o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},Ge(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const l of Fa){const f=ii(l,e.markDef,e.config);t.encode.update[l]?(s[l]=t.encode.update[l],delete t.encode.update[l]):f&&(s[l]=ce(f)),f&&(t.encode.update[l]={value:0})}const a=e.fieldDef(e.stack.groupbyChannel),u=C(a)?[C(a)]:[];return(a!=null&&a.bin||a!=null&&a.timeUnit)&&u.push(C(a,{binSuffix:"end"})),s=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((l,f)=>{if(t.encode.update[f])return Object.assign(Object.assign({},l),{[f]:t.encode.update[f]});{const d=ii(f,e.markDef,e.config);return d!==void 0?Object.assign(Object.assign({},l),{[f]:ce(d)}):l}},s),s.stroke&&(s.strokeForeground={value:!0},s.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(re.Main),name:Ff+e.requestDataName(re.Main),groupby:u,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:s},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}function HS(e){const{encoding:t,stack:n,mark:i,markDef:r,config:s}=e,o=t.order;if(!(!I(o)&&ut(o)&&Sa(o.value)||!o&&Sa(Z("order",r,s)))){if((I(o)||F(o))&&!n)return hg(o,{expr:"datum"});if($n(i)){const a=r.orient==="horizontal"?"y":"x",u=t[a];if(F(u)){const c=u.sort;if(I(c))return{field:C(u,{prefix:a,suffix:"sort_index",expr:"datum"})};if(xt(c))return{field:C({aggregate:nc(e.encoding)?c.op:void 0,field:c.field},{expr:"datum"})};if(eg(c)){const l=e.fieldDef(c.encoding);return{field:C(l,{expr:"datum"}),order:c.order}}else return c===null?void 0:{field:C(u,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}return}}}function Ic(e,t={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:s}=e,o=pe(i.clip,qS(e),VS(e)),a=gg(i),u=r.key,c=HS(e),l=XS(e),f=Z("aria",i,s),d=ss[n].postEncodingTransform?ss[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:ss[n].vgMark},o?{clip:!0}:{}),a?{style:a}:{}),u?{key:u.field}:{}),c?{sort:c}:{}),l||{}),f===!1?{aria:f}:{}),{from:{data:t.fromPrefix+e.requestDataName(re.Main)},encode:{update:ss[n].encodeEntry(e)}}),d?{transform:d}:{})]}function qS(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t&&t.get("selectionExtent")||n&&n.get("selectionExtent")?!0:void 0}function VS(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function XS(e){if(!e.component.selection)return null;const t=y(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=y(i.component.selection).length,i=i.parent;return n?{interactive:t>0||!!e.encoding.tooltip}:null}class rh extends Zp{constructor(t,n,i,r={},s){super(t,"unit",n,i,s,void 0,Il(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const o=Zt(t.mark)?Object.assign({},t.mark):{type:t.mark},a=o.type;o.filled===void 0&&(o.filled=xS(o,s,{graticule:t.data&&gc(t.data)}));const u=this.encoding=cO(t.encoding||{},a,o.filled,s);this.markDef=vS(o,u,s),this.size=yS({encoding:u,size:Il(t)?Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):r}),this.stack=Bg(a,u),this.specifiedScales=this.initScales(a,u),this.specifiedAxes=this.initAxes(u),this.specifiedLegends=this.initLegends(u),this.specifiedProjection=t.projection,this.selection=t.selection}get hasProjection(){const{encoding:t}=this,n=this.mark===Ud,i=t&&vb.some(r=>M(t[r]));return n||i}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return eo.reduce((i,r)=>{var s;const o=ve(n[r]);return o&&(i[r]=this.initScale((s=o.scale)!==null&&s!==void 0?s:{})),i},{})}initScale(t){const{domain:n,range:i}=t,r=it(t);return I(n)&&(r.domain=n.map($e)),I(i)&&(r.range=i.map($e)),r}initAxes(t){return Je.reduce((n,i)=>{const r=t[i];if(M(r)||i===le&&M(t.x2)||i===Oe&&M(t.y2)){const s=M(r)?r.axis:void 0;n[i]=s&&this.initAxis(Object.assign({},s))}return n},{})}initAxis(t){const n=y(t),i={};for(const r of n){const s=t[r];i[r]=Nr(s)?dg(s):$e(s)}return i}initLegends(t){return Fb.reduce((n,i)=>{const r=ve(t[i]);if(r&&$b(i)){const s=r.legend;n[i]=s&&it(s)}return n},{})}parseData(){this.component.data=Lo(this)}parseLayoutSize(){eS(this)}parseSelections(){this.component.selection=Lx(this,this.selection)}parseMarkGroup(){this.component.mark=US(this)}parseAxesAndHeaders(){this.component.axes=lS(this)}assembleSelectionTopLevelSignals(t){return mE(this,t)}assembleSignals(){return[...xp(this),...pE(this,[])]}assembleSelectionData(t){return bE(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return wc(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return(!this.parent||!Ji(this.parent))&&(n=up(this,n)),n.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return Yn(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return Ct(n)}typedFieldDef(t){const n=this.fieldDef(t);return Qe(n)?n:null}}class Rc extends Tc{constructor(t,n,i,r,s){super(t,"layer",n,i,s,t.resolve,t.view);const o=Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((a,u)=>{if(vo(a))return new Rc(a,this,this.getName("layer_"+u),o,s);if(sn(a))return new rh(a,this,this.getName("layer_"+u),o,s);throw new Error(wu(a))})}parseData(){this.component.data=Lo(this);for(const t of this.children)t.parseData()}parseLayoutSize(){Qw(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of y(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){dS(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),xp(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),wc(this))}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t}assembleLayout(){return null}assembleMarks(){return yE(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),Lp(this))}}function Lc(e,t,n,i,r){if(co(e))return new mr(e,t,n,r);if(vo(e))return new Rc(e,t,n,i,r);if(sn(e))return new rh(e,t,n,i,r);if(kO(e))return new oS(e,t,n,r);throw new Error(wu(e))}var YS=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function JS(e,t={}){t.logger&&Dy(t.logger),t.fieldTitle&&ug(t.fieldTitle);try{const n=Lg(Bs(t.config,e.config)),i=Wg(e,n),r=Lc(i,null,"",void 0,n);return r.parse(),uw(r.component.data,r),{spec:QS(r,KS(e,i.autosize,n,r),e.datasets,e.usermeta),normalized:i}}finally{t.logger&&Ty(),t.fieldTitle&&eO()}}function KS(e,t,n,i){const r=i.component.layoutSize.get("width"),s=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):W(t)&&(t={type:t}),r&&s&&y1(t.type)){if(r==="step"&&s==="step")O(vl()),t.type="pad";else if(r==="step"||s==="step"){const o=r==="step"?"width":"height";O(vl(Zs(o)));const a=o==="width"?"height":"width";t.type=v1(a)}}return Object.assign(Object.assign(Object.assign({},y(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),Xl(n,!1)),Xl(e,!0))}function QS(e,t,n={},i){const r=e.config?YO(e.config):void 0,s=[].concat(e.assembleSelectionData([]),Xw(e.component.data,n)),o=e.assembleProjections(),a=e.assembleTitle(),u=e.assembleGroupStyle(),c=e.assembleGroupEncodeEntry(!0);let l=e.assembleLayoutSignals();l=l.filter(g=>(g.name==="width"||g.name==="height")&&g.value!==void 0?(t[g.name]=+g.value,!1):!0);const{params:f}=t,d=YS(t,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),d),a?{title:a}:{}),u?{style:u}:{}),c?{encode:{update:c}}:{}),{data:s}),o.length>0?{projections:o}:{}),e.assembleGroup([...l,...e.assembleSelectionTopLevelSignals([]),...Ig(f)])),r?{config:r}:{}),i?{usermeta:i}:{})}const ZS=Object.freeze(Object.defineProperty({__proto__:null,accessPathDepth:$i,accessPathWithDatum:bu,compile:JS,contains:L,deepEqual:Gi,deleteNestedProperty:Os,duplicate:G,entries:Dr,every:pu,fieldIntersection:mu,flatAccessWithDatum:rd,getFirstDefined:pe,hasIntersection:hu,hash:V,internalField:ad,isBoolean:vr,isEmpty:te,isEqual:ib,isInternalField:ud,isNullOrFalse:Sa,isNumeric:Vs,keys:y,logicalExpr:wi,mergeDeep:nd,normalize:Wg,normalizeAngle:Or,omit:Ge,pick:Fi,prefixGenerator:Ca,removePathFromField:yu,replaceAll:Zn,replacePathInField:Kt,resetIdCounter:sb,setEqual:id,some:ji,stringify:se,titleCase:Tr,unique:Ot,uniqueId:od,vals:Gt,varName:ae,version:Q0},Symbol.toStringTag,{value:"Module"}));function sh(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}var eC="vega-themes",tC="2.10.0",nC="Themes for stylized Vega and Vega-Lite visualizations.",iC=["vega","vega-lite","themes","style"],rC="BSD-3-Clause",sC={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},oC=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],aC="build/vega-themes.js",uC="build/vega-themes.module.js",cC="build/vega-themes.min.js",lC="build/vega-themes.min.js",fC="build/vega-themes.module.d.ts",dC={type:"git",url:"https://github.com/vega/vega-themes.git"},gC=["src","build"],pC={prebuild:"yarn clean",build:"rollup -c",clean:"rimraf build && rimraf examples/build","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",prepare:"beemo create-config",eslintbase:"beemo eslint .",format:"yarn eslintbase --fix",lint:"yarn eslintbase"},hC={"@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^11.2.0","@wessberg/rollup-plugin-ts":"^1.3.8","browser-sync":"^2.26.14",concurrently:"^6.0.0","gh-pages":"^3.1.0",rollup:"^2.39.1","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-terser":"^7.0.2",typescript:"^4.2.2",vega:"^5.19.1","vega-lite":"^5.0.0","vega-lite-dev-config":"^0.16.1"},mC={vega:"*","vega-lite":"*"},bC={name:eC,version:tC,description:nC,keywords:iC,license:rC,author:sC,contributors:oC,main:aC,module:uC,unpkg:cC,jsdelivr:lC,types:fC,repository:dC,files:gC,scripts:pC,devDependencies:hC,peerDependencies:mC};const Oi="#fff",yC="#888",vC={background:"#333",title:{color:Oi,subtitleColor:Oi},style:{"guide-label":{fill:Oi},"guide-title":{fill:Oi}},axis:{domainColor:Oi,gridColor:yC,tickColor:Oi}},In="#4572a7",OC={background:"#fff",arc:{fill:In},area:{fill:In},line:{stroke:In,strokeWidth:2},path:{stroke:In},rect:{fill:In},shape:{stroke:In},symbol:{fill:In,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},Rn="#30a2da",da="#cbcbcb",EC="#999",xC="#333",jf="#f0f0f0",$f="#333",AC={arc:{fill:Rn},area:{fill:Rn},axis:{domainColor:da,grid:!0,gridColor:da,gridWidth:1,labelColor:EC,labelFontSize:10,titleColor:xC,tickColor:da,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:jf,group:{fill:jf},legend:{labelColor:$f,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:$f,titleFontSize:14,titlePadding:10},line:{stroke:Rn,strokeWidth:2},path:{stroke:Rn,strokeWidth:.5},rect:{fill:Rn},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:Rn},bar:{binSpacing:2,fill:Rn,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},Ln="#000",wC={group:{fill:"#e5e5e5"},arc:{fill:Ln},area:{fill:Ln},line:{stroke:Ln},path:{stroke:Ln},rect:{fill:Ln},shape:{stroke:Ln},symbol:{fill:Ln,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},SC=22,CC="normal",Df="Benton Gothic, sans-serif",Tf=11.5,_C="normal",Bn="#82c6df",ga="Benton Gothic Bold, sans-serif",Nf="normal",kf=13,or={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},FC={background:"#ffffff",title:{anchor:"start",color:"#000000",font:ga,fontSize:SC,fontWeight:CC},arc:{fill:Bn},area:{fill:Bn},line:{stroke:Bn,strokeWidth:2},path:{stroke:Bn},rect:{fill:Bn},shape:{stroke:Bn},symbol:{fill:Bn,size:30},axis:{labelFont:Df,labelFontSize:Tf,labelFontWeight:_C,titleFont:ga,titleFontSize:kf,titleFontWeight:Nf},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:Df,labelFontSize:Tf,symbolType:"square",titleFont:ga,titleFontSize:kf,titleFontWeight:Nf},range:{category:or["category-6"],diverging:or["fireandice-6"],heatmap:or["fire-7"],ordinal:or["fire-7"],ramp:or["fire-7"]}},zn="#ab5787",os="#979797",jC={background:"#f9f9f9",arc:{fill:zn},area:{fill:zn},line:{stroke:zn},path:{stroke:zn},rect:{fill:zn},shape:{stroke:zn},symbol:{fill:zn,size:30},axis:{domainColor:os,domainWidth:.5,gridWidth:.2,labelColor:os,tickColor:os,tickWidth:.2,titleColor:os},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},Mn="#3e5c69",$C={background:"#fff",arc:{fill:Mn},area:{fill:Mn},line:{stroke:Mn},path:{stroke:Mn},rect:{fill:Mn},shape:{stroke:Mn},symbol:{fill:Mn},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},Ve="#1696d2",Pf="#000000",DC="#FFFFFF",as="Lato",pa="Lato",TC="Lato",NC="#DEDDDD",kC=18,ar={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},PC={background:DC,title:{anchor:"start",fontSize:kC,font:as},axisX:{domain:!0,domainColor:Pf,domainWidth:1,grid:!1,labelFontSize:12,labelFont:pa,labelAngle:0,tickColor:Pf,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:as},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:NC,gridWidth:1,labelFontSize:12,labelFont:pa,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:as,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:pa,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:as,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:ar["six-groups-cat-1"],diverging:ar["diverging-colors"],heatmap:ar["diverging-colors"],ordinal:ar["six-groups-seq"],ramp:ar["shades-blue"]},area:{fill:Ve},rect:{fill:Ve},line:{color:Ve,stroke:Ve,strokeWidth:5},trail:{color:Ve,stroke:Ve,strokeWidth:0,size:1},path:{stroke:Ve,strokeWidth:.5},point:{filled:!0},text:{font:TC,color:Ve,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:Ve,stroke:null}},arc:{fill:Ve},shape:{stroke:Ve},symbol:{fill:Ve,size:30}},Un="#3366CC",If="#ccc",us="Arial, sans-serif",IC={arc:{fill:Un},area:{fill:Un},path:{stroke:Un},rect:{fill:Un},shape:{stroke:Un},symbol:{stroke:Un},circle:{fill:Un},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:us,fontSize:12},"guide-title":{font:us,fontSize:12},"group-title":{font:us,fontSize:12}},title:{font:us,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:If,tickColor:If,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},RC=bC.version,LC=Object.freeze(Object.defineProperty({__proto__:null,dark:vC,excel:OC,fivethirtyeight:AC,ggplot2:wC,googlecharts:IC,latimes:FC,quartz:jC,urbaninstitute:PC,version:RC,vox:$C},Symbol.toStringTag,{value:"Module"}));var BC=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element img {
    max-width: 200px;
    max-height: 200px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;const oh="vg-tooltip-element",zC={offsetX:10,offsetY:10,id:oh,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:MC,maxDepth:2};function MC(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function UC(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return BC.toString().replace(oh,e)}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function WC(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function GC(e,t,n){if(I(e))return`[${e.map(i=>t(W(i)?i:Rf(i,n))).join(", ")}]`;if(ye(e)){let i="";const r=e,{title:s,image:o}=r,a=WC(r,["title","image"]);s&&(i+=`<h2>${t(s)}</h2>`),o&&(i+=`<img src="${t(o)}">`);const u=Object.keys(a);if(u.length>0){i+="<table>";for(const c of u){let l=a[c];l!==void 0&&(ye(l)&&(l=Rf(l,n)),i+=`<tr><td class="key">${t(c)}:</td><td class="value">${t(l)}</td></tr>`)}i+="</table>"}return i||"{}"}return t(e)}function HC(e){const t=[];return function(n,i){if(typeof i!="object"||i===null)return i;const r=t.indexOf(this)+1;return t.length=r,t.length>e?"[Object]":t.indexOf(i)>=0?"[Circular]":(t.push(i),i)}}function Rf(e,t){return JSON.stringify(e,HC(t))}function qC(e,t,n,i){let r=e.clientX+n;r+t.width>window.innerWidth&&(r=+e.clientX-n-t.width);let s=e.clientY+i;return s+t.height>window.innerHeight&&(s=+e.clientY-i-t.height),{x:r,y:s}}class VC{constructor(t){this.options=Object.assign(Object.assign({},zC),t);const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const i=document.createElement("style");i.setAttribute("id",this.options.styleId),i.innerHTML=UC(n);const r=document.head;r.childNodes.length>0?r.insertBefore(i,r.childNodes[0]):r.appendChild(i)}}tooltipHandler(t,n,i,r){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(document.fullscreenElement!=null?document.fullscreenElement:document.body).appendChild(this.el),r==null||r===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=GC(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:o,y:a}=qC(n,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${o}px`)}}function XC(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Lf(e,t,n,i,r,s,o){try{var a=e[s](o),u=a.value}catch(c){n(c);return}a.done?t(u):Promise.resolve(u).then(i,r)}function Is(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){var s=e.apply(t,n);function o(u){Lf(s,i,r,o,a,"next",u)}function a(u){Lf(s,i,r,o,a,"throw",u)}o(void 0)})}}var ah=Object.prototype,qn=ah.hasOwnProperty,vt,Bc=typeof Symbol=="function"?Symbol:{},Bo=Bc.iterator||"@@iterator",YC=Bc.asyncIterator||"@@asyncIterator",Rs=Bc.toStringTag||"@@toStringTag";function uh(e,t,n,i){var r=t&&t.prototype instanceof Ka?t:Ka,s=Object.create(r.prototype),o=new Qa(i||[]);return s._invoke=e_(e,n,o),s}function zc(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(i){return{type:"throw",arg:i}}}var Bf="suspendedStart",JC="suspendedYield",zf="executing",cs="completed",rt={};function Ka(){}function zo(){}function Bi(){}var Mc={};Mc[Bo]=function(){return this};var ha=Object.getPrototypeOf,ls=ha&&ha(ha(Uc([])));ls&&ls!==ah&&qn.call(ls,Bo)&&(Mc=ls);var Ki=Bi.prototype=Ka.prototype=Object.create(Mc);zo.prototype=Ki.constructor=Bi;Bi.constructor=zo;Bi[Rs]=zo.displayName="GeneratorFunction";function ch(e){["next","throw","return"].forEach(function(t){e[t]=function(n){return this._invoke(t,n)}})}function lh(e){var t=typeof e=="function"&&e.constructor;return t?t===zo||(t.displayName||t.name)==="GeneratorFunction":!1}function KC(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,Bi):(e.__proto__=Bi,Rs in e||(e[Rs]="GeneratorFunction")),e.prototype=Object.create(Ki),e}function QC(e){return{__await:e}}function Mo(e,t){function n(s,o,a,u){var c=zc(e[s],e,o);if(c.type==="throw")u(c.arg);else{var l=c.arg,f=l.value;return f&&typeof f=="object"&&qn.call(f,"__await")?t.resolve(f.__await).then(function(d){n("next",d,a,u)},function(d){n("throw",d,a,u)}):t.resolve(f).then(function(d){l.value=d,a(l)},function(d){return n("throw",d,a,u)})}}var i;function r(s,o){function a(){return new t(function(u,c){n(s,o,u,c)})}return i=i?i.then(a,a):a()}this._invoke=r}ch(Mo.prototype);Mo.prototype[YC]=function(){return this};function ZC(e,t,n,i,r){r===void 0&&(r=Promise);var s=new Mo(uh(e,t,n,i),r);return lh(t)?s:s.next().then(function(o){return o.done?o.value:s.next()})}function e_(e,t,n){var i=Bf;return function(s,o){if(i===zf)throw new Error("Generator is already running");if(i===cs){if(s==="throw")throw o;return dh()}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=fh(a,n);if(u){if(u===rt)continue;return u}}if(n.method==="next")n.sent=n._sent=n.arg;else if(n.method==="throw"){if(i===Bf)throw i=cs,n.arg;n.dispatchException(n.arg)}else n.method==="return"&&n.abrupt("return",n.arg);i=zf;var c=zc(e,t,n);if(c.type==="normal"){if(i=n.done?cs:JC,c.arg===rt)continue;return{value:c.arg,done:n.done}}else c.type==="throw"&&(i=cs,n.method="throw",n.arg=c.arg)}}}function fh(e,t){var n=e.iterator[t.method];if(n===vt){if(t.delegate=null,t.method==="throw"){if(e.iterator.return&&(t.method="return",t.arg=vt,fh(e,t),t.method==="throw"))return rt;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return rt}var i=zc(n,e.iterator,t.arg);if(i.type==="throw")return t.method="throw",t.arg=i.arg,t.delegate=null,rt;var r=i.arg;if(!r)return t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,rt;if(r.done)t[e.resultName]=r.value,t.next=e.nextLoc,t.method!=="return"&&(t.method="next",t.arg=vt);else return r;return t.delegate=null,rt}ch(Ki);Ki[Rs]="Generator";Ki[Bo]=function(){return this};Ki.toString=function(){return"[object Generator]"};function t_(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function ma(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Qa(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(t_,this),this.reset(!0)}function n_(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function i(){for(;t.length;){var r=t.pop();if(r in e)return i.value=r,i.done=!1,i}return i.done=!0,i}}function Uc(e){if(e){var t=e[Bo];if(t)return t.call(e);if(typeof e.next=="function")return e;if(!isNaN(e.length)){var n=-1,i=function r(){for(;++n<e.length;)if(qn.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=vt,r.done=!0,r};return i.next=i}}return{next:dh}}function dh(){return{value:vt,done:!0}}Qa.prototype={constructor:Qa,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=vt,this.done=!1,this.delegate=null,this.method="next",this.arg=vt,this.tryEntries.forEach(ma),!t)for(var n in this)n.charAt(0)==="t"&&qn.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=vt)},stop:function(){this.done=!0;var t=this.tryEntries[0],n=t.completion;if(n.type==="throw")throw n.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(c,l){return o.type="throw",o.arg=t,n.next=c,l&&(n.method="next",n.arg=vt),!!l}for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r],o=s.completion;if(s.tryLoc==="root")return i("end");if(s.tryLoc<=this.prev){var a=qn.call(s,"catchLoc"),u=qn.call(s,"finallyLoc");if(a&&u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(a){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else if(u){if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,n){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&qn.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&(t==="break"||t==="continue")&&s.tryLoc<=n&&n<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=n,s?(this.method="next",this.next=s.finallyLoc,rt):this.complete(o)},complete:function(t,n){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&n&&(this.next=n),rt},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),ma(i),rt}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc===t){var r=i.completion;if(r.type==="throw"){var s=r.arg;ma(i)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:Uc(t),resultName:n,nextLoc:i},this.method==="next"&&(this.arg=vt),rt}};var hn={wrap:uh,isGeneratorFunction:lh,AsyncIterator:Mo,mark:KC,awrap:QC,async:ZC,keys:n_,values:Uc};function i_(e,t,n){var i=e.open(t),r=1e4,s=250,o=new URL(t),a=o.origin,u=~~(r/s);function c(f){f.source===i&&(u=0,e.removeEventListener("message",c,!1))}e.addEventListener("message",c,!1);function l(){u<=0||(i.postMessage(n,a),setTimeout(l,s),u-=1)}setTimeout(l,s)}var r_=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box; }
  .vega-embed.has-actions {
    padding-right: 38px; }
  .vega-embed details:not([open]) > :not(summary) {
    display: none !important; }
  .vega-embed summary {
    list-style: none;
    position: absolute;
    top: 0;
    right: 0;
    padding: 6px;
    z-index: 1000;
    background: white;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    color: #1b1e23;
    border: 1px solid #aaa;
    border-radius: 999px;
    opacity: 0.2;
    transition: opacity 0.4s ease-in;
    outline: none;
    cursor: pointer;
    line-height: 0px; }
    .vega-embed summary::-webkit-details-marker {
      display: none; }
    .vega-embed summary:active {
      box-shadow: #aaa 0px 0px 0px 1px inset; }
    .vega-embed summary svg {
      width: 14px;
      height: 14px; }
  .vega-embed details[open] summary {
    opacity: 0.7; }
  .vega-embed:hover summary,
  .vega-embed:focus summary {
    opacity: 1 !important;
    transition: opacity 0.2s ease; }
  .vega-embed .vega-actions {
    position: absolute;
    z-index: 1001;
    top: 35px;
    right: -9px;
    display: flex;
    flex-direction: column;
    padding-bottom: 8px;
    padding-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
    border: 1px solid #d9d9d9;
    background: white;
    animation-duration: 0.15s;
    animation-name: scale-in;
    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
    text-align: left; }
    .vega-embed .vega-actions a {
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      color: #434a56;
      text-decoration: none; }
      .vega-embed .vega-actions a:hover {
        background-color: #f7f7f9;
        color: black; }
    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
      content: "";
      display: inline-block;
      position: absolute; }
    .vega-embed .vega-actions::before {
      left: auto;
      right: 14px;
      top: -16px;
      border: 8px solid #0000;
      border-bottom-color: #d9d9d9; }
    .vega-embed .vega-actions::after {
      left: auto;
      right: 15px;
      top: -14px;
      border: 7px solid #0000;
      border-bottom-color: #fff; }
  .vega-embed .chart-wrapper.fit-x {
    width: 100%; }
  .vega-embed .chart-wrapper.fit-y {
    height: 100%; }

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px; }

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6); }
  to {
    opacity: 1;
    transform: scale(1); } }
`;String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});function gh(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,s=n;r<s.length;r++){var o=s[r];s_(e,o)}return e}function s_(e,t){for(var n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];qf(e,r,t[r],!0)}}var ba;function Mf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function mn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Mf(Object(n),!0).forEach(function(i){XC(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mf(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var pn=Oh,$r=ZS,fs=typeof window<"u"?window:void 0;$r===void 0&&fs!==null&&fs!==void 0&&(ba=fs.vl)!==null&&ba!==void 0&&ba.compile&&($r=fs.vl);var o_={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},a_={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},fr={vega:"Vega","vega-lite":"Vega-Lite"},Ls={vega:pn.version,"vega-lite":$r?$r.version:"not available"},u_={vega:e=>e,"vega-lite":(e,t)=>$r.compile(e,{config:t}).spec},c_=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,l_="chart-wrapper";function f_(e){return typeof e=="function"}function Uf(e,t,n,i){var r="<html><head>".concat(t,'</head><body><pre><code class="json">'),s="</code></pre>".concat(n,"</body></html>"),o=window.open("");o.document.write(r+e+s),o.document.title="".concat(fr[i]," JSON Source")}function d_(e,t){if(e.$schema){var n=sh(e.$schema);if(t&&t!==n.library){var i;console.warn("The given visualization spec is written in ".concat(fr[n.library],", but mode argument sets ").concat((i=fr[t])!==null&&i!==void 0?i:t,"."))}var r=n.library;return td.satisfies(Ls[r],"^".concat(n.version.slice(1)))||console.warn("The input spec uses ".concat(fr[r]," ").concat(n.version,", but the current version of ").concat(fr[r]," is v").concat(Ls[r],".")),r}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t!=null?t:"vega"}function g_(e){return!!(e&&"load"in e)}function Wf(e){return g_(e)?e:pn.loader(e)}function Gf(e){var t;return(t=e.usermeta&&e.usermeta.embedOptions)!==null&&t!==void 0?t:{}}function O_(e,t){return Za.apply(this,arguments)}function Za(){return Za=Is(hn.mark(function e(t,n){var i,r,s,o,a,u,c,l,f,d,g=arguments;return hn.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(s=g.length>2&&g[2]!==void 0?g[2]:{},!W(n)){m.next=10;break}return a=Wf(s.loader),m.t0=JSON,m.next=6,a.load(n);case 6:m.t1=m.sent,o=m.t0.parse.call(m.t0,m.t1),m.next=11;break;case 10:o=n;case 11:return u=Gf(o).loader,(!a||u)&&(a=Wf((c=s.loader)!==null&&c!==void 0?c:u)),m.next=15,Hf(Gf(o),a);case 15:return l=m.sent,m.next=18,Hf(s,a);case 18:return f=m.sent,d=mn(mn({},gh(f,l)),{},{config:Bs((i=f.config)!==null&&i!==void 0?i:{},(r=l.config)!==null&&r!==void 0?r:{})}),m.next=22,h_(t,o,d,a);case 22:return m.abrupt("return",m.sent);case 23:case"end":return m.stop()}},e)})),Za.apply(this,arguments)}function Hf(e,t){return eu.apply(this,arguments)}function eu(){return eu=Is(hn.mark(function e(t,n){var i,r,s;return hn.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!W(t.config)){a.next=8;break}return a.t1=JSON,a.next=4,n.load(t.config);case 4:a.t2=a.sent,a.t0=a.t1.parse.call(a.t1,a.t2),a.next=9;break;case 8:a.t0=(i=t.config)!==null&&i!==void 0?i:{};case 9:if(r=a.t0,!W(t.patch)){a.next=18;break}return a.t4=JSON,a.next=14,n.load(t.patch);case 14:a.t5=a.sent,a.t3=a.t4.parse.call(a.t4,a.t5),a.next=19;break;case 18:a.t3=t.patch;case 19:return s=a.t3,a.abrupt("return",mn(mn(mn({},t),s?{patch:s}:{}),r?{config:r}:{}));case 21:case"end":return a.stop()}},e)})),eu.apply(this,arguments)}function p_(e){var t=e.getRootNode?e.getRootNode():document;if(t instanceof ShadowRoot)return{root:t,rootContainer:t};var n;return{root:document,rootContainer:(n=document.head)!==null&&n!==void 0?n:document.body}}function h_(e,t){return tu.apply(this,arguments)}function tu(){return tu=Is(hn.mark(function e(t,n){var i,r,s,o,a,u,c,l,f,d,g,p,m,h,E,v,S,D,x,N,w,B,K,ie,_,A,R,j,k,$,P,H,U,q,he,Q,qe,et,Nn,mi,bi,kn,an,Qi,Zi,un,er,ht=arguments;return hn.wrap(function(cn){for(;;)switch(cn.prev=cn.next){case 0:if(er=function(){q&&document.removeEventListener("click",q),j.finalize()},u=ht.length>2&&ht[2]!==void 0?ht[2]:{},c=ht.length>3?ht[3]:void 0,l=u.theme?Bs(LC[u.theme],(i=u.config)!==null&&i!==void 0?i:{}):u.config,f=Mi(u.actions)?u.actions:gh({},o_,(r=u.actions)!==null&&r!==void 0?r:{}),d=mn(mn({},a_),u.i18n),g=(s=u.renderer)!==null&&s!==void 0?s:"canvas",p=(o=u.logLevel)!==null&&o!==void 0?o:pn.Warn,m=(a=u.downloadFileName)!==null&&a!==void 0?a:"visualization",h=typeof t=="string"?document.querySelector(t):t,h){cn.next=12;break}throw new Error("".concat(t," does not exist"));case 12:return u.defaultStyle!==!1&&(E="vega-embed-style",v=p_(h),S=v.root,D=v.rootContainer,S.getElementById(E)||(x=document.createElement("style"),x.id=E,x.innerText=u.defaultStyle===void 0||u.defaultStyle===!0?r_.toString():u.defaultStyle,D.appendChild(x))),N=d_(n,u.mode),w=u_[N](n,l),N==="vega-lite"&&w.$schema&&(B=sh(w.$schema),td.satisfies(Ls.vega,"^".concat(B.version.slice(1)))||console.warn("The compiled spec uses Vega ".concat(B.version,", but current version is v").concat(Ls.vega,"."))),h.classList.add("vega-embed"),f&&h.classList.add("has-actions"),h.innerHTML="",K=h,f&&(ie=document.createElement("div"),ie.classList.add(l_),h.appendChild(ie),K=ie),_=u.patch,_&&(_ instanceof Function?w=_(w):w=zs(w,_,!0,!1).newDocument),u.formatLocale&&pn.formatLocale(u.formatLocale),u.timeFormatLocale&&pn.timeFormatLocale(u.timeFormatLocale),A=u.ast,R=pn.parse(w,N==="vega-lite"?{}:l,{ast:A}),j=new(u.viewClass||pn.View)(R,mn({loader:c,logLevel:p,renderer:g},A?{expr:pn.expressionInterpreter}:{})),j.addSignalListener("autosize",(mt,Pe)=>{var Me=Pe.type;Me=="fit-x"?(K.classList.add("fit-x"),K.classList.remove("fit-y")):Me=="fit-y"?(K.classList.remove("fit-x"),K.classList.add("fit-y")):Me=="fit"?K.classList.add("fit-x","fit-y"):K.classList.remove("fit-x","fit-y")}),u.tooltip!==!1&&(f_(u.tooltip)?k=u.tooltip:k=new VC(u.tooltip===!0?{}:u.tooltip).call,j.tooltip(k)),$=u.hover,$===void 0&&($=N==="vega"),$&&(P=typeof $=="boolean"?{}:$,H=P.hoverSet,U=P.updateSet,j.hover(H,U)),u&&(u.width!=null&&j.width(u.width),u.height!=null&&j.height(u.height),u.padding!=null&&j.padding(u.padding)),cn.next=36,j.initialize(K,u.bind).runAsync();case 36:if(f!==!1){if(he=h,u.defaultStyle!==!1&&(Q=document.createElement("details"),Q.title=d.CLICK_TO_VIEW_ACTIONS,h.append(Q),he=Q,qe=document.createElement("summary"),qe.innerHTML=c_,Q.append(qe),q=mt=>{Q.contains(mt.target)||Q.removeAttribute("open")},document.addEventListener("click",q)),et=document.createElement("div"),he.append(et),et.classList.add("vega-actions"),f===!0||f.export!==!1)for(Nn=function(){var Pe=bi[mi];if(f===!0||f.export===!0||f.export[Pe]){var Me=d["".concat(Pe.toUpperCase(),"_ACTION")],yi=document.createElement("a");yi.text=Me,yi.href="#",yi.target="_blank",yi.download="".concat(m,".").concat(Pe),yi.addEventListener("mousedown",function(){var ph=Is(hn.mark(function Wc(hh){var Gc;return hn.wrap(function(tr){for(;;)switch(tr.prev=tr.next){case 0:return hh.preventDefault(),tr.next=3,j.toImageURL(Pe,u.scaleFactor);case 3:Gc=tr.sent,this.href=Gc;case 5:case"end":return tr.stop()}},Wc,this)}));return function(Wc){return ph.apply(this,arguments)}}()),et.append(yi)}},mi=0,bi=["svg","png"];mi<bi.length;mi++)Nn();(f===!0||f.source!==!1)&&(kn=document.createElement("a"),kn.text=d.SOURCE_ACTION,kn.href="#",kn.addEventListener("click",function(mt){var Pe,Me;Uf(Wo(n),(Pe=u.sourceHeader)!==null&&Pe!==void 0?Pe:"",(Me=u.sourceFooter)!==null&&Me!==void 0?Me:"",N),mt.preventDefault()}),et.append(kn)),N==="vega-lite"&&(f===!0||f.compiled!==!1)&&(an=document.createElement("a"),an.text=d.COMPILED_ACTION,an.href="#",an.addEventListener("click",function(mt){var Pe,Me;Uf(Wo(w),(Pe=u.sourceHeader)!==null&&Pe!==void 0?Pe:"",(Me=u.sourceFooter)!==null&&Me!==void 0?Me:"","vega"),mt.preventDefault()}),et.append(an)),(f===!0||f.editor!==!1)&&(Zi=(Qi=u.editorUrl)!==null&&Qi!==void 0?Qi:"https://vega.github.io/editor/",un=document.createElement("a"),un.text=d.EDITOR_ACTION,un.href="#",un.addEventListener("click",function(mt){i_(window,Zi,{config:l,mode:N,renderer:g,spec:Wo(n)}),mt.preventDefault()}),et.append(un))}return cn.abrupt("return",{view:j,spec:n,vgSpec:w,finalize:er});case 38:case"end":return cn.stop()}},e)})),tu.apply(this,arguments)}export{o_ as DEFAULT_ACTIONS,O_ as default,d_ as guessMode,pn as vega,$r as vegaLite};
